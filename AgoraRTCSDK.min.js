/*! AgoraRTC|BUILD v3.6.11-0-gbdacc5f-dirty */ !function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("AgoraRTC",[],n):"object"==typeof exports?exports.AgoraRTC=n():t.AgoraRTC=n()}(window,function(){return function(t){var n={};function i(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=n,i.d=function(t,n,r){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n||4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)i.d(r,o,(function(n){return t[n]}).bind(null,o));return r},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=96)}([function(t,n,i){"use strict";i.r(n);var r,o=i(11),a=i.n(o),s=function(){var t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()},c=i(14),d=i(2),u=i(1),l=i(48),f=i.n(l),p=i(49),_=i.n(p),g=Array(32).fill(void 0);function h(t){return g[t]}g.push(void 0,null,!0,!1);var m=g.length;function v(t){var n,i=h(t);return(n=t)<36||(g[n]=m,m=n),i}var $=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});$.decode();var E=null;function S(){return null!==E&&E.buffer===r.memory.buffer||(E=new Uint8Array(r.memory.buffer)),E}function y(t,n){return $.decode(S().subarray(t,t+n))}function R(t){m===g.length&&g.push(g.length+1);var n=m;return m=g[n],g[n]=t,n}var T=0,I=new TextEncoder("utf-8"),A="function"==typeof I.encodeInto?function(t,n){return I.encodeInto(t,n)}:function(t,n){var i=I.encode(t);return n.set(i),{read:t.length,written:i.length}},C=null;function b(){return null!==C&&C.buffer===r.memory.buffer||(C=new Int32Array(r.memory.buffer)),C}var N,O=function(){function t(){f()(this,t)}return _()(t,[{key:"free",value:function(){var t=this.ptr;this.ptr=0,r.__wbg_signmanager_free(t)}},{key:"get_digest",value:function(t){return v(r.signmanager_get_digest(this.ptr,R(t)))}}],[{key:"__wrap",value:function(n){var i=Object.create(t.prototype);return i.ptr=n,i}},{key:"new",value:function(){var n=r.signmanager_new();return t.__wrap(n)}}]),t}(),w=!1,L=null,k=0,D="free",P=[],M=[],x=0;(L?Promise.resolve(L):new Promise(function(t){w||r||(function t(){var n={wbg:{}};n.wbg.__wbindgen_object_drop_ref=function(t){v(t)},n.wbg.__wbindgen_string_new=function(t,n){return R(y(t,n))},n.wbg.__wbindgen_string_get=function(t,n){var i=h(n),o="string"==typeof i?i:void 0,a=null==o?0:function(t,n,i){if(void 0===i){var r=I.encode(t),o=n(r.length);return S().subarray(o,o+r.length).set(r),T=r.length,o}for(var a=t.length,s=(o=n(a),S()),c=0;c<a;c++){var d=t.charCodeAt(c);if(d>127)break;s[o+c]=d}if(c!==a){0!==c&&(t=t.slice(c)),o=i(o,a,a=c+3*t.length);var u=S().subarray(o+c,o+a);c+=A(t,u).written}return T=c,o}(o,r.__wbindgen_malloc,r.__wbindgen_realloc),s=T;b()[t/4+1]=s,b()[t/4+0]=a},n.wbg.__wbindgen_throw=function(t,n){throw Error(y(t,n))};for(var i=Uint8Array.from(atob("55ZBgM/2Bzm2JGhNn//ljJsSorhWUYE66a1Hf8O7pfQGR2zfol8qRP6CDhsi3iG7nFZu9stSyPq/qu2Rr2w8QkTGP6Gm2cg3J5qsQgq5bcHA9mDpGv/b24uEwsixZVl1eGkdV4SB/6ayw2v48hLmNA+w5UlnTCiWwerzESQPidpSUMbamXL3pU815EQm12GhhZ9aWzo568gdZvXevBc/WHfFKQSuTgWva4e4eSmW7UxpH8sY4HlDsCTMu0WwEB8B95XsZwOp3GLgfOQmJBw036DgIKU+XGn4KpIEq77WE/h6R7sZKsFUp+u+2cDnW7IPNe7xfd9areFo0EUh0/9K9CqxUkLqMB5hlgS1fwQHRzKPhQ7gALyc6HwMCPooS0M1NrzjdfH3vUn0PeQ1GBlnrnXgiu8TunfHg5TcbBfPEbxbyiiow1Np+VEBlHNh00PiAWyu024NHaPbDGfMtzu4WF02fgkh8Pxb7bCSpCZndjTytQgAzfZxk2bbe6NoHHFnsviqYzHVpxoPEk7icHRWcZC28d2muthq673KCMQay1fJcPqSTuYhWUZS5eylIguT33lP+TBbOWQI8KtCzBN5FzqILfKzRkzrJ3L192BUF8SILdwmriv10HU9ZlQAyQA1VdegnzOl/dYk2GGsB3724y7w/7aJLHJzEfwrfIzFd5CoAft7ct+zQW2G4Wm2kpoz6uJfgrNyykQgwCO6pkPy1ADrBUuJon9ySjhgcFru6AKa99wTlIhzBw3FKFt9Aa1/1KWWy7W1wAIGzRTs/7rLXRkKFjNqGVXBdoVNTpHFtfEFsuX0X98ISr0Bennlx0h2Yl/CGNb5Kc7i3bio1XJHX24avcMsEAwfdfskCki4/dkStn7QC97YJC3z+7gD84IiEEeGcnn7gHJyeALr0ssbqDUcKqxEyheyFs9FToJziLB+eYw6nMQLmYTrQyrg3b+3YBdgx7pzNEDSyz3tmaPaikwcLSyB/Igo6U/oP/fS2TZLtmN03m4iS76YrDJAgI+2W1GboabuixVcLdxm6SQ4CzUnHSPl1knhcGhW/+OcKa53tB5j5C4wEpiENv6T9PUu4K0YwtEAqFbd/eN2wVAYCKn/nlVA8uiESxCfgs0411mRFk4i1pixJLPP5AFPG9QFZnj6X19TqmhmIhl8D6Q1rOvPCqPZV/z04HjayX4qPzPzP/5NVilN/sHhQe7ulriGmU/3rj5QEuiOymsL7EdCQMc/4mXDPdVrDBfbt6dnv11oLYGmqOP1oSBj02FtsmYrMn9pRg7HJoCh86jAnzuOYn4tGnQ4gw/89sb64NAXcoIbTIjyiHBAQCCK2Yn4I/fNF10rkQlvSvkpqLG2eYpJmpWrcouNDEUtJFR607oNraLdmUKyLc1g7SNpS+ofp1FL6rua/HFSrb5kTF2Vcy2gl+6MACbFRChKoP/un7IbYJuOima/JWFZcs/MXokIx+ijuqjMtVKaYRTzNI5ncPa2y/EXTNdUUFpMhbE7sa39Uoh6Hci/viXy2KFTNbiw+BkWOPnyOr04LjIYKlJ8ud/KvjuvNUGQOHJvj6tpZJxj97tr0OrgZCAxSHGU5JQfqEd/U0QfzGM8Wh3zdsnd9LhoIIRJAtyA2PmjwJk4zTxeYlgwPqAVTU3+9bA1QD+jLZZ3Ffk3MRq+Ar2RT8YN6ASR4bItt3omBj0LJe0zeGY3OzfhljL6LA1m4+IUp+CzeWo0aEjnvRk3iCJeajgdC+NUGB5qh8PWKtBeC58woavnRjvRNphXS4b9M7Aymcfq26B2YY2lS+wLf763OnGJlVdV/srgyAUJJZjarxom4zrYy23kLFB8zFzWuwSMue5Xm1YWape91JGDuRLIctrJWU47/XfLm6Zgei4xOwq1RcjikGuaZtDwcFg9aKtO+JOGJsCjy9AiPnmt+rmdX83GsT3KtTETnLv6ZQcnGtmt4H8AjFgGYePdQc40cj8VAOV8NCLspyW5w63b3g37GXJrzjm9Fym3fh27psjo5RuTs7XCSrNENxKm9jCcXPqWxyuXJSn6dhdWnw5SAnUjixXviWS4HsnYjw4Xt4cSwkqCB9naLstVXt5D2HgG4fzHFNHvnETft0mrhU81IBDTSyNFdDvFEX8cifoc6FcNq7pzXlotl2ZS1FIzNXddZrdXpBNYZPV52gtCok6ePpUR/Y8jyJpE9P3q8dmFVivVGgmKTcBKMDDbzeOfl4MpOGBtBX/Lab/kzqG42sTyOyGUyOoFXYGMUWJ33GPI2KNa/mW8zVl+imshfbj7PiK1qRUn74KjAkH4wjKnu50AONYUaiveSdwnEc1zCjZSJ3dmBKSxhWAcO2PdHBg5m9+JCiPGCVfK9dzoM8Bm7xx9noJiqt4hNiVa5di1Fd1JRN4rnd1DbKglKpAVSoqvJPxmuyH56TFE4BQjhfKbDMZezQJqx+KXDiW1JWGeDYaPVBWPYeZX6STIzC/DjS7UFlqoKgGGAGP17x8wmMRE6O/axG5jDzloCGxCmrymT0ZGCh4g54O1iDYUtmJr7Bo1d+H9RQj2Y10BxcMkLFTIZVjm9e3vtIbeRx0OdXE1Ou37J/WeJZyPXn1fszvp/KonCqVnt862LrxfoB/0sF5gk4Y/f6LVneU5hun9/V1OVre9XrnDBhcVaQa9Ye6gs8sHW9HCNchaFbkUpxSiyxVEFZIlbejbjSPFlkYOLhtQHduwZWRHWA9akqykJNG3PKvOZAaJG5nWQq8+e4K0JF/AXTKIIr4J7zDt8ZR4xb9T2gxjl1nfqzidMRIY5B4rkw0oetta+j8rqkFpTEGA+hU/tw7bDtpkPYvCguwncnCjwULNFT9I9jXx3H4Ws3WWMCit29F7kGq2Ka+rU/MjnuP0lsXkoB1rr8LawHH5gaf8rajq/BhKrGTIfjDiZG5qz+L7SZBZsMSZZ9pM1QhKju+GTD9iC+9HlhfXMtj94gz8U4h7eGXziEO7lo7LwLL6/DVMrGbkv68JYUYhGz2yBm/8cbQEh5vhakbhmpv1K6XYM9rzdsd9bwYcYt3cfKE3m+/NrUa42+RpJBdFg7cAmxsZ7/0TMyVw6Aqu2gzldb2ag4iLrPNEyW1ywaJ2DXMgPi/sjnDzhuo+vIUrc86j4ZLhT4GAN6uqwbnXq5UDzX7TfuB48oMvvE1sK5q6owkdWfklgnC6pSBpK7wl+e3kuvaYnGRGJJMBQuVgWL1awHrVtfOTsSE1vc0ZdG+a/Jbza6pHbyfi5L7FXJAGdQTk0EP3VT54+F7RZ/MJ9fj56aMxzhJRwQJ6df3cM26qSc5bW/zP3PFXypTOBwzCvVtwGQzkGvDW7XGwgLbTNHDpQXOd2BQ5Zd9bjQqGg+S+kIqWZVZCqVLfyFPF9bEOHfPepL6nRDJUD2l5uRnXqeTvidaSIoqS1Fbc6mLPtYnbp6uuts6Qo8TbMzFuI7NuaPuKnQIyVu7vUGJ8jg1uVOjlMNKdVtLPr9/ZEKVZVj7lsFA+nm3zRjjr1DRKhr/wY1CI1iXKVTeQZ0i2PSnN99j4iVTSwNAYQLWWD+KyZ/xRLVxmZQPuSkLeKBRAkavxjWnIFQb1dn72wMSUdcB9cNCNJNdyTkrl44MRR+pUuiVrTAnTlzL33X32eEYwT+vn564yxFJLUDyIMNjJ0nx+GreKSOglI2et0kAwRHKYFclH9GVTiVlB0TWeUJGD+7JYogF7BizjTGyPOUEWQCguIEmtC4fHD5461T80Z3Mp7rhNTI+Cswuknr9hrIZmpRyFSrSrP8R4S1Cf34Tu4RNrDxpofVK9nGTklZPsYM6eiP29Lx264fsX9oLdYhq7vCwcrRMJ1a5d0QHXUYRV5IqTFBoUSpxkQ6IHHL8ckM4NCzwk8K0CA3pj5Jp2a9wZjfKq7R/eukzQFuhMxV2qgHf2E3t7/SA8N7sMvsmF0p3J96QRE3rA85ekH1q8nrBVujlIqahmL0Qto3+JxdqAfnKMCblQGSKVWZgWLMm82MG/9pjhdkMzG7C2GRLGMty2y8NhX1pZWHNbLOmvaC424LNz/Nl5tkPv7fVbCT2ItB+/dx3ZhVhmgSLd1zL+2PsNFmj7VGBruTttezlo1mDKErjY27nTswjf2fY/Uq8lPcVAgRpJM+m7jS/8dk8cdl7fkY7Tuj4TfiSe0tiNSoJgZwom4+9haoBQ65AifaB7pUiTc0MAXCvG+nDydkRIbKx5fL6gAlyMAnBbQf+Qh1naLfzzwLVTP0EEyoenW2W1zKqfMql5rwGlyCB9mSa2s25yHf4SDSBlgEVMJtplpRgegZvDakpWDKgx3UR4W7yKW+RD7bd7rEa/GQmA/q0RYAOIaXfO/2CgEUPtNhPS2uqy29lBYFPPv5SHQ0t/jRxQLBpe09ateAWKypt9TWS7Z5gynOePS5M2NC16AhF0Xz6s7DUjtI0xNho9Y6GK16J5V8HqHypV/OAz7+VBzTaiR57XGH4r62GoAiJqfWOM7okzKCeeSBnOIKPHtwgM0SQbvCvv7rmS6ZAacu4BbXZ5R9gOhdR9H3bi7lWLBNnqqLPIy0k6m4XBhtl40B6z/5AcJxjtKfwvIExl7VsQRqbW8gpPMsmJZfSp3uC35g1AkP+BJlju3RVoFZNo3JR18A5uc60NGD4zvzIdGTAOth4ZAZx0ZGQItHuNcLz/0CiavJdkjD65h4avf1vf7LFZ1uogJz6vLK3uDisXIBIGkXOlIpxTdjjjTQt6Khy50bYbXsG9JBrSUGhsBWpeRUnq2cZWOifhfueY95gFIDAu37oKR3FQ1YxGMg3UMq+L2VN2rtqodelSHof8SyYZVQWs7L0bjtgolId1tAAjHI7J1/+JIRXeUBjjaGGQAU+az9XFfiqn+VRAGG8JDdP/WmEqjhYpcy00LIBIBzCF9I9mbXCv8IX9fhPlI5NqWGO/v0ikpfn+hb5U16FcPYsx+xLb4la6nSbvrTDP5MthPyeLIIY7ZE/rNU4ajgPmI0/3RvD7WtEbo8UGPjnev55N2ELuFpEPzkNu9MzXqq8K0cWxk4lT2DQPi3rDO8x8i5jX7wWQi8e0neCMb0SUO67zRfaekZONGfaFl47LByciUuy5dhqxMPokhTE2WbzxqCyt/s2TqG66R0ocYHmzv9f7tJ+TES8NFyzL3fhNoZoW5IxWNE+stYWutd3LPwa7HKhhRAbl5uCEbEGjrUzTXwbzG0qvpmNtpnYnmKjzTaSAFNCxfw9edcjaxCiRKKIDd6GS/eDsGBgTvJexDfwGmVWm9jadZhee9jRFiZFtL6m7sY1oQa8F9ycxSuPANXCqWkApcaEfQLkt1yyfeRs5yC5O/6XGJ4TEtJmCTPJFRr95au20STIPgkoEF1mzZ+5ZRtWKUYuWJVZDwcA/lTy6oYp0/d0LGPRUXnXRm0qtIXQVdnoVhKZPeWACt9rujRL57MEDi2kHtfV/ucu+k03bN0fQlbalUJ0faY99GC6L8MO8MXTSmqDAxNSpqpIFPhgHgAg0YK/GZhlQjbQXE4tMDEDO9obNfp4W6m8fdznMesSSRINBG5FDf//DkT9pSRQsIdSg4VK7W7j2d2jsQUIyjJmbd/2zCTaqh0Yq0cH6mS/5g/cq3eGOiJbaCNo6oVwGURzXVAeVaGIfJFhd2A59sVp+rVfe1f8B6bVbCLIKgGUgpUokO0vTg6ouAxXGQKtveMhhBT83ukPIRZ02+qF1kvM+nNCVy8uzrB0+W9QIKbMio2m/7zW78xd5Tf9itocpLbRuNC5cuS/GyRGXw6fzFzjM1UITlQ5dlvoyYxuvb7ol4S1MyhkfMNZbif6/xic0wB3uSScez3oFTRbCHBd0cbJL3cLwfQjCBpGBrRVC7174qW4XWnw0eYGSSzTVSEDOlMaTUIGJO+s7/z8JxaZprcEsoB4+vt9/+uwtM/iyqLVPidu8ZTh+F1rsEWKwZhDAg/giVc6VzRq+DJCrhn81b/LYlLJOdgoAjID2VnwgU+mQhCL6KhgIqqiVraD25UIYEqxMcZ1aRcZvHa8x5gh5onPtsVcl53Xek9BOYqkyj64acX921zwqoY0lmNA81NE7BzVts3cwWDZ4Dk6uuzwtfJuJc7vVS+fdVDEg3ATwC9oG5/Vb1swTyzTsl2V4m+93bSQo5STFG5AruTDWTym6Lxtt4OrAeIVgdoyTJL+keHiHTNiL0/nO5oYwftSQK1aYBuA0e12t/FVN+LsCk0L/hfCCcke89LuP4d46qnFo3NLpHb+NFrvekXVT4GiZgMW2H0orIY0TpS15wlxVUaGCUo7YSN0yWDRU5+p41dCOs5/vXq1do7K+Byjj35/mPlQ+VEDqqF7OIBQrXfHgCXYPy8ye3Ih3io+tYA6nK0/2clIERrpA0AMHKLTGEO7q/IzIcOCwYN9W/ISH4v4uk9MhzNu7Fg2IPCq5CQF1GLuzQu+wNv2h94NIA2UJydawv5X2bHkZjv+kB/WQCYjxUNEU8ssUdxDZstpv2qNAHmI6BMD84olxMiwFdK5J80zc9x7de/cz3ZNIkkGIpMCZJqKKkaLVo1MLnR/h/hQeUvfqJmvkPeIre3EjnliNkKJKL0KNaupHzY7Eoztaj0cNOhJ5dxIRB2is3kLcSK1FZswRJR0B5OXX+Q4UlFIrhR10lIge3Fg5DnaGoZoOyFaaHztrdF251JubDsCZRDSWA0y6ysykO+h4jhXtuWF7D5Wp7B4Hx3EQvKsmPPZYcLevowjlWghHbRBEhwPI3bzjhNWXlqtym5ObYAeYxuHyvyYue2X4651f7Om3+m8KT7Y/JqLWXwgayCdzxHuJidti1ITuf/oXzeCfTRbG5ytXlDk/epX061W6BO074jI7nV518OkYtRJDnPqdDFAf0uWcATfk0h17+gP7GHjy0Rc0Ive9XmvA6gCkoMjNjMEA7GQ3xy7e12DzfNpIfND7GKKojMifTrvkDXrfa3o4wNYktY6/VlBdHtrcH9F7uMWICej/BjZXVX83WFGcVHx3nOXxSL59kE9bSmHc3Xp8iDbPuSG5GIRp3fTFHnmTzzGedl6al2gUbGFKtkC0jFNtKTk2rr8LEObiGgfCoSpTWknvAYDQBoj93s0KiRNPOqgY++Xka2cQiDwqUsLl8/i57YC/V6sy5/NvhViRRZgCzcyjNHGzZsYA5YMtUntyfC1gNFP7cL3AwVA+326NJI7MQJoxTqcHL/YhntsnYTR5R6GVVvFYIlW8Nv9qn3daoGXMz0MoAsXpCzbiHZ0XWkfw2qlJkmZjgQtMAEhHXNgokGRPfOprmtlvNZaNlGB1EjQTVX1Y4tCyJFZhdhID4CowB23uQF16NifyxH+DGnQrnxeklnG7UQV2BRVdr6ZEKZYv7Gj+PbpojzAskvbdtaFsataqPrLDoejjc6ZfPA5zA0iYcCvcNjzuy9SuT0uG8NWMTLv2OsImL++PQV1sifUENAwi4O3yBvzTy4J77B7mMBpjCYGXAyjFGFZL4eAazSmvZ8thJ0FFW+keLHL+ft1dQBKmXY6JatelGebcIC/PyLBHdfX9bRcauGg4xEO7mMl8AjlcPMczkPniNQpiQFqcDJYrFGoxMV2hskxMn0bRQT8Ajc6w6sQYkGl0CQUImPrGfie9dsk4mrCLMIFOqcm0WT8O8AiREEGmooBTO7WI0qk506NsV7ffvc0rVJERJKcyRyCmFZdTSn/SrBfjV7SXT3pQlgluoY4FBUCDDkzwBgjkrE1oFUA3ls+xVP10w5jjBIMwKBSQqRVAEDXw+Dyj+jH3ila8czULWsCKhWd4qGsMFN7++OGBAz9eXHjAO9m++mTXF6qiyG35Q+61yjYQKsBrjR4NNexrwVGqBwAZA6cr5mp8AhoyzPomJ6TLfWEJjEeRI3QsX5oQkNuyF7u650QFka+VjFeNRY6ALklleTW9I0v4ABKDCXTGkjv80vqVNk+FTL0bJK7ndSjjMJD7OBFIEywBPJFrxTdyzocmxEgG0zu1VDgsQuXITYCx1RRty89A/F+CdSAlbMlIkptCC0GrF/jFS8PAU+6TNV1eBqJrCr9BgH1mth8FtdfE7druR+xyZKn5idfUKzGW6ACGF4M61IRoSs9o6xmaj3dnAVQvFWUsMcR6MI3xTKJNyMxkhXhhvT0IxialnG7i/BBzXfMXYh5jl4BXzCSNlxU4+aboEgIDr48/+pfj8J3WcNccFfzV6eiX05qkNktmafoBcxrEsrM8WQV0VVSRybQyXPOqJ1yndwBI6BOGO9oGxGDAd+HcKaZlptCMJsR1Cp3m7F9HpBFSu/NYVj+WSDY7jWSFBlTBSCFyyPEUn8S9NmBVa+mwGVsz0Q+fxe23w1w6wVO7sVnZqRpmXJeXg72QFkl7Qda1lBzn/FW+rRwLvFxCsuad67Wmzab1RJdzPGsuq8AzW6tL+JiwW/VPUSBbBmV1+EjqQ28x1u9W5Eoy7zhsU8NT87CtNbZ0lPEpsoWMewxC80kPanfWPrQXmixWDXXz7uf1kBTr1J/iYuls7fUsyAChXjKcKOaCF4ySqkhMTGmjNqYiG5joBUi/SZpWvgxk28pyIPhf28YULINiqmbWPBKuTCLFruV7JfRgGM87XfNEFc7tgnYx503k/0UXJfpmjx6wKbKcvV5fqrctx+OrIn++TxRxSKlTScEIwd2vG5mg/p5wsQDpiD+X91XbkReKLB25Jvp/IJaJh715RXqBzwCwlY3URonyy+oZoTD8Ym8XMMv/dMllh0LCFZkZFn2gYcLG9iO+I5S/GyxwjajQLQtwH7o+n50vimC+ES8ePOpPDwlu4oG8KhS7NL/OTdIWPIHbSa6/9DfjOq9W66EpaK57R78PpEzVNLkTP2L6lllqDT6SDhIDIvQS3SQbxG96khXgvW/rME+tiXFXi+BC0udi9keyGlc3sLBN3CP3QXzswhBGTxvz2LmRMkU3rLuSkYR1Gzr7vj1VxTN1y1iciA0DswsPZ38eB6X10Uzk6HZqjzBK+EJ5osJJJ/s3b0MFRIWYlM15TPm1uzeOk1zQ96quClQLEZbpxmV/eAduIotXUYQZjWAkTulBJt7kw9uEnLo7OpZrf8k+0ZQP0agcOTLbfrekHji86Mxr7rTwve82mePKoAkkEthE45VI+f1VqpyWNW1kbBbVVfuatKt6MEKqyTUyxSFGHk81kY7CxkgMNexiikN0+IeiUNsfuktjfOAiMfDhbTe4rtxSEPvO4CCUGaktA58TGnSO8rHdCicmGkNrwWsnXgUWjhp8bllNcnQN10TbwxYPAwQKW/JJiYQadr4THXO+vWudiq3I47vqmEM/Ab3Dlq11Q7RmRWntYOEyESbTI8PZYwbtsmjcSwBtTAIHQ5h3I633h3FpOkT2c0PlMjzj0Q/OuqaTVt639fowVppqvSlNcK5KupBnrxfKHQK+SoKSuaO8PNMkYkbcEAc9F0I4uzPfRVP/q5QkvJVsVoJ8BEWW/q1+kivHEMQfb+J2NfJjSTG+WhjHjL8eqi7FgfVewxwmqG9IOnTkwDjAHUaJMIyhVkadW/+GQjLyNP4zyHcLAdWcB5zQ2kc/blAx2RKfG+ON3RfC+iQ5Th7V2i5abkoy0pjfyOwTjIvaq9slSCtoNGBZggBDOiWwau0CX4NAIThFyqu9VWCLr8TsqhQZvQP+xrywovGs6A079U7YBjhEXyQw4Q3rbQY1EQnxTPXNlHfn9vQnuhsJnzx6PZrCqry8fidPz2U1scmAMVPHxa/injIf+hDziEU02xWm9ou67OgebktON9V6wwVotoNOzVNJhiDBlHbktBwOjX1BlJHybLox5y/7NhR7uc8f85O6xdxueabhwtJjYcBzac56v6RbuI9IRvPzOnNbltj8Hh0ftwwhWyHAyiEat0oDSEVZ925jmxJKAqTo4/uHnkozgMDsnkzXPXBDJ1sDTawXy23mXuTJOYV6ZVWrervMaGGGQpgQjAnfP7KPZro+OKt/MpnoM0NeGQgIFAiH7dU7Nl1QbcMiwO6/5nIosJtrFB8w1kpqb6OjI9BgZHG1nzTMGA++HNrl4WQNcq3SajD4C9utQYAu/fETPFMMJeCDwHRCnPuRAlqJ5t0E5h3Wlh1Nw57LQ36kDjC3lS9w0a89eI8ym6BzEA25Cdz3LQAyz94Fvjqp7MyHrpm3PzmsV/tbSLF9NJBjFmzWPQ8Tfgvj3fi8dg78tXvEatqtUhLxsNp2VCU6IzSqafxWw93+Wk47skJv5qxM+tv7CrpYKvWLEylJNEXlh7GHm9UenNf2/szZOl+54P4ZWksh1r6+rphL68QYhmqW7DqKVrc2rjzPYcvFDmKtCGL/F62i3riMV9z+LoLnuVaMn4dtpNNFmQEQ4uEhDfLYU4x8G2OHCz7gnxLCa4zE4CFo9m/+ECmdzziVumHM/P00/BESH2rxUYMBL8/9NRG5fiskFJr4AO0qNUKUCgTRgEiFsTbGXtP4DTTzc8ZAmfNJuJQE5Kp7W7U7QZnBXKepfSHkYTEqgOhqo95Jw9i56kYGt4BWwX50mC27CCW92SVMl4tbUEhBDSB36zgztz5Zts0563Kjc34B+6ZUnMIk+BiQNvqSkZHnk3rHNSaYthO72IWLIxij0hcv7n228yc82FsQLK9jmptjY6estDfH3OSMaAj+poCLKwRFXvXWb6jwM9mG4nu1yug0Cc4L89w4EYek6dnV17VBfIxB2dmFFQdp0kqx3BM9gdMAr0KS7WLOSf3cn5eDItDLP2UW7MWaIR+GJ0EGcEL3ejBdu0to6vDh04JcRMNU55usmSn3jp74myzWE3azMIT96wr39F62c3G/ldGskbqTIMTk3gMg61vNBQ0cJSIxVdcgNb3xFDowwVyIqYz54F8Rqg0uQE4FIiUGZxJhND/AWhkukqIqLLZEpxj07kPBN6Zb2pWht/X5JrC8yJzPlvFhfJndQ4jcgjFyhvymr/a17uxTKHpKNWDEoL4nNa9/Prf7TYRw6Gyo6vcwYcUHk17SMb9aEdVnx24msNCDEKbj0OVzRaA3gFJeXZPObqJKvWqFlavGpxXnP+4ZYTl0Dmcri6vMdwX687ApG+ygiGHZDwNzU68F4JMPQ9JB45vLkCsE2w50QNP1kJZlI56dVGzfK1MyRqP4J6VshesfOT4hzR6MYq373IoONlLvENdYXN6pTxo5eRzQkwk2tZ1zmZqczCytqTEhpweKcBCCZ/FhizgLm8/x5ScBlO0wEXHZm90mpmL1gR/J2CUnz3wDU99YFFKqm01AZ8q2S5Fnh81CbD687c7K2OjWlZgdvEJA9M0JT3eKdIRd9GCx6g1TO5PWTE8OOphUDKdazyYnmMqFhFxfJ//cWJTsgYbol2a7Ob/Q69Fy3kb9K7aZLzH+Kl/uCzWnqTOrQonVL7LTFPr7wbTaepfAl5zSgMInjrGXY+Gspw+fCNgEU1zyC0Suum6VFyHBjdKWft7strrOXqOSQwxsYXp4F013mN9gZyu4Hc84A4dzIHN5UNXmxNn+vPjS82JM6klySWB9pLCzLBUgXiMDllaG6fT2PSBv/b+yaruyWBVcpsOKuEaQ37W3A3t9YFRcgB5rFMDjwOn3c0lfsg+5V+dBX2EmWLTSelNZkeq67CFnxaKtnlsAJRPBqYvoWVZcJKn0zSelrO2TwnailO7zgAHaMRmQYbXo9beBs16JWf7V8LjYGS/DYUKTTE1zKECC/pK1EKf6mxIgmV+mJ+Mc8h04qep+okIIEXaN351J3N0VUk7cEEaOLE1rFF3W4vqRcodPfbLqINF6QtTsfny1+O46J5ahlamZEyxglZtpjEkKd9yKDsgwnzqoAPN5o76IsI+FRaBc8u1qLBWxpKU615chTVegNFR5V4o1T2JGwVkueD6CjAhOplPnRyv8sauMnMy2wEMARR6AmCQ8S5ebL0nCEqjSztMoUyAEjQ6FDYqkGweu48DkBR5HjwlBloKVawYcDezxKBH8WWnMpJKZj1Ol+OHMmg5iq9xDswLx0iTNkujgatOkeRU0c/GmSSH+7GTTMLQJdj51l3EkojjEwWOjw8XBOm88GqC4bWPEE+U/5XYtZNJG/X4FYjgIvVd69RYVbMEMfPSKJ825e3XQ6RBesp/G+lkMk4VIxRakyUBPLO1u0UYnNG9ExAnPdOO0OfFvcPOL9rBJO8bR+q9Lp9/i+fH32KkaNR2WgoxQY3FY+rS2NUvtCOgZAaF9vny16WG/3zeUtRP9V28PcGivAHAwwCcRk0D0iohjAfgL/EKXJkr8gIFqbNq7lXUFRKqMbpBa182ol77SqJq1M5setGUJuSBKqYBYKdDZv3XdT/u6J5aKKkLvA5ez6PuWX0RT7kELSKDKfg9w9nwSmMmJHjbnr0blM2WvpiirR/nLid6SRN9+5KoLUb+pLw3QzD8JlS3X2q0m4BNRxfltr5KWqryOuuGDt6IOHSE8/zqGXMiTqgrUOfDH58NoWe0te4mFc1GxswvhZXWJZmaWaMJo2SBnuXa7+jIfFbnhNH74Z6jygwcqXsldYfI/Zh8BZbqTh2I7Hu44dilfbX8Uh18NVB3phRnTwpUonKquUs/iZXRnDFjtEmKg2YRQm2CP1FWRb/B92HqJlHT7Hs/Tpl3RrlxvkoskpNlW53/6Ujse0fkHLNeUm97TlDsaRXpfZkR1uWMTwhPv4oYM2Bv941R+c7nQ0yBdFNVQpZRkpejmIfjFrdQUA7DPwR69aq6Pzmk3IXarIMKG6R4MBdkB3j3HWxohnZLWpaNy/BMxS+84e4vPPfO/7+nLWVZsdpUY/nGDkQts0NGnRpZK/lW60tmncMoTepY5fMbow1GyKhqSXLbOZkz59l8DG9v9ZHPwA1roKz3MW/j2tN/U+lPQVYXTa6h1ePQkSWR2bp9OHmCCvT6s8v9PVG2ufK7dkbpY500gNx7fdArzH3yCjY33Fa5TbOuybLNdW8juJyJtikDn+5jMnMzIWP/+v12XkaXj195xk6eOKuvA5zeKk1i1PrSnmWA46Ca2ldgNqJ0rvLqM9X2EPn/QuMjLnLg0iVJ4H4r5S2PgpGdSdfVoiX/rBAq6yVDc30v8DOUae4oquSM0YDCIafLQ+hvEmB5b/f+QsTFtAR0zIVWeLyYbmrx3g9gHhVRfelCz9/exh19AGsyXcwuSaBiCzQIoctYvyhhkdCsC/cdZDce/1Fav35JQt+RJFAjiMRQhCdE4eS3SmfsREHe9LZa0ElOLhxxvs5uS/SnMYssyK9FxiucRjjOqfaIp2N8CmuNJqg3WvtMk+MlbAYeji9K94rx6U7nj9L1TGhVcAyz+Gb4sib21AW94HRzWbTrRKEkx5+KLE69Vc+8Cj1Vu2GkZ1AA2E4kaJ2aTjsEL2C0srAINXRAjnxwI3p5ED0NRYn9sT1iY9GPBJwhhd6WXEJ/Z44D0rufaDOA8dUj1SIqywRs2b7SjYcCYS8eefkwdWlpN0DvnecdwHVc3TqyCcUy7K2PMS2l2KZHzZfLCTCPaPq/NVc/Nlc5hVJoFvnNUpKWZcTsxVeHfH1mnELREECq9YES9v6FcvONCxXLQmf0k3S2dyNmsxbvlXM0u7lSqkx81md0rad3E33PPuPpDGM9UiBhSeJn3Sejmx+LdLCiZYcVxow59nCqrUmXGAbsR4O7wVQzyHdL6DX5s8k5BjHXlONz0PaIqS89xMhkYetMw6w7JZ5c/oJBH2jdZPbS6KbR0RpEe16BATLzU4QiHybxArrjBM8MKKP8Zz6MVbg/d8yb76U8nQzCK4Eqa5ombBm7/6xo2dR9O/ByfcU6qDu+efdLFAP4LiCr6C3aihDPjigUYuy0voLuX3Flevl7xXRtRZ4Vc48j2tgA7tK0wqv4OjLwCzZJn9lYIQuScQBEFMBjA6Vj8FTp4h3OphB6g0uA13nTnVLmKQ+zfELl+6znWX5nCWvbwak0t3q4qwWK3MAPKE2vqDEeCsFKvmJ2Ws+VOqnrA+ekCk9jaszBsZd71InADWijT4SHnyVmc55dv5ivXl1fED4vwNrxbiZHWeGinS3ImcoDAT1vGiLpP/D3NaiIPq9A2h5DT5SgaCVCh0JKu7DKsHjW9ZAACRxHgTSo5jrVWUJfGKweg2auQuittVidB+JaCdwYd0x9oJ4jyI5UygrB9Nzi2gbLVcCnpu+1ytsiWCbJb1Xxas8FhG/EX86taG6flZZauhaGnpRyfBB5ojGdsdPBVHEtb8R951oaNTvKXK7CddSeWaeOi2FIDPEhWhAk19RzuR9wSKEwvvi8nQFz649+fUlBMuDL7VmUBSsC1ExWwqY+uSdNKowEkpsBb+/KpWl6oGxymyR/e4uKjipBJrVPXg0nE2j6HL2JbCHNh01lV+/+6FUglhV8GTypzdvdfhYc7t0ZYtkyH/17wDakU7r1GAdUIXXmtxamhK2FdelBa4BPryblCC9gJG9htJue9LMrNS7mM6gbRA1xSFnWNsziDuGZeS3Dcu4bjsWaIebrgNnxpl/pLGxV5EtkFwDeh8fPyfPU8CZAM/Ljk3+Vi7jUtNZmZM8+f7d4wlUIkTHiAULRUKu0ODFIeyk20BiqLB7vvAT342SIDP+z5FPaa6Tjyqh/AsX2jFhbeIXKxDMb8fid0jHAWk6JKhswbtvtP6bDz+lYjvXIPwV1Y+nyft2uM8c1aUxmDHAUmZnJBvZXT43mxjXDHP05R1/dKfoExcgcYzv3wO5mazi7ugS01z6oUmByKtfQ6fA2+MQynPCoDHcp1eDtag/E3HQpHMWAgGkNh9wWR5Y48YG0W4CgvOrngI111j/x+MIuH5xFlVkxqptSjW+hnVbt9qxtXndEH5RtnxWfd9eP+kli/x3LU1WGsZVAkVElXD274LBGK0bMveEUbj/6EpnocEnvRSlglpE4GiAO5S4JdYb4uYd6oeK8vuZvTQaWMS3dEIJ2ssCxWz8DqYmc/b38ynz0DWCCeF1gCyipaLG2Kq9wqfHz3S6m7CS+H42nmDYAz2dYcx77M8purGOS5tQ4aykJXIDQBwHjIGSU+52M+1OV53rp4B3JbIXecQWEjfk9gkVoz8T6HJbIhFgm3quNMk+cIyRHlj/BdURXY8o7H7dBQfsdpLJhAsxS/1JtMkY8JoP4YdyOxzJY5x/+A9scOTXvPVoQAMqgmP899s6GvRtzNFGXLX7VHSnUj7VPO8K1qxaS/a/6v/YhRlUtNgnqnth3Jo/DKbdhdPn6HgB9YjU5GuN1uPyUXZJDZYfFwMfdqNPVoI8d1csoHMK5tquGoK060mIwBHMk3pFGqBosajr9g/5kBPrrtuIIEPFZnaAKSCQqLdeQq2B6Bs8WxD8+DfzGJ2nu0Xeb58spPoiHZAVV+I5lRUseUE0IA4E844UzFYADNYcLBW3zsP7aWzLnUZoQPuIDR3FX3bkM5mCunvXaPSi4PRkKnItEv8/OYiq8RSKQcaTwxX9YgdNbgPuXLwb5ARofv0Zj3WpHhNnlTq2Qu/lwvM3PUaqv8L7kpFqQR9aRaXfFanbLgbyxJ2kAx9oA1kRMyH3JXI06oQhRiZQ1LtWz+QKKxme0zAgI2q6/dmYApsA7WGeBae5+Y3eqkqDjXyS7Q+LzYgrM3EiqGHsibaKZKgFecxpGiMLXY5+kkuDKBdMkj2Bd8uTKI+aTWpu97gNp78fm891zYuT68sIEzE5JggpWjlWFSpzYayxvnOxJ3JYK/q8WbCy14KhtCFhdLOxCEAvyqXN3K+oP52ZzdxHiCAac5LX2TO5CTmkxp6zCT5JZDIBgnnmQU8GBowEvogfPni17fE1sljd55P2C4mWCNDr8l3hMH+4zpyZqp3iFbJx20nGtU+9LJozl0OxNrk/c0C9chEe+k4vUECnUaXbS8JqdnymqbZ1SCI+4+1BYMW4nzYKDLaqL3Nm08C/Ug7zNg2BuwhWepXrkqaRX58LCWLPDQyUzn369E1drtekeuNcI4SgdmyQZ/7xhXZ6sOKg9G/HEiJQsriRQThvHz4BhaFaXic4nlrz4LhUthGBLbnnB6tufJizYx4c6b2rY1E63pLDA8QdZsTOD7euNMku1a0T2nNQ9rOPBYPDyksaP+EmKTvqcgRycKMtzhHh37mAqVERuzIIMs/zXE9jGBpJBBWb8KCPZne6Sxw0+UFlY6/VeXJUHunHXY1csfc40Tw95XrkpLzxqX/LrsaYM7Y0UQ/Qe6PTjMQUXDseSMhYwHTXCohySQ+1fIjz/yjZWRFI1/a4d9eQzWLoGjz8O8ldPhzhpWFwwlaR0T1gpMP3VeHvDOx4RJocHJOSRQ+H4/nHJsiuXWDKowYZZW8Jk9vUiw2jExedn7glAsC/bgN1NrgIp1y+y3tmLd2V9x7yKVC+QK6MOFq19dlQflj350qUavBULMCTn0BvCRQY4q6VjniU6XHISUsaApCVoQeevAOuCUFcnwWfK+44XDo1qSpPF1wcnbH7N9aO+AzD212PgFlGkXlaQ3Gbfz9XIUMjulgGUREelr6IX+tR2K9H/yep959z5WLXlZ81Z8HCIV8CyU0JKYzkIeFqf6o2ywb2O73oRi7i8F6Vcn2zU1VWZpLfSXgTNkRtqM7r5s13UimLWtAVZs97rLcMRlwXzYp98ZnKvQLj/dpKn8nfNnU9V2Bp90frlQedeKt6zd4mPR53FKQ1J4r95n1G8ph0XG37DC9b185sWbnoyC4Q1iUvyy5IOxBrIqbqn/JSUWzdrlOiZGDJrU5IGuzUl5TaupUTIgFeLfT6uh0gIEJ5nZQ/8XjB0mmEZxTvocrU/BFoOaUvV/N48W3W/aQu5nR3KwsSByfSDAEq6qBqTVTkZtkaAd/1Rie2jkdRlZvxFMu0MGnLc0SHPII8eOz/bjfIhSQhAb38dSRcFmfRb+fpDrDHeazED6EHNayy0kESoRG+XFbJa6xWB6OlbwHVDwdO9Ka7bIOqLRHpZjwXmv/2DR9nu+2xwxE39cBHq/7Vv99HcvH8ZJeGmgHr8mBKQmOCTkvLkxf5k4FrqZuNpaRNhCB3puFuF5d2nnQbhgAaANLMCYAiGsJhX2bFM/r3BGhR/dkGPXeBQUJ4tTARQnVqA07mW/42Dv2k7Wa7hWU/wv7FTIWLwWyHX0Vqdg4BHrlJ7zh+b+T6fH+W3d53LS5rkXK5GIctMIttK+osfGYIvOD0BkkXBJR0EYUmteToIxpoaMVKZmCRC2BbmBLdUTIZiI1kVYKYnq9Q5xMGODu+6vCT2ofvYE0pmGbQ9Ln6wnBDYZUD/BL9rmiPn3n28Zs33OsHUQcLp2vjUEV5sOBLO2ScyescGu0N58y1q1NSNJuXCzI4fu4RWJtSIn3P3+9eAsMo/2NupFeaf70/usLGd2Z0F27EjLoIj+nmJ4/Q5edPFhVNpPURQrUzPALNNzEvx3e82rDtPpbZjugv7Abm2q2vMGwz5W+hGH0hkCzXdZhPFbLk0sR5vVhScLgAPdZIVZIjTuzwIKVuWmvpMr7Gwxgiglpy8ecfOAZcCpXRzG6lNuRB64D4G9AWD9vQi/crWV4Xq5VjJnRjQc3g4bJe+MmksjEctghn27n5i5PHZvW/gM0BsXzo8Pou6yOLnp49dGXpK/oLAbOdOel9h+kDqEtZunvsXa9EFomdl0QbDvk+H58SjszCVqVOXSgDpOdZjXWfZpFL6S/fd1Lq8FQS3LklgiNhdvE5GzgSO8uq3gtj8I2o+JzucnrUSrtoxa6IejmVQLGzF3rSCy3fdhBPhZnDdgctC89dRJ+PTfW4ga5WWAyaWspzFg5251FoByB8LUbD3AxhvV6M1ARNXRJ4NhPe2j9WOlu5I2KmCMGvGP5CbHAyZk3YhiuIdtDgOvre9Cz0yOWvHH5FpZQzqzyHE5XkTTFMU2JhG1nvne9SCi9zNvPnGj9h/bQXgpue78rpogXJl8oDSfMwz9fp4ocyOxEV1JCEslSsRvodEzPbUsMUYWDERNzR6f45Ku6EmW3qdD48dcFQtc9rr2wF3o85edZ/2SY0BSkOdQX1ahwPVBP554Q1Z4lbd0d/vrRCO5k3QBWOb3iML0vI4MRkiKwqt735Q2fkq0Xl1pI3nk4ll51cSEHOrFTctkxwLOiQl6HJh2q3iqHFmtOCSo0A4YLl+mllolm7FLpe/79gMoe7A5cbFPCbX9Z3GhI43FgBbWoq8pwaIoDlklRimVauOx355pv7v26P0MLrgiqWTOxJaIGO/UhHf7GSOm0r1O5m1sPYYn1bathmEkYfrQLiEWQ2/3IjunsIxgAmi6t4JsxalYxE4YyvD59EpzvswOjZUvSgkHwPZonVtaiMTLXnV3p0dKpCSSz38Kv8QbNFzqLbwbBBRUHw/nHSxNipNm5vtjfkuf06jWRwkctgu8wZqKwS/7IcGnFtmwnbJFPhpGcyV9GVFzCCG+TOeNgAWxOUPgmtLdD8JawVVDV+e3iR8kHuaZXIknncI/3uFnblTd2P/OdWvxl+9CXbqJb1CS8osg2fg/qaA9KvM3FQoZQ79JRZC/Upm90ABPCGzksTWJ7Xy9VHpnPZCgGzAVbJhmurq8tm24BjBvnm1GOKfotvCqXyIXFE1bYTRS1WtzgZrGWgR/oOUDnNgDPXqUfTmyFPfNCD9MX22hvuBans/Kl1DustiTunl9Kravj0NG1Ds5nkTqlQSYOfhgvRIowimmWAYWma55eqvaQL9GvHmuH/hIVB/tiN6s7yOW2iahReL8dNddIbMJ6BLVguJ4n1dnquV3ZNqi6V0H/Vn00j0cE80ERsZTgsHPJ0eUjxYik+eDtaEHnyAsYeR2AjRcGw=="),function(t){return t.charCodeAt(0)}),o=new Uint8Array([177,156,215,89,13,111,230,1]),a=new Uint8Array(i.length),s=new Uint8Array(256),c=0;c<256;c++)s[c]=c;var d,u=0;for(c=0;c<256;c++){var l=[s[u=(u+s[c]+o[c%o.length])%256],s[c]];s[c]=l[0],s[u]=l[1]}c=0,u=0;for(var f=0;f<0+i.length;f++){var p=[s[u=(u+s[c=(c+1)%256])%256],s[c]];s[c]=p[0],s[u]=p[1],d=s[(s[c]+s[u])%256],f>=0&&(a[f-0]=i[f-0]^d)}return w=!0,new Promise(function(i){var o,s;(o=a.buffer,s=n,WebAssembly.instantiate(o,s)).then(function(n){w=!1,r=n.instance.exports,t.__wbindgen_wasm_module=n.module,i()})})})().then(function(){t(L=O.new())})})).then(function(t){N=t});var U,V,B,F,j,W,G,H,q,Y,z,K,J=!0;setInterval(function(){Object(d.getParameter)("UPLOAD_LOG")&&X.info("console log upload")},9e5);var X=(G=null,H=["DEBUG","INFO","WARNING","ERROR","NONE"],q=0,Y=function(t,n,i){var r={};Array.isArray(t)||(t=[t]),t=t.map(function(t){return{log_item_id:k++,log_level:t.log_level,payload_str:t.payload}}),r={timestamp:Date.now(),sdk_version:d.VERSION,process_id:Object(u.getProcessId)(),payload:JSON.stringify(t)},N?r.hash=N.get_digest("".concat(r.payload).concat(r.process_id).concat(r.timestamp)):i&&i();try{var o=G,a=G||"https://".concat(Object(d.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2");Object(c.post)(a,r,function(t){"OK"===t?n&&n(t):i&&i(t)},function(t){i&&i(t)},o?{withCredentials:!0}:{withCredentials:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}catch(s){i&&i(s)}},z=function(t,n){if(Object(d.getParameter)("UPLOAD_LOG"))try{n=Array.prototype.slice.call(n);var i="";if(n.forEach(function(t){"object"===a()(t)&&(t=JSON.stringify(t)),i=i+t+" "}),P.push({payload:i,log_level:t}),J)return;"free"===D&&function t(n){D="uploading",setTimeout(function(){Y(n,function(){x=0,0!==P.length?(M=P.length<10?P.splice(0,P.length):P.splice(0,10),t(M)):D="free"},function(){setTimeout(function(){t(M)},x++<2?200:1e4)})},3e3)}(M=P.length<10?P.splice(0,P.length):P.splice(0,10))}catch(r){}},V=function(){for(var t=[0],n=0;n<arguments.length;n++)t.push(arguments[n]);U.apply(this,t)},B=function(){for(var t=[1],n=0;n<arguments.length;n++)t.push(arguments[n]);U.apply(this,t)},F=function(){for(var t=[2],n=0;n<arguments.length;n++)t.push(arguments[n]);U.apply(this,t)},j=function(){for(var t=[3],n=0;n<arguments.length;n++)t.push(arguments[n]);U.apply(this,t)},K={},W=function(t){K[t]||(F.apply(void 0,arguments),K[t]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,stopWaitJoin:function(){J=!1},enableLogUpload:function(){Object(d.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(d.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(t){G=t?"https://".concat(t,"/ls/?h=").concat(Object(d.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v2"):"https://".concat(Object(d.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2")},setLogLevel:function(t){t>4?t=4:t<0&&(t=0),q=t},log:U=function(){var t=arguments[0],n=arguments;if(n[0]=s()+" Agora-SDK ["+(H[t]||"DEFAULT")+"]:",z(t,n),!(t<q))switch(t){case 0:case 1:case 3:console.log.apply(console,n);break;case 2:console.warn.apply(console,n);break;default:return void console.log.apply(console,n)}},debug:V,info:B,warning:F,deprecate:W,error:j});n.default=X},function(t,n,i){"use strict";i.r(n),i.d(n,"report",function(){return C}),i.d(n,"SESSION_INIT",function(){return v}),i.d(n,"JOIN_CHOOSE_SERVER",function(){return $}),i.d(n,"JOIN_GATEWAY",function(){return E}),i.d(n,"PUBLISH",function(){return S}),i.d(n,"SUBSCRIBE",function(){return y}),i.d(n,"getProcessId",function(){return A});var r=i(46),o=i.n(r),a=i(7),s=i.n(a),c=i(2),d=i(0),u=i(14),l=i(28),f=i.n(l),p=i(47);function _(t,n){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function g(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?_(Object(i),!0).forEach(function(n){o()(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}var h,m,v="session_init",$="join_choose_server",E="join_gateway",S="publish",y="subscribe",R=new(i.n(p)).a,T={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},I=null,A=function(){return I||(I="process-"+f()(),d.default.info("processId: "+I)),I},C=(m=0,(h={list:{},setProxyServer:function(t){R.setProxy(t),h.proxyServerURL=t},getUrl:function(){return h.proxyServerURL?"https://".concat(h.proxyServerURL,"/rs/?h=").concat(Object(c.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(c.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message")},getBackUrl:function(){return h.proxyServerURL?"https://".concat(h.proxyServerURL,"/rs/?h=").concat(Object(c.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(c.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message")},getSessionStartTime:function(t){return h.list[t]?h.list[t].startTime:(d.default.DEBUG("[getSessionStartTime]: session ".concat(t," no exit")),0)},sessionInit:function(t,n){var i=s()({},T);i.startTime=+new Date,i.sid=t,i.cname=n.cname,h.list[t]=i;var r=s()({},{willUploadConsoleLog:Object(c.getParameter)("UPLOAD_LOG"),areaVersion:"global"},n.extend),o=s()({},i);o.eventType=v,o.appid=n.appid,o.browser=navigator.userAgent,o.build=c.BUILD,o.lts=+new Date,o.elapse=o.lts-o.startTime,o.extend=JSON.stringify(r),o.mode=n.mode,o.process=A(),o.success=n.succ,o.version=c.VERSION,delete o.startTime,h.send({type:"Session",data:o}),h._flushInvokeReport(t)},joinChooseServer2:function(t,n,i){if(h.list[t]){h.list[t].uid||(n.uid&&(h.list[t].uid=parseInt(n.uid)),n.cid&&(h.list[t].cid=parseInt(n.cid)),n.vid&&(h.list[t].vid=parseInt(n.vid)));var r=s()({},h.list[t]);r.eventType=$;var o=n.lts;r.lts=Date.now(),r.eventElapse=r.lts-o,r.chooseServerAddr=n.csAddr,r.errorCode=n.ec,r.elapse=r.lts-r.startTime,r.success=n.succ,r.chooseServerIp=n.chooseServerIp||"",r.chooseServerAddrList=JSON.stringify(n.serverList),delete r.startTime,h.send({type:"JoinChooseServer",data:r})}},joinChooseServer:function(t,n,i){if(h.list[t]){i&&(n.uid&&(h.list[t].uid=parseInt(n.uid)),n.cid&&(h.list[t].cid=parseInt(n.cid)),n.vid&&(h.list[t].vid=parseInt(n.vid)));var r=s()({},h.list[t]);r.eventType=$;var o=n.lts;r.lts=Date.now(),r.eventElapse=r.lts-o,r.chooseServerAddr=n.csAddr,r.errorCode=n.ec,r.elapse=r.lts-r.startTime,r.success=n.succ,r.chooseServerIp=n.chooseServerIp||"",r.chooseServerAddrList=JSON.stringify(n.serverList),delete r.startTime,h.send({type:"JoinChooseServer",data:r})}},reqUserAccount:function(t,n){n.vid&&(h.list[t].vid=parseInt(n.vid));var i=s()({},h.list[t]),r=n.lts;i.eventType="req_user_account",i.lts=Date.now(),i.success=n.success,i.serverAddress=n.serverAddress,i.stringUid=n.stringUid,i.uid=n.uid,i.errorCode=n.errorCode,i.elapse=i.lts-i.startTime,i.eventElapse=i.lts-r,i.extend="string"==typeof n.extend?n.extend:JSON.stringify(n.extend),delete i.startTime,h.send({type:"ReqUserAccount",data:i})},joinGateway:function(t,n){n.vid&&(h.list[t].vid=parseInt(n.vid)),n.uid&&(h.list[t].uid=parseInt(n.uid));var i=s()({},h.list[t]),r=n.lts;i.eventType=E,i.firstSuccess=n.firstSuccess,i.lts=Date.now(),i.gatewayAddr=n.addr,i.success=n.succ,i.errorCode=n.ec,i.elapse=i.lts-i.startTime,i.eventElapse=i.lts-r,delete i.startTime,h.send({type:"JoinGateway",data:i})},publish:function(t,n){var i=s()({},h.list[t]);i.eventType=S;var r=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-r,i.elapse=i.lts-i.startTime,i.success=n.succ,i.errorCode=n.ec,i.audio=n.audio,i.video=n.video,i.screenshare=n.screenshare,i.publishRequestid=n.publishRequestid,i.p2pid=n.p2pid,n.videoName&&(i.videoName=n.videoName),n.audioName&&(i.audioName=n.audioName),n.screenName&&(i.screenName=n.screenName),delete i.startTime,h.send({type:"Publish",data:i}),h._flushInvokeReport(t)},subscribe:function(t,n){var i=s()({},h.list[t]);i.eventType=y;var r=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-r,i.elapse=i.lts-i.startTime,i.errorCode=n.ec,i.success=n.succ,i.subscribeRequestid=n.subscribeRequestid,i.p2pid=n.p2pid,isFinite(n.peerid)?i.peer=n.peerid:i.peerSuid=""+n.peerid,"boolean"==typeof n.video&&(i.video=n.video),"boolean"==typeof n.audio&&(i.audio=n.audio),delete i.startTime,h.send({type:"Subscribe",data:i}),h._flushInvokeReport(t)},firstRemoteFrame:function(t,n){var i=s()({},h.list[t]);i.eventType="first_remote_frame";var r=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-r,i.elapse=i.lts-i.startTime,i.width=n.width,i.height=n.height,i.success=n.succ,i.errorCode=n.ec,isFinite(n.peerid)?i.peer=n.peerid:i.peerSuid=""+n.peerid,delete i.startTime,h.send({type:"FirstFrame",data:i})},firstVideoReceived:function(t,n){var i=s()({},h.list[t]);i.eventType="first_video_received",i.lts=Date.now(),i.peer=n.peerid,i.uid=n.uid,i.elapse=n.elapse,i.subscribeElapse=n.subscribeElapse,i.subscribeRequestid=n.subscribeRequestid,i.p2pid=n.p2pid,h.send({type:"FirstVideoReceived",data:i})},firstAudioReceived:function(t,n){var i=s()({},h.list[t]);i.eventType="first_audio_received",i.lts=Date.now(),i.peer=n.peerid,i.uid=n.uid,i.elapse=n.elapse,i.subscribeElapse=n.subscribeElapse,i.subscribeRequestid=n.subscribeRequestid,i.p2pid=n.p2pid,h.send({type:"FirstAudioReceived",data:i})},firstVideoDecode:function(t,n){var i=s()({},h.list[t]);i.eventType="first_video_decode",i.lts=Date.now(),i.peer=n.peerid,i.uid=n.uid,i.elapse=n.elapse,i.videowidth=n.width,i.videoheight=n.height,i.subscribeElapse=n.subscribeElapse,i.subscribeRequestid=n.subscribeRequestid,i.p2pid=n.p2pid,h.send({type:"FirstVideoDecode",data:i})},firstAudioDecode:function(t,n){var i=s()({},h.list[t]);i.eventType="first_audio_decode",i.lts=Date.now(),i.uid=n.uid,i.peer=n.peerid,i.elapse=n.elapse,i.subscribeElapse=n.subscribeElapse,i.subscribeRequestid=n.subscribeRequestid,i.p2pid=n.p2pid,h.send({type:"FirstAudioDecode",data:i})},onAddAudioStream:function(t,n){var i=s()({},h.list[t]);i.eventType="on_add_audio_stream",i.lts=Date.now(),i.uid=n.uid,i.peer=n.peerid,h.send({type:"OnAddAudioStream",data:i})},onAddVideoStream:function(t,n){var i=s()({},h.list[t]);i.eventType="on_add_video_stream",i.lts=Date.now(),i.uid=n.uid,i.peer=n.peerid,h.send({type:"OnAddVideoStream",data:i})},onUpdateStream:function(t,n){var i=s()({},h.list[t]);i.eventType="on_update_stream",i.lts=Date.now(),i.uid=n.uid,i.peer=n.peerid,i.audio=n.audio,i.video=n.video,h.send({type:"OnUpdateStream",data:i})},onRemoveStream:function(t,n){var i=s()({},h.list[t]);i.eventType="on_remove_stream",i.lts=Date.now(),i.uid=n.uid,i.peer=n.peerid,h.send({type:"OnRemoveStream",data:i})},streamSwitch:function(t,n){var i=s()({},h.list[t]);i.eventType="stream_switch",i.lts=Date.now(),i.isDual=n.isdual,i.elapse=i.lts-i.startTime,i.success=i.succ,delete i.startTime,h.send({type:"StreamSwitch",data:i})},audioSendingStopped:function(t,n){var i=s()({},h.list[t]);i.eventType="audio_sending_stopped",i.lts=Date.now(),i.elapse=i.lts-i.startTime,i.reason=n.reason,i.success=n.succ,delete i.startTime,h.send({type:"AudioSendingStopped",data:i})},videoSendingStopped:function(t,n){var i=s()({},h.list[t]);i.eventType="video_sending_stopped",i.lts=Date.now(),i.elapse=i.lts-i.startTime,i.reson=n.reason,i.success=n.succ,delete i.startTime,h.send({type:"VideoSendingStopped",data:i})},requestProxyAppCenter:function(t,n){var i=s()({},h.list[t]),r=n.lts;i.eventType="request_proxy_appcenter",i.lts=Date.now(),i.eventElapse=i.lts-r,i.elapse=i.lts-i.startTime,i.extend=n.extend+"",i.APAddr=n.APAddr,i.workerManagerList=n.workerManagerList,i.response=n.response,i.errorCode=n.ec,i.success=n.succ,delete i.startTime,h.send({type:"RequestProxyAppCenter",data:i})},requestProxyWorkerManager:function(t,n){var i=s()({},h.list[t]),r=n.lts;i.eventType="request_proxy_worker_manager",i.lts=Date.now(),i.eventElapse=i.lts-r,i.elapse=i.lts-i.startTime,i.extend=n.extend,i.workerManagerAddr=n.workerManagerAddr,i.response=n.response,i.errorCode=n.ec,i.success=n.succ,delete i.startTime,h.send({type:"RequestProxyWorkerManager",data:i})},requestWorkerEvent:function(t,n){var i=s()({},h.list[t]),r=i.startTime,o=Date.now();delete(i=g({},i,{},n,{elapse:o-r,lts:o,productType:"WebRTC"})).startTime,h.send({type:"WorkerEvent",data:i})},requestApWorkerEvent:function(t,n){var i=s()({},h.list[t]),r=i.startTime,o=Date.now();i=g({},i,{},n,{elapse:o-r,lts:o}),h.send({type:"APWorkerEvent",data:i})},sendCustomReportMessage:function(t,n,i){var r={type:"UserAnalytics",data:g({sid:t},n)},o=h.getUrl(),a=!!h.proxyServerURL;Object(u.post)(o,r,function(t){i&&i()},function(t){var n=h.getBackUrl();Object(u.post)(n,r,function(t){i&&i()},function(t){i&&i("Failed")},a?{timeout:Object(c.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(c.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},a?{timeout:Object(c.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(c.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},joinChannelTimeOut:function(t){h.send({type:"JoinChannelTimeout",data:g({},t)})},peerPublishStatus:function(t){h.send({type:"PeerPublishStatus",data:g({},t)})},joinWebProxyAP:function(t){h.send({type:"JoinWebProxyAP",data:g({},t)})},webSocketQuit:function(t){h.send({type:"WebSocketQuit",data:g({},t)})}}).reportApiInvoke=function(t,n){var i=n.tag,r=n.name,o=n.getStates,a=n.options,s=n.timeout,u=void 0===s?6e4:s,l=n.callback,f=n.reportResult,p=void 0===f||f,_=Date.now(),h=0,v=m++,$=function(){var n;return g({tag:i,invokeId:v,sid:t,name:r,apiInvokeTime:_,options:a},o&&{states:Object.keys(n=o()).reduce(function(t,i){var r=t;return null!=n[i]&&(r[i]=n[i]),r},{})})},E=!!Object(c.getParameter)("SHOW_REPORT_INVOKER_LOG");E&&d.default.info("".concat(r," start"));var S=setTimeout(function(){C._sendApiInvoke(g({},$(),{error:"API_INVOKE_TIMEOUT",success:!1}))},u);return function(t,n){if(clearTimeout(S),++h>1&&(t="EXECUTOR_INVOKE_".concat(h)),t)return C._sendApiInvoke(g({},$(),{success:!1,error:t},o&&{states:o()})),E&&d.default.info("".concat(r," onFailure"),t),l&&l(t);C._sendApiInvoke(g({},$(),{success:!0},p&&{result:n},{},o&&{states:o()})),E&&d.default.info("".concat(r," onSuccess")),l&&l(null,n)}},h._cachedItems=[],h._cacheInvokeReport=function(t){t.lts||(t.lts=Date.now()),h._cachedItems.push(t),h._cachedItems.length>50&&h._cachedItems.shift()},h._flushInvokeReport=function(t){if(h._cachedItems.length){var n=h._cachedItems;h._cachedItems=[],d.default.debug("Flush cached event reporting:",n.length),n.forEach(function(n,i){n.sid=t,setTimeout(function(){h._sendApiInvoke(n)},5e3+500*i)})}},h._sendApiInvoke=function(t){var n=t.tag,i=t.invokeId,r=t.sid,o=t.name,a=t.result,s=t.states,d=t.options,u=t.error,l=t.success,f=t.apiInvokeTime,p=t.lts,_=Object(c.getParameter)("NOT_REPORT_EVENT");if(!(n&&_ instanceof Array&&-1!==_.indexOf(n))){if(h.list[r]){var m=h.list[r],v=m.startTime,$=m.cname,E=m.uid,S=m.cid,y=(p=p||Date.now())-v,R=p-f,T="";if(d)try{T=JSON.stringify(d)}catch(I){T=d.toString()}var A=g({invokeId:i,sid:r,cname:$,cid:S,lts:p,uid:E,success:l,elapse:y,apiName:o,execElapse:R},void 0!==d&&{options:T},{},void 0!==s&&{execStates:JSON.stringify(s)},{},void 0!==u&&{errorCode:JSON.stringify(u)},{},void 0!==a&&{execResult:JSON.stringify(a)});h.send({type:"ApiInvoke",data:A})}else h._cacheInvokeReport(arguments[0])}},h.sendCache=[],h.sendTimer=null,h.send=function(t){if(t.data){var n=t.data;h._lastLts&&h._lastLts>=n.lts&&(n.lts=h._lastLts+1),h._lastLts=n.lts}if(h.sendCache.push(t),null===h.sendTimer)return function t(){h.sendTimer=setTimeout(function(){if(0!==h.sendCache.length){var n=h.sendCache.length<10?h.sendCache.splice(0,h.sendCache.length):h.sendCache.splice(0,10),i=h.list[n[0].data.sid].vid;return R.sendReportList(n,i),t()}h.sendTimer=null},Object(c.getParameter)("EVENT_REPORT_SEND_INTERVAL"))}()},h)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BUILD="v3.6.11-0-gbdacc5f-dirty",n.VERSION="3.6.11";var r=0*Date.now()+11499+86604+5615+6547+846;n.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90,null,null,null,null],"120p_1":[160,120,15,15,30,65],"120p_3":[120,120,15,15,30,50],"120p_4":[212,120,null,null,null,null],"180p_1":[320,180,15,15,30,140],"180p_3":[180,180,15,15,30,100],"180p_4":[240,180,15,15,30,120],"240p_1":[320,240,15,15,40,200],"240p_3":[240,240,15,15,40,140],"240p_4":[424,240,15,15,40,220],"360p_1":[640,360,15,15,80,400],"360p_3":[360,360,15,15,80,260],"360p_4":[640,360,30,30,80,600],"360p_6":[360,360,30,30,80,400],"360p_7":[480,360,15,15,80,320],"360p_8":[480,360,30,30,80,490],"360p_9":[640,360,15,15,80,800],"360p_10":[640,360,24,24,80,800],"360p_11":[640,360,24,24,80,1e3],"480p_1":[640,480,15,15,100,500,1,5],"480p_2":[640,480,30,30,100,1e3,25,30],"480p_3":[480,480,15,15,100,400],"480p_4":[640,480,30,30,100,750],"480p_6":[480,480,30,30,100,600],"480p_8":[848,480,15,15,100,610],"480p_9":[848,480,30,30,100,930],"480p_10":[640,480,10,10,100,400],"720p_1":[1280,720,15,15,120,1130,1,5],"720p_2":[1280,720,30,30,120,2e3,25,30],"720p_3":[1280,720,30,30,120,1710],"720p_5":[960,720,15,15,120,910],"720p_6":[960,720,30,30,120,1380],"1080p_1":[1920,1080,15,15,120,2080,1,5],"1080p_2":[1920,1080,30,30,120,3e3,25,30],"1080p_3":[1920,1080,30,30,120,3150],"1080p_5":[1920,1080,60,60,120,4780],"1440p_1":[2560,1440,30,30,120,4850],"1440p_2":[2560,1440,60,60,120,7350],"4k_1":[3840,2160,30,30,120,8910],"4k_3":[3840,2160,60,60,120,13500]},n.AUDIO_PROFILE_SETTINGS={speech_low_quality:[!1,!1,!0,!0],speech_standard:[!1,!1,!0,!1],music_standard:[!1,!1,!1,!1],standard_stereo:[!1,!0,!1,!1],high_quality:[!0,!1,!1,!1],high_quality_stereo:[!0,!0,!1,!1],default:[!1,!1,!1,!1]};var o={AREA_SETTING:["NORTH_AMERICA","OVERSEA"],WEBCS_DOMAIN:["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],LOG_UPLOAD_SERVER:"logservice-oversea.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1-oversea.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"statscollector-2-oversea.agora.io",ENABLE_LIVE_SERVER_LIST:!1,LIVE_SERVER_LIST:[],ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,GATEWAY_DOMAINS:["edge.agora.io"],WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,LIVESTREAMING_ALIGN:!0,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e7,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,REPORT_STATS_TIMEOUT:3e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:1e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:2e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,TICKET_RENEW_TIMEOUT:828e5,LIVE_STREAMING_TIMEOUT:12e4,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,FORCE_CHANGED_GATEWAY_FLAG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",CHROME_NEW_STATS:!1,AP_BACKOFF_MAX_TIME:8,SET_DEFAULT_TURNSERVER:!0,TURN_SERVER_PASSWORD:r.toString(),PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",NGINX:"webrtc-cloud-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CR:!0,CRL:10,CRI:6,CUSTOMER_REPORT_TIMEOUT:5e3,LIVE_STREAMING_ADDRESS:"",CHOOSE_SERVER_FRAGEMENT_LENGTH:4,PLAN:"plan-b"};o.AREA_SETTING=["CHINA","GLOBAL"],o.WEBCS_DOMAIN=["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],o.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],o.PROXY_CS=["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],o.CDS_AP=["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],o.ACCOUNT_REGISTER=["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],o.UAP_AP=["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],o.LOG_UPLOAD_SERVER="logservice.agora.io",o.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",o.EVENT_REPORT_BACKUP_DOMAIN="web-3.statscollector.sd-rtn.com",o.GATEWAY_DOMAINS=["edge.agora.io","edge.sd-rtn.com"],o.NGINX="webrtc-cloud-proxy.sd-rtn.com",o.PROXY_SERVER_TYPE3=["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],n.setParameter=function(t,n){return void 0!==o[t]&&(o[t]=n,!0)},n.getParameter=function(t){return void 0!==o[t]?o[t]:null}},function(t,n,i){"use strict";i.r(n),i.d(n,"checkValidObject",function(){return d}),i.d(n,"checkValidString",function(){return u}),i.d(n,"checkValidNumber",function(){return l}),i.d(n,"checkValidArray",function(){return f}),i.d(n,"checkValidFloatNumber",function(){return p}),i.d(n,"checkValidBoolean",function(){return _}),i.d(n,"checkValidEnum",function(){return c}),i.d(n,"checkValidUID",function(){return g}),i.d(n,"isValidString",function(){return h}),i.d(n,"isValidNumber",function(){return m}),i.d(n,"isValidBoolean",function(){return $}),i.d(n,"isASCII",function(){return y}),i.d(n,"isInteger",function(){return R}),i.d(n,"isNumber",function(){return T}),i.d(n,"isString",function(){return I}),i.d(n,"isArray",function(){return A}),i.d(n,"isEmpty",function(){return C}),i.d(n,"isValidToken",function(){return E}),i.d(n,"isValidChannelName",function(){return S});var r=i(11),o=i.n(r),a=i(10),s=i(0),c=function(t,n,i){for(var r=0;r<i.length;r++)if(t===i[r])return!0;throw Error("".concat(n," can only be set as ").concat(JSON.stringify(i)))},d=function(t,n){if(!t)throw Error("Invalid param: ".concat(n||"param"," cannot be empty"));if("object"!==o()(t))throw Error("".concat(n||"This paramter"," is of the object type"));return!0},u=function(t,n,i,r,o){if(C(i)&&(i=1),r=r||255,C(o)&&(o=!0),C(t))throw Error("".concat(n||"param"," cannot be empty"));if(!h(t,i,r,o))throw Error("Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(r,"].").concat(o?" ASCII characters only.":""))},l=function(t,n,i,r){if(C(i)&&(i=1),r=r||1e4,C(t))throw Error("".concat(n||"param"," cannot be empty"));if(!m(t,i,r))throw Error("Invalid ".concat(n||"number param",": The value range is [").concat(i,",").concat(r,"]. integer only"))},f=function(t,n){if(!Array.isArray(t))throw Error("".concat(n," should be an array"))},p=function(t,n,i,r){if(null==t)throw Error("".concat(n||"param"," cannot be null"));if(C(i)&&(i=0),r=r||1e4,C(t))throw Error("".concat(n||"param"," cannot be empty"));if(!v(t,i,r))throw Error("Invalid ".concat(n||"number param",": The value range is [").concat(i,",").concat(r,"]."))},_=function(t,n){if(C(t))throw Error("".concat(n||"param"," cannot be empty"));if(!$(t))throw Error("Invalid ".concat(n||"boolean param",": The value is of the boolean type."))},g=function(t){if(!Object(a.is32Uint)(t)&&!h(t,1,255))throw s.default.error("Invalid UID ".concat(t," ").concat(o()(t))),Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")},h=function(t,n,i,r){return n||(n=0),i||(i=Number.MAX_SAFE_INTEGER),C(r)&&(r=!0),I(t)&&(!r||y(t))&&t.length>=n&&t.length<=i},m=function(t,n,i){return R(t)&&t>=n&&t<=i},v=function(t,n,i){return T(t)&&t>=n&&t<=i},$=function(t){return"boolean"==typeof t},E=function(t){return h(t,1,2047)},S=function(t){return I(t)&&/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t)},y=function(t){if("string"==typeof t){for(var n=0;n<t.length;n++){var i=t.charCodeAt(n);if(i<0||i>255)return!1}return!0}},R=function(t){return"number"==typeof t&&t%1==0},T=function(t){return"number"==typeof t},I=function(t){return"string"==typeof t},A=function(t){return t instanceof Array},C=function(t){return null==t}},function(t,n,i){"use strict";i.r(n),i.d(n,"getBrowserInfo",function(){return $}),i.d(n,"getBrowserVersion",function(){return p}),i.d(n,"getBrowserOS",function(){return _}),i.d(n,"isChrome",function(){return r}),i.d(n,"isSafari",function(){return o}),i.d(n,"isFireFox",function(){return s}),i.d(n,"isOpera",function(){return c}),i.d(n,"isEdge",function(){return a}),i.d(n,"isQQBrowser",function(){return d}),i.d(n,"isWeChatBrowser",function(){return u}),i.d(n,"isLegacyChrome",function(){return h}),i.d(n,"isSupportedPC",function(){return l}),i.d(n,"isSupportedMobile",function(){return f}),i.d(n,"getChromeKernelVersion",function(){return v}),i.d(n,"isChromeKernel",function(){return g});var r=function(){var t=$();return t.name&&"Chrome"===t.name},o=function(){var t=$();return t.name&&"Safari"===t.name},a=function(){var t=$();return t.name&&"Edge"===t.name},s=function(){var t=$();return t.name&&"Firefox"===t.name},c=function(){var t=$();return t.name&&"OPR"===t.name},d=function(){var t=$();return t.name&&"QQBrowser"===t.name},u=function(){var t=$();return t.name&&"MicroMessenger"===t.name},l=function(){var t=_();return"Linux"===t||"Mac OS X"===t||"Mac OS"===t||-1!==t.indexOf("Windows")},f=function(){var t=_();return"Android"===t||"iOS"===t},p=function(){return $().version},_=function(){return $().os},g=function(){return!!navigator.userAgent.match(/chrome\/[\d]+/i)};function h(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}var m,v=function(){var t=navigator.userAgent.match(/chrome\/[\d]+/i);return t&&t[0]&&t[0].split("/")[1]},$=(m=function(){var t,n=navigator.userAgent,i=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===i[1]&&null!=(t=n.match(/(OPR(?=\/))\/?(\d+)/i))&&(i=t),"Safari"===i[1]&&null!=(t=n.match(/version\/(\d+)/i))&&(i[2]=t[1]),~n.toLowerCase().indexOf("qqbrowser")&&null!=(t=n.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(i=t),~n.toLowerCase().indexOf("micromessenger")&&null!=(t=n.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(i=t),~n.toLowerCase().indexOf("edge")&&null!=(t=n.match(/(edge(?=\/))\/?(\d+)/i))&&(i=t),~n.toLowerCase().indexOf("trident")&&null!=(t=/\brv[ :]+(\d+)/g.exec(n)||[])&&(i=[null,"IE",t[1]]);var r=void 0,o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var a in o){var s=o[a];if(s.r.test(navigator.userAgent)){r=s.s;break}}return{name:i[1],version:i[2],os:r}}(),function(){return m})},function(t,n,i){"use strict";i.r(n),i.d(n,"APErrorCode",function(){return r}),i.d(n,"GatewayErrorCode",function(){return o}),i.d(n,"StringUidErrorCode",function(){return a}),i.d(n,"JOIN_GS_TRYNEXT_LIST",function(){return s}),i.d(n,"JOIN_CS_RETRY_LIST",function(){return c}),i.d(n,"JOIN_PROXY_RETRY_LIST",function(){return d}),i.d(n,"INJECT_STREAM_STATUS",function(){return u}),i.d(n,"WEBSOCKET_CLOSE_REASON",function(){return l});var r={1010100:"NO_FLAG_SET",1010101:"FLAG_SET_BUT_EMPTY",1010102:"INVALID_FALG_SET",2010005:"INVALID_VENDOR_KEY",2010007:"INVALID_CHANNEL_NAME",2010008:"INTERNAL_ERROR",2010009:"NO_AUTHORIZED",2010010:"DYNAMIC_KEY_TIMEOUT",2010011:"NO_ACTIVE_STATUS",2010013:"DYNAMIC_KEY_EXPIRED",2010014:"STATIC_USE_DYANMIC_KEY",2010015:"DYNAMIC_USE_STATIC_KEY",2010016:"USER_OVERLOAD",2010018:"FORBIDDEN_REGION",2010019:"CANNOT_MEET_AREA_DEMAND"},o={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",2011:"ERR_NOT_JOINED",2012:"WARN_REPEAT_JOIN",2013:"ERR_INVALID_VENDOR_KEY",2014:"ERR_INVALID_CHANNEL_NAME",2015:"ERR_INVALID_STRINGUID",2016:"ERR_TOO_MANY_USERS",2017:"ERR_SET_CLIENT_ROLE_TIMEOUT",2018:"ERR_SET_CLIENT_ROLE_NO_PERMISSION",2019:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",2020:"ERR_PUBLISH_REQUEST_INVALID",2021:"ERR_SUBSCRIBE_REQUEST_INVALID",2022:"ERR_NOT_SUPPORTED_MESSAGE",2023:"ERR_ILLEAGAL_PLUGIN",2028:"ILLEGAL_AES_PASSWORD",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},a={1:"ERROR_ILLEAGAL_APPID",2:"ERROR_ILLEAGAL_UID",3:"INTERNAL_SERVER_ERROR"},s=["ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_TIMEOUT","ERR_VOM_SERVICE_UNAVAILABLE","ERR_TOO_MANY_USERS","ERR_MASTER_VOCS_UNAVAILABLE","ERR_INTERNAL_ERROR"],c=["NO_SERVICE_AVAILABLE"],d=["NO_SERVICE_AVAILABLE","REQUEST_PROXY_SERVER_FAILED","REQUEST_PROXY_SERVER_TIME_OUT"],u={INJECT_STREAM_STATUS_START_SUCCESS:0,INJECT_STREAM_STATUS_START_ALREADY_EXISTS:1,INJECT_STREAM_STATUS_START_UNAUTHORIZED:2,INJECT_STREAM_STATUS_START_TIMEDOUT:3,INJECT_STREAM_STATUS_START_FAILED:4,INJECT_STREAM_STATUS_STOP_SUCCESS:5,INJECT_STREAM_STATUS_STOP_NOT_FOUND:6,INJECT_STREAM_STATUS_STOP_UNAUTHORIZED:7,INJECT_STREAM_STATUS_STOP_TIMEDOUT:8,INJECT_STREAM_STATUS_STOP_FAILED:9,INJECT_STREAM_STATUS_BROKEN:10},l={WS_DISCONNECT:"WS_DISCONNECT"};n.default={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_CLIENT_MODE:"INVALID_CLIENT_MODE",INVALID_CLIENT_CODEC:"INVALID_CLIENT_CODEC",CLIENT_MODE_CODEC_MISMATCH:"CLIENT_MODE_CODEC_MISMATCH",WEB_API_NOT_SUPPORTED:"WEB_API_NOT_SUPPORTED",INVALID_PARAMETER:"INVALID_PARAMETER",NO_TRACK_IN_STREAM:"NO_TRACK_IN_STREAM",INVALID_OPERATION:"INVALID_OPERATION",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",INVALID_DYNAMIC_KEY:"INVALID_DYNAMIC_KEY",DYNAMIC_KEY_TIMEOUT:"DYNAMIC_KEY_TIMEOUT",NO_VOCS_AVAILABLE:"NO_VOCS_AVAILABLE",NO_VOS_AVAILABLE:"ERR_NO_VOS_AVAILABLE",JOIN_CHANNEL_TIMEOUT:"ERR_JOIN_CHANNEL_TIMEOUT",NO_AVAILABLE_CHANNEL:"NO_AVAILABLE_CHANNEL",LOOKUP_CHANNEL_TIMEOUT:"LOOKUP_CHANNEL_TIMEOUT",LOOKUP_CHANNEL_REJECTED:"LOOKUP_CHANNEL_REJECTED",OPEN_CHANNEL_TIMEOUT:"OPEN_CHANNEL_TIMEOUT",OPEN_CHANNEL_REJECTED:"OPEN_CHANNEL_REJECTED",REQUEST_DEFERRED:"REQUEST_DEFERRED",STREAM_ALREADY_PUBLISHED:"STREAM_ALREADY_PUBLISHED",STREAM_NOT_YET_PUBLISHED:"STREAM_NOT_YET_PUBLISHED",JOIN_TOO_FREQUENT:"JOIN_TOO_FREQUENT",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED",NO_SUCH_REMOTE_STREAM:"NO_SUCH_REMOTE_STREAM",ERR_FAILED:"1",ERR_INVALID_VENDOR_KEY:"101",ERR_INVALID_CHANNEL_NAME:"102",WARN_NO_AVAILABLE_CHANNEL:"103",WARN_LOOKUP_CHANNEL_TIMEOUT:"104",WARN_LOOKUP_CHANNEL_REJECTED:"105",WARN_OPEN_CHANNEL_TIMEOUT:"106",WARN_OPEN_CHANNEL_REJECTED:"107",WARN_REQUEST_DEFERRED:"108",ERR_DYNAMIC_KEY_TIMEOUT:"109",ERR_INVALID_DYNAMIC_KEY:"110",ERR_NO_VOCS_AVAILABLE:"2000",ERR_NO_VOS_AVAILABLE:"2001",ERR_JOIN_CHANNEL_TIMEOUT:"2002",IOS_NOT_SUPPORT:"IOS_NOT_SUPPORT",WECHAT_NOT_SUPPORT:"WECHAT_NOT_SUPPORT",SHARING_SCREEN_NOT_SUPPORT:"SHARING_SCREEN_NOT_SUPPORT",STILL_ON_PUBLISHING:"STILL_ON_PUBLISHING",LOW_STREAM_ALREADY_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",LOW_STREAM_NOT_YET_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",HIGH_STREAM_NOT_VIDEO_TRACE:"HIGH_STREAM_NOT_VIDEO_TRACE",NOT_FIND_DEVICE_BY_LABEL:"NOT_FIND_DEVICE_BY_LABEL",ENABLE_DUALSTREAM_FAILED:"ENABLE_DUALSTREAM_FAILED",DISABLE_DUALSTREAM_FAILED:"DISABLE_DUALSTREAM_FAILED",PLAYER_NOT_FOUND:"PLAYER_NOT_FOUND",ELECTRON_NOT_SUPPORT_SHARING_SCREEN:"ELECTRON_NOT_SUPPORT_SHARING_SCREEN",BAD_ENVIRONMENT:"BAD_ENVIRONMENT",LOAD_AUDIO_FAILED:"LOAD_AUDIO_FAILED"}},function(t,n,i){"use strict";i.d(n,"b",function(){return r}),i.d(n,"a",function(){return o}),i.d(n,"c",function(){return a}),i(0);var r=function(t,n,i){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight","VideoPublishDuration","AudioPublishDuration"].indexOf(n)>-1&&("string"==typeof i||isFinite(i)))return t[n]=""+i},o=function(t){var n={};return t.forEach(function(t){t.id&&t.type&&(-1===t.id.indexOf("send")&&-1===t.type.toLowerCase().indexOf("outbound")&&-1===t.id.indexOf("outbound_rtp")&&-1===t.id.indexOf("OutboundRTP")||("audio"===t.mediaType?(r(n,"audioSendBytes",t.bytesSent),r(n,"audioSendPackets",t.packetsSent),r(n,"audioSendPacketsLost",t.packetsLost)):(r(n,"videoSendBytes",t.bytesSent),r(n,"videoSendPackets",t.packetsSent),r(n,"videoSendPacketsLost",t.packetsLost),r(n,"videoSendFrameRate",t.googFrameRateSent),r(n,"videoSendResolutionWidth",t.googFrameWidthSent),r(n,"videoSendResolutionHeight",t.googFrameHeightSent))))}),n},a=function(t){var n={};return t.forEach(function(t){t.id&&t.type&&(-1===t.id.indexOf("recv")&&-1===t.type.toLowerCase().indexOf("inbound")&&-1===t.id.indexOf("inbound_rtp")&&-1===t.id.indexOf("inbound-rtp")&&-1===t.id.indexOf("InboundRTP")||("audio"===t.mediaType?(r(n,"audioReceiveBytes",t.bytesReceived),r(n,"audioReceivePackets",t.packetsReceived),r(n,"audioReceivePacketsLost",t.packetsLost)):(r(n,"videoReceiveBytes",t.bytesReceived),r(n,"videoReceivePacketsLost",t.packetsLost),r(n,"videoReceivePackets",t.packetsReceived),r(n,"videoReceiveFrameRate",t.googFrameRateReceived),r(n,"videoReceiveDecodeFrameRate",t.googFrameRateDecoded),r(n,"videoReceiveResolutionWidth",t.googFrameWidthReceived),r(n,"videoReceiveResolutionHeight",t.googFrameHeightReceived))))}),n}},function(t,n){function i(){return t.exports=i=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},i.apply(this,arguments)}t.exports=i},function(t,n,i){"use strict";i.d(n,"b",function(){return o}),i.d(n,"e",function(){return s}),i.d(n,"a",function(){return c}),i.d(n,"d",function(){return d}),i.d(n,"c",function(){return u});var r=i(0),o=function(){var t={dispatcher:{}};return t.dispatcher.eventListeners={},t.addEventListener=function(n,i){void 0===t.dispatcher.eventListeners[n]&&(t.dispatcher.eventListeners[n]=[]),t.dispatcher.eventListeners[n].push(i)},t.hasListeners=function(n){return!(!t.dispatcher.eventListeners[n]||!t.dispatcher.eventListeners[n].length)},t.on=t.addEventListener,t.removeEventListener=function(n,i){var r;t.dispatcher.eventListeners[n]&&-1!==(r=t.dispatcher.eventListeners[n].indexOf(i))&&t.dispatcher.eventListeners[n].splice(r,1)},t.dispatchEvent=function(n){var i;for(i in t.dispatcher.eventListeners[n.type])if(t.dispatcher.eventListeners[n.type]&&t.dispatcher.eventListeners[n.type].hasOwnProperty(i)&&"function"==typeof t.dispatcher.eventListeners[n.type][i])try{t.dispatcher.eventListeners[n.type][i](n)}catch(o){r.default.debug("[".concat(t.clientId,"] Error in ").concat(n.type," event"),o)}},t.dispatchSocketEvent=function(n){var i;for(i in t.dispatcher.eventListeners[n.type])t.dispatcher.eventListeners[n.type]&&t.dispatcher.eventListeners[n.type].hasOwnProperty(i)&&"function"==typeof t.dispatcher.eventListeners[n.type][i]&&t.dispatcher.eventListeners[n.type][i](n.msg)},t},a=function(t){var n={};return n.type=t.type,n},s=function(t){var n=a(t);return n.stream=t.stream,n.reason=t.reason,n.msg=t.msg,n},c=function(t){var n=a(t);return n.uid=t.uid,n.attr=t.attr,n.stream=t.stream,n},d=function(t){var n=a(t);return n.msg=t.msg,n},u=function(t){var n=a(t);return n.url=t.url,n.uid=t.uid,n.status=t.status,n.reason=t.reason,n}},function(t,n,i){"use strict";var r,o=this&&this.__extends||(r=function(t,n){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),a=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var d=c(i(69)),u=i(2),l=c(i(0)),f=i(3),p=i(14),_=i(10),g=function(t){function n(n,i){var r=t.call(this)||this;return r._state=E.RELAY_STATE_IDLE,r._onStatus=function(t){l.default.debug("["+r.clientId+"] ChannelMediaStatus: "+JSON.stringify(t)),t&&t.command&&("onAudioPacketReceived"===t.command&&r.emit("event",$.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===t.command&&r.emit("event",$.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===t.command&&(r._state=E.RELAY_STATE_FAILURE,r.emit("state",E.RELAY_STATE_FAILURE,S.SRC_TOKEN_EXPIRED)),"onDestTokenPrivilegeDidExpire"===t.command&&(r._state=E.RELAY_STATE_FAILURE,r.emit("state",E.RELAY_STATE_FAILURE,S.DEST_TOKEN_EXPIRED,t.channelName?{came:t.channelName}:null)))},r._onClose=function(){return a(r,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:if(l.default.debug("["+this.clientId+"] ChannelMediaSocket onClose"),this.emit("event",$.NETWORK_DISCONNECTED),this.state=E.RELAY_STATE_IDLE,!this._prevChannelMediaConfig)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startChannelMediaRelay(this._prevChannelMediaConfig)];case 2:return n.sent(),[3,4];case 3:return(t=n.sent())instanceof b&&(t.message===m.WS_ABORT||t.message===m.AP_REQUEST_ABORT)?[2]:(this.emit("state",E.RELAY_STATE_FAILURE,S.SERVER_CONNECTION_LOST),[3,4]);case 4:return[2]}})})},r.token=n.appId,r.appId=n.appId,r.cname=n.cname,r.uid=n.uid,r.sid=n.sid,r.clientId=i,r}return o(n,t),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){var n=this._state;this._state=t,n!==t&&this.emit("state",t)},enumerable:!0,configurable:!0}),n.prototype.startChannelMediaRelay=function(t){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:if(this.state!==E.RELAY_STATE_IDLE)throw new b(m.BAD_STATE);return this.state=E.RELAY_STATE_CONNECTING,[4,this._connect()];case 1:return n.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: connect success"),[4,this._sendStartRelayMessage(t)];case 2:return n.sent(),this._prevChannelMediaConfig=t,[2]}})})},n.prototype.updateChannelMediaRelay=function(t){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:if(this.state!==E.RELAY_STATE_RUNNING)throw new b(m.BAD_STATE);return[4,this._sendUpdateMessage(t)];case 1:return n.sent(),this._prevChannelMediaConfig=t,[2]}})})},n.prototype.stopChannelMediaRelay=function(){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._sendStopRelayMessage()];case 1:return t.sent(),l.default.debug("["+this.clientId+"] stopChannelMediaRelay: send stop message success"),this.state=E.RELAY_STATE_IDLE,this.dispose(),[2]}})})},n.prototype.dispose=function(){l.default.debug("["+this.clientId+"] disposeChannelMediaRelay"),this.state=E.RELAY_STATE_IDLE,this.emit("dispose"),this._signal&&this._signal.dispose(),this._prevChannelMediaConfig=null,this.removeEvent()},n.prototype._requestOneAP=function(t){var n=this;return new Promise(function(i,r){var o={service_name:"tele_channel",json_body:JSON.stringify({command:"convergeAllocateEdge",sid:n.sid,appId:n.appId,token:"",ts:+new Date,version:u.VERSION,cname:n.cname,uid:n.uid+"",seq:1,requestId:1})},a="https://"+t;p.post(a,o,function(t){var n=null,o=null;try{n=JSON.parse(t)}catch(a){r(new b(m.AP_JSON_PARSE_ERROR,a))}0!==n.code&&r(new b(m.AP_REQUEST_ERROR,n));try{o=JSON.parse(n.json_body)}catch(s){r(new b(m.AP_JSON_PARSE_ERROR,s))}200!==o.code&&r(new b(m.AP_REQUEST_ERROR,o)),o.servers?i(o.servers):r(new b(m.AP_JSON_PARSE_ERROR,o))},function(t){return r(t)},{"X-Packet-Service-Type":0,"X-Packet-URI":61})})},n.prototype._requestAP=function(){var t=this,n=u.getParameter("UAP_AP");return new Promise(function(i,r){setTimeout(function(){r(new b(m.AP_REQUEST_TIMEOUT))},5e3),t.on("dispose",function(){r(new b(m.AP_REQUEST_ABORT))}),n.forEach(function(n){n+="/api/v1",t._requestOneAP(n).then(function(r){l.default.debug("["+t.clientId+"] startChannelMediaRelay request AP "+n+" success: "+JSON.stringify(r));var o=r[0];i("wss://"+o.address.replace(/\./g,"-")+".edge.agora.io:"+o.wss)}).catch(function(i){l.default.debug("["+t.clientId+"] startChannelMediaRelay request AP "+n+" failed: "+JSON.stringify(i))})})})},n.prototype._connectWebsocket=function(t){return this._signal=new C(this.appId,this.cname,this.uid,this.sid),this._signal.connect(t)},n.prototype._connect=function(){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this._requestAP()];case 1:return t=n.sent(),[4,this._connectWebsocket(t)];case 2:return n.sent(),this._signal.on("close",this._onClose.bind(this)),this._signal.on("status",this._onStatus.bind(this)),this.emit("event",$.NETWORK_CONNECTED),[2]}})})},n.prototype._sendStartRelayMessage=function(t){return a(this,void 0,void 0,function(){var n,i,r,o,a,c;return s(this,function(s){switch(s.label){case 0:return this._checkSignal(),n=this._genMessage(v.StopPacketTransfer),[4,this._signal.request(n)];case 1:return s.sent(),[4,this._signal.waitStatus("Normal Quit")];case 2:return s.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: StopPacketTransfer success"),i=this._genMessage(v.SetSdkProfile,t),[4,this._signal.request(i)];case 3:return s.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSdkProfile success"),r=this._genMessage(v.SetSourceChannel,t),[4,this._signal.request(r)];case 4:return s.sent(),[4,this._signal.waitStatus("SetSourceChannelStatus")];case 5:return s.sent(),this.emit("event",$.PACKET_JOINED_SRC_CHANNEL),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceChannel success"),o=this._genMessage(v.SetSourceUserId,t),[4,this._signal.request(o)];case 6:return s.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceUserId success"),a=this._genMessage(v.SetDestChannel,t),[4,this._signal.request(a)];case 7:return s.sent(),[4,this._signal.waitStatus("SetDestChannelStatus")];case 8:return s.sent(),this.emit("event",$.PACKET_JOINED_DEST_CHANNEL),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetDestChannel success"),c=this._genMessage(v.StartPacketTransfer,t),[4,this._signal.request(c)];case 9:return s.sent(),this.emit("event",$.PACKET_SENT_TO_DEST_CHANNEL),this.state=E.RELAY_STATE_RUNNING,l.default.debug("["+this.clientId+"] startChannelMediaRelay: StartPacketTransfer success"),[2]}})})},n.prototype._sendReconnectMessage=function(t){return a(this,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return this._checkSignal(),n=this._genMessage(v.Reconnect,t),[4,this._signal.request(n)];case 1:return i.sent(),[2]}})})},n.prototype._sendUpdateMessage=function(t){return a(this,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return this._checkSignal(),n=this._genMessage(v.UpdateDestChannel,t),[4,this._signal.request(n)];case 1:return i.sent(),this.emit("event",$.PACKET_UPDATE_DEST_CHANNEL),l.default.debug("["+this.clientId+"] sendUpdateMessage: UpdateDestChannel success"),[2]}})})},n.prototype._sendStopRelayMessage=function(){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return this._checkSignal(),t=this._genMessage(v.StopPacketTransfer),[4,this._signal.request(t)];case 1:return n.sent(),l.default.debug("["+this.clientId+"] sendStopRelayMessage: StopPacketTransfer success"),[2]}})})},n.prototype._genMessage=function(t,n){var i=this,r=[],o=[],a=[],s={appId:this.appId,cname:this.cname,uid:this.uid+"",sdkVersion:u.VERSION,sid:this.sid,ts:+new Date,requestId:0,seq:0,allocate:!0,clientRequest:{}},c=null;switch(t){case v.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case v.SetSourceChannel:return c=n.getSrcChannelMediaInfo(),s.clientRequest={command:"SetSourceChannel",uid:c.uid+"",channelName:c.channelName,token:c.token||this.appId},s;case v.SetSourceUserId:return c=n.getSrcChannelMediaInfo(),s.clientRequest={command:"SetSourceUserId",uid:this.uid+""},s;case v.SetDestChannel:return n.getDestChannelMediaInfos().forEach(function(t){r.push(t.channelName),o.push(t.uid+""),a.push(t.token||i.appId)}),s.clientRequest={command:"SetDestChannel",channelName:r,uid:o,token:a},s;case v.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case v.Reconnect:return s.clientRequest={command:"Reconnect"},s;case v.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case v.UpdateDestChannel:return n.getDestChannelMediaInfos().forEach(function(t){r.push(t.channelName),o.push(t.uid+""),a.push(t.token||i.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:r,uid:o,token:a},s}},n.prototype._checkSignal=function(){if(!this._signal||!this._signal.isConnect())throw new b(m.WS_DISCONNECTED)},n}(d.default);n.default=g;var h=function(){function t(){this.destChannelMediaInfos=new Map}return t.prototype.setSrcChannelInfo=function(t){f.checkValidObject(t,"srcInfo");var n=t.uid,i=t.channelName,r=t.token;if(r&&!f.isValidToken(r))throw Error("Invalid token in SrcChannelInfo");if(!f.isValidChannelName(i))throw Error("Invalid channelName in SrcChannelInfo");if(!_.is32Uint(n))throw Error("Invalid uid in SrcChannelInfo");this.srcChannelMediaInfo=t},t.prototype.setDestChannelInfo=function(t,n){if(!f.isValidChannelName(t))throw Error("Invalid channelName in DestChannelInfo");f.checkValidObject(n,"destInfo");var i=n.uid,r=n.token,o=n.channelName;if(r&&!f.isValidToken(r))throw Error("Invalid token in DestChannelInfo");if(!f.isValidChannelName(o))throw Error("Invalid channelName in DestChannelInfo");if(!_.is32Uint(i))throw Error("Invalid uid in DestChannelInfo");this.destChannelMediaInfos.set(t,n)},t.prototype.removeDestChannelInfo=function(t){if(!f.isValidChannelName(t))throw Error("Invalid channelName when invoke removeDestChannelInfo");this.destChannelMediaInfos.delete(t)},t.prototype.getSrcChannelMediaInfo=function(){return this.srcChannelMediaInfo},t.prototype.getDestChannelMediaInfos=function(){return this.destChannelMediaInfos},t}();n.ChannelMediaRelayConfiguration=h;var m,v,$,E,S,y,R,T,I,A,C=function(t){function n(n,i,r,o){var a=t.call(this)||this;return a._onOpen=function(){a.emit("open")},a._onClose=function(t){a.emit("close"),a.dispose()},a._onMessage=function(t){var n=JSON.parse(t.data);if(!n||"serverResponse"!==n.command||!n.requestId)return n&&"serverStatus"===n.command&&n.serverStatus&&n.serverStatus.command?(a.emit("status",n.serverStatus),void a.emit(n.serverStatus.command,n.serverStatus)):void 0;a.emit("req_"+n.requestId,n)},a._requestId=1,a.appId=n,a.cname=i,a.uid=r,a.sid=o,a}return o(n,t),n.prototype.isConnect=function(){return this._ws&&this._ws.readyState===WebSocket.OPEN},n.prototype.sendMessage=function(t){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new b(m.WS_DISCONNECTED);var n=this._requestId++;return t.requestId=n,t.seq=n,this._ws.send(JSON.stringify(t)),n},n.prototype.waitStatus=function(t){var n=this;return new Promise(function(i,r){var o=window.setTimeout(function(){r(new b(m.WAIT_STATUS_TIMEOUT,t))},5e3);n.once(t,function(n){clearTimeout(o),n.state&&0!==n.state?r(new b(m.WAIT_STATUS_ERROR,t)):i()}),n.once("dispose",function(){clearTimeout(o),r(new b(m.WS_ABORT))})})},n.prototype.request=function(t){var n=this;return new Promise(function(i,r){var o=n.sendMessage(t),a=window.setTimeout(function(){n.removeAllListeners("req_"+o),r(new b(m.REQUEST_TIMEOUT))},3e3);n.once("req_"+o,function(t){clearTimeout(a),t&&200===t.code?i(t):r(new b(m.REQUEST_FAILED,t))}),n.once("dispose",function(){clearTimeout(a),r(new b(m.WS_ABORT))})})},n.prototype.connect=function(t){var n=this;return new Promise(function(i,r){n._ws=new WebSocket(t),n._ws.onopen=function(){n._onOpen(),n._prvUrl=t,n._ws.onmessage=n._onMessage,n._ws.onclose=n._onClose,n._startHeartBeatCheck(),i()},n._ws.onclose=function(t){n._ws=null,r(new b(m.CONNECT_FAILED,"websocket error code: "+t.code))},setTimeout(function(){n._ws&&n._ws.readyState!==WebSocket.OPEN&&(n._ws.onopen=null,n._ws.onclose=null,n._ws.close(),n._ws=null,r(new b(m.CONNECT_TIMEOUT)))},5e3),n.once("dispose",function(){r(new b(m.WS_ABORT))})})},n.prototype.dispose=function(){this._clearHeartBeatCheck(),this.emit("dispose"),this.removeEvent(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.close()),this._ws=null},n.prototype._sendPing=function(t){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new b(m.WS_DISCONNECTED);var n=this._requestId++;return t.requestId=n,this._ws.send(JSON.stringify(t)),n},n.prototype._startHeartBeatCheck=function(){var t=this;this._heartBeatTimer=window.setInterval(function(){t._sendPing({command:"ping",appId:t.appId,cname:t.cname,uid:t.uid+"",sid:t.sid,ts:+new Date,requestId:0})},3e3)},n.prototype._clearHeartBeatCheck=function(){window.clearInterval(this._heartBeatTimer)},n}(d.default),b=function(t,n,i){void 0===t&&(t=""),this.code=i,this.data=n,this.message=t};n.ChannelMediaError=b,(y=m=n.CHANNEL_MEDIA_ERROR||(n.CHANNEL_MEDIA_ERROR={})).CONNECT_FAILED="connect failed",y.CONNECT_TIMEOUT="connect timeout",y.WS_DISCONNECTED="websocket disconnected",y.REQUEST_TIMEOUT="request timeout",y.REQUEST_FAILED="request failed",y.WAIT_STATUS_TIMEOUT="wait status timeout",y.WAIT_STATUS_ERROR="wait status error",y.BAD_STATE="bad state",y.WS_ABORT="ws abort",y.AP_REQUEST_TIMEOUT="AP request timeout",y.AP_JSON_PARSE_ERROR="AP json parse error",y.AP_REQUEST_ERROR="AP request error",y.AP_REQUEST_ABORT="AP request abort",(R=v||(v={}))[R.SetSdkProfile=0]="SetSdkProfile",R[R.SetSourceChannel=1]="SetSourceChannel",R[R.SetSourceUserId=2]="SetSourceUserId",R[R.SetDestChannel=3]="SetDestChannel",R[R.StartPacketTransfer=4]="StartPacketTransfer",R[R.StopPacketTransfer=5]="StopPacketTransfer",R[R.UpdateDestChannel=6]="UpdateDestChannel",R[R.Reconnect=7]="Reconnect",R[R.SetVideoProfile=8]="SetVideoProfile",(T=$=n.CHANNEL_MEDIA_RELAY_EVENT||(n.CHANNEL_MEDIA_RELAY_EVENT={}))[T.NETWORK_DISCONNECTED=0]="NETWORK_DISCONNECTED",T[T.NETWORK_CONNECTED=1]="NETWORK_CONNECTED",T[T.PACKET_JOINED_SRC_CHANNEL=2]="PACKET_JOINED_SRC_CHANNEL",T[T.PACKET_JOINED_DEST_CHANNEL=3]="PACKET_JOINED_DEST_CHANNEL",T[T.PACKET_SENT_TO_DEST_CHANNEL=4]="PACKET_SENT_TO_DEST_CHANNEL",T[T.PACKET_RECEIVED_VIDEO_FROM_SRC=5]="PACKET_RECEIVED_VIDEO_FROM_SRC",T[T.PACKET_RECEIVED_AUDIO_FROM_SRC=6]="PACKET_RECEIVED_AUDIO_FROM_SRC",T[T.PACKET_UPDATE_DEST_CHANNEL=7]="PACKET_UPDATE_DEST_CHANNEL",T[T.PACKET_UPDATE_DEST_CHANNEL_REFUSED=8]="PACKET_UPDATE_DEST_CHANNEL_REFUSED",T[T.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE=9]="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",(I=E=n.CHANNEL_MEDIA_RELAY_STATE||(n.CHANNEL_MEDIA_RELAY_STATE={}))[I.RELAY_STATE_IDLE=0]="RELAY_STATE_IDLE",I[I.RELAY_STATE_CONNECTING=1]="RELAY_STATE_CONNECTING",I[I.RELAY_STATE_RUNNING=2]="RELAY_STATE_RUNNING",I[I.RELAY_STATE_FAILURE=3]="RELAY_STATE_FAILURE",(A=S=n.CHANNEL_MEDIA_RELAY_ERROR||(n.CHANNEL_MEDIA_RELAY_ERROR={}))[A.RELAY_OK=0]="RELAY_OK",A[A.SERVER_ERROR_RESPONSE=1]="SERVER_ERROR_RESPONSE",A[A.SERVER_NO_RESPONSE=2]="SERVER_NO_RESPONSE",A[A.NO_RESOURCE_AVAILABLE=3]="NO_RESOURCE_AVAILABLE",A[A.FAILED_JOIN_SRC=4]="FAILED_JOIN_SRC",A[A.FAILED_JOIN_DEST=5]="FAILED_JOIN_DEST",A[A.FAILED_PACKET_RECEIVED_FROM_SRC=6]="FAILED_PACKET_RECEIVED_FROM_SRC",A[A.FAILED_PACKET_SENT_TO_DEST=7]="FAILED_PACKET_SENT_TO_DEST",A[A.SERVER_CONNECTION_LOST=8]="SERVER_CONNECTION_LOST",A[A.INTERNAL_ERROR=9]="INTERNAL_ERROR",A[A.SRC_TOKEN_EXPIRED=10]="SRC_TOKEN_EXPIRED",A[A.DEST_TOKEN_EXPIRED=11]="DEST_TOKEN_EXPIRED",A[A.RELAY_ALREADY_START=12]="RELAY_ALREADY_START",A[A.RELAY_NOT_START=13]="RELAY_NOT_START",A[A.OPERATION_ABORT=14]="OPERATION_ABORT"},function(t,n,i){"use strict";i.r(n),i.d(n,"isLiveTranscodingValid",function(){return S}),i.d(n,"generateSessionId",function(){return v}),i.d(n,"audioLevelHelper",function(){return g}),i.d(n,"vsResHack",function(){return $}),i.d(n,"is32Uint",function(){return E}),i.d(n,"safeCall",function(){return f}),i.d(n,"random",function(){return R}),i.d(n,"popBanTip",function(){return A}),i.d(n,"lengthInUtf8Bytes",function(){return T}),i.d(n,"audioTimerLoop",function(){return I}),i.d(n,"generateId",function(){return m}),i.d(n,"uint8ArrayToBase64",function(){return p}),i.d(n,"base64ToUint8Array",function(){return _});var r=i(11),o=i.n(r),a=i(4),s=i(0),c=i(28),d=i.n(c),u=i(25),l=i(15),f=function(){var t=arguments[0];if("function"==typeof t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n)}},p=function(t){for(var n="",i=0;i<t.length;i+=1)n+=String.fromCharCode(t[i]);return window.btoa(n)},_=function(t){for(var n=window.atob(t),i=new Uint8Array(new ArrayBuffer(n.length)),r=0;r<n.length;r+=1)i[r]=n.charCodeAt(r);return i},g=function(t){return this.audioContext=Object(u.a)(),this.sourceNode=t.otWebkitAudioSource||this.audioContext.createMediaStreamSource(t),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var t=0,n=0;n<this.timeDomainData.length;n++)t=Math.max(t,Math.abs(this.timeDomainData[n]-128));return t/128}return s.default.warning("can't find analyser in audioLevelHelper"),0},this},h=1e4;function m(){return++h}function v(){return d()().replace(/-/g,"").toUpperCase()}var $=function(t,n,i){try{s.default.debug("start vsResHack",t);var r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(r);var o=!1;r.addEventListener("playing",function(i){a.isFireFox()?r.videoWidth&&(o=!0,s.default.debug("[vsResHack] get stream resolution: ","".concat(r.videoWidth," x ").concat(r.videoHeight),t),n(r.videoWidth,r.videoHeight),r.srcObject=null,r.remove()):(o=!0,s.default.debug("[vsResHack] get stream resolution: ","".concat(r.videoWidth," x ").concat(r.videoHeight),t),n(r.videoWidth,r.videoHeight),r.srcObject=null,r.remove())}),Object(l.setSrcObject)(r,t),r.play().catch(function(){}),setTimeout(function(){!o&&r&&(n(r.videoWidth,r.videoHeight),r.srcObject=null,r.remove())},4e3)}catch(c){i(c)}},E=function(t){return"number"==typeof t&&0<=t&&t<=4294967295},S=function(t){var n=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var i in t)if("lowLatency"===i&&"boolean"!=typeof t[i]||"userConfigExtraInfo"===i&&"object"!==o()(t[i])||"transcodingUsers"===i&&!y(t[i])||!~n.indexOf(i)&&"number"!=typeof t[i])throw Error("Param ["+i+"] is inValid");return!0},y=function(t){for(var n=0;n<t.length;n++)for(var i in t[n])if("number"!=typeof t[n][i])throw Error("Param user["+n+"] - ["+i+"] is inValid");return!0},R=function(t){isNaN(t)&&(t=1e3);var n=+new Date;return Math.ceil((n=(9301*n+49297)%233280)/233280*t)},T=function(t){var n=encodeURIComponent(t).match(/%[89ABab]/g);return t.length+(n?n.length:0)},I=function(t,n){var i=1/n,r=Object(u.a)(),o=r.createGain();o.gain.value=0,o.connect(r.destination);var a=!1;return function n(){var s=r.createOscillator();s.onended=n,s.connect(o),s.start(0),s.stop(r.currentTime+i),t(r.currentTime),a&&(s.onended=function(){})}(),function(){a=!0}},A=function(){if(!document.getElementById("agora-ban-tip")){var t=document.createElement("div");t.id="agora-ban-tip",t.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(t);var n=document.createElement("div");n.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",t.append(n);var i=document.createElement("div");i.style="height: 76px; display: flex; justify-content: center; align-items: center;";var r=document.createElement("span");r.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",r.innerText="!";var o=document.createElement("span");o.innerText="This browser does not support webRTC",i.append(r),i.append(o);var a=document.createElement("div");a.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",a.innerText="OK",n.append(i),n.append(a),a.onclick=function(){var t=document.getElementById("agora-ban-tip");t.parentNode.removeChild(t)}}}},function(t,n){function i(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=i=function(t){return typeof t}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(n)}t.exports=i},function(t,n,i){t.exports=i(64)},function(t,n,i){"use strict";var r=i(12),o=i.n(r),a=i(17),s=i.n(a),c=i(11),d=i.n(c),u=i(32),l=i.n(u),f=i(7),p=i.n(f),_=i(22),g=i(8),h=function(t){t&&t.apply(this,[].slice.call(arguments,1))},m=i(0),v=i(1),$=i(10),E=i(14),S=i(2),y=function(t){var n=Object(g.b)(t);n.needReconnect=!0,n.isTimeout=!1,n.isInit=!0,n.sendbytes=0,n.recvbytes=0,n.startTime=Date.now(),n.lastMsgTime=null,n.clientId=t.clientId,n.hostIndex=0,n.requestID=0,t.host instanceof Array?n.host=t.host:n.host=[t.host],n.getSendBytes=function(){return n.sendbytes},n.getRecvBytes=function(){return n.recvbytes},n.getDuration=function(){return Math.ceil((Date.now()-n.startTime)/1e3)},n.getURL=function(){return n.connection.url},n.reconnect=function(){n.isInit=!0,n.creatConnection()},n.connectNext=function(){n.isInit=!0,++n.hostIndex,m.default.debug("["+n.clientId+"] Gateway length:"+n.host.length+" current index:"+n.hostIndex),n.hostIndex>=n.host.length?n.dispatchEvent(Object(g.d)({type:"recover"})):n.creatConnection()},n.replaceHost=function(t){n.host=t||n.host,n.hostIndex=0,n.creatConnection()},n.creatConnection=function(){n.needReconnect=!0,n.lts=(new Date).getTime(),n.connection=new WebSocket("wss://"+n.host[n.hostIndex]),n.connection.binaryType="arraybuffer",n.turnConfig={};var i=t.proxyServerType;if(n.connection.url&&3!==i&&4!==i&&5!==i){var r=n.connection.url.match(/wss\:\/\/([^:]+):(\d+)/),o=n.host[n.hostIndex].split(":"),a=n.connection.url.match(/h=([^:]+)&p=(\d+)/);r?(n.turnConfig.url=r[1],Object(S.getParameter)("TURN_ENABLE_TCP")&&(n.turnConfig.tcpport=parseInt(r[2])+30),Object(S.getParameter)("TURN_ENABLE_UDP")&&(n.turnConfig.udpport=parseInt(r[2])+30)):a?(n.turnConfig.url=a[1],Object(S.getParameter)("TURN_ENABLE_TCP")&&(n.turnConfig.tcpport=parseInt(a[2])+30),Object(S.getParameter)("TURN_ENABLE_UDP")&&(n.turnConfig.udpport=parseInt(a[2])+30)):o&&(n.turnConfig.url=o[0],Object(S.getParameter)("TURN_ENABLE_TCP")&&(n.turnConfig.tcpport=parseInt(o[1])+30),Object(S.getParameter)("TURN_ENABLE_UDP")&&(n.turnConfig.udpport=parseInt(o[1])+30))}n.connection.onopen=function(t){n.needReconnect=!0,n.isTimeout=!1,n.isInit=!1,n.sendbytes=0,n.recvbytes=0,n.startTime=Date.now(),Object(E.resetHTTPByetsCount)(),clearTimeout(n.timeoutCheck),n.dispatchEvent(Object(g.d)({type:"onopen",event:t,socket:n}))},n.connection.onmessage=function(t){if(t.data instanceof ArrayBuffer)n.dispatchEvent({type:"onBinaryData",data:t.data});else{n.recvbytes+=Object($.lengthInUtf8Bytes)(t.data);var i=JSON.parse(t.data);n.lastMsgTime=Date.now(),i.hasOwnProperty("_id")?n.dispatchEvent(Object(g.d)({type:i._id,msg:i})):i.hasOwnProperty("_type")&&n.dispatchSocketEvent(Object(g.d)({type:i._type,msg:i._message}))}},n.connection.onclose=function(i){n.needReconnect?n.isTimeout||n.isInit?(m.default.debug("["+n.clientId+"] websockect connect timeout"),v.report.joinGateway(t.sid,{lts:n.lts,succ:!1,ec:"timeout",addr:n.connection.url}),n.connectNext()):(n.dispatchEvent(Object(g.d)({type:"disconnect",event:i})),n.requests&&n.requests instanceof Array&&(n.requests.map(function(t){t.callback("REQUEST_ABORT")}),n.requests=[])):(m.default.debug("["+n.clientId+"] websockect closeed"),h(t.onFailure,i),clearTimeout(n.timeoutCheck),n.dispatchEvent(Object(g.d)({type:"close",event:i})),n.connection.onopen=void 0,n.connection.onclose=void 0,n.connection.onerror=void 0,n.connection.onmessage=void 0,n.connection=void 0)},n.connection.onerror=function(t){},setTimeout(function(){n.connection&&n.connection.readyState!=WebSocket.OPEN&&(n.isTimeout=!0,n.connection.close())},5e3)},n.creatConnection(),n.sendMessage=function(t,i){if(n.connection&&n.connection.readyState==WebSocket.OPEN){var r=JSON.stringify(t);n.sendbytes+=Object($.lengthInUtf8Bytes)(r),n.connection.send(r)}else i({error:"Gateway not connected"})},n.disconnect=function(){n.needReconnect=!0,n.connection.close()},n.close=function(){n.needReconnect=!1,n.connection.onclose=void 0,n.connection.close(),clearInterval(n.requestTimer),n.requests&&n.requests instanceof Array&&(n.requests.map(function(t){t.callback("REQUEST_ABORT")}),n.requests=[])},n.sendSignalCommand=function(t,i){t._id="_request_"+n.requestID,n.requestID+=1,"publish_stats"!==t._type&&"subscribe_stats"!==t._type&&"publish_stats_low"!==t._type&&n.on(t._id,function(r){r.msg&&i&&i(r.msg._result,r.msg.message),delete n.dispatcher.eventListeners[t._id]}),n.sendMessage(t,function(t){t.reason="NOT_CONNECTED",i&&i(t.reason,t)})},n.requests=[];var i=function(t){var i=n.requests.findIndex(function(n){return n.id===t.type});if(i>=0)var r=n.requests.splice(i,1)[0];r&&n.dispatcher.eventListeners[t.type]?(delete n.dispatcher.eventListeners[t.type],t.msg&&r.callback&&r.callback(t.msg._result,t.msg._message)):m.default.warning("Detached Response",t.type,t.msg)},r=function(t){var i=this,r=n.requests.findIndex(function(t){return t.id===i.id});r>=0&&(i=n.requests.splice(r,1)[0]),i&&n.dispatcher.eventListeners[t.type]?(delete n.dispatcher.eventListeners[t.type],t.reason="NOT_CONNECTED",i.callback&&i.callback(t.reason,t)):m.default.warning("handleSendError",i)};return n.sendRequest=function(t,o){t=p()({_id:"_request_"+n.requestID},t),n.requestID+=1;var a={id:t._id,timeoutCounter:0,stalledAt:Date.now(),message:t,callback:o};n.requests.push(a),n.addEventListener(t._id,i),n.sendMessage(t,r.bind(a))},n.checkRequestTimeout=function(){for(var t=Math.ceil(Object(S.getParameter)("SIGNAL_REQUEST_TIMEOUT")/Object(S.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),i=n.requests.length-1;i>=0;i--){var r=n.requests[i];r.timeoutCounter>=t?(n.requests.splice(i,1),m.default.error("Request Timeout",r.timeoutCounter,r.message),r.callback&&r.callback("TIMEOUT")):r.timeoutCounter++}},clearInterval(n.requestTimer),n.requestTimer=setInterval(n.checkRequestTimeout,Object(S.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),n.sendReport=function(t){n.sendMessage(t,function(){})},n},R=function(t,n){var i={connect:function(){n.host=t,i.signal=y(n),i.on=i.signal.on,i.dispatchEvent=i.signal.dispatchEvent,i.signal.on("onopen",function(t){i.signal.onEvent=function(t){i.dispatchEvent(Object(g.d)({type:t.event,msg:t}))},i.dispatchEvent(Object(g.d)({type:"connect",msg:t}))}),i.signal.on("onError",function(t){onError(t.msg.code,"error")})},getLastMsgTime:function(){return i.signal&&i.signal.lastMsgTime},getSendBytes:function(){return i.signal.getSendBytes()},getRecvBytes:function(){return i.signal.getRecvBytes()},getDuration:function(){return i.signal.getDuration()},disconnect:function(){i.signal.disconnect()},close:function(){i.signal.close()},getURL:function(){return i.signal.getURL()},reconnect:function(){i.signal.reconnect()},connectNext:function(){i.signal.connectNext()},replaceHost:function(t){i.signal.replaceHost(t)},emitSimpleMessage:function(t,n){i.signal.sendSignalCommand(t,n)},emitRequest:function(t,n){i.signal.sendRequest(t,n)},emitReport:function(t){i.signal.sendReport(t)}};return i.connect(),i},T=i(23),I=i(5),A=i(20),C=i(4),b={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",K_SERVICE_NOT_READY:"tryNext",K_SERVICE_TOO_HEAVY:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},N={googActualEncBitrate:"A_aeb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googAvailableReceiveBandwidth:"A_arb",googTargetEncBitrate:"A_teb",googBucketDelay:"A_bd",googTransmitBitrate:"A_tb",googCodecName:"A_cn",bytesSent:"bytesSent",packetsLost:"packetsLost",packetsSent:"packetsSent",googAdaptationChanges:"A_ac",googAvgEncodeMs:"A_aem",googEncodeUsagePercent:"A_eup",googFirsReceived:"A_fr",googFrameHeightInput:"A_fhi",googFrameHeightSent:"A_fhs",googFrameRateInput:"A_fri",googFrameRateSent:"A_frs",googFrameWidthInput:"A_fwi",googFrameWidthSent:"A_fws",googNacksReceived:"A_nr",googPlisReceived:"A_pr",googRtt:"A_rtt",aecDivergentFilterFraction:"A_adff",audioInputLevel:"A_ail",googEchoCancellationReturnLoss:"A_ecrl",googEchoCancellationReturnLossEnhancement:"A_ecrle",googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_relrm",googTargetDelayMs:"A_tdm",bytesReceived:"bytesReceived",packetsReceived:"packetsReceived",googDecodeMs:"A_dm",googMaxDecodeMs:"A_mdm",googRenderDelayMs:"A_rdm",googFrameWidthReceived:"A_fwr",googFrameHeightReceived:"A_fhr",googFrameRateReceived:"A_frr",googFrameRateDecoded:"A_frd",googFrameRateOutput:"A_fro",googJitterBufferMs:"A_jbm",googCurrentDelayMs:"A_cdm",googMinPlayoutDelayMs:"A_mpdm",googNacksSent:"A_ns",googPlisSent:"A_ps",googFirsSent:"A_fs",audioOutputLevel:"A_aol",googAccelerateRate:"A_ar",googDecodingCNG:"A_dcng",googDecodingCTN:"A_dctn",googDecodingCTSG:"A_dctsg",googDecodingNormal:"A_dn",googDecodingPLC:"A_dplc",googDecodingPLCCNG:"A_dplccng",googExpandRate:"A_er",googJitterReceived:"A_jr",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sdr",googSpeechExpandRate:"A_ser",uplink_fraction_lost:"B_ufl",uplink_cumulative_lost:"B_ucl",uplink_available_bandwidth:"B_uab",period_fir:"B_fir",access_delay:"B_acd",uplink_network_quality:"B_unq",downlink_network_quality:"B_dnq",pub_audio_lost_ratio_400ms:"B_palr4",pub_video_lost_ratio_400ms:"B_pvlr4",e2e_delay:"B_ed",audio_delay:"B_ad",video_delay:"B_vd",stream_type:"B_st",e2e_audio_lost_ratio_400ms:"B_ealr4",e2e_video_lost_ratio_400ms:"B_evlr4",downlink_estimate_bandwidth:"B_deb",peer_publish_audio_duration:"B_ppad",peer_publish_video_duration:"B_ppvd"},O={};for(var w in N){var L=N[w];O[L]&&m.default.error("Key Conflict: ".concat(L,": ").concat(N[L],"| ").concat(w)),O[L]=w}var k=function(t){return N[t]||t},D=function(t){return O[t]||t},P=i(9),M=i.n(P),x=i(54),U=function t(n){var i,r,a=!1,c=function(t){return{_type:"control",_message:t}},u=function(t,n){var i={};return Object.keys(n).forEach(function(t){Object(S.getParameter)("STATS_FILTER")[t]||(i[k(t)]=n[t])}),{_type:"subscribe_related_stats",_message:{stream_type:"high",stream_id:t,stats:i}}},f=function(t){return{_type:"publish",_message:t}},E=function(t,n){var i={};return Object.keys(n).forEach(function(t){Object(S.getParameter)("STATS_FILTER")[t]||(i[k(t)]=n[t])}),{_type:"subscribe_stats",_message:{stream_id:t,stats:i}}},y=t.DISCONNECTED,N=t.CONNECTING,O=t.CONNECTED,w=t.DISCONNECTING,L=y,U=Object(g.b)(n);Object.defineProperty(U,"state",{set:function(n){var i=L;L=n,Object(A._setClientConnectionStateRecord)(U.clientId,n),n!==t.CONNECTED&&n!==t.DISCONNECTING&&(U.hasJoined=!1),i!==n&&U.dispatchEvent({type:"connection-state-change",prevState:t.connetionStateMap[i],curState:t.connetionStateMap[n]})},get:function(){return L}}),U.socket=void 0,U.state=y,U.mode=n.mode,U.role=n.role,U.codec=n.codec,U.config={},U.timers={},U.timer_counter={},U.localStreams={},U.remoteStreams={},U.remoteMuteState={},U.attemps=1,U.p2p_attemps=1,U.audioLevel={},U.activeSpeaker=void 0,U.reconnectMode="tryNext",U.rejoinAttempt=0,U.hasChangeBGPAddress=!1,U.traffic_stats={},U.clientId=n.clientId,U.pingpongCounter=0,U.hasInvokeLeave=!1,U.p2ps=new Map,U.liveStreams=new Map,U.injectLiveStreams=new Map,U.remoteStreamsInChannel=new Set,U.subscribeRequestId=new Map,U.publishRequestId=0,U.hasJoined=!1,U.isFirstSuccess=!0,U.peerPublishDurationMap=new Map,i=U,r=h,i.makeRequest=function(t,n,o){if(void 0===i.socket)return m.default.debug("[".concat(i.clientId,"] No socket available")),void r(o,I.default.INVALID_OPERATION);try{i.socket.emitRequest(t,function(t,i){var r;"success"===t?"function"==typeof n&&n(i):"function"==typeof o&&(r=i&&i.error_code&&I.GatewayErrorCode[i.error_code]?I.GatewayErrorCode[i.error_code]:i&&i.error_str?i.error_str:i&&i.error_code?"UNKNOW_ERROR_".concat(i.error_code):t,o(r,i))})}catch(a){m.default.debug("[".concat(i.clientId,"] Socket emit message failed ").concat(JSON.stringify(t))),m.default.debug("[".concat(i.clientId,"] "),a),r(o,I.default.SOCKET_ERROR)}},i.makeReport=function(t){void 0===i.socket&&m.default.debug("[".concat(i.clientId,"] No socket available"));try{i.socket.emitReport(t)}catch(n){m.default.debug("[".concat(i.clientId,"] Socket emit report failed ").concat(JSON.stringify(t)))}},U.inChannelInfo={joinAt:null,duration:0},U._sendMessage=function(t,n){switch(t){case"SubscribeStats":U.makeReport(E.apply(void 0,l()(n)));break;case"SubscribeRelatedStats":U.makeReport(u.apply(void 0,l()(n)))}};var B,F,j=h;U.p2pCounter=Object($.random)(1e5),U.generateP2PId=function(){return++U.p2pCounter},U.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},U.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},U.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},U.configPublisher=function(t){U.config=t},U.getGatewayInfo=function(t,n){U.makeRequest({_type:"gateway_info"},t,n)},U.setClientRole=function(t,n){m.default.debug("[".concat(U.clientId,"] setClientRole to ").concat(t));var i=v.report.reportApiInvoke(U.joinInfo.sid,{name:"_setClientRole",callback:n});U.makeRequest({_type:"set_client_role",_message:{role:t}},function(){U.role=t,U.dispatchEvent({type:"client-role-changed",role:t}),i&&i(null,{role:t})},function(n,r){if(r&&r.code&&(n=I.GatewayErrorCode[r.code]||"UNKNOW_ERROR_"+r.code),"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE"===n)return i&&i(null);m.default.error("set Client role error to "+t+": "+n),i&&i(n)})},U.join=function(t,i,r,o){U.hasInvokeLeave=!1,t.useProxyServer&&(U.hasChangeBGPAddress=!0);var a=(new Date).getTime(),s=t.uid;if(U.inChannelInfo.joinAt&&(U.inChannelInfo.duration+=a-U.inChannelInfo.joinAt),U.inChannelInfo.joinAt=a,U.state!==N)return m.default.error("[".concat(U.clientId,"] GatewayClient.join Failed: state "),U.state),o&&o(I.default.INVALID_OPERATION),void v.report.joinGateway(t.sid,{lts:a,succ:!1,ec:I.default.INVALID_OPERATION,addr:null});if(null!=s&&parseInt(s)!==s)return m.default.error("[".concat(U.clientId,"] Input uid is invalid")),U.state=y,o&&o(I.default.INVALID_PARAMETER),void v.report.joinGateway(t.sid,{lts:a,succ:!1,ec:I.default.INVALID_PARAMETER,addr:null});var c=V.register(U,{uid:s,cname:t&&t.cname});if(c)return U.state=y,o&&o(c),void v.report.joinGateway(t.sid,{lts:a,succ:!1,ec:c,addr:null});U.joinInfo=p()({},t),U.uid=s,U.key=i,U.pingpongCounter=0,q(t,function(i){if(t.useLocalAccessPoint)try{var c=U.socket.signal.connection.url.match(/wss\:\/\/([^:]+):(\d+)/)[1];Object(S.setParameter)("EVENT_REPORT_DOMAIN",c),Object(S.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",c),Object(S.setParameter)("LOG_UPLOAD_SERVER","".concat(c,":6444"))}catch(d){m.default.debug("[".concat(U.clientId,"] LocalAccessPoint error: ").concat(d))}if(U.state===w||U.state===y)return o&&o("LEAVE_BEFORE_JOIN_SUCCESS");U.state=O,m.default.debug("[".concat(U.clientId,"] Connected to gateway server")),clearInterval(U.pingTimer),U.pingTimer=setInterval(function(){var t=Object(S.getParameter)("PING_PONG_TIME_OUT");if(++U.pingpongCounter>=t){var n=Date.now();U.socket&&m.default.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-U.socket.getLastMsgTime(),"ms")),U.socket&&U.socket.getLastMsgTime()&&n-U.socket.getLastMsgTime()>Object(S.getParameter)("WEBSOCKET_TIMEOUT_MIN")&&(U.pingpongCounter=0,U.socket.close(),U.socket.dispatchEvent(Object(g.d)({type:"disconnect",event:{msg:"PING_PONG_TIME_OUT"}})))}var i=Date.now();U.makeRequest({_type:"ping"},function(){U.pingpongCounter=0;var t=Date.now()-i;Object(S.getParameter)("REPORT_STATS")&&U.makeRequest({_type:"ping_back",_message:{pingpongElapse:t}})},function(t,n){"TIMEOUT"!==t&&(m.default.error("Ping Error ".concat(t," ").concat(JSON.stringify(n))),n&&n.error_code&&U.socket&&U.socket.signal&&U.socket.signal.connection&&U.socket.signal.connection.readyState===WebSocket.OPEN&&(m.default.info("Disconnecting websocket connection"),U.socket.signal.connection.close()))})},3e3),function(t,i){var r=t.role,o=p()({},U.joinInfo.apResponse),a={session_id:U.joinInfo.sid,app_id:n.appId,channel_key:U.key,channel_name:U.joinInfo.cname,sdk_version:S.VERSION,browser:navigator.userAgent,process_id:Object(v.getProcessId)(),mode:U.mode,codec:U.codec,role:r,has_changed_gateway:Object(S.getParameter)("FORCE_CHANGED_GATEWAY_FLAG")||U.hasChangeBGPAddress,ap_response:o,optionalInfo:U.joinInfo.optionalInfo,extend:Object(S.getParameter)("JOIN_EXTEND"),details:{}};if(U.joinInfo.hasOwnProperty("stringUid")&&(a.string_uid=U.joinInfo.stringUid),U.socket&&U.socket.signal&&U.socket.signal&&(o.addresses&&o.addresses[U.socket.signal.hostIndex]&&(a.ap_response.ticket=o.addresses[U.socket.signal.hostIndex].ticket,delete o.addresses),Object(S.getParameter)("SET_DEFAULT_TURNSERVER")&&U.socket.signal.turnConfig)){var s={username:U.joinInfo.uid.toString(),credential:U.joinInfo.token,forceturn:Object(S.getParameter)("FORCE_TURN")};s.url=U.socket.signal.turnConfig.url,U.socket.signal.turnConfig.tcpport&&(s.tcpport=""+U.socket.signal.turnConfig.tcpport),U.socket.signal.turnConfig.udpport&&(s.udpport=""+U.socket.signal.turnConfig.udpport),U.joinInfo.turnServers.find(function(t){if(t.url===s.url)return!0})||U.joinInfo.turnServers.push(s)}3===U.joinInfo.proxyServerType&&(a.plugin="web_cloud_proxy",a.details.cservice_map="1"),U.joinInfo.aesmode&&U.joinInfo.aespassword?(a.aes_mode=U.joinInfo.aesmode,a.aes_encrypt=!0,U.joinInfo.aes_salt&&(a.aes_salt=U.joinInfo.aes_salt),Object(x.encryptRSA)(U.joinInfo.aespassword).then(function(t){a.aes_secret=t,U.dispatchEvent({type:"join-message-hook",joinMessage:a}),i(null,{_type:"join",_message:a})}).catch(function(t){m.default.error("[".concat(U.clientId,"] encrypt password failed "),t),i("ENCRYPT_PASSWORD_FAILED")})):(U.dispatchEvent({type:"join-message-hook",joinMessage:a}),i(null,{_type:"join",_message:a}))}({role:U.role},function(n,i){if(n)return o&&o(n);U.makeRequest(i,function(n){if(v.report.joinGateway(t.sid,{lts:a,succ:!0,ec:null,vid:t.vid,uid:t.uid,addr:U.socket.getURL(),firstSuccess:U.isFirstSuccess}),U.joinSuccessLts=Date.now(),U.isFirstSuccess=!1,U.rejoinAttempt=0,U.hasJoined=!0,r&&r(n.uid),!0===n.return_vosip||!0===Object(S.getParameter)("ENABLE_LIVE_SERVER_LIST")){var i=null;try{i=U.socket.signal.connection.url}catch(o){m.default.debug("[".concat(U.clientId,"] Can not get gateway ip: ").concat(o))}i?Object(S.setParameter)("LIVE_SERVER_LIST",[i]):Object(S.setParameter)("LIVE_SERVER_LIST",[])}U.dispatchEvent({type:"join"}),clearInterval(U.timers.trafficStats),U.timers.trafficStats=setInterval(function(){U.makeRequest({_type:"traffic_stats"},function(t){var n={};for(var i in t)n[D(i)]=t[i];if(n.peer_delay&&n.peer_delay.length){var r=[];n.peer_delay.forEach(function(t){var n={};for(var i in t)n[D(i)]=t[i];r.push(n)}),n.peer_delay=r}U.traffic_stats=n,U.traffic_stats.timestamp=Date.now();var o=U.joinInfo.stringUid,a=U.localStreams[s]||U.localStreams[o];a&&(a.traffic_stats={access_delay:n.access_delay}),n.peer_delay&&n.peer_delay.forEach(function(t){var i=U.remoteStreams[t.peer_uid];i&&(i.traffic_stats={access_delay:n.access_delay,e2e_delay:t.e2e_delay,audio_delay:t.audio_delay,video_delay:t.video_delay})}),U.dispatchEvent({type:"after-getTrafficStats",trafficStats:n})})},3e3)},function(n,i){if(m.default.error("[".concat(U.clientId,"] User join failed [").concat(n,"]")),"ERR_JOIN_BY_MULTI_IP"===n){try{v.report.joinGateway(t.sid,{lts:a,succ:!1,ec:"ERR_JOIN_BY_MULTI_IP",addr:U.socket.getURL()})}catch(s){}return U.dispatchEvent({type:"onMultiIP",option:i.option})}b[n]&&U.rejoinAttempt<4?U._doWithAction(b[n],r,o):o&&o(n),v.report.joinGateway(t.sid,{lts:a,succ:!1,ec:n,addr:U.socket&&U.socket.getURL()})})})},function(n){m.default.error("[".concat(U.clientId,"] User join failed [").concat(n,"]")),o&&o(n),v.report.joinGateway(t.sid,{lts:a,succ:!1,ec:n,addr:U.socket.getURL()})}),this.remoteMuteState={},U.resetAudioVolumeIndication()},U.leave=function(t,n){var i=V.unregister(U);switch(i&&m.default.debug("[".concat(U.clientId,"] "),i),U.p2ps.clear(),U.state){case y:return m.default.debug("[".concat(U.clientId,"] Client Already in DISCONNECTED status")),void j(t);case w:return m.default.debug("[".concat(U.clientId,"] Client Already in DISCONNECTING status")),void j(n,I.default.INVALID_OPERATION);case N:return U.socket&&U.socket.close(),U.socket=void 0,m.default.info("[".concat(U.clientId,"] Client connecting, Leave channel success")),U.state=y,t&&t()}for(var r in U.state=w,U.channelMediaConfig&&(U.channelMediaRelayController&&U.channelMediaRelayController.dispose(),U.channelMediaConfig,U.channelMediaRelayController=null),clearInterval(U.pingTimer),U.timers)U.timers.hasOwnProperty(r)&&clearInterval(U.timers[r]);for(var r in U.inChannelInfo.joinAt&&(U.inChannelInfo.duration+=Date.now()-U.inChannelInfo.joinAt,U.inChannelInfo.joinAt=null),U.hasJoined?U.makeRequest({_type:"leave"},function(n){U.socket.close(),U.socket=void 0,m.default.info("[".concat(U.clientId,"] Leave channel success")),U.state=y,t&&t(n)},function(t){"TIMEOUT"!==t&&"REQUEST_ABORT"!==t&&(m.default.error("[".concat(U.clientId,"] Leave Channel Failed"),t),U.state=O,n&&n(t))}):(U.socket&&(U.socket.close(),U.socket=void 0),m.default.info("[".concat(U.clientId,"] Leave channel before joined")),U.state=y,t&&t()),U.localStreams)if(U.localStreams.hasOwnProperty(r)){var o=U.localStreams[r];delete U.localStreams[r],void 0!==o.pc&&(o.pc.close(),o.pc=void 0)}K()},U.publish=function(t,n,i,r){var o=(new Date).getTime(),a=!1;if(t.publishLTS=o,"object"!==d()(t)||null===t)return m.default.error("[".concat(U.clientId,"] Invalid local stream")),r&&r(I.default.INVALID_LOCAL_STREAM),void v.report.publish(U.joinInfo.sid,{lts:o,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:I.default.INVALID_LOCAL_STREAM});if(!t.stream&&void 0===t.url)return m.default.error("[".concat(U.clientId,"] Invalid local media stream")),r&&r(I.default.INVALID_LOCAL_STREAM),void v.report.publish(U.joinInfo.sid,{lts:o,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:I.default.INVALID_LOCAL_STREAM});if(U.state!==O)return m.default.error("[".concat(U.clientId,"] User is not in the session")),r&&r(I.default.INVALID_OPERATION),void v.report.publish(U.joinInfo.sid,{lts:o,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:I.default.INVALID_OPERATION});var s=t.getAttributes()||{};if(t.local&&void 0===U.localStreams[t.getId()]&&(t.hasAudio()||t.hasVideo()||t.hasScreen())){var u=U.generateP2PId();if(U.p2ps.set(u,t),t.p2pId=u,void 0!==t.url)Y(f({state:"url",audio:t.hasAudio(),video:t.hasVideo(),attributes:t.getAttributes()},t.url),function(n,i){"success"===n?(t.getUserId()!==i&&t.setUserId(i),U.localStreams[i]=t,t.onClose=function(){U.unpublish(t)}):m.default.error("[".concat(U.clientId,"] Publish local stream failed"),n)});else{U.localStreams[t.getId()]=t,t.connectionSpec={callback:function(s){s||r&&r("CANNOT_GET_OFFER"),"motion"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-framerate"),"detail"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-resolution"),U.makeRequest(f({state:"offer",stream_type:1==n.streamType?"low":"high",p2p_id:u,sdp:s,audio:t.audio||t.screenAudio,video:t.screen||t.video,screen:t.screen,attributes:t.getAttributes(),dtx:t.DTX,hq:t.highQuality,lq:t.lowQuality,stereo:t.stereo,speech:t.speech,codec:U.codec,extend:Object(S.getParameter)("PUB_EXTEND")}),function(n){t.getUserId()!==n.uid&&t.setUserId(n.uid),m.default.info("[".concat(U.clientId,"] Local stream published with uid"),n.uid),t.onClose=function(){U.unpublish(t)},t._onAudioUnmute=function(){U.makeReport(c({action:"unmute_local_audio",stream_id:t.getId()}))},t._onVideoUnmute=function(){U.makeReport(c({action:"unmute_local_video",stream_id:t.getId()}))},t._onAudioMute=function(){U.makeReport(c({action:"mute_local_audio",stream_id:t.getId()}))},t._onVideoMute=function(){U.makeReport(c({action:"mute_local_video",stream_id:t.getId()}))},t.getId()===t.getUserId()&&(t.isAudioOn()||t.hasAudio()&&(m.default.debug("[".concat(U.clientId,"] local stream audio mute")),t._onAudioMute()),t.isVideoOn()||(t.hasVideo()||t.hasScreen())&&(m.default.debug("[".concat(U.clientId,"] local stream video mute")),t._onVideoMute())),t.pc.oniceconnectionstatechange=function(n){if("failed"===n){if(null!=U.timers[t.getId()]&&(clearInterval(U.timers[t.getId()]),clearInterval(U.timers[t.getId()]+"_RelatedStats")),m.default.error("[".concat(U.clientId,"] Publisher connection is lost -- streamId: ").concat(t.getId(),", p2pId: ").concat(u)),U.p2ps.delete(u),m.default.debug("[".concat(U.clientId,"] publish p2p failed: "),U.p2ps),!a)return a=!0,v.report.publish(U.joinInfo.sid,{lts:o,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:I.default.PEERCONNECTION_FAILED,publishRequestid:U.publishRequestId||0,p2pid:u}),U.dispatchEvent(Object(g.a)({type:"pubP2PLost",stream:t})),r&&r(I.default.PEERCONNECTION_FAILED);U.dispatchEvent(Object(g.a)({type:"pubP2PLost",stream:t}))}else if("connected"===n&&(m.default.debug("[".concat(U.clientId,"] publish p2p connected: "),U.p2ps),t.getId()===t.getUserId()&&(t._isAudioMuted()?U.makeReport(c({action:"mute_local_audio",stream_id:t.getId()})):U.makeReport(c({action:"unmute_local_audio",stream_id:t.getId()})),t._isVideoMuted()?U.makeReport(c({action:"mute_local_video",stream_id:t.getId()})):U.makeReport(c({action:"unmute_local_video",stream_id:t.getId()}))),!a))return a=!0,v.report.publish(U.joinInfo.sid,{lts:o,succ:!0,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:null,publishRequestid:U.publishRequestId||0,p2pid:u}),i&&i()},t.pc.processSignalingMessage(n.sdp)},function(n,i){m.default.error("Publish Failed: ".concat(n)),v.report.publish(U.joinInfo.sid,{lts:o,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:n,publishRequestid:U.publishRequestId||0,p2pid:u}),"TIMEOUT"!=n&&(U.processPublishFailure(t),r&&r(n))})},audio:t.hasAudio(),video:t.hasVideo(),screen:t.hasScreen(),optimizationMode:t.optimizationMode,isSubscriber:!1,stunServerUrl:U.stunServerUrl,turnServers:U.joinInfo.turnServers,maxAudioBW:s.maxAudioBW,minVideoBW:s.minVideoBW,maxVideoBW:s.maxVideoBW,mode:U.mode,codec:U.codec,isVideoMute:t.userMuteVideo||t.peerMuteVideo,isAudioMute:t.userMuteAudio||t.peerMuteAudio,maxFrameRate:t.attributes.maxFrameRate,agoraStream:t,clientId:U.clientId,isCloudProxy3:3===U.joinInfo.proxyServerType,onNoIceCandidate:function(){U.dispatchEvent({type:"no_ice_candidate",stream:t})}},t.pc=Object(T.a)(t.connectionSpec),t.pc.addStream(t.stream),m.default.debug("[".concat(U.clientId,"] PeerConnection add stream :"),t.stream),t.pc.onnegotiationneeded=function(i){"motion"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-framerate"),"detail"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-resolution");var r={state:"negotiation",stream_type:1===n.streamType?"low":"high",p2p_id:u,sdp:i};U.makeRequest(f(r),function(n){m.default.debug("Negotating Stream ".concat(t.getId())),t.pc.processSignalingMessage(n.sdp)},function(t,n){m.default.error("Negotiation failed ".concat(t),n,r)})},clearInterval(U.timers[t.getId()]),U.timers[t.getId()]=setInterval(function(){if(Object(S.getParameter)("REPORT_STATS")){var n=0;t&&t.pc&&t.pc.getStats&&t.pc.getStatsRate(function(i){i.forEach(function(i){if(i&&i.id&&!(/_recv$/.test(i.id)||/^time$/.test(i.id)||~i.type.toLowerCase().indexOf("inbound"))&&t.getUserId()){if(-1===i.id.indexOf("outbound_rtp")&&-1===i.id.indexOf("OutboundRTP")&&-1===i.type.toLowerCase().indexOf("outbound")||"video"!==i.mediaType||(i.googFrameWidthSent=t.videoWidth+"",i.googFrameHeightSent=t.videoHeight+""),"video"===i.mediaType)try{var r=t.stream.getVideoTracks()[0];i.A_vstd=r.enabled?"0":"1"}catch(o){}if("audio"===i.mediaType)try{var a=t.stream.getAudioTracks()[0];i.A_astd=a.enabled?"0":"1"}catch(s){}if(t.getId()==t.getUserId()){var c=200*n;n++,setTimeout(function(){var t,n,r=U.socket&&U.socket.getLastMsgTime()&&Date.now()-U.socket.getLastMsgTime();r>Object(S.getParameter)("REPORT_STATS_TIMEOUT")?m.default.debug("PublishStats report blocked by REPORT_STATS_TIMEOUT ".concat(r)):U.makeReport((n={},Object.keys(t=i).forEach(function(i){Object(S.getParameter)("STATS_FILTER")[i]||(n[k(i)]=t[i])}),{_type:"publish_stats",_message:{stream_type:"high",stats:n}}))},c)}else c=200*n,n++,setTimeout(function(){var t,n,r=U.socket&&U.socket.getLastMsgTime()&&Date.now()-U.socket.getLastMsgTime();r>Object(S.getParameter)("REPORT_STATS_TIMEOUT")?m.default.debug("PublishStatsLow report blocked by REPORT_STATS_TIMEOUT ".concat(r)):U.makeReport((n={},Object.keys(t=i).forEach(function(i){Object(S.getParameter)("STATS_FILTER")[i]||(n[k(i)]=t[i])}),{_type:"publish_stats",_message:{stream_type:"low",stats:n}}))},c)}})})}},3e3);var l=function(){Object(S.getParameter)("REPORT_STATS")&&t&&t.pc&&t.pc.getVideoRelatedStats&&t.pc.getVideoRelatedStats(function(n){var i,r,o,a,s=U.socket&&U.socket.getLastMsgTime()&&Date.now()-U.socket.getLastMsgTime();s>Object(S.getParameter)("REPORT_STATS_TIMEOUT")?m.default.debug("PublishRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(s)):t.getId()===t.getUserId()?U.makeReport((r={},Object.keys(i=n).forEach(function(t){Object(S.getParameter)("STATS_FILTER")[t]||(r[k(t)]=i[t])}),{_type:"publish_related_stats",_message:{stream_type:"high",stats:r}})):U.makeReport((a={},Object.keys(o=n).forEach(function(t){Object(S.getParameter)("STATS_FILTER")[t]||(a[k(t)]=o[t])}),{_type:"publish_related_stats",_message:{stream_type:"low",stats:a}}))})};l(),clearInterval(U.timers[t.getId()+"_RelatedStats"]),U.timers[t.getId()+"_RelatedStats"]=setInterval(l,1e3)}}},U.unpublish=function(t,n,i,r){if("object"!==d()(t)||null===t)return m.default.error("[".concat(U.clientId,"] Invalid local stream")),void j(r,I.default.INVALID_LOCAL_STREAM);if(U.state!==O)return m.default.error("[".concat(U.clientId,"] User not in the session")),void j(r,I.default.INVALID_OPERATION);if(null!=U.timers[t.getId()]&&(clearInterval(U.timers[t.getId()]),clearInterval(U.timers[t.getId()+"_RelatedStats"])),void 0!==U.socket){if(t.local&&void 0!==U.localStreams[t.getId()]){delete U.localStreams[t.getId()];var o={stream_id:t.getUserId(),stream_type:1===n.streamType?"low":"high"};U.makeRequest({_type:"unpublish",_message:o}),(t.hasAudio()||t.hasVideo()||t.hasScreen())&&void 0===t.url&&void 0!==t.pc&&(t.pc.close(),t.pc=void 0),t.onClose=void 0,t._onAudioMute=void 0,t._onAudioUnute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,U.p2ps.delete(t.p2pId),i&&i()}else m.default.error("[".concat(U.clientId,"] Invalid local stream")),j(r,I.default.INVALID_LOCAL_STREAM)}else m.default.error("[".concat(U.clientId,"] User not in the session")),j(r,I.default.INVALID_OPERATION)},U.subscribe=function(t,n,i){var r=(new Date).getTime();t.subscribeLTS=r;var o=!1;if(m.default.info("[".concat(U.clientId,"] Gatewayclient ").concat(U.uid," Subscribe ").concat(t.getId(),": ").concat(JSON.stringify(t.subscribeOptions))),"object"!==d()(t)||null===t)return m.default.error("[".concat(U.clientId,"] Invalid remote stream")),i&&i(I.default.INVALID_REMOTE_STREAM),void v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:I.default.INVALID_REMOTE_STREAM});if(U.state!==O&&(m.default.error("[".concat(U.clientId,"] User is not in the session")),!o))return o=!0,v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:I.default.INVALID_OPERATION}),i&&i(I.default.INVALID_OPERATION);if(!t.local&&U.remoteStreams.hasOwnProperty(t.getId())){if(t.hasAudio()||t.hasVideo()||t.hasScreen()){var a=U.generateP2PId();U.p2ps.set(a,t),t.p2pId=a,t.pc=Object(T.a)({callback:function(n){n||i&&i("CANNOT_GET_OFFER");var o={stream_id:t.getId(),audio:!t.subscribeOptions||t.subscribeOptions.audio,video:!t.subscribeOptions||t.subscribeOptions.video,codec:U.codec,p2p_id:a,sdp:n,tcc:Object(S.getParameter)("SUBSCRIBE_TCC"),extend:Object(S.getParameter)("SUB_EXTEND")};U.makeRequest({_type:"subscribe",_message:o},function(n){t.pc.processSignalingMessage(n.sdp)},function(n,o){m.default.error("[".concat(U.clientId,"] Subscribe remote stream Failed: ").concat(n,", closing stream "),t.getId(),o),v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:n}),"TIMEOUT"!=n&&(U.processSubscribeFailure(t),i&&i(n))})},nop2p:!0,audio:!0,video:!0,screen:t.hasScreen(),isSubscriber:!0,stunServerUrl:U.stunServerUrl,turnServers:U.joinInfo.turnServers,isVideoMute:t.userMuteVideo,isAudioMute:t.userMuteAudio,uid:t.getId(),agoraStream:t,clientId:U.clientId}),t.pc.onaddstream=function(n,i){if(t._onAudioUnmute=function(){U.makeReport(c({action:"unmute_remote_audio",stream_id:t.getId()}),function(){},function(){})},t._onAudioMute=function(){U.makeReport(c({action:"mute_remote_audio",stream_id:t.getId()}),function(){},function(){})},t._onVideoUnmute=function(){U.makeReport(c({action:"unmute_remote_video",stream_id:t.getId()}),function(){},function(){})},t._onVideoMute=function(){U.makeReport(c({action:"mute_remote_video",stream_id:t.getId()}),function(){},function(){})},"ontrack"===i&&"video"===n.track.kind||"onaddstream"===i){m.default.info("[".concat(U.clientId,"] Remote stream subscribed with uid "),t.getId());var r=U.remoteStreams[t.getId()];if(U.remoteStreams[t.getId()].stream="onaddstream"===i?n.stream:n.streams[0],U.remoteStreams[t.getId()].hasVideo()){if(Object(C.isFireFox)()||Object(C.isSafari)()){var o=U.remoteStreams[t.getId()].stream;Object($.vsResHack)(o,function(n,i){t.videoWidth=n,t.videoHeight=i},function(t){return m.default.warning("[".concat(U.clientId,"] vsResHack failed: ")+t)})}}else{var a=U.remoteStreams[t.getId()];a.peerMuteVideo=!0,U._adjustPCMuteStatus(a)}r&&r.isPlaying()&&r.elementID&&(m.default.debug("[".concat(U.clientId,"] Reload Player ").concat(r.elementID," StreamId ").concat(r.getId())),t.audioOutput=r.audioOutput,r.stop(),t.play(r.elementID,r.playOptions)),delete t.audioLevelHelper;var s=Object(g.e)({type:"stream-subscribed",stream:U.remoteStreams[t.getId()]});U.dispatchEvent(s)}},clearInterval(U.timers[t.getId()]),U.timers[t.getId()]=setInterval(function(){if(Object(S.getParameter)("REPORT_STATS")){var n=0;t&&t.pc&&t.pc.getStats&&t.pc.getStatsRate(function(i){i.forEach(function(i){if(i&&i.id&&!(/_send$/.test(i.id)||/^time$/.test(i.id)||/^bweforvideo$/.test(i.id))){-1===i.id.indexOf("inbound_rtp")&&-1===i.id.indexOf("inbound-rtp")&&-1===i.type.toLowerCase().indexOf("inbound")||"video"!==i.mediaType||(i.googFrameWidthReceived=t.videoWidth+"",i.googFrameHeightReceived=t.videoHeight+"");var r=200*n;n++;var o=t.getId();setTimeout(function(){var n=U.socket&&U.socket.getLastMsgTime()&&Date.now()-U.socket.getLastMsgTime();if(n>Object(S.getParameter)("REPORT_STATS_TIMEOUT"))m.default.debug("SubscribeStats report blocked by REPORT_STATS_TIMEOUT ".concat(n));else{if("video"===i.mediaType)try{var r=t.stream.getVideoTracks()[0];i.A_vrtd=r.enabled?"0":"1",t.player&&t.player.freezeTimeCounterList.length>0&&(i.A_vrft=t.player.freezeTimeCounterList.splice(0,1)[0].toString())}catch(a){}if("audio"===i.mediaType)try{var s=t.stream.getAudioTracks()[0];i.A_artd=s.enabled?"0":"1"}catch(c){}U.makeReport(E(o,i))}},r)}})})}},3e3),clearInterval(U.timers[t.getId()+"_RelatedStats"]),U.timers[t.getId()+"_RelatedStats"]=setInterval(function(){if(Object(S.getParameter)("REPORT_STATS")&&t&&t.pc){var n=U.socket&&U.socket.getLastMsgTime()&&Date.now()-U.socket.getLastMsgTime();if(n>Object(S.getParameter)("REPORT_STATS_TIMEOUT"))return void m.default.debug("SubscribeRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(n));t.pc.getVideoRelatedStats&&t.pc.getVideoRelatedStats(function(n){t.player&&(t.hasVideo()&&!t.peerMuteVideo&&(n.isFreeze=t.player.freezeCount>t.player.lastFreezeCount),t.player.lastFreezeCount=t.player.freezeCount),U.makeReport(u(t.getId(),n))}),t.pc.getAudioRelatedStats&&t.pc.getAudioRelatedStats(function(n){U.makeReport(u(t.getId(),n))})}},1e3),U.audioLevel[t.getId()]=0,clearInterval(U.timers[t.getId()+"audio"]),U.timers[t.getId()+"audio"]=setInterval(function(){U.hasListeners("active-speaker")&&t&&t.pc&&"established"===t.pc.state&&t.pc.getStats&&t.pc.getStats(function(n){n.forEach(function(n){if("audio"===n.mediaType){if(n.audioOutputLevel>5e3)for(var i in U.audioLevel[t.getId()]<20&&(U.audioLevel[t.getId()]+=1),U.audioLevel)i!==""+t.getId()&&U.audioLevel[i]>0&&(U.audioLevel[i]-=1);var r=Object.keys(U.audioLevel).sort(function(t,n){return U.audioLevel[n]-U.audioLevel[t]});if(U.activeSpeaker!==r[0]){var o=Object(g.a)({type:"active-speaker",uid:r[0]});U.dispatchEvent(o),U.activeSpeaker=r[0],m.default.debug("[".concat(U.clientId,"] Update active speaker: ").concat(U.activeSpeaker))}}})},50)},50),t.pc.oniceconnectionstatechange=function(s){if("failed"===s)null!=U.timers[t.getId()]&&(clearInterval(U.timers[t.getId()]),clearInterval(U.timers[t.getId()]+"audio")),m.default.error("[".concat(U.clientId,"] Subscriber connection is lost -- streamId: ").concat(t.getId(),", p2pId: ").concat(a)),m.default.debug("[".concat(U.clientId,"] subscribe p2p failed: "),U.p2ps),o||(o=!0,i&&i(I.default.PEERCONNECTION_FAILED),v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:I.default.PEERCONNECTION_FAILED,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:a})),U.remoteStreams[t.getId()]&&U.p2ps.has(a)&&(U.p2ps.delete(a),U.dispatchEvent(Object(g.a)({type:"subP2PLost",stream:t})));else if("connected"===s&&(m.default.debug("[".concat(U.clientId,"] subscribe p2p connected: "),U.p2ps),!o)){o=!0,v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!0,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:null,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:a}),U._adjustPCMuteStatus(t);var c=!1,d=!1,u=!1,l=setInterval(function(){c&&d||(t.pc?t.pc.getStats(function(n){n.forEach(function(n){if((-1!==n.id.indexOf("recv")||n.type&&-1!==n.type.toLowerCase().indexOf("inbound")||-1!==n.id.indexOf("inbound_rtp")||-1!==n.id.indexOf("inbound-rtp")||-1!==n.id.indexOf("InboundRTP"))&&"audio"===n.mediaType){if((n.googDecodingNormal>0||n.audioOutputLevel>0)&&!c){c=!0,U.dispatchEvent({type:"first-audio-frame-decode",stream:t}),c&&d&&clearInterval(l);var i=Date.now(),r=v.report.getSessionStartTime(U.joinInfo.sid);v.report.firstAudioDecode(U.joinInfo.sid,{peerid:t.uintId,uid:U.uid,elapse:i-r,subscribeElapse:i-t.subscribeLTS,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:a})}parseInt(n.packetsReceived)>0&&!d&&(d=!0,U.dispatchEvent({type:"first-audio-packet-received",stream:t}),c&&d&&clearInterval(l),i=Date.now(),r=v.report.getSessionStartTime(U.joinInfo.sid),v.report.firstAudioReceived(U.joinInfo.sid,{peerid:t.uintId,uid:U.uid,elapse:i-r,subscribeElapse:i-t.subscribeLTS,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:a}))}})},100):clearInterval(l))},100),f=!1,p=!1,_=setInterval(function(){f&&p||(t.pc?t.pc.getStats(function(n){n.forEach(function(n){if((-1!==n.id.indexOf("recv")||n.type&&-1!==n.type.toLowerCase().indexOf("inbound")||-1!==n.id.indexOf("inbound_rtp")||-1!==n.id.indexOf("inbound-rtp")||-1!==n.id.indexOf("InboundRTP"))&&"video"===n.mediaType){if((n.framesDecoded>0||n.googFramesDecoded>0)&&!f){f=!0,U.dispatchEvent({type:"first-video-frame-decode",stream:t}),f&&p&&clearInterval(_);var i=Date.now(),r=v.report.getSessionStartTime(U.joinInfo.sid);t.firstFrameTime=(new Date).getTime()-t.subscribeLTS,v.report.firstVideoDecode(U.joinInfo.sid,{peerid:t.uintId,width:parseInt(n.googFrameWidthReceived)||0,height:parseInt(n.googFrameHeightReceived)||0,uid:U.uid,elapse:i-r,subscribeElapse:i-t.subscribeLTS,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:a})}n.packetsReceived>0&&!p&&(p=!0,U.dispatchEvent({type:"first-video-packet-received",stream:t}),f&&p&&clearInterval(_),i=Date.now(),r=v.report.getSessionStartTime(U.joinInfo.sid),v.report.firstVideoReceived(U.joinInfo.sid,{peerid:t.uintId,uid:U.uid,elapse:i-r,subscribeElapse:i-t.subscribeLTS,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:a}))}})},100):clearInterval(_))},100),h=setInterval(function(){if(!u){var n=t.getId(),i=U.traffic_stats;if(i&&i.peer_delay){var r=i.peer_delay.find(function(t){return t.peer_uid==n});if(r){if(u=!0,U.peerPublishDurationMap.get(t.getId()))return void clearInterval(h);var o=r.peer_publish_audio_duration,a=r.peer_publish_video_duration;if(void 0===o||void 0===a)return;U.peerPublishDurationMap.set(t.getId(),!0);var s=v.report.getSessionStartTime(U.joinInfo.sid),c=(o||a)+(Date.now()-i.timestamp),d=Date.now();v.report.peerPublishStatus({audiotag:o?1:-1,videotag:a?1:-1,lts:d,sid:U.joinInfo.sid,cname:U.joinInfo.cname,cid:U.joinInfo.cid,uid:U.joinInfo.uid,elapse:d-s,peer:t.uintId,peerPublishDuration:c,joinChannelSuccessElapse:d-U.joinSuccessLts,subscribeElapse:d-t.subscribeLTS}),clearInterval(h)}}}},1e3);return t.sid=U.joinInfo.sid,n&&n()}}}else m.default.error("[".concat(U.clientId,"] Invalid remote stream")),o||(o=!0,i&&i(I.default.INVALID_REMOTE_STREAM),v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:I.default.INVALID_REMOTE_STREAM}))}else m.default.error("[".concat(U.clientId,"] No such remote stream")),o||(o=!0,i&&i(I.default.NO_SUCH_REMOTE_STREAM),v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:I.default.NO_SUCH_REMOTE_STREAM}))},U.subscribeChange=function(t,n,i){var r=Date.now();m.default.info("[".concat(U.clientId,"] Gatewayclient ").concat(U.uid," SubscribeChange ").concat(t.getId(),": ").concat(JSON.stringify(t.subscribeOptions))),U._adjustPCMuteStatus(t);var o={stream_id:t.getId(),audio:t.subscribeOptions.audio,video:t.subscribeOptions.video};U.makeRequest({_type:"subscribe_change",_message:o},function(i){var o=Object(g.e)({type:"stream-subscribe-changed",stream:U.remoteStreams[t.getId()]});v.report.subscribe(U.joinInfo.sid,{lts:r,succ:!0,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:null,subscribeRequestid:U.subscribeRequestId.get(t.getId())||0,p2pid:U.p2ps.get(t.getId())}),U.dispatchEvent(o),n&&n()},function(n,r){m.default.error("[".concat(U.clientId,"] Subscribe Change Failed ").concat(t.getId()),n,r),i&&i(n,r)})},U.processPublishFailure=function(t){t.publishLTS=null,t.p2pId&&U.p2ps.get(t.p2pId)===t&&U.p2ps.delete(t.p2pId),U.localStreams[t.getUserId()]===t&&delete U.localStreams[t.getUserId()],U.localStreams[t.getId()]===t&&delete U.localStreams[t.getId()],t.pc&&(t.pc.processSignalingMessage=function(){},t.pc.oniceconnectionstatechange=function(){},t.pc.close(),delete t.pc),delete t.onClose,delete t._onAudioUnmute,delete t._onVideoUnmute,delete t._onAudioMute,delete t._onVideoMute,delete t._onAudioUnmute},U.processSubscribeFailure=function(t){t.p2pId&&U.p2ps.get(t.p2pId)===t&&U.p2ps.delete(t.p2pId),t.pc&&(t.pc.onaddstream=function(){},t.pc.processSignalingMessage=function(){},t.pc.oniceconnectionstatechange=function(){},t.pc.close(),delete t.pc),delete t.onClose,delete t._onAudioUnmute,delete t._onVideoUnmute,delete t._onAudioMute,delete t._onVideoMute,delete t._onAudioUnmute},U._adjustPCMuteStatus=function(t){m.default.debug("[".concat(U.clientId,"]: use _adjustPCMuteStatus: ").concat(t.getId())),m.default.debug("[".concat(U.clientId,"]: video: ").concat(t.video,", audio: ").concat(t.audio,", suboption: ").concat(JSON.stringify(t.subscribeOptions),",userMuteVideo: ").concat(t.userMuteVideo,", peerMuteVideo: ").concat(t.peerMuteVideo,", userMuteAudio: ").concat(t.userMuteAudio,", peerMuteAudio: ").concat(t.peerMuteAudio)),!t.local&&t.pc&&t.pc.peerConnection.getReceivers&&t.pc.peerConnection.getReceivers().forEach(function(n){if(n&&n.track&&"audio"===n.track.kind){var i=!t.userMuteAudio&&!t.peerMuteAudio;t.subscribeOptions&&!t.subscribeOptions.audio&&(i=!1),m.default.debug("[".concat(U.clientId,"]: set receiver audio track: ").concat(i)),n.track.enabled=!!i}else if(n&&n.track&&"video"===n.track.kind){var r=!t.userMuteVideo&&!t.peerMuteVideo;t.subscribeOptions&&!t.subscribeOptions.video&&(r=!1),m.default.debug("[".concat(U.clientId,"]: set receiver video track: ").concat(r)),n.track.enabled=!!r}})},U.unsubscribe=function(t,n,i){if("object"!==d()(t)||null===t)return m.default.error("[".concat(U.clientId,"] Invalid remote stream")),void j(i,I.default.INVALID_REMOTE_STREAM);if(U.state!==O)return m.default.error("[".concat(U.clientId,"] User is not in the session")),void j(i,I.default.INVALID_OPERATION);if(null!=U.timers[t.getId()]&&(clearInterval(U.timers[t.getId()]),clearInterval(U.timers[t.getId()]+"audio")),null!=U.audioLevel[t.getId()]&&delete U.audioLevel[t.getId()],null!=U.timer_counter[t.getId()]&&delete U.timer_counter[t.getId()],U.remoteStreams.hasOwnProperty(t.getId())){if(!U.socket)return m.default.error("[".concat(U.clientId,"] User is not in the session")),void j(i,I.default.INVALID_OPERATION);if(t.local)return m.default.error("[".concat(U.clientId,"] Invalid remote stream")),void j(i,I.default.INVALID_REMOTE_STREAM);t.close(),t.stop();var r={stream_id:t.getId()};U.makeRequest({_type:"unsubscribe",_message:r}),void 0!==t.pc&&(t.pc.close(),t.pc=void 0),t.onClose=void 0,t._onAudioMute=void 0,t._onAudioUnute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,delete t.subscribeOptions,U.p2ps.delete(t.p2pId),m.default.info("[".concat(U.clientId,"] Unsubscribe stream success")),n&&n()}else j(i,I.default.NO_SUCH_REMOTE_STREAM)},U.setRemoteVideoStreamType=function(t,n){if(m.default.debug("[".concat(U.clientId,"] Switching remote video stream ").concat(t.getId()," to ").concat(n)),"object"===d()(t)&&null!==t){if(U.state===O){if(!t.local){switch(n){case U.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case U.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case U.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}var i={stream_id:t.getId(),stream_type:n};U.makeRequest({_type:"switch_video_stream",_message:i},function(){m.default.debug("SwitchVideoStream Success ".concat(i.stream_id," ").concat(i.stream_type))},function(t,n){m.default.error("SwitchVideoStream Error ".concat(t," ").concat(i.stream_id," ").concat(i.stream_type),n)})}}else m.default.error("[".concat(U.clientId,"] User is not in the session"))}else m.default.error("[".concat(U.clientId,"] Invalid remote stream"))},U.renewToken=function(t,n,i){t?U.key?U.state!==O?(m.default.debug("[".concat(U.clientId,"] Client is not connected. Trying to rejoin")),U.key=t,U.rejoin(),n&&n()):(m.default.debug("[".concat(U.clientId,"] renewToken from ").concat(U.key," to ").concat(t)),U.key=t,U.makeRequest({_type:"renew_token",_message:{token:t}},n,i)):(m.default.error("[".concat(U.clientId,"] Client is previously joined without token")),i&&i(I.default.INVALID_PARAMETER)):(m.default.error("[".concat(U.clientId,"] Invalid Token ").concat(t)),i&&i(I.default.INVALID_PARAMETER))},U.setStreamFallbackOption=function(t,n){if(m.default.debug("[".concat(U.clientId,"] Set stream fallback option ").concat(t.getId()," to ").concat(n)),"object"===d()(t)&&null!==t){if(U.state===O){if(!t.local){switch(n){case U.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case U.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case U.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}var i={stream_id:t.getId(),fallback_type:n};U.makeRequest({_type:"set_fallback_option",_message:i},function(){m.default.debug("SetStreamFallbackOption success ".concat(i.stream_id," ").concat(n))},function(t,r){m.default.error("Failed to SetStreamFallbackOption ".concat(i.stream_id," ").concat(n," ").concat(t),r)})}}else m.default.error("[".concat(U.clientId,"] User is not in the session"))}else m.default.error("[".concat(U.clientId,"] Invalid remote stream"))},U.enableAudioVolumeIndicator=function(t,n){U.audioVolumeIndication.enabled=!0,U.audioVolumeIndication.interval=t,U.audioVolumeIndication.smooth=n,U.resetAudioVolumeIndication()},U.resetAudioVolumeIndication=function(){if(clearInterval(U.timers.audioVolumeIndication),clearInterval(U.timers.audioVolumeSampling),U.audioVolumeIndication.enabled&&U.audioVolumeIndication.interval){var t=Math.floor(1e3*U.audioVolumeIndication.smooth/100);clearInterval(U.timers.audioVolumeSampling),U.timers.audioVolumeSampling=setInterval(function(){U.audioVolumeSampling||(U.audioVolumeSampling={});var n={};for(var i in U.remoteStreams){var r=U.remoteStreams[i];if(r.stream&&r.hasAudio()){var o=r.getAudioLevel();o>0&&o<1&&(o*=100);var a=U.audioVolumeSampling[i]||[];for(a.push(o);a.length>t;)a.shift();n[i]=a}}U.audioVolumeSampling=n},100),clearInterval(U.timers.audioVolumeIndication),U.timers.audioVolumeIndication=setInterval(function(){if(U.socket&&U.socket.signal&&U.socket.signal.connection&&U.socket.signal.connection.readyState===WebSocket.OPEN){var t=[];for(var n in U.remoteStreams)if(U.audioVolumeSampling&&U.audioVolumeSampling[n]){var i=U.audioVolumeSampling[n],r=0;i.forEach(function(t){r+=t});var o={uid:n,level:Math.floor(r/i.length)};o.level&&t.push(o)}var a=t.sort(function(t,n){return t.level-n.level});m.default.debug("[".concat(U.clientId,"] volume-indicator "),JSON.stringify(a)),U.audioVolumeIndication.sortedAudioVolumes=a;var s=Object(g.a)({type:"volume-indicator",attr:a});U.dispatchEvent(s)}},U.audioVolumeIndication.interval)}},U.closeGateway=function(){m.default.debug("[".concat(U.clientId,"] close gateway")),U.state=y,U.socket.close(),G()},U.startChannelMediaRelay=(B=s()(o.a.mark(function t(n){var i,r,a,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!U.channelMediaRelayController){t.next=2;break}throw new P.ChannelMediaError("RELAY_ALREADY_START","",P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_ALREADY_START);case 2:return i=function(t){U.dispatchEvent({type:"channel-media-relay-event",code:t})},r=function(t,n,i){t===P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE&&n===P.CHANNEL_MEDIA_RELAY_ERROR.SERVER_CONNECTION_LOST&&(U.channelMediaRelayController.dispose(),U.channelMediaRelayController=null),U.dispatchEvent({type:"channel-media-relay-state",state:t,code:n,data:i})},U.channelMediaRelayController=new M.a(U.joinInfo,U.clientId),U.channelMediaRelayController.on("event",i),U.channelMediaRelayController.on("state",r),t.prev=7,t.next=10,U.channelMediaRelayController.startChannelMediaRelay(n);case 10:t.next=22;break;case 12:throw t.prev=12,t.t0=t.catch(7),m.default.debug("[".concat(U.clientId,"] startChannelMediaRelay exception: ").concat(JSON.stringify(t.t0))),a=P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,s="",s=t.t0 instanceof P.ChannelMediaError?"SetSourceChannelStatus"===t.t0.data||t.t0.data&&t.t0.data.serverResponse&&"SetSourceChannel"===t.t0.data.serverResponse.command?"FAILED_JOIN_SRC":"SetDestChannelStatus"===t.t0.data||t.t0.data&&t.t0.data.serverResponse&&"SetDestChannel"===t.t0.data.serverResponse.command?"FAILED_JOIN_DEST":t.t0.data&&t.t0.data.serverResponse&&"StartPacketTransfer"===t.t0.data.serverResponse.command?"FAILED_PACKET_SENT_TO_DEST":t.t0.message===P.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||t.t0.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":t.t0.message===P.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||t.t0.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":t.t0.message===P.CHANNEL_MEDIA_ERROR.AP_REQUEST_TIMEOUT?"NO_RESOURCE_AVAILABLE":t.t0.message===P.CHANNEL_MEDIA_ERROR.WS_ABORT||t.t0.message===P.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",U.dispatchEvent({type:"channel-media-relay-state",state:a,code:P.CHANNEL_MEDIA_RELAY_ERROR[s]}),U.channelMediaRelayController&&(U.channelMediaRelayController.dispose(),U.channelMediaConfig=null,U.channelMediaRelayController=null),U.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new P.ChannelMediaError(s,null,P.CHANNEL_MEDIA_RELAY_ERROR[s]);case 22:U.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_RUNNING,code:P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_OK}),U.channelMediaConfig=n;case 24:case"end":return t.stop()}},t,null,[[7,12]])})),function(t){return B.apply(this,arguments)}),U.updateChannelMediaRelay=(F=s()(o.a.mark(function t(n){var i,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(U.channelMediaRelayController){t.next=2;break}throw new P.ChannelMediaError("RELAY_NOT_START",null,P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return t.prev=2,t.next=5,U.channelMediaRelayController.updateChannelMediaRelay(n);case 5:t.next=18;break;case 7:throw t.prev=7,t.t0=t.catch(2),m.default.debug("[".concat(U.clientId,"] updateChannelMediaRelay exception: ").concat(JSON.stringify(e))),i=P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,r="",r=e instanceof P.ChannelMediaError?e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.message===P.CHANNEL_MEDIA_ERROR.WS_ABORT||e.message===P.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",U.dispatchEvent({type:"channel-media-relay-event",code:P.CHANNEL_MEDIA_RELAY_EVENT.PACKET_UPDATE_DEST_CHANNEL_REFUSED}),U.dispatchEvent({type:"channel-media-relay-state",state:i,code:P.CHANNEL_MEDIA_RELAY_ERROR[r]}),U.channelMediaRelayController&&(U.channelMediaRelayController.dispose(),U.channelMediaConfig=null,U.channelMediaRelayController=null),U.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new P.ChannelMediaError(r,null,P.CHANNEL_MEDIA_RELAY_ERROR[r]);case 18:U.channelMediaConfig=n;case 19:case"end":return t.stop()}},t,null,[[2,7]])})),function(t){return F.apply(this,arguments)}),U.stopChannelMediaRelay=s()(o.a.mark(function t(){var n,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(U.channelMediaRelayController){t.next=2;break}throw new P.ChannelMediaError("RELAY_NOT_START",null,P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return t.prev=2,t.next=5,U.channelMediaRelayController.stopChannelMediaRelay();case 5:t.next=17;break;case 7:throw t.prev=7,t.t0=t.catch(2),m.default.debug("[".concat(U.clientId,"] stopChannelMediaRelay exception: ").concat(JSON.stringify(e))),n=P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,i="",i=e instanceof P.ChannelMediaError?e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":"INTERNAL_ERROR":"INTERNAL_ERROR",U.dispatchEvent({type:"channel-media-relay-state",state:n,code:P.CHANNEL_MEDIA_RELAY_ERROR[i]}),U.channelMediaRelayController&&(U.channelMediaRelayController.dispose(),U.channelMediaConfig=null,U.channelMediaRelayController=null),U.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new P.ChannelMediaError(i,null,P.CHANNEL_MEDIA_RELAY_ERROR[i]);case 17:U.channelMediaConfig=null,U.channelMediaRelayController=null;case 19:case"end":return t.stop()}},t,null,[[2,7]])})),U.sendMetadata=function(t,n){var i;U.makeRequest((i=t,{_type:"send_metadata",_message:{session_id:U.joinInfo.sid,metadata:window.btoa(unescape(encodeURIComponent(i)))}}),function(){m.default.debug("[".concat(U.clientId,'] send metadata "').concat(t,'" success')),n&&n(null)},function(i){m.default.error("[".concat(U.clientId,'] send metadata "').concat(t,'" failed'),i),n&&n(i)})},U._reportWebsocketCloseEvent=function(t,n){try{var i=v.report.getSessionStartTime(U.joinInfo.sid),r=Date.now();v.report.webSocketQuit({lts:r,sid:U.joinInfo.sid,cname:U.joinInfo.cname,cid:U.joinInfo.cid,uid:U.joinInfo.uid,elapse:r-i,succ:t,errorCode:n,ip:null})}catch(o){m.default.debug("[".concat(U.clientId,"]: _reportWebsocketCloseEvent exception, ").concat(o))}};var W=function(){m.default.debug("[".concat(U.clientId,"] Reconnect gateway")),U.state=y,U.socket.close(),G(),U.reconnectMode="recover",U.state=N,H()};U.recover=W;var G=function(){for(var t in U.dispatchEvent({type:"before-clear-connection"}),U.timers)U.timers.hasOwnProperty(t)&&clearInterval(U.timers[t]);for(var t in U.remoteStreams)if(U.remoteStreams.hasOwnProperty(t)){var n=U.remoteStreams[t],i=Object(g.a)({type:"stream-removed",uid:n.getId(),stream:n});U.dispatchEvent(i)}U.p2ps.clear(),K(),z(),clearInterval(U.pingTimer)};U.rejoin=function(){U.socket&&(clearInterval(U.pingTimer),U.socket.close(),U.socket=void 0),U.state=N,H()};var H=function(t,n){U.dispatchEvent(Object(g.a)({type:"rejoin-start"})),t=t||function(t){m.default.info("[".concat(U.clientId,"] User ").concat(t," is re-joined to ").concat(U.joinInfo.cname)),U.dispatchEvent(Object(g.a)({type:"rejoin"})),U.channelMediaConfig&&U.startChannelMediaRelay(U.channelMediaConfig).then(function(){m.default.debug("[".concat(U.clientId,"] restartChannelMediaRelay success"))}).catch(function(t){m.default.debug("[".concat(U.clientId,"] restartChannelMediaRelay failed: ").concat(JSON.stringify(t)))}),U.liveStreams&&U.liveStreams.size&&U.liveStreams.forEach(function(t,n){t&&U.setLiveTranscoding(U.transcoding),U.startLiveStreaming(n,t)}),U.injectLiveStreams&&U.injectLiveStreams.size&&U.injectLiveStreams.forEach(function(t,n){U.addInjectStreamUrl(n,t)})},n=n||function(t){m.default.error("[".concat(U.clientId,"] Re-join to channel failed "),t),U.dispatchEvent(Object(g.e)({type:"error",reason:t}))},U.key?(++U.rejoinAttempt,U.join(U.joinInfo,U.key,t,n)):m.default.error("[".concat(U.clientId,"] Connection recover failed [Invalid channel key]"))},q=function(t,n,i){if(U.onConnect=n,U.socket){if(U.dispatchEvent({type:"reconnect"}),"retry"===U.reconnectMode)m.default.debug("[".concat(U.clientId,"] Retry current gateway")),U.socket.reconnect();else if("tryNext"===U.reconnectMode)m.default.debug("[".concat(U.clientId,"] Try next gateway")),U.socket.connectNext();else if("recover"===U.reconnectMode){m.default.debug("[".concat(U.clientId,"] Recover gateway")),m.default.debug("[".concat(U.clientId,"] Try to reconnect choose server and get gateway list again ")),U.reconnectingCS=!0;var r,o=U.joinInfo&&U.joinInfo.sid;Object(A.getGatewayList)(U.joinInfo,function(t){m.default.debug("[".concat(U.clientId,"] session:  ").concat(o," get gateway list success")),U.joinInfo.apResponse=t.res,U.reconnectingCS?U.socket.replaceHost(t.gateway_addr):m.default.debug("[".concat(U.clientId,"] session:  ").concat(o," already leave"))})}}else r=t.gatewayAddr,U.socket=R(r,{sid:U.joinInfo.sid,clientId:U.clientId,proxyServerType:U.joinInfo.proxyServerType}),U.socket.on("start-connection",function(t){U.ticket=t&&t.msg&&t.msg.ticket}),U.socket.on("on_uplink_stats",function(t){var n={};for(var i in t)n[D(i)]=t[i];if(U.OutgoingAvailableBandwidth=n.uplink_available_bandwidth,U.localStreams[U.uid]){var r=U.localStreams[U.uid].uplinkStats;r&&r.period_fir===n.period_fir||m.default.debug("[".concat(U.clientId,"]: Period fir change to: ").concat(n.period_fir)),U.localStreams[U.uid].uplinkStats=n}}),U.socket.on("connect",function(){U.dispatchEvent({type:"connected"}),U.attemps=1,U.onConnect()}),U.socket.on("recover",function(){U.state=N,m.default.debug("[".concat(U.clientId,"] Try to reconnect choose server and get gateway list again ")),U.reconnectingCS=!0;var t=U.joinInfo&&U.joinInfo.sid;Object(A.getGatewayList)(U.joinInfo,function(n){m.default.debug("[".concat(U.clientId,"] session:  ").concat(t," get gateway list success")),U.reconnectingCS?U.socket.replaceHost(n.gateway_addr):m.default.debug("[".concat(U.clientId,"] session:  ").concat(t," already leave"))})}),U.socket.on("disconnect",function(t){if(m.default.debug("[".concat(U.clientId,"] Receive disconnect message")),U.state!==y){U.state=y,U._reportWebsocketCloseEvent(-1,I.WEBSOCKET_CLOSE_REASON.WS_DISCONNECT);var n=Object(g.e)({type:"error",reason:I.default.SOCKET_DISCONNECTED});if(U.dispatchEvent(n),0===U.p2ps.size?U.reconnectMode="tryNext":U.reconnectMode="retry",G(),U.channelMediaRelayController&&U.channelMediaRelayController.dispose(),U.channelMediaRelayController=null,1!=a){var i,r=1e3*Math.min(30,Math.pow(2,i=U.attemps)-1);if(m.default.error("[".concat(U.clientId,"] Disconnect from server [").concat(JSON.stringify(t),"], attempt to recover [#").concat(U.attemps,"] after ").concat(r/1e3," seconds")),U.hasInvokeLeave)return m.default.debug("[".concat(U.clientId,"] No reconnection because Client.leave has been invoked")),void(U.hasInvokeLeave=!1);setTimeout(function(){U.attemps++,U.state=N,U.inChannelInfo&&Date.now()-U.inChannelInfo.joinAt>Object(S.getParameter)("TICKET_RENEW_TIMEOUT")?(m.default.debug("Recovering to renew ticket"),W()):H()},r)}else{var o=V.unregister(U);o&&m.default.debug("[".concat(U.clientId,"] "),o)}}}),U.socket.on("on_add_audio_stream",function(t){if(m.default.info("[".concat(U.clientId,"] Newly added audio stream with uid ").concat(t.uid)),U.joinInfo.stringUid&&"string"!=typeof t.uid&&m.default.error("StringUID is Mixed with UintUID"),U.remoteStreamsInChannel.has(t.uid)||U.remoteStreamsInChannel.add(t.uid),void 0===U.remoteStreams[t.uid]){var n=Object(_.a)({streamID:t.uid,local:!1,audio:t.audio,video:t.video,uintUID:t.uint_id||t.uid});n.peerMuteVideo=!0,U.remoteStreams[t.uid]=n;var i=Object(g.e)({type:"stream-added",stream:n});U.dispatchEvent(i);var r=U.remoteMuteState[t.uid];r&&r.audio&&(i=Object(g.a)({type:"mute-audio",uid:t.uid}),U.dispatchEvent(i)),r&&r.video&&(i=Object(g.a)({type:"mute-video",uid:t.uid}),U.dispatchEvent(i))}v.report.onAddAudioStream(U.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:U.uid})}),U.socket.on("on_update_stream",function(t){m.default.info("[".concat(U.clientId,"] on_update_stream:"),t);var n=U.remoteStreams[t.uid];if(U.joinInfo.stringUid&&"string"!=typeof t.uid&&m.default.error("StringUID is Mixed with UintUID"),n){n.audio=t.audio,n.video=t.video,n.screen=t.screen,n.pc&&U._adjustPCMuteStatus(n);var i=Object(g.e)({type:"stream-updated",stream:n});U.dispatchEvent(i)}else m.default.debug("[".concat(U.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(t.uid));v.report.onUpdateStream(U.joinInfo.sid,{peerid:t.uint_id||t.uid,audio:t.audio,video:t.video,uid:U.uid})}),U.socket.on("on_add_video_stream",function(t){if(m.default.info("[".concat(U.clientId,"] Newly added remote stream with uid ").concat(t.uid,".")),U.joinInfo.stringUid&&"string"!=typeof t.uid&&m.default.error("StringUID is Mixed with UintUID"),U.remoteStreamsInChannel.has(t.uid)||U.remoteStreamsInChannel.add(t.uid),void 0===U.remoteStreams[t.uid]){var n=Object(_.a)({streamID:t.uid,local:!1,audio:t.audio,video:t.video,uintUID:t.uint_id||t.uid});U.remoteStreams[t.uid]=n;var i=Object(g.e)({type:"stream-added",stream:n});U.dispatchEvent(i);var r=U.remoteMuteState[t.uid];r&&r.audio&&(i=Object(g.a)({type:"mute-audio",uid:t.uid}),U.dispatchEvent(i)),r&&r.video&&(i=Object(g.a)({type:"mute-video",uid:t.uid}),U.dispatchEvent(i))}else{var o=U.remoteStreams[t.uid];if(o.video=!0,o.peerMuteVideo=!1,o.pc&&U._adjustPCMuteStatus(o),m.default.info("[".concat(U.clientId,"] Stream changed: enable video ").concat(t.uid)),void 0!==o.stream&&o.isPlaying()){var a=o.player.elementID;o.stop(),o.play(a,o.playOptions)}}v.report.onAddVideoStream(U.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:U.uid})}),U.socket.on("on_remove_stream",function(t){m.default.info("[".concat(U.clientId,"] on_remove_stream:"),t),U.remoteStreamsInChannel.has(t.uid)&&U.remoteStreamsInChannel.delete(t.uid);var n=U.remoteStreams[t.uid];if(n){delete U.remoteStreams[t.uid],delete U.remoteMuteState[t.uid];var i=Object(g.e)({type:"stream-removed",stream:n});U.dispatchEvent(i),n.close(),void 0!==n.pc&&(n.pc.close(),n.pc=void 0,U.p2ps.delete(n.p2pId)),v.report.onRemoveStream(U.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:U.uid})}else m.default.error("ERROR stream ",t.uid," not found onRemoveStream ",t)}),U.socket.on("on_publish_stream",function(t){m.default.info("[".concat(U.clientId,"] on_publish_stream:"),t);var n=U.localStreams[t.uid];U.dispatchEvent({type:"streamPublished",stream:n,proxy:t.proxy}),v.report.reportApiInvoke(U.joinInfo.sid,{name:"on_publish_stream",options:{proxy:t.proxy}})()}),U.socket.on("mute_audio",function(t){m.default.info("[".concat(U.clientId,"] rcv peer mute audio: ").concat(t.uid)),U.remoteMuteState[t.uid]=U.remoteMuteState[t.uid]||{audio:!1,video:!1},U.remoteMuteState[t.uid].audio=!0;var n=Object(g.a)({type:"mute-audio",uid:t.uid}),i=U.remoteStreams[t.uid];i?(i.peerMuteAudio=!0,i.pc&&U._adjustPCMuteStatus(i),U.dispatchEvent(n)):m.default.debug("Ignoring event ".concat(t.type),t)}),U.socket.on("unmute_audio",function(t){m.default.info("[".concat(U.clientId,"] rcv peer unmute audio: ").concat(t.uid)),U.remoteMuteState[t.uid]=U.remoteMuteState[t.uid]||{audio:!1,video:!1},U.remoteMuteState[t.uid].audio=!1;var n=Object(g.a)({type:"unmute-audio",uid:t.uid}),i=U.remoteStreams[t.uid];i?(i.peerMuteAudio=!1,i.pc&&U._adjustPCMuteStatus(i),U.dispatchEvent(n)):m.default.debug("Ignoring event ".concat(t.type),t)}),U.socket.on("mute_video",function(t){m.default.info("[".concat(U.clientId,"] rcv peer mute video: ").concat(t.uid)),U.remoteMuteState[t.uid]=U.remoteMuteState[t.uid]||{audio:!1,video:!1},U.remoteMuteState[t.uid].video=!0;var n=Object(g.a)({type:"mute-video",uid:t.uid}),i=U.remoteStreams[t.uid];i?(i.peerMuteVideo=!0,i.player&&(i.player.peerVideoReady=!1),i.pc&&U._adjustPCMuteStatus(i),U.dispatchEvent(n)):m.default.debug("Ignoring event ".concat(t.type),t)}),U.socket.on("unmute_video",function(t){m.default.info("[".concat(U.clientId,"] rcv peer unmute video: ").concat(t.uid)),U.remoteMuteState[t.uid]=U.remoteMuteState[t.uid]||{audio:!1,video:!1},U.remoteMuteState[t.uid].video=!1;var n=Object(g.a)({type:"unmute-video",uid:t.uid}),i=U.remoteStreams[t.uid];i?(i.peerMuteVideo=!1,i.pc&&U._adjustPCMuteStatus(i),U.dispatchEvent(n)):m.default.debug("Ignoring event ".concat(t.type),t)}),U.socket.on("on_crypt_error",function(t){m.default.warning("[".concat(U.clientId,"] stream crypt error"));var n=Object(g.a)({type:"crypt-error",cryptType:t.crypt_type});U.dispatchEvent(n)}),U.socket.on("on_user_banned",function(t){m.default.info("[".concat(U.clientId,"] user banned uid: ").concat(t.uid," error: ").concat(t.error_code));var n=Object(g.a)({type:"client-banned",uid:t.uid,attr:t.error_code});U.dispatchEvent(n),a=!0}),U.socket.on("on_stream_fallback_update",function(t){m.default.info("[".concat(U.clientId,"] stream fallback peerId: ").concat(t.stream_id," type: ").concat(t.stream_type));var n=Object(g.a)({type:"stream-fallback",uid:t.stream_id,stream:t.stream_id,attr:t.stream_type});U.dispatchEvent(n)}),U.socket.on("stream_recover",function(t){m.default.info("[".concat(U.clientId,"] stream recover uid: ").concat(t.id," peerId: ").concat(t.peerid," type: ").concat(t.type));var n=Object(g.a)({type:"stream-recover",uid:t.id,stream:t.peerid,attr:t.type});U.dispatchEvent(n)}),U.socket.on("on_p2p_lost",function(t){m.default.debug("[".concat(U.clientId,"] p2plost: "),t,"p2ps:",U.p2ps);var n,i="DTLS failed";(n=U.localStreams[t.uid]||U.remoteStreams[t.uid])?(n.pc&&n.pc.offerCandidates&&0===n.pc.offerCandidates.length&&(i="NO_CANDIDATES_IN_OFFER"),"publish"===t.event&&v.report.publish(U.joinInfo.sid,{lts:n.publishLTS,succ:!1,audio:n.hasAudio(),video:n.hasVideo(),screenshare:n.hasScreen(),audioName:n.hasAudio()&&n.audioName,videoName:n.hasVideo()&&n.videoName,screenName:n.hasScreen()&&n.screenName,ec:i,publishRequestid:U.publishRequestId||0,p2pid:U.p2ps.get(n.getId())}),"subscribe"===t.event&&v.report.subscribe(U.joinInfo.sid,{lts:n.subscribeLTS,succ:!1,video:n.subscribeOptions&&n.subscribeOptions.video,audio:n.subscribeOptions&&n.subscribeOptions.audio,peerid:t.uid+"",ec:i,subscribeRequestid:U.subscribeRequestId.get(n.getId())||0,p2pid:U.p2ps.get(n.getId())})):m.default.warning("P2PLost Stream Not found",t),m.default.debug("[".concat(U.clientId,"] p2plost:"),t.p2pid),(n=U.p2ps.get(t.p2pid))&&(U.p2ps.delete(t.p2pid),n.local?U.dispatchEvent(Object(g.a)({type:"pubP2PLost",stream:n,attr:i})):U.remoteStreams[n.getId()]&&U.dispatchEvent(Object(g.a)({type:"subP2PLost",stream:n,attr:i})))}),U.socket.on("on_token_privilege_will_expire",function(t){m.default.debug("[".concat(U.clientId,"] Received Message onTokenPrivilegeWillExpire")),U.dispatchEvent(Object(g.a)({type:"onTokenPrivilegeWillExpire"}))}),U.socket.on("on_token_privilege_did_expire",function(){m.default.warning("[".concat(U.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),U.closeGateway(),U.dispatchEvent(Object(g.a)({type:"onTokenPrivilegeDidExpire"}))}),U.socket.on("enable_local_video",function(t){m.default.info("[".concat(U.clientId,"] enable_local_video:"),t),U.dispatchEvent(Object(g.a)({type:"enable-local-video",uid:t.uid}))}),U.socket.on("disable_local_video",function(t){m.default.info("[".concat(U.clientId,"] disable_local_video:"),t),U.dispatchEvent(Object(g.a)({type:"disable-local-video",uid:t.uid}))}),U._doWithAction=function(t,n,i){var r,o,a,s;"tryNext"===t?(r=n,o=i,m.default.debug("[".concat(U.clientId,"] Connect next gateway")),U.state=y,U.socket.close(),G(),U.reconnectMode="tryNext",U.state=N,H(r,o)):"retry"===t?(a=n,s=i,m.default.debug("[".concat(U.clientId,"] Reconnect gateway")),U.state=y,U.socket.close(),G(),U.reconnectMode="retry",U.state=N,H(a,s)):"quit"===t?(m.default.debug("[".concat(U.clientId,"] quit gateway")),U.state=y,U.socket.close(),G()):"recover"===t&&W()},U.socket.on("on_notification",function(t){if(m.default.debug("[".concat(U.clientId,"] Receive notification: "),t),"ERR_JOIN_BY_MULTI_IP"===I.GatewayErrorCode[t.code])return U.dispatchEvent({type:"onMultiIP",option:t.option});t.detail?U._doWithAction(b[I.GatewayErrorCode[t.code]]):t.action&&U._doWithAction(t.action)}),U.socket.on("on_user_offline",function(t){m.default.info("[".concat(U.clientId,"] on_user_offline:"),t);var n=Object(g.a)({type:"peer-leave",uid:t.uid});if(U.remoteStreamsInChannel.has(t.uid)&&U.remoteStreamsInChannel.delete(t.uid),U.remoteStreams.hasOwnProperty(t.uid)&&(n.stream=U.remoteStreams[t.uid]),n.reason=t.reason,U.dispatchEvent(n),m.default.info("[".concat(U.clientId,"] remove remoteMuteState "),t.uid),delete U.remoteMuteState[t.uid],U.remoteStreams.hasOwnProperty(t.uid)){m.default.info("[".concat(U.clientId,"] closing stream on peer leave"),t.uid);var i=U.remoteStreams[t.uid];i.close(),delete U.remoteStreams[t.uid],v.report.onRemoveStream(U.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:U.uid}),void 0!==i.pc&&(i.pc.close(),i.pc=void 0,U.p2ps.delete(i.p2pId))}U.timers.hasOwnProperty(t.uid)&&(clearInterval(U.timers[t.uid]),clearInterval(U.timers[t.uid]+"_RelatedStats"),delete U.timers[t.uid]),null!=U.audioLevel[t.uid]&&delete U.audioLevel[t.uid],null!=U.timer_counter[t.uid]&&delete U.timer_counter[t.uid]}),U.socket.on("onUplinkStats",function(t){}),U.socket.on("liveStreamingStarted",function(t){var n=Object(g.c)({type:"liveStreamingStarted",url:t.url});U.dispatchEvent(n)}),U.socket.on("liveStreamingFailed",function(t){var n=Object(g.c)({type:"liveStreamingFailed",url:t.url});U.dispatchEvent(n)}),U.socket.on("liveStreamingStopped",function(t){var n=Object(g.c)({type:"liveStreamingStopped",url:t.url});U.dispatchEvent(n)}),U.socket.on("liveTranscodingUpdated",function(t){var n=Object(g.c)({type:"liveTranscodingUpdated",reason:t.reason});U.dispatchEvent(n)}),U.socket.on("streamInjectedStatus",function(t){var n=Object(g.c)({type:"streamInjectedStatus",url:t.url,uid:t.uid,status:t.status});U.dispatchEvent(n)}),U.socket.on("on_user_online",function(t){U.joinInfo.stringUid&&"string"!=typeof t.uid&&m.default.error("StringUID is Mixed with UintUID"),U.dispatchEvent({type:"peer-online",uid:t.uid})}),U.socket.on("receive_metadata",function(t){U.joinInfo.stringUid&&"string"!=typeof t.uid&&m.default.error("StringUID is Mixed with UintUID");var n=decodeURIComponent(escape(window.atob(t.metadata)));m.default.debug("[".concat(U.clientId,"] received ").concat(t.uid," metadata: ").concat(n)),U.dispatchEvent({type:"receive-metadata",uid:t.uid,metadata:n})})},Y=function(t,n){if(void 0!==U.socket)try{U.socket.emitSimpleMessage(t,function(t,i){n&&n(t,i)})}catch(i){m.default.error("[".concat(U.clientId,"] Error in sendSimpleSdp [").concat(i,"]"))}else m.default.error("[".concat(U.clientId,"] Error in sendSimpleSdp [socket not ready]"))},z=function(){for(var t in U.localStreams)if(void 0!==U.localStreams[t]){var n=U.localStreams[t];delete U.localStreams[t],void 0!==n.pc&&(n.pc.close(),n.pc=void 0)}},K=function(){for(var t in U.remoteStreamsInChannel.clear(),U.remoteStreams)if(U.remoteStreams.hasOwnProperty(t)){var n=U.remoteStreams[t];n.isPlaying()&&n.stop(),n.close(),delete U.remoteStreams[t],void 0!==n.pc&&(n.pc.close(),n.pc=void 0)}};return U},V={_gatewayClients:{},register:function(t,n){if(!n.uid){var i="NO_UID_PROVIDED";return m.default.error("[".concat(t.clientId,"] "),i,n),i}if(n.cname)return this._gatewayClients[n.cname]&&this._gatewayClients[n.cname][n.uid]&&this._gatewayClients[n.cname][n.uid]!==t?(i="UID_CONFLICT",m.default.error("[".concat(t.clientId,"] "),i,n),i):(m.default.debug("[".concat(t.clientId,"] register client Channel"),n.cname,"Uid",n.uid),this._gatewayClients[n.cname]||(this._gatewayClients[n.cname]={}),this._gatewayClients[n.cname][n.uid]=t,null);var i="NO_CHANNEL_PROVIDED";return m.default.error("[".concat(t.clientId,"] "),i,n),i},unregister:function(t){var n=t&&t.uid,i=t.joinInfo&&t.joinInfo.cname;if(!n||!i){var r="INVALID_GATEWAYCLIENT";return m.default.error("[".concat(t.clientId,"] "),r),r}if(this._gatewayClients[i]&&this._gatewayClients[i][n])return this._gatewayClients[i][n]!==t?(r="GATEWAYCLIENT_UID_CONFLICT",m.default.error("[".concat(t.clientId,"] "),r),r):(m.default.debug("[".concat(t.clientId,"] unregister client "),t.uid),delete this._gatewayClients[i][n],null);var r="GATEWEAY_CLIENT_UNREGISTERED";m.default.error("[".concat(t.clientId,"] "),r)}};U.DISCONNECTED=0,U.CONNECTING=1,U.CONNECTED=2,U.DISCONNECTING=3,U.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"},n.a=U},function(t,n,i){"use strict";i.r(n),i.d(n,"post",function(){return f}),i.d(n,"postFormData",function(){return l}),i.d(n,"shouldUseHttps",function(){return p}),i.d(n,"getHTTPSendBytes",function(){return c}),i.d(n,"getHTTPRecvBytes",function(){return d}),i.d(n,"resetHTTPByetsCount",function(){return u});var r=i(2),o=i(10),a=0,s=0,c=function(){return a},d=function(){return s},u=function(){a=0,s=0},l=function(t,n,i,c,d){var u=new XMLHttpRequest;if(u.timeout=n.timeout||Object(r.getParameter)("HTTP_CONNECT_TIMEOUT"),u.open("POST",t,!0),d)for(var l in d)"withCredentials"==l?u.withCredentials=!0:u.setRequestHeader(l,d[l]);u.onload=function(n){s+=Object(o.lengthInUtf8Bytes)(u.responseText),200!==u.status?c&&c({httpErrorCode:"httpcode-xhr.status"},t):i&&i(u.responseText)},u.onerror=function(n){c&&c(n,t)},u.ontimeout=function(n){c&&c(n,t)};var f=JSON.stringify(n);a+=Object(o.lengthInUtf8Bytes)(f);var p=new FormData;p.append("request",f),u.send(p)},f=function(t,n,i,c,d){var u=new XMLHttpRequest;if(u.timeout=n.timeout||Object(r.getParameter)("HTTP_CONNECT_TIMEOUT"),u.open("POST",t,!0),u.setRequestHeader("Content-type","application/json; charset=utf-8"),d)for(var l in d)"withCredentials"==l?u.withCredentials=!0:u.setRequestHeader(l,d[l]);u.onload=function(n){s+=Object(o.lengthInUtf8Bytes)(u.responseText),200!==u.status?c&&c({httpErrorCode:"httpcode-xhr.status"},t):i&&i(u.responseText)},u.onerror=function(n){c&&c(n,t)},u.ontimeout=function(n){c&&c(n,t)};var f=JSON.stringify(n);a+=Object(o.lengthInUtf8Bytes)(f),u.send(f)},p=function(){return"https:"==document.location.protocol}},function(t,n,i){"use strict";i.r(n),i.d(n,"RTCPeerConnection",function(){return T}),i.d(n,"getUserMedia",function(){return s}),i.d(n,"attachMediaStream",function(){return c}),i.d(n,"reattachMediaStream",function(){return d}),i.d(n,"setSrcObject",function(){return _}),i.d(n,"getSrcObject",function(){return g}),i.d(n,"webrtcDetectedBrowser",function(){return u}),i.d(n,"webrtcDetectedVersion",function(){return l}),i.d(n,"webrtcMinimumVersion",function(){return f}),i.d(n,"webrtcTesting",function(){return I}),i.d(n,"webrtcUtils",function(){return v});var r=i(11),o=i.n(r),a=i(4),s=null,c=null,d=null,u=null,l=null,f=null,p=null,_=null,g=null,h=null,m={addStream:null},v={log:function(){},extractVersion:function(t,n,i){var r=t.match(n);return r&&r.length>=i&&parseInt(r[i])}};if("object"==("undefined"==typeof window?"undefined":o()(window))?(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype?(_=function(t,n){t.srcObject=n},g=function(t){return t.srcObject}):(_=function(t,n){"mozSrcObject"in t?t.mozSrcObject=n:(t._srcObject=n,t.src=n?URL.createObjectURL(n):null)},g=function(t){return"mozSrcObject"in t?t.mozSrcObject:t._srcObject}),s=window.navigator&&window.navigator.getUserMedia):(_=function(t,n){t.srcObject=n},g=function(t){return t.srcObject}),c=function(t,n){_(t,n)},d=function(t,n){_(t,g(n))},"undefined"!=typeof window&&window.navigator){if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var $ in v.log("This appears to be Firefox"),u="firefox",l=v.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),f=31,h=mozRTCPeerConnection,m)m[$]=h.prototype[$];if(p=function(t,n){if(l<38&&t&&t.iceServers){for(var i=[],r=0;r<t.iceServers.length;r++){var o=t.iceServers[r];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),i.push(s)}else i.push(t.iceServers[r])}t.iceServers=i}var c=new h(t,n);for(var d in m)c[d]=m[d];return c},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),s=function(t,n,i){var r=function(t){if("object"!==o()(t)||t.require)return t;var n=[];return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var r=t[i]="object"===o()(t[i])?t[i]:{ideal:t[i]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||n.push(i),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:t[i]=r.exact,delete r.exact),void 0!==r.ideal){t.advanced=t.advanced||[];var a={};"number"==typeof r.ideal?a[i]={min:r.ideal,max:r.ideal}:a[i]=r.ideal,t.advanced.push(a),delete r.ideal,Object.keys(r).length||delete t[i]}}}),n.length&&(t.require=n),t};return l<38&&(v.log("spec: "+JSON.stringify(t)),t.audio&&(t.audio=r(t.audio)),t.video&&(t.video=r(t.video)),v.log("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,i)},navigator.getUserMedia=s,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:R,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(t){t([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},l<41){var E=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return E().then(void 0,function(t){if("NotFoundError"===t.name)return[];throw t})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var $ in v.log("This appears to be Chrome"),u="chrome",l=v.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),f=38,h=webkitRTCPeerConnection,m)m[$]=h.prototype[$];p=function(t,n){t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy);var i=new h(t,n);for(var r in m)i[r]=m[r];var o=i.getStats.bind(i);return i.getStats=function(t,n,i){var r=arguments;r.length>0&&"function"==typeof t&&(n?(i=n,n=t,r=[t=null,n,i]):(n=t,r=[t=null,n]));var a=function(t){var n={};return t.result().forEach(function(t){var i={id:t.id,timestamp:t.timestamp,type:t.type};t.names().forEach(function(n){i[n]=t.stat(n)}),n[i.id]=i}),n};if(r.length>=2){var s=function(t){r[1](a(t))};return o.apply(this,[s,r[0]])}return o()},i},["createOffer","createAnswer"].forEach(function(t){var n=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=this;if(arguments.length<1||1===arguments.length&&"object"===o()(arguments[0])){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,o){n.apply(t,[r,o,i])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=arguments,i=this;return new Promise(function(r,o){n.apply(i,[t[0],function(){r(),t.length>=2&&t[1].apply(null,[])},function(n){o(n),t.length>=3&&t[2].apply(null,[n])}])})}});var S=function(t){if("object"!==o()(t)||t.mandatory||t.optional)return t;var n={};return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var r="object"===o()(t[i])?t[i]:{ideal:t[i]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var a=function(t,n){return t?t+n.charAt(0).toUpperCase()+n.slice(1):"deviceId"===n?"sourceId":n};if(void 0!==r.ideal){n.optional=n.optional||[];var s={};"number"==typeof r.ideal?(s[a("min",i)]=r.ideal,n.optional.push(s),(s={})[a("max",i)]=r.ideal,n.optional.push(s)):(s[a("",i)]=r.ideal,n.optional.push(s))}void 0!==r.exact&&"number"!=typeof r.exact?(n.mandatory=n.mandatory||{},n.mandatory[a("",i)]=r.exact):["min","max"].forEach(function(t){void 0!==r[t]&&(n.mandatory=n.mandatory||{},n.mandatory[a(t,i)]=r[t])})}}),t.advanced&&(n.optional=(n.optional||[]).concat(t.advanced)),n};if(s=function(t,n,i){return t.audio&&(t.audio=S(t.audio)),t.video&&(t.video=S(t.video)),v.log("chrome: "+JSON.stringify(t)),navigator.webkitGetUserMedia(t,n,i)},navigator.getUserMedia=s,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:R,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){t(i.map(function(t){return{label:t.label,kind:n[t.kind],deviceId:t.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){if((Object(a.getBrowserVersion)()?Number(Object(a.getBrowserVersion)().split(".")[0]):void 0)<46){var y=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return v.log("spec:   "+JSON.stringify(t)),t.audio=S(t.audio),t.video=S(t.video),v.log("chrome: "+JSON.stringify(t)),y(t)}}}else navigator.mediaDevices.getUserMedia=function(t){return R(t)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){v.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){v.log("Dummy mediaDevices.removeEventListener called.")}),c=function(t,n){l>=43?_(t,n):void 0!==t.src?t.src=n?URL.createObjectURL(n):null:v.log("Error attaching stream to element.")},d=function(t,n){l>=43?_(t,g(n)):t.src=n.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(v.log("This appears to be Edge"),u="edge",l=v.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),f=12):v.log("Browser does not appear to be WebRTC-capable")}else v.log("This does not appear to be a browser"),u="not a browser";function R(t){return new Promise(function(n,i){s(t,n,i)})}var T,I={};try{Object.defineProperty(I,"version",{set:function(t){l=t}})}catch(A){}p?T=p:"undefined"!=typeof window&&(T=window.RTCPeerConnection)},function(t,n,i){"use strict";var r=i(12),o=i.n(r),a=i(17),s=i.n(a),c=i(51),d=i.n(c),u=i(4),l=i(1),f=i(3),p=i(0),_=(i(25),i(2),i(5),i(52)),g=i.n(_),h=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function m(t){for(var n=new Uint8Array([99,114,121,112,116,105,105]),i=n.length,r=t,o=r.length,a=new Uint8Array(o),s=new Uint8Array(256),c=0;c<256;c++)s[c]=c;for(var d=0,u=0;u<256;u++){var l=[s[d=(d+s[u]+n[u%i])%256],s[u]];s[u]=l[0],s[d]=l[1]}var f,p=0;d=0;for(var _=0;_<0+o;_++){var g=[s[d=(d+s[p=(p+1)%256])%256],s[p]];s[p]=g[0],s[d]=g[1],f=s[(s[p]+s[d])%256],_>=0&&(a[_-0]=r[_-0]^f)}return Function("var winSize = 5; return `"+String.fromCharCode.apply(null,a)+"`")()}function v(t,n){var i=m(n),r=g.a.createProgramFromSources(t,[m(h),i]),o=t.getAttribLocation(r,"a_position"),a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(o);var s=2,c=t.FLOAT,d=!1,u=0,l=0;t.vertexAttribPointer(o,s,c,d,u,l);var f=t.getAttribLocation(r,"a_texCoord"),p=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(f),s=2,c=t.FLOAT,d=!1,u=0,l=0,t.vertexAttribPointer(f,s,c,d,u,l),r}var $=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];function E(t,n,i){var r=t.gl;this.program=v(r,$),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY");r.uniform1f(t,1)}}var S=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];function y(t,n,i){var r=t.gl,o=1/n,a=1/i,s=5;this.program=v(r,S),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY"),n=r.getUniformLocation(this.program,"u_singleStepOffset"),i=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(n,o,a),r.uniform1f(i,s),r.uniform1f(t,1)},this.setParameters=function(t){void 0!==t.denoiseLevel&&(s=t.denoiseLevel)},this.setSize=function(t,n){o=1/t,a=1/n}}var R=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];function T(t,n,i){var r=t.gl,o=1/n,a=1/i,s=5;this.program=v(r,R),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY"),n=r.getUniformLocation(this.program,"u_singleStepOffset"),i=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(n,o,a),r.uniform1f(i,s),r.uniform1f(t,1)},this.setParameters=function(t){void 0!==t.denoiseLevel&&(s=t.denoiseLevel)},this.setSize=function(t,n){o=1/t,a=1/n}}var I=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];function A(t,n,i){var r=t.gl,o=1/n,a=1/i,s=5;this.program=v(r,I),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY"),n=r.getUniformLocation(this.program,"u_singleStepOffset"),i=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(n,o,a),r.uniform1f(i,s),r.uniform1f(t,1)},this.setParameters=function(t){void 0!==t.denoiseLevel&&(s=t.denoiseLevel)},this.setSize=function(t,n){o=1/t,a=1/n}}var C=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144];function b(t,n,i){var r=t.gl,o=5,a=.1,s=.5,c=175/180*3.141593,d=115/180*3.141593,u=173/180*3.141593,l=116/180*3.141593,f=2.04203545,p=0,_=0,g=0,h=[],m=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],$=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],E=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];this.program=v(r,C),this.setUniforms=function(){var n=r.getUniformLocation(this.program,"u_flipY"),i=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform1f(i,o),r.uniform1f(n,1);var m=r.getUniformLocation(this.program,"light");r.uniform1f(m,a);var v=r.getUniformLocation(this.program,"redness");r.uniform1f(v,s);var $=r.getUniformLocation(this.program,"skin_he_max"),E=r.getUniformLocation(this.program,"skin_he_min"),S=r.getUniformLocation(this.program,"skin_hc_max"),y=r.getUniformLocation(this.program,"skin_hc_min"),R=r.getUniformLocation(this.program,"skin_hc_axis"),T=r.getUniformLocation(this.program,"facts_rotate_c"),I=r.getUniformLocation(this.program,"facts_rotate_le"),A=r.getUniformLocation(this.program,"facts_rotate_ge");r.uniform1f($,c),r.uniform1f(E,d),r.uniform1f(S,u),r.uniform1f(y,l),r.uniform1f(R,f),r.uniform1f(T,p),r.uniform1f(I,_),r.uniform1f(A,g);var C=r.getUniformLocation(this.program,"u_originImage");r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,t.inputTexture),r.uniform1i(C,2);for(var b=["lighten_lut"],N=[r.TEXTURE3],O=0;O<b.length;O++){var w=r.getUniformLocation(this.program,b[O]);r.activeTexture(N[O]),r.bindTexture(r.TEXTURE_2D,h[O]),r.uniform1i(w,O+3)}},this.setParameters=function(t){void 0!==t.denoiseLevel&&(o=t.denoiseLevel),void 0!==t.lightLevel&&(a=t.lightLevel),void 0!==t.rednessLevel&&(s=t.rednessLevel,this._updateRedness(s)),void 0!==t.lighteningContrastLevel&&this._updateLut(t.lighteningContrastLevel)},this._updateRedness=function(t){var n,i,r=3.141593,o=t,a=o;o>1&&(o=1),o<0&&(o=0),a>1&&(a=1),a<0&&(a=0),p=.8*o,a<.8&&(a=0),(f=(117-4*a)/180*r)<(l=(116-4*a)/180*r)&&(f=l),l<r/2&&(l=r/2),f<r/2&&(f=r/2),(d=(115-4*a)/180*r)<r/2&&(d=r/2),(u=173/180*r)>r&&(u=r),f>r&&(f=r),(c=175/180*r)>r&&(c=r),i=u-f,g=(n=c-u)>.01?p*i/n:p,i=f-l,_=(n=l-d)>.01?p*i/n:p},this._updateLut=function(t){var n=null;0==t&&(n=$),1==t&&(n=E),2==t&&(n=m);for(var i=[new Uint8Array(n)],o=[256],a=[1],s=0;s<i.length;s++)r.bindTexture(r.TEXTURE_2D,h[s]),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,o[s],a[s],0,r.LUMINANCE,r.UNSIGNED_BYTE,i[s])},this._init=function(){var t=null;t=$;for(var n=[new Uint8Array(t)],i=[256],o=[1],a=0;a<n.length;a++){var s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,i[a],o[a],0,r.LUMINANCE,r.UNSIGNED_BYTE,n[a]),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),h.push(s)}},this._init()}var N=!1;function O(){this.programs=[];var t=this,n=null,i=null;t.gl=null,t.inputTexture=null;var r=[],o=[],a=0,s=0;t._initGl=function(i,c){t.inputTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,t.inputTexture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);for(var d=0;d<4;d++){var u=n.createTexture();n.bindTexture(n.TEXTURE_2D,u),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),d<2?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,i,c,0,n.RGBA,n.UNSIGNED_BYTE,null):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,c,i,0,n.RGBA,n.UNSIGNED_BYTE,null);var l=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,l),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,u,0),r.push(u),o.push(l)}n.viewport(0,0,i,c),a=i,s=c},t.render=function(c){if(n){var d=0;s==c.videoWidth&&a===c.videoHeight&&(d=2),n.viewport(0,0,c.videoWidth,c.videoHeight),n.bindTexture(n.TEXTURE_2D,t.inputTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,c);for(var u=N?t.programs.length-1:0,l=0;l<=u;l++){var f=t.programs[l].program;n.useProgram(f);var p=n.getUniformLocation(f,"u_image");t.programs[l].setUniforms(),n.bindFramebuffer(n.FRAMEBUFFER,o[d+l%2]),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLES,0,6),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r[d+l%2]),n.uniform1i(p,0)}n.useProgram(i);var _=n.getUniformLocation(i,"u_flipY");n.uniform1f(_,-1),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLES,0,6)}},t.setEnableBeauty=function(t){N=t},t.init=function(r,o,a){if("undefined"==typeof WebGLRenderingContext)throw Error("NOT_SUPPORT");n=a.getContext("webgl"),t.gl=n,t._initGl(r,o),t.programs.push(new E(this,r,o)),t.programs.push(new y(this,r,o)),t.programs.push(new T(this,r,o)),t.programs.push(new A(this,r,o)),t.programs.push(new b(this,r,o)),i=t.programs[0].program},t.release=function(){t.gl=null,n=null,i=null,t.inputTexture=null,t.programs=[],r=[],o=[]},t.setDenoiseLevel=function(n){t.programs.forEach(function(t){t.setParameters&&t.setParameters({denoiseLevel:n})})},t.setLightLevel=function(n){t.programs.forEach(function(t){t.setParameters&&t.setParameters({lightLevel:n})})},t.setRednessLevel=function(n){t.programs.forEach(function(t){t.setParameters&&t.setParameters({rednessLevel:n})})},t.setContrastLevel=function(n){t.programs.forEach(function(t){t.setParameters&&t.setParameters({lighteningContrastLevel:n})})},t.setSize=function(n,i){t.programs.forEach(function(t){t.setSize&&t.setSize(n,i)})}}O._instance=null,O.getInstance=function(){return O._instance||(O._instance=new O),O._instance},n.a={addVideoEffectCapability:function(t){var n;t.videoEffect={canvas:null,video:null,fps:30,stopChromeBackgroundLoop:null,enableBeauty:!1,denoiseLevel:5,lightLevel:.35,rednessLevel:.5,lighteningContrastLevel:1,videoContextInited:!1,originVideoTrack:null,canvasVideoTrack:null,ctx:null},t._initVideoContext=function(){if(t.videoEffect.videoContextInited)throw Error("Failed to init video context. Already inited");if(!t.stream)throw Error("Failed to init video context. Local Stream not initialized");t.videoEffect.originVideoTrack=t.stream.getVideoTracks()[0],t.attributes&&t.attributes.maxFrameRate&&(t.videoEffect.fps=t.attributes.maxFrameRate),t.videoEffect.videoContextInited=!0},t._renderWithWebGL=function(n){return new Promise(function(i){t.videoEffect.canvas||(t.videoEffect.canvas=document.createElement("canvas")),t.videoEffect.video||(t.videoEffect.video=document.createElement("video")),t.videoEffect.video.setAttribute("autoplay",""),t.videoEffect.video.setAttribute("muted",""),t.videoEffect.video.muted=!0,t.videoEffect.video.setAttribute("playsinline",""),t.videoEffect.video.setAttribute("style","display:none"),t.videoEffect.video.srcObject=n;var r=n.getVideoTracks()[0].getSettings(),o=r.width,a=r.height;t.videoEffect.canvas.setAttribute("width",o),t.videoEffect.canvas.setAttribute("height",a),t.videoEffect.video.setAttribute("width",o),t.videoEffect.video.setAttribute("height",a);var s=O.getInstance();s.init(t.videoEffect.video.width,t.videoEffect.video.height,t.videoEffect.canvas),s.setDenoiseLevel(t.videoEffect.denoiseLevel),s.setLightLevel(t.videoEffect.lightLevel),s.setRednessLevel(t.videoEffect.rednessLevel),s.setContrastLevel(t.videoEffect.lighteningContrastLevel),t.videoEffect.video.addEventListener("playing",function n(){var r=t.videoEffect.canvas.captureStream(t.videoEffect.fps);t.videoEffect.video.removeEventListener("playing",n,!0),i([r.getVideoTracks()[0],t.videoEffect.video])},!0),t.videoEffect.video.play()})},t._disableEffect=function(){t.videoEffect.videoContextInited||t._initVideoContext();var n=t.videoEffect.originVideoTrack;if(!n)return p.default.warning("Video track is null, fail to disable video effect!"),Promise.resolve();if(t.pc&&t.pc.peerConnection&&t.pc.peerConnection){var i=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find(function(t){return t&&t.track&&"video"==t.track.kind});if(i&&i.replaceTrack&&n)return i.replaceTrack(n)}return Promise.resolve()},t._releaseEffect=function(){var n;return n=t.videoEffect.enableBeauty?t._disableEffect():Promise.resolve(),O.getInstance().release(),t.videoEffect.videoContextInited=!1,t.videoEffect.canvasVideoTrack=null,n},t._enableEffect=function(){return t.videoEffect.videoContextInited||t._initVideoContext(),t.videoEffect.originVideoTrack?t.videoEffect.canvasVideoTrack?(t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()):t._renderWithWebGL(t.stream).then(function(n){var i=d()(n,2),r=i[0],o=i[1];t.videoEffect.canvasVideoTrack=r;var a=O.getInstance();return requestAnimationFrame(function n(){t.videoEffect.enableBeauty&&a.render(o),t.videoEffect.videoContextInited&&requestAnimationFrame(n)}),u.isChrome()&&document.addEventListener("visibilitychange",function(){var n,i,r,s,c,d;document.hidden,document.hidden?t.videoEffect.stopChromeBackgroundLoop=(n=function(){t.videoEffect.enableBeauty&&a.render(o)},r=1/(i=t.videoEffect.fps),(c=(s=new AudioContext).createGain()).gain.value=0,c.connect(s.destination),function t(){var i=s.createOscillator();i.onended=t,i.connect(c),i.start(0),i.stop(s.currentTime+r),n(s.currentTime),d&&(i.onended=function(){s.close()})}(),d=!1,function(){d=!0}):t.videoEffect.stopChromeBackgroundLoop&&(t.videoEffect.stopChromeBackgroundLoop(),t.videoEffect.stopChromeBackgroundLoop=null)},!1),t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()}):(p.default.warning("Video track is null, fail to enable video effect!"),Promise.resolve())},t._showEffectInLocalPlayer=function(){if(t.player){var n=t.player.div.children[0];if("none"!==n.style.display&&(t.player.div.appendChild(t.videoEffect.canvas),"video"===n.tagName.toLowerCase())){var i=n.getAttribute("style");t.videoEffect.canvas.setAttribute("style",i),"none"!==n.style.display&&(n.style.display="none")}}},t._removeEffectFromLocalPlayer=function(){if(t.player&&t.player.div&&t.videoEffect.enableBeauty&&t.videoEffect.canvas){t.player.div.removeChild(t.videoEffect.canvas);var n=t.player.div.children[0];"video"===n.tagName.toLowerCase()&&(t.videoEffect.canvas.style.display="none",n.style.display="block")}},t._replaceWithCanvasTrack=function(){var n=null;return t.pc&&t.pc.peerConnection&&t.pc.peerConnection&&(n=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find(function(t){return t&&t.track&&"video"==t.track.kind})),n&&n.replaceTrack&&t.videoEffect.canvasVideoTrack?n.replaceTrack(t.videoEffect.canvasVideoTrack):Promise.resolve()},t.setBeautyEffectOptions=(n=s()(o.a.mark(function n(i,r){var a,s=arguments;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(Object(f.checkValidBoolean)(i,"enabled"),a=O.getInstance(),t.videoEffect.enableBeauty==i){n.next=14;break}if(a.setEnableBeauty(i),!i){n.next=9;break}return n.next=7,t._enableEffect();case 7:n.next=12;break;case 9:return t._removeEffectFromLocalPlayer(),n.next=12,t._releaseEffect();case 12:t.videoEffect.enableBeauty=i,l.report.reportApiInvoke(t.sid,{callback:null,options:s,name:"Stream.setBeautyEffectOptions",tag:"tracer"});case 14:if(i){n.next=16;break}return n.abrupt("return");case 16:if(!r){n.next=20;break}Object(f.checkValidObject)(r,"options"),n.next=21;break;case 20:return n.abrupt("return");case 21:if(void 0!==r.smoothnessLevel&&(Object(f.checkValidFloatNumber)(r.smoothnessLevel,"smoothnessLevel",0,1),t.videoEffect.denoiseLevel=10*r.smoothnessLevel,t.videoEffect.denoiseLevel<.1&&(t.videoEffect.denoiseLevel=.1),a.setDenoiseLevel(t.videoEffect.denoiseLevel)),void 0!==r.lighteningLevel&&(Object(f.checkValidFloatNumber)(r.lighteningLevel,"lighteningLevel",0,1),t.videoEffect.lightLevel=r.lighteningLevel/2,t.videoEffect.lightLevel<.01&&(t.videoEffect.lightLevel=.01),a.setLightLevel(t.videoEffect.lightLevel)),void 0!==r.rednessLevel&&(Object(f.checkValidFloatNumber)(r.rednessLevel,"rednessLevel",0,1),t.videoEffect.rednessLevel=r.rednessLevel,t.videoEffect.rednessLevel<.01&&(t.videoEffect.rednessLevel=.01),a.setRednessLevel(t.videoEffect.rednessLevel)),void 0===r.lighteningContrastLevel){n.next=29;break}if(0===r.lighteningContrastLevel||1===r.lighteningContrastLevel||2===r.lighteningContrastLevel){n.next=27;break}throw Error("Invalid lighteningContrastLevel: The value should be 0, 1 or 2.");case 27:t.videoEffect.lighteningContrastLevel=parseFloat(r.lighteningContrastLevel),a.setContrastLevel(t.videoEffect.lighteningContrastLevel);case 29:case"end":return n.stop()}},n)})),function(t,i){return n.apply(this,arguments)})},restoreVideoEffect:function(t){return t.videoEffect.enableBeauty?t._enableEffect():Promise.resolve()},disableVideoEffect:function(t){return t._releaseEffect?t._releaseEffect():Promise.resolve()},applyEffectInPlayer:function(t){t.videoEffect.enableBeauty&&t.videoEffect.canvas&&t._showEffectInLocalPlayer()},removeEffectFromLocalPlayer:function(t){t._removeEffectFromLocalPlayer()},replaceWithCanvasTrack:function(t){return t.videoEffect.enableBeauty?t._replaceWithCanvasTrack():Promise.resolve()},checkVideoEffectEnabled:function(t){return!!t.videoEffect.enableBeauty&&!!t.videoEffect&&!!t.videoEffect.videoContextInited&&(p.default.error("Operation not permitted: ".concat("VIDEO_EFFECT_ENABLED")),"VIDEO_EFFECT_ENABLED")}}},function(t,n){function i(t,n,i,r,o,a,s){try{var c=t[a](s),d=c.value}catch(u){return void i(u)}c.done?n(d):Promise.resolve(d).then(r,o)}t.exports=function(t){return function(){var n=this,r=arguments;return new Promise(function(o,a){var s=t.apply(n,r);function c(t){i(s,o,a,c,d,"next",t)}function d(t){i(s,o,a,c,d,"throw",t)}c(void 0)})}}},function(t,n,i){"use strict";var r=i(38),o=Object.prototype.toString;function a(t){return"[object Array]"===o.call(t)}function s(t){return void 0===t}function c(t){return null!==t&&"object"==typeof t}function d(t){return"[object Function]"===o.call(t)}function u(t,n){if(null!=t){if("object"!=typeof t&&(t=[t]),a(t))for(var i=0,r=t.length;i<r;i++)n.call(null,t[i],i,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.call(null,t[o],o,t)}}t.exports={isArray:a,isArrayBuffer:function(t){return"[object ArrayBuffer]"===o.call(t)},isBuffer:function(t){return null!==t&&!s(t)&&null!==t.constructor&&!s(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:c,isUndefined:s,isDate:function(t){return"[object Date]"===o.call(t)},isFile:function(t){return"[object File]"===o.call(t)},isBlob:function(t){return"[object Blob]"===o.call(t)},isFunction:d,isStream:function(t){return c(t)&&d(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function t(){var n={};function i(i,r){"object"==typeof n[r]&&"object"==typeof i?n[r]=t(n[r],i):n[r]=i}for(var r=0,o=arguments.length;r<o;r++)u(arguments[r],i);return n},deepMerge:function t(){var n={};function i(i,r){"object"==typeof n[r]&&"object"==typeof i?n[r]=t(n[r],i):n[r]="object"==typeof i?t({},i):i}for(var r=0,o=arguments.length;r<o;r++)u(arguments[r],i);return n},extend:function(t,n,i){return u(n,function(n,o){t[o]=i&&"function"==typeof n?r(n,i):n}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,n,i){"use strict";i.d(n,"a",function(){return l});var r=i(7),o=i.n(r),a=i(8),s=i(0),c=i(5);function d(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"==typeof t)return u(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,n)}}(t))){var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,r=Array(n);i<n;i++)r[i]=t[i];return r}var l=new function(){var t=Object(a.b)();return t.devicesHistory={},t.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},t.state=t.states.UNINIT,t.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},t.deviceReloadTimer=null,t._init=function(n,i){t.state=t.states.INITING,t.devicesHistory={},t._reloadDevicesInfo(function(){t.state=t.states.INITED,t.dispatchEvent({type:"inited"}),n&&n()},function(n){s.default.warning("Device Detection functionality cannot start properly."),t.state=t.states.UNINIT,i&&i(n)})},t._enumerateDevices=function(t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return s.default.warning("enumerateDevices() not supported."),n&&n("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then(function(n){t&&setTimeout(function(){t(n)},0)}).catch(function(t){n&&n(t)})},t._reloadDevicesInfo=function(n,i){var r=[];t._enumerateDevices(function(i){var a=Date.now();for(var c in i.forEach(function(n){var i=t.devicesHistory[n.deviceId];if((i?i.state:t.deviceStates.INACTIVE)!=t.deviceStates.ACTIVE){var o=i||{initAt:a};o.device=n,o.state=t.deviceStates.ACTIVE,r.push(o),t.devicesHistory[n.deviceId]=o}t.devicesHistory[n.deviceId].lastReloadAt=a}),t.devicesHistory){var d=t.devicesHistory[c];d&&d.state==t.deviceStates.ACTIVE&&d.lastReloadAt!==a&&(d.state=t.deviceStates.INACTIVE,r.push(d)),d.lastReloadAt=a}t.state==t.states.INITED&&r.forEach(function(n){var i=o()({},n);switch(n.device.kind){case"audioinput":i.type="recordingDeviceChanged";break;case"audiooutput":i.type="playoutDeviceChanged";break;case"videoinput":i.type="cameraChanged";break;default:s.default.warning("Unknown device change",i),i.type="unknownDeviceChanged"}t.dispatchEvent(i)}),n&&n()},i)},t.getDeviceById=function(n,i,r){t.getDevices(function(t){for(var o=0;o<t.length;o++){var a=t[o];if(a&&a.deviceId===n)return i&&i(a)}return r&&r()})},t.searchDeviceNameById=function(n){var i=t.devicesHistory[n];return i?i.device.label||i.device.deviceId:null},t.getDevices=function(n,i){t._enumerateDevices(n,function(t){i&&i(t.name+": "+t.message)})},t.getVideoCameraIdByLabel=function(n,i,r){t.getCameras(function(t){var o,a=d(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(s.label===n)return i&&i(s.deviceId)}}catch(u){a.e(u)}finally{a.f()}return r&&r(c.default.NOT_FIND_DEVICE_BY_LABEL)},r)},t.getRecordingDevices=function(n,i){return t._enumerateDevices(function(t){var i=t.filter(function(t){return"audioinput"==t.kind});n&&n(i)},function(t){i&&i(t)})},t.getPlayoutDevices=function(n,i){return t._enumerateDevices(function(t){var i=t.filter(function(t){return"audiooutput"==t.kind});n&&n(i)},function(t){i&&i(t)})},t.getCameras=function(n,i){return t._enumerateDevices(function(t){var i=t.filter(function(t){return"videoinput"==t.kind});n&&n(i)},function(t){i&&i(t)})},t._init(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",function(){t._reloadDevicesInfo()}),t.deviceReloadTimer=setInterval(t._reloadDevicesInfo,5e3)}),t}},function(t,n,i){"use strict";i.r(n),i.d(n,"_getReconnectCSTimer",function(){return C}),i.d(n,"_setClientConnectionStateRecord",function(){return b}),i.d(n,"getGatewayList",function(){return O}),i.d(n,"getUserAccount",function(){return L});var r=i(11),o=i.n(r),a=i(12),s=i.n(a),c=i(17),d=i.n(c),u=i(2),l=(i(4),i(0)),f=i(14),p=i(1),_=i(5),g=function(t,n){var i=!1,r=0,o=Object(u.getParameter)("PROXY_CS"),a=Object(u.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),s=0,c={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,uid:t.uid,cname:t.cname,ts:Math.floor(Date.now()/1e3),version:u.VERSION,seq:0,requestId:1},d=function(d){var u=(new Date).getTime();h("https://"+d+"/api/v1",c,function(c,_){if(c)return l.default.debug("["+t.clientId+"] Request proxy server failed: ",c),r++,p.report.requestProxyAppCenter(t.sid,{lts:u,succ:!1,APAddr:d,workerManagerList:null,ec:JSON.stringify(c),response:JSON.stringify({err:c,res:_})}),r>=o.length&&n&&n("Get proxy server failed: request all failed"),void(!(r%a)&&r<o.length&&(s++,f()));if(!i){if((_=JSON.parse(_)).json_body){var g=JSON.parse(_.json_body);if(l.default.debug("["+t.clientId+"] App return:",g.servers),200!==g.code)c="Get proxy server failed: response code ["+g.code+"], reason [ "+g.reason+"]",r++,l.default.debug("["+t.clientId+"] "+c),p.report.requestProxyAppCenter(t.sid,{lts:u,succ:!1,APAddr:d,workerManagerList:null,ec:c,response:JSON.stringify({err:c,res:_})}),r>=o.length&&n&&n(c),!(r%a)&&r<o.length&&(s++,f());else{i=!0;var h=v(g.servers);p.report.requestProxyAppCenter(t.sid,{lts:u,succ:!0,APAddr:d,workerManagerList:JSON.stringify(h),ec:null,response:JSON.stringify({res:_})}),n&&n(null,h)}}else l.default.debug("["+t.clientId+"] Get proxy server failed: no json_body"),p.report.requestProxyAppCenter(t.sid,{lts:u,succ:!1,APAddr:d,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:_})})}})},f=function(){for(var t=s*a,n=t;n<Math.min(o.length,t+a);n++)d(o[n])};f()},h=function(t,n,i){var r={service_name:"webrtc_proxy",json_body:JSON.stringify(n)};Object(f.post)(t,r,function(t){i&&i(null,t)},function(t){i&&i(t)},{"X-Packet-Service-Type":0,"X-Packet-URI":61})},m=function(t,n,i){var r=!1,o=0,a={command:"request",gatewayType:"http",appId:t.appId,cname:t.cname,uid:t.uid+"",sdkVersion:"2.3.1",sid:t.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:t.appId,cname:t.cname,uid:t.uid+"",sid:t.sid}};n.map(function(s){var c,d,u,_=(new Date).getTime();c="https://"+s+":4000/v2/machine",d=a,u=function(a,c){if(a)return l.default.debug("["+t.clientId+"] Request worker manager failed: ",a),o++,p.report.requestProxyWorkerManager(t.sid,{lts:_,succ:!1,workerManagerAddr:s,ec:JSON.stringify(a),response:JSON.stringify({res:c})}),void(o>=n.length&&i&&i("requeet worker manager server failed: request failed"));if(!r){if(!(c=JSON.parse(c)).serverResponse)return i&&i("requeet worker manager server failed: serverResponse is undefined");r=!0,p.report.requestProxyWorkerManager(t.sid,{lts:_,succ:!0,workerManagerAddr:s,ec:JSON.stringify(a),response:JSON.stringify({res:c})}),i&&i(null,{address:s,serverResponse:c.serverResponse})}},Object(f.post)(c,d,function(t){u&&u(null,t)},function(t){u&&u(t)})})},v=function(t){if(!t||[]instanceof Array==!1)return[];var n=[];return t.forEach(function(t){var i;t.address&&t.tcp?(t.address.match(/^[\.\:\d]+$/)?i="".concat(t.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(l.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(t.address,". Used As Host instead")),i="".concat(t.address,":").concat(t.tcp)),n.push(i)):l.default.error("["+joinInfo.clientId+"] Invalid address format ",t)}),n},$=i(21),E=function(t,n,i,r){var o=Object(u.getParameter)("WEBCS_DOMAIN").concat(Object(u.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")),a=Object(u.getParameter)("PROXY_SERVER_TYPE3");o=o.map(function(t,n){return"".concat(a[(n+1)%a.length],"/ap/?url=").concat(t)});var s,c=0,d=!0,g=Object(u.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),h=0,m=function(m){var E,S,y,R,T,I,A,C,b,N;E=t,S=m,y=n,R=function(t,r){t?(c++,l.default.error("[".concat(n.clientId,"] request ").concat(m," failed: ").concat(t)),t&&-1===_.JOIN_PROXY_RETRY_LIST.indexOf(t)&&(s=t),c===o.length&&(s||(s="RETRYABLE_ERROR"),i(s)),!(c%g)&&c<o.length&&(h++,v())):d&&(/sd-rtn/.test(r.gatewayServers.gateway_addr[0])?Object(u.setParameter)("NGINX",a[0]):Object(u.setParameter)("NGINX",a[1]),d=!1,i(null,r))},T=r,I=Date.now(),A=function(t,n){try{p.report.joinChooseServer2(y.sid,{lts:I,succ:!t,csAddr:S,serverList:n&&n.gateway_addr,cid:n&&n.cid+"",uid:n&&n.uid+"",ec:t,chooseServerIp:n&&n.detail&&n.detail[502]})}catch(i){}},C=function(t,n){var i=Date.now();try{p.report.joinWebProxyAP({lts:i,sid:y.sid,cname:y.cname,cid:y.cid,uid:y.uid,sucess:t?-1:1,elapse:i-I,eventType:E,apServerAddr:S,turnServerAddrList:JSON.stringify(n),errorCode:t||"0"})}catch(r){}},b=Object(u.getParameter)("AREA_SETTING").reduce(function(t,n,i){var r=Object($.getAreaCodeByArea)(n);return r?0===i?r:"".concat(t,",").concat(r):t},""),N={appid:y.token,client_ts:Date.now(),opid:133,sid:y.sid,request_bodies:[{uri:22,buffer:{cname:y.cname,detail:{11:b,6:y.stringUid},key:y.token,service_ids:[11,T?20:18],uid:y.uid||0}}]},S="https://".concat(S,"/api/v2/transpond/webrtc?v=2"),Object(f.postFormData)(S,N,function(t){var n=function(t){return RegExp(/10102\d{2}$/).test(t)?"NO_SERVICE_AVAILABLE":_.APErrorCode[t]||t};try{var i,r,o=JSON.parse(t);if(30===(o=o.response_body)[0].uri&&0!==o[0].buffer.code){var a=n(o[0].buffer.code);return C(a,o),R(a)}if(4096===o[0].buffer.flag?(r=o[0].buffer,i=o[1].buffer):(r=o[1].buffer,i=o[0].buffer),0!==i.code)return a=n(i.code),l.default.error("[".concat(y.clientId,"] requestProxyServer failed: ").concat(a)),C(a,i),R(a);if(!i.edges_services||!i.edges_services instanceof Array)return C("UNEXPECTED_ERROR",i),R("UNEXPECTED_ERROR");var s=Object(u.getParameter)("GATEWAY_DOMAINS"),c=0;if(S.indexOf(s[1])>-1&&(c=1),0===i.edges_services.length)return C("EMPTY_PROXY_LIST",i),R("EMPTY_PROXY_LIST");var d=i.edges_services.map(function(t){if(t.ip)return t.ip=T?"".concat(t.ip.replace(/[^\d]/g,"-"),".").concat(s[c++%s.length]):"".concat(t.ip),t});if(C(null,d),0!==r.code)return a=n(r.code),l.default.error("[".concat(y.clientId,"] requestChooseServer failed: ").concat(a)),A(a),R(a);var f=[];if(s=Object(u.getParameter)("GATEWAY_DOMAINS"),c=0,S.indexOf(s[1])>-1&&(c=1),r.edges_services.forEach(function(t){var n;if(t.ip&&t.port){if(!t.ip.match(/^[\.\:\d]+$/))return l.default.info("["+y.clientId+"] "+"Cannot recognized as IP address ".concat(t.ip,". Used As Host instead")),void A("UNEXPECTED_IP");n="".concat(t.ip.replace(/[^\d]/g,"-"),".").concat(s[c++%s.length]);var i=Object(u.getParameter)("PROXY_SERVER_TYPE3");n=/sd-rtn/.test(S)?"".concat(i[0],"/ws/?h=").concat(n,"&p=").concat(t.port):"".concat(i[1],"/ws/?h=").concat(n,"&p=").concat(t.port),f.push(n)}else l.default.error("["+y.clientId+"] Invalid address format ",t)}),!f.length)return l.default.error("["+y.clientId+"] Empty Address response",o),A("EMPTY_ADDRESS_RESPONSE"),R("EMPTY_ADDRESS_RESPONSE");r.ticket=r.cert;var p={gateway_addr:f,uid:r.uid,cid:r.cid,vid:r.detail&&r.detail[8],res:r,detail:o.detail};A(null,p),R(null,{gatewayServers:p,turnServers:d})}catch(g){return l.default.error("[".concat(y.clientId,"] requestProxyServer failed with unexpected body "),g),C("UNEXPECTED_ERROR"),R("UNEXPECTED_ERROR")}},function(t,n){"timeout"===t.type?(C("REQUEST_PROXY_SERVER_TIME_OUT"),R("REQUEST_PROXY_SERVER_TIME_OUT")):(C("REQUEST_PROXY_SERVER_FAILED"),R("REQUEST_PROXY_SERVER_FAILED"))})},v=function(){for(var t=h*g,n=t;n<Math.min(o.length,t+g);n++)m(o[n])};v()},S=i(13),y=i(29),R=i.n(y),T=i(30),I={},A={},C=function(t){return I[t]},b=function(t,n){A[t]=n},N=function(t,n,i,r,o,a){var s=(new Date).getTime(),c=n,d="";n.multiIP&&n.multiIP.gateway_ip&&(d={vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]});var g=Object(u.getParameter)("AREA_SETTING").reduce(function(t,n,i){var r=Object($.getAreaCodeByArea)(n);return r?0===i?r:"".concat(t,",").concat(r):t},""),h={appid:n.token,opid:133,client_ts:+new Date,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:{5:d?JSON.stringify(d):void 0,6:n.stringUid,11:g},key:n.token,service_ids:[11],uid:n.uid||0}}]};Object(f.postFormData)(t,h,function(o){try{var d=JSON.parse(o),f=(d=d.response_body[0].buffer).code}catch(g){var h="requestChooseServer failed with unexpected body "+o;return l.default.error("["+c.clientId+"]",h),r(h,void 0,void 0,a)}if(f)return E=RegExp(/10102\d{2}$/).test(f)?"NO_SERVICE_AVAILABLE":_.APErrorCode[d.code]||f,p.report.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:t,serverList:null,ec:E,chooseServerIp:d&&d.detail&&d.detail[502]}),r("Get server node failed ["+E+"]",t,E,a);var m=[],v=Object(u.getParameter)("GATEWAY_DOMAINS"),$=0;if(t.indexOf(v[1])>-1&&($=1),d.edges_services.forEach(function(t){var n;t.ip&&t.port?(t.ip.match(/^[\.\:\d]+$/)?n="".concat(t.ip.replace(/[^\d]/g,"-"),".").concat(v[$++%v.length],":").concat(t.port):(l.default.info("["+c.clientId+"] "+"Cannot recognized as IP address ".concat(t.ip,". Used As Host instead")),n="".concat(t.ip,":").concat(t.port)),m.push(n)):l.default.error("["+c.clientId+"] Invalid address format ",t)}),!m.length){l.default.error("["+c.clientId+"] Empty Address response",d);var E="EMPTY_ADDRESS_RESPONSE";return p.report.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:t,serverList:null,ec:E,chooseServerIp:d&&d.detail&&d.detail[502]}),r("Get server node failed ["+E+"]",t,E,a)}return d.ticket=d.cert,i({gateway_addr:m,uid:d.uid,cid:d.cid,vid:d.detail&&d.detail[8],res:d,uni_lbs_ip:d.detail},t)},function(t,i){"timeout"===t.type?(p.report.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:i,serverList:null,ec:"timeout"}),r("Connect choose server timeout",i,void 0,a)):(p.report.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:i,serverList:null,ec:t.httpErrorCode||"server_wrong"}),r("Connect choose server error",i,void 0,a))})},O=function(t,n,i){var r=!1,o=null,a=1,s=1,c=t.clientId,d=function n(s,d){if(!r){var f,g,h,m,v,E,y,R,T,C,b,O,w,L,k,D,P,M,x,U,V=[];f=t,g=function(n){r=!0,V=n,clearTimeout(o),A[c]!==S.a.DISCONNECTED&&A[c]!==S.a.DISCONNECTING?d&&d(V,null):l.default.debug("[".concat(t.clientId,"] Request gateway list success when connection state is ").concat(A[c]))},h=function(r){if(r)return l.default.info("["+t.clientId+"] Join failed: "+r),void(i&&i(r));if(A[c]===S.a.DISCONNECTED||A[c]===S.a.DISCONNECTING)return l.default.debug("[".concat(t.clientId,"] Request gateway list falied when connection state is ").concat(A[c])),void(i&&i("OPERATION_ABORT"));l.default.debug("["+t.clientId+"] Request gateway list will be restart in "+a+"s"),o=setTimeout(function(){n(s,d)},1e3*a),I[c]=o;var f=Object(u.getParameter)("AP_BACKOFF_MAX_TIME");a=a>=f?f:2*a},v=(new Date).getTime(),E=!1,y=0,R=0,C=(T=Object(u.getParameter)("WEBCS_DOMAIN")).length,O=(b=Object(u.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")).length,w=Object(u.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),L=0,k=0,D=function(t,n){var i;try{i=t.res.detail[8]}catch(r){l.default.debug("["+f.clientId+"] get vid failed",r)}if(E)p.report.joinChooseServer(f.sid,{lts:v,succ:!0,csAddr:n,serverList:t.gateway_addr,cid:t.cid+"",uid:t.uid+"",ec:null,vid:i,chooseServerIp:t.res&&t.res.detail&&t.res.detail[502]},!1);else{if(clearTimeout(U),E=!0,f.proxyServer)for(var o=t.gateway_addr,a=0;a<o.length;a++){var s=o[a].split(":");t.gateway_addr[a]=f.proxyServer+"/ws/?h="+s[0]+"&p="+s[1]}g(t),p.report.joinChooseServer(f.sid,{lts:v,succ:!0,csAddr:n,serverList:t.gateway_addr,cid:t.cid+"",uid:t.uid+"",ec:null,vid:i,chooseServerIp:t.res&&t.res.detail&&t.res.detail[502]},!0)}},P=function(t,n,i,r){"domain"===r&&y++,"backup"===r&&R++,l.default.error("["+f.clientId+"]",t,n,i),i&&-1===_.JOIN_CS_RETRY_LIST.indexOf(i)&&(m=i),y===C&&R===O&&h(m),"domain"===r&&!(y%w)&&y<C&&(L++,M()),"backup"===r&&!(R%w)&&R<O&&(k++,x())},(M=function t(){for(var n,i=L*w,r=i;r<Math.min(C,i+w);++r)if("string"==typeof T[r]){var o=T[r];n=f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(o+"/api/v2/transpond/webrtc?v=2"):"https://".concat(o,"/api/v2/transpond/webrtc?v=2");var a=Object($.getAreaCodeByWebCS)(o);l.default.debug("["+f.clientId+"] "+"Connect to choose_server: ".concat(n,", ").concat(a)),N(n,f,D,P,0,"domain")}else y++,l.default.error("["+f.clientId+"] Invalid Host",T[r]),r===i+w-1&&r<C-1-1&&(L++,t())})(),U=setTimeout(x=function t(){if(!E)for(var n,i=k*w,r=i;r<Math.min(O,i+w);r++)if("string"==typeof b[r]){var o=b[r];n=f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(o+"/api/v2/transpond/webrtc?v=2"):"https://".concat(o,"/api/v2/transpond/webrtc?v=2");var a=Object($.getAreaCodeByWebCS)(o);l.default.debug("["+f.clientId+"] "+"Connect to backup_choose_server: ".concat(n,", ").concat(a)),N(n,f,D,P,0,"backup")}else R++,l.default.error("["+f.clientId+"] Invalid Host",b[r]),r===i+w-1&&r<b-1-1&&(L++,t())},1e3)}},f=function i(){var r,a;r=t,a=function(r,a){if(r){l.default.debug("["+t.clientId+"]",r),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+s+"s"),o=setTimeout(function(){i()},1e3*s),I[c]=o;var f=Object(u.getParameter)("AP_BACKOFF_MAX_TIME");s=s>=f?f:2*s}else{clearTimeout(o);var _=a.address;t.proxyServer=_;var g={mode:"manual",url:a.address,tcpport:a.serverResponse.tcpport||"3433",udpport:a.serverResponse.udpport||"3478",username:a.serverResponse.username||"test",credential:a.serverResponse.password||Object(u.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!0};g.tcpport+="",g.udpport+="",t.turnServers=[],t.turnServers.push(g),p.report.setProxyServer(_),l.default.setProxyServer(_),d(_,n)}},g(r,function(t,n){if(t)return a&&a(t);l.default.debug("["+r.clientId+"] getProxyServerList: ",n),m(r,n,a)})};t.useProxyServer?1==t.proxyServerType?f():2==t.proxyServerType?function i(){var r,a;r=t,a=function(r,a){if(r)return l.default.debug("["+t.clientId+"]",r),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+s+"s"),o=setTimeout(function(){i()},1e3*s),I[c]=o,void(s=s>=3600?3600:2*s);clearTimeout(o);var f=Object(u.getParameter)("PROXY_SERVER_TYPE2");t.proxyServer=f;var _={mode:"manual",url:a.address,tcpport:a.serverResponse.tcpport||"3433",udpport:a.serverResponse.udpport||"3478",username:a.serverResponse.username||"test",credential:a.serverResponse.password||"111111",forceturn:!0};_.tcpport+="",_.udpport+="",t.turnServers=[],t.turnServers.push(_),p.report.setProxyServer(f),l.default.setProxyServer(f),d(f,n)},g(r,function(t,n){return t?a&&a(t):(l.default.debug("["+r.clientId+"] getProxyServerList: ",n),a&&a(null,{address:n[0],serverResponse:{tcpport:"443",udpport:"3478",username:"test",password:"111111"}}))})}():3==t.proxyServerType?function r(){E("proxy3",t,function(a,d){if(a)return"RETRYABLE_ERROR"!==a?i&&i(a):(l.default.debug("["+t.clientId+"]",a),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+s+"s"),o=setTimeout(function(){r()},1e3*s),I[c]=o,void(s=s>=3600?3600:2*s));var f=d.gatewayServers,_=d.turnServers;clearTimeout(o);var g=Object(u.getParameter)("NGINX");t.proxyServer=g,t.turnServers=[];var h=Object(T.randomString)();_.map(function(n){var i={mode:"manual",url:n.ip,tcpport:"",udpport:n.port||"3478",username:n.username||h,credential:n.password||R()(h).toString(),forceturn:!0};i.tcpport+="",i.udpport+="",t.turnServers.push(i)}),p.report.setProxyServer(g),l.default.setProxyServer(g),n(f)})}():4==t.proxyServerType?function r(){E("proxy4",t,function(a,d){if(a)return"RETRYABLE_ERROR"!==a?i&&i(a):(l.default.debug("["+t.clientId+"]",a),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+s+"s"),o=setTimeout(function(){r()},1e3*s),I[c]=o,void(s=s>=3600?3600:2*s));var f=d.gatewayServers,_=d.turnServers;clearTimeout(o);var g=Object(u.getParameter)("NGINX");t.proxyServer=g,t.turnServers=[];var h=Object(T.randomString)();_.map(function(n){var i={mode:"manual",url:n.ip,tcpport:n.port||"443",udpport:"",username:n.username||h,credential:n.password||R()(h).toString(),forceturn:!1};i.tcpport+="",i.udpport+="",t.turnServers.push(i)}),p.report.setProxyServer(g),l.default.setProxyServer(g),n(f)})}():5==t.proxyServerType?function r(){E("proxy5",t,function(a,d){if(a)return"RETRYABLE_ERROR"!==a?i&&i(a):(l.default.debug("["+t.clientId+"]",a),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+s+"s"),o=setTimeout(function(){r()},1e3*s),I[c]=o,void(s=s>=3600?3600:2*s));var f=d.gatewayServers,_=d.turnServers;clearTimeout(o);var g=Object(u.getParameter)("NGINX");t.proxyServer=g,t.turnServers=[];var h=Object(T.randomString)();_.map(function(n){var i={mode:"manual",url:n.ip,tcpport:n.port||"443",udpport:"",username:n.username||h,credential:n.password||R()(h).toString(),forceturn:!1,useTurns:!0};i.tcpport+="",i.udpport+="",t.turnServers.push(i)}),p.report.setProxyServer(g),l.default.setProxyServer(g),n(f)},!0)}():f():d(null,n)},w=function(t,n,i,r,o){var a=Date.now();r=r||n.stringUid;var s={sid:n.sid,opid:10,appid:n.appId,string_uid:r};return new Promise(function(o,c){Object(f.post)(t+"".concat(-1===t.indexOf("?")?"?":"&","action=stringuid"),s,function(d){try{var u=JSON.parse(d),f=u.code}catch(g){var h="requestUserAccount failed with unexpected body "+d;return l.default.error("["+n.clientId+"]",h),c({retryable:!0,info:h,url:t,error:"UNEXPECTED_ERROR"}),i&&i.dispatchEvent({type:"error",reason:"USER_ACCOUNT_BODY_NOT_JSON"}),void p.report.reqUserAccount(s.sid,{lts:a,success:!1,serverAddress:t,stringUid:r,uid:null,extend:d,errorCode:"USER_ACCOUNT_BODY_NOT_JSON"})}if(f){var m=!1;return"INTERNAL_SERVER_ERROR"===($=_.StringUidErrorCode[u.code%1e4]||"REQ_ACCOUNT_ERR_".concat(f))&&(m=!0),i&&i.dispatchEvent({type:"error",reason:$}),p.report.reqUserAccount(s.sid,{lts:a,success:!1,serverAddress:t,stringUid:r,uid:null,errorCode:$,extend:s}),c({retryable:m,info:h="Get String Uid Failed ["+$+"]",url:t,error:$})}var v=u.uid;if(!(v>0&&v<4294967296)){l.default.error("["+n.clientId+"] "+"Invalid Uint Uid ".concat(r," => ").concat(v),u);var $="INVALID_UINT_UID_".concat(v);return i&&i.dispatchEvent({type:"error",reason:$}),p.report.reqUserAccount(s.sid,{lts:a,success:!1,serverAddress:t,stringUid:r,uid:null,errorCode:$,extend:s}),c({retryable:!0,error:$,info:"Get String Uid failed ["+$+"]",url:t})}o({uid:v,url:t}),p.report.reqUserAccount(s.sid,{lts:a,success:!0,serverAddress:t,stringUid:r,uid:v,errorCode:null,extend:s})},function(t,n){if("timeout"===t.type){var o="USER_ACCOUNT_TIMEOUT";i&&i.dispatchEvent({type:"error",reason:o}),p.report.reqUserAccount(s.sid,{lts:a,success:!1,serverAddress:n,stringUid:r,uid:null,errorCode:o,extend:s}),c({retryable:!0,info:o,url:n,error:o})}else{var d="USER_ACCOUNT_SERVER_WRONG_".concat(t.type);i&&i.dispatchEvent({type:"error",reason:d}),p.report.reqUserAccount(s.sid,{lts:a,success:!1,serverAddress:n,stringUid:r,uid:null,errorCode:d,extend:s}),c({retryable:!0,info:d,url:n,error:d})}},{"X-Packet-Service-Type":0,"X-Packet-URI":72})})},L=function(t,n,i){Date.now();var r,a,c=Object(u.getParameter)("ACCOUNT_REGISTER"),f=!1,p=Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT"),_=null,g=null,h=new Promise((r=d()(s.a.mark(function r(d,h){var m,v,$;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:_=d,g=h,a=0;case 3:if(!(a<Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_COUNT_MAX"))){r.next=33;break}if(!f){r.next=6;break}return r.abrupt("return");case 6:return m=c[a%c.length],v=t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1"),r.prev=8,r.delegateYield(s.a.mark(function r(){var o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.proxyServer,r.next=3,w(v,t,n,i);case 3:if(o=r.sent,!f){r.next=6;break}return r.abrupt("return",{v:void 0});case 6:f=!0,setTimeout(function(){l.default.debug("Get UserAccount Successfully",o),_(o)},0);case 8:case"end":return r.stop()}},r)})(),"t0",10);case 10:if($=r.t0,"object"!==o()($)){r.next=13;break}return r.abrupt("return",$.v);case 13:case 25:r.next=30;break;case 15:if(r.prev=15,r.t1=r.catch(8),!f){r.next=19;break}return r.abrupt("return");case 19:if(!r.t1.retryable){r.next=27;break}return(p=Math.ceil(p*Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_RATIO")))>Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")&&(p=Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")),l.default.error("".concat(r.t1.info," ").concat(r.t1.url," Will Fetch User Account in ").concat(p/1e3," seconds")),r.next=25,new Promise(function(t){setTimeout(t,p)});case 27:l.default.error("Get UserAccount Error: ".concat(r.t1.info," ").concat(r.t1.url),r.t1.error),f=!0,g(r.t1.error);case 30:a++,r.next=3;break;case 33:case"end":return r.stop()}},r,null,[[8,15]])})),function(t,n){return r.apply(this,arguments)}));return h.cancel=function(){f||(f=!0,g({info:"Request Cancelled",retryable:!1}))},h.isFinished=function(){return f},h}},function(t,n,i){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<i;n++)for(var a=arguments[n],s=0,c=a.length;s<c;s++,o++)r[o]=a[s];return r},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var a,s,c,d,u=o(i(0));(c=a||(a={})).CHINA="CHINA",c.ASIA="ASIA",c.NORTH_AMERICA="NORTH_AMERICA",c.EUROPE="EUROPE",c.JAPAN="JAPAN",c.INDIA="INDIA",c.OCEANIA="OCEANIA",c.SOUTH_AMERICA="SOUTH_AMERICA",c.AFRICA="AFRICA",c.OVERSEA="OVERSEA",c.GLOBAL="GLOBAL",n.AREAS=a,(d=s||(s={})).CHINA="CN",d.ASIA="AS",d.NORTH_AMERICA="NA",d.EUROPE="EU",d.JAPAN="JP",d.INDIA="IN",d.OCEANIA="OC",d.SOUTH_AMERICA="SA",d.AFRICA="AF",d.OVERSEA="OVERSEA",d.GLOBAL="GLOBAL";var l={ASIA:{CODE:s.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:s.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:s.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:s.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:s.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:s.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],NGINX:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:s.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],NGINX:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:s.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:s.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:s.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};n.AREA_DOMAIN_MAP=l;var f={GLOBAL:{ASIA:[a.CHINA,a.JAPAN,a.INDIA],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},p=Object.keys(f[a.GLOBAL]),_=[a.CHINA,a.NORTH_AMERICA,a.EUROPE,a.ASIA,a.JAPAN,a.INDIA,a.OCEANIA,a.SOUTH_AMERICA,a.AFRICA],g=function(t,n){var i,o=[];if("string"==typeof t&&(t=[t]),n&&!t.includes(a.GLOBAL)&&(o=t),n||(o=t),n&&t.includes(a.GLOBAL)){var s,c,d=[a.GLOBAL,a.OVERSEA],u=Object.keys(l);if(n===a.GLOBAL)throw Error("Can not set excludedArea to 'GLOBAL'");if(n===a.CHINA)o=[a.OVERSEA];else if(i=n,p.includes(i)){var g,h=(void 0===(g=n)&&(g=""),f[a.GLOBAL][g]||[]),m=r(d,[n],h);o=u.filter(function(t){return!m.includes(t)})}else if(v=n,$=!1,p.forEach(function(t){f.GLOBAL[t].includes(v)&&($=!0)}),$){var v,$,E,S,y=(void 0===(E=n)&&(E=""),S="",p.forEach(function(t){f.GLOBAL[t].includes(E)&&(S=t)}),S),R=r(d,[y,n]);o=u.filter(function(t){return!R.includes(t)})}else o=t;o=(s=o,c=[],_.forEach(function(t){s.includes(t)&&c.push(t)}),c.concat(s.filter(function(t){return!_.includes(t)})))}return o};n.getAreaCodeByConfig=function(t){var n=t.areaCode,i=t.excludedArea;return i?g(n,i):n},l.CHINA={CODE:s.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]},n.getAreaCodeByWebCS=function(t){for(var n=Object.keys(l),i=0;i<n.length;i++){var r=l[n[i]];if(r.WEBCS_DOMAIN.includes(t)||r.WEBCS_DOMAIN_BACKUP_LIST.includes(t))return r.CODE===s.OVERSEA?s.ASIA+","+s.EUROPE+","+s.AFRICA+","+s.NORTH_AMERICA+","+s.SOUTH_AMERICA+","+s.OCEANIA:r.CODE}},n.getAreaCodeByArea=function(t){return t===a.OVERSEA?s.ASIA+","+s.EUROPE+","+s.AFRICA+","+s.NORTH_AMERICA+","+s.SOUTH_AMERICA+","+s.OCEANIA:s[t]},n.getAreaDomainConfig=function(t){var n={WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],NGINX:[]};return t.map(function(t){var i=l[t];if(i){var r=Object.keys(i);r?r.map(function(t){"CODE"!==t&&(n[t]=n[t].concat(i[t]))}):u.default.info(t+" is not exist")}else u.default.info(t+" is not exist")}),n}},function(t,n,i){"use strict";i.d(n,"a",function(){return b}),i.d(n,"b",function(){return N});var r=i(7),o=i.n(r),a=i(4),s=i(8),c=function(t){var n=Object(s.b)(t);return n.url=".",n},d=i(0),u=i(15),l=i(5),f=i(2),p=i(1),_=0,g=function(t){var n=c({});n.id=t.id,n.playerId=_++,n.destroyed=!1,n.fit=t.options&&t.options.fit,"contain"!==n.fit&&"cover"!==n.fit&&(n.fit=null),n.url=t.url,n.stream=t.stream.stream,n.peerVideoReady=!1,n.isFreeze=!1,n.freezeTimeCounterList=[],n.freezeCount=0,n.lastFreezeCount=0,n.lastTimeupdateTime=0,n.elementID=t.elementID,n.setAudioOutput=function(t,i,r){var o=n.video||n.audio;return o?o.setSinkId?void o.setSinkId(t).then(function(){return d.default.debug("["+n.id+"] "+"video ".concat(n.id," setAudioOutput ").concat(t," SUCCESS")),o==n.video&&n.audio?n.audio.setSinkId(t):Promise.resolve()}).then(function(){return d.default.debug("["+n.id+"] "+"audio ".concat(n.id," setAudioOutput ").concat(t," SUCCESS")),i&&i()}).catch(function(t){return d.default.error("["+n.id+"] VideoPlayer.setAudioOutput",t),r&&r(t)}):(d.default.error("["+n.id+"] ",l.default.WEB_API_NOT_SUPPORTED),r&&r(l.default.WEB_API_NOT_SUPPORTED)):(d.default.error("["+n.id+"] ",l.default.PLAYER_NOT_FOUND),r&&r(l.default.PLAYER_NOT_FOUND))},n.destroy=function(){d.default.debug("[".concat(n.id,"] destroy ").concat(t.stream.local?"local":"remote"," Player ").concat(n.id)),Object(u.setSrcObject)(n.video,null),Object(u.setSrcObject)(n.audio,null),n.video.load(),n.audio.load(),n.video.pause(),n.video.remove(),n.audio.remove(),n.freezeCheckInterval&&clearInterval(n.freezeCheckInterval),n.destroyed=!0,delete n.resizer,document.getElementById(n.div.id)&&n.parentNode.contains(n.div)&&n.div.remove()&&n.parentNode.removeChild(n.div),["video","audio"].forEach(function(i){n[i];var r=s[i];clearTimeout(r.playDeferTimeout),r.formerMediaState=null;var o={playerId:n.playerId,stateId:r.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"stop",updatedAt:Date.now()};s[i]=o;var a={type:"player-status-change",playerId:n.playerId,mediaType:i,status:o.status,reason:o.reason,isErrorState:!1,streamId:n.id};d.default.debug("[".concat(n.id,"] Media Player Status Change Triggered by destroy()"),a),t.stream.dispatchEvent(a),p.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:a,tag:"tracer"})()})},n.div=document.createElement("div"),n.div.setAttribute("id","player_"+n.id),t.stream.video?n.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):n.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),n.video=document.createElement("video"),n.video.setAttribute("id","video"+n.id),t.stream.local&&!t.stream.screen?t.stream.mirror?n.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(n.fit||"cover",";")):n.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(n.fit||"cover",";")):t.stream.video?n.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(n.fit||"cover",";")):t.stream.screen?n.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(n.fit||"contain")):n.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(n.fit||"cover"));var i={autoplay:!0,muted:!!t.stream.local||!(!a.isSafari()&&"iOS"!==a.getBrowserOS())&&"video_element_muted",playsinline:!0,controls:!1,volume:null},r=o()({},i,t.options);!0!==r.muted||r.volume||(r.volume=0),n.video.setAttribute("autoplay",""),n.video.setAttribute("muted",""),n.video.muted=!0,n.video.autoplay=!0,r.playsinline&&n.video.setAttribute("playsinline",""),r.controls&&n.video.setAttribute("controls",""),r.contains&&(n.video.controls=!0),Number.isFinite(r.volume)&&(n.video.volume=r.volume),n.audio=document.createElement("audio"),n.audio.setAttribute("id","audio"+n.id),!0===r.muted&&n.audio.setAttribute("muted",""),!0===r.muted&&(n.audio.muted=!0),r.playsinline&&n.audio.setAttribute("playsinline",""),Number.isFinite(r.volume)&&(n.audio.volume=r.volume),void 0!==n.elementID?(document.getElementById(n.elementID).appendChild(n.div),n.container=document.getElementById(n.elementID)):(document.body.appendChild(n.div),n.container=document.body),n.parentNode=n.div.parentNode;var s={video:{playerId:n.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()},audio:{playerId:n.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()}};n.mediaElemExists=function(t){for(var n=t,i=0;i<Object(f.getParameter)("MEDIA_ELEMENT_EXISTS_DEPTH")&&n;i++)n=n.parentNode;return!!n};var g=function(t){return n.mediaElemExists(t)?t.paused?"paused":"play":"aborted"},h=function(t,n,i){var r=g(t),o=!0;return"paused"===r?("audio"===n&&!0===i.muted&&(o=!1),i.autoplay||(o=!1)):"play"===r?"video"===n?o=!1:!0===i.muted?t.muted&&(o=!1):t.muted||(o=!1):"aborted"===r&&(o=!1),o},m=function(i){var o,a=this;if(a===n.video?o="video":a===n.audio&&(o="audio"),o){if(i.type||d.default.error("[".concat(n.id,"] Unexpected evt"),i),"video"===o&&a.muted&&a.paused)return d.default.debug("[".concat(n.id,"] auto resume video element")),void a.play();var c=g(a);clearTimeout(s[o].playDeferTimeout),s[o].playDeferTimeout=setTimeout(function(){s[o].playDeferTimeout=null;var u=s[o],l=g(a);if(c===l){var f={playerId:n.playerId,stateId:u.stateId+1,playDeferTimeout:null,error:h(a,o,r),status:g(a),reason:i.type,updatedAt:Date.now()};if(u.status!==f.status){s[o]=f;var _={type:"player-status-change",playerId:n.playerId,mediaType:o,status:f.status,reason:f.reason,isErrorState:f.error,streamId:n.id};d.default.debug("[".concat(n.id,"] Media Player Status Change"),_),t.stream.dispatchEvent(_),p.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:_,tag:"tracer"})()}}else d.default.debug("[".concat(n.id,"] Status Change after event Triggered.")+"Stream ".concat(n.id," PlayerId ").concat(n.playerId," mediaType ").concat(o," Status ").concat(c,"=>").concat(l))},Object(f.getParameter)("PLAYER_STATE_DEFER"))}else d.default.error("[".concat(n.id,"] Unknown media element"),a)};n.video.addEventListener("playing",function(t){!function t(){n.video.videoWidth*n.video.videoHeight>4?d.default.debug("["+n.id+"] video dimensions:",n.video.videoWidth,n.video.videoHeight):setTimeout(t,50)}()});var v=0,$=0,E=0;n.freezeCheckInterval=setInterval(function(){Date.now()-n.lastTimeupdateTime>500&&n.peerVideoReady?(n.isFreeze=!0,n.freezeCount+=1):n.isFreeze=!1},500),n.video.addEventListener("playing",m),n.video.addEventListener("canplay",m),n.video.addEventListener("abort",m),n.video.addEventListener("onerror",m),n.video.addEventListener("suspend",m),n.video.addEventListener("stalled",m),n.video.addEventListener("pause",m),n.audio.addEventListener("playing",m),n.audio.addEventListener("canplay",m),n.audio.addEventListener("abort",m),n.audio.addEventListener("onerror",m),n.audio.addEventListener("suspend",m),n.audio.addEventListener("stalled",m),n.audio.addEventListener("pause",m);var S=n.audio,y="audio";if(t.stream.hasVideo()||t.stream.hasScreen())n.div.appendChild(n.video),n.div.appendChild(n.audio),a.isEdge()?n.video.srcObject=t.stream.stream:(Object(u.attachMediaStream)(n.video,t.stream.stream),Object(u.attachMediaStream)(n.audio,t.stream.stream)),n.video.addEventListener("timeupdate",function(){var t=Date.now();if((v+=1)<10)n.lastTimeupdateTime=t;else for(t-n.lastTimeupdateTime>500&&(n.peerVideoReady?$+=t-n.lastTimeupdateTime:n.peerVideoReady=!0),E+=t-n.lastTimeupdateTime,n.lastTimeupdateTime=t;E>=6e3;)E-=6e3,n.freezeTimeCounterList.push(Math.min(6e3,$)),$-=6e3,$=Math.max($,0)});else{!1!==r.muted&&"video_element_muted"!==r.muted||(n.video.removeAttribute("muted"),n.video.muted=!1),n.video.removeAttribute("autoplay"),n.video.autoplay=!1,n.div.appendChild(n.video),S=n.video,y="video";var R=s.audio,T={playerId:n.playerId,stateId:R.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"audioonly",updatedAt:Date.now()};s.audio=T;var I={type:"player-status-change",playerId:n.playerId,mediaType:"audio",status:T.status,reason:T.reason,isErrorState:T.error,streamId:n.id};if(d.default.debug("[".concat(n.id,"] Media Player Status Change"),I),Promise.resolve().then(function(){return t.stream.dispatchEvent(I)}),p.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:I,tag:"tracer"})(),window.MediaStream&&(a.isSafari()||"iOS"===a.getBrowserOS())){var A=new MediaStream(t.stream.stream.getAudioTracks());Object(u.setSrcObject)(n.video,A)}else Object(u.setSrcObject)(n.video,t.stream.stream)}if(r.autoplay&&S){var C=S.play();C&&C.catch&&C.catch(function(i){if(!n.destroyed&&S){var o=s[y],a={playerId:n.playerId,stateId:o.stateId+1,playDeferTimeout:null,error:h(S,y,r),status:g(S),reason:"error",updatedAt:Date.now()};if(o.status!==a.status){d.default.debug("[".concat(n.id,"] Player ").concat(n.playerId," Status Changed Detected by promise error: ").concat(o.status,"=>").concat(a.status),i),s[y]=a;var c={type:"player-status-change",playerId:n.playerId,mediaType:y,status:a.status,reason:a.reason,isErrorState:a.error,streamId:n.id};d.default.debug("[".concat(n.id,"] Media Player Status Change"),c),t.stream.dispatchEvent(c),p.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:c,tag:"tracer"})()}}})}return n.setAudioVolume=function(t){var i=parseInt(t)/100;isFinite(i)&&(i<0?i=0:i>1&&(i=1),n.video&&(n.video.volume=i),n.audio&&(n.audio.volume=i))},n},h=i(23),m=i(10),v=i(6),$=i(19),E=i(3),S=i(25),y=i(16),R=i(11),T=i.n(R),I=function(t){Object(E.checkValidString)(t,"profileName"),-1===(t=t.toLowerCase()).indexOf("_")&&(t+="_1"),Object(E.checkValidEnum)(t,"profileName",Object.keys(f.SUPPORT_RESOLUTION_LIST));var n=f.SUPPORT_RESOLUTION_LIST[t];n||(t=Object(f.getParameter)("DEFAULT_PROFILE"),n=f.SUPPORT_RESOLUTION_LIST[t]);var i={profileName:t,video:{width:n[0],height:n[1]},attributes:{resolution:"".concat(n[0],"x").concat(n[1]),minFrameRate:n[2],maxFrameRate:n[3],minVideoBW:n[4],maxVideoBW:n[5]}};return n[2]&&(i.video.frameRate=n[2]),n[6]&&n[7]&&(i.screen={width:n[0],height:n[1],frameRate:{min:n[6],max:n[7]}}),i},A=function(t){return Object.keys(f.SUPPORT_RESOLUTION_LIST).filter(function(n){var i=f.SUPPORT_RESOLUTION_LIST[n],r=["width","height","frameRate"];for(var o in r){var a=r[o];if(t[a]&&i[o]&&("number"==typeof t[a].max&&t[a].max<i[o]||"number"==typeof t[a].min&&t[a].min>i[o]))return!1}return!0}).reverse()},C=function(t){var n=f.AUDIO_PROFILE_SETTINGS[t]||f.AUDIO_PROFILE_SETTINGS.default;return{highQuality:n[0],stereo:n[1],speech:n[2],lowQuality:n[3]}},b=function(t){var n,i,r,c=Object(s.b)();if(c.params=o()({},t),c.stream=t.stream,c.url=t.url,c.onClose=void 0,c.local=!1,c.videoSource=t.videoSource,c.audioSource=t.audioSource,t.video=!(!t.videoSource&&!t.video),c.video=t.video,t.audio=!(!t.audioSource&&!t.audio),c.audio=t.audio,c.screen=!!t.screen,c.screenAudio=!!t.screenAudio,c.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},c.videoSize=t.videoSize,c.player=void 0,c.audioLevelHelper=null,t.attributes=t.attributes||{},c.attributes=t.attributes,c.microphoneId=t.microphoneId,c.cameraId=t.cameraId,c.facingMode=t.facingMode,c.inSwitchDevice=!1,c.userMuteVideo=!1,c.userMuteAudio=!1,c.peerMuteVideo=!1,c.peerMuteAudio=!1,c.lowStream=null,c.videoWidth=0,c.videoHeight=0,c.streamId=t.streamID,c.userId=null,c.uintId=t.uintUID||null,c.mirror=!1!==t.mirror,c.DTX=t.audioProcessing&&t.audioProcessing.DTX,c.audioProcessing=t.audioProcessing,c.optimizationMode=t.optimizationMode,c.highQuality=!1,c.stereo=!1,c.speech=!1,c.screen||delete c.screen,!(void 0===c.videoSize||c.videoSize instanceof Array&&4===c.videoSize.length))throw Error("Invalid Video Size");function u(){var t={};c.getVideoTrack()===this?(d.default.debug("Video Track Ended"),t.type="videoTrackEnded",t.track=this):c.getAudioTrack()===this?(d.default.debug("Audio Track Ended"),t.type="audioTrackEnded",t.track=this):d.default.debug("Detached Track ended",this.kind,this.label,this),t.type&&c.dispatchEvent(t)}return c.videoSize=[640,480,640,480],void 0!==t.local&&!0!==t.local||(c.local=!0),c.initialized=!c.local,c._streamInitID=null,(n=c).audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},n._initSoundIfNotExists=function(t,i){n.audioMixing.sounds[t]||(n.audioMixing.sounds[t]={soundId:t,state:"IDLE",muted:n.userMuteAudio,filePath:i,volume:n.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},n._initSoundIfNotExists(-1),n.loadAudioBuffer=function(t,i,r){var o=p.report.reportApiInvoke(n.sid,{callback:r,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});Object(E.checkValidString)(i,"url",1,1024,!1),Object(E.checkValidString)(t,"id",1,1024,!1);var a=function(t){d.default.error("[".concat(n.streamId,"] loadAudioBuffer Failed: ")+t),o(l.default.LOAD_AUDIO_FAILED)},s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType="arraybuffer",s.onload=function(){if(s.status>400)a("".concat(s.status," ").concat(s.statusText));else{var i=s.response;n.audioMixing.audioContextInited||n._initAudioContext(),n.audioMixing.ctx.decodeAudioData(i,function(i){n.audioMixing.buffer[t]=i,o(null)},function(t){d.default.error("[".concat(n.streamId,"] decodeAudioData Failed: "),t),o(t)})}},s.onerror=function(){return a("load error")},s.ontimeout=function(){return a("timeout")},s.send()},n.createAudioBufferSource=function(t){var i=p.report.reportApiInvoke(n.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(n.audioMixing.buffer[t.id]){var r=n.audioMixing.buffer[t.id],o=n.audioMixing.ctx.createBufferSource();o.buffer=r;var s=n.audioMixing.ctx.createGain();if(o.connect(s),s.connect(n.audioMixing.mediaStreamDest),o.gainNode=s,t.loop)o.loop=!0,o.start(0,t.playTime/1e3);else if(t.cycle>1){if(Object(a.isChrome)()){o.loop=!0;var c=t.cycle*r.duration*1e3-(t.playTime||0);o.start(0,t.playTime/1e3,c/1e3)}else d.default.warning("[".concat(n.streamId,"] Cycle Param is ignored by current browser")),o.start(0,t.playTime/1e3)}else o.start(0,t.playTime/1e3);var u=n.audioMixing.sounds[t.soundId];return u.source=o,n._flushAudioMixingMuteStatus(),o.addEventListener("ended",function(){o===u.source&&n.dispatchEvent({type:"audioSourceEnded",soundId:t.soundId,source:o,sound:u})}),i(),o}var l="AUDIOBUFFER_NOT_FOUND";return d.default.error("[".concat(n.streamId,"] "),l,t.id),i(!1),!1},n.on("audioSourceEnded",function(t){var i=t.source,r=t.sound;r&&r.state===n.audioMixing.states.BUSY&&!r.pauseAt&&(r.state=n.audioMixing.states.IDLE,r.startAt=null,r.startOffset=null,r.resumeAt=null,r.resumeOffset=null,i.gainNode&&i.gainNode.disconnect&&i.gainNode.disconnect(),i.buffer=null,n.audioMixing.mediaStreamSource.connect(n.audioMixing.mediaStreamDest))}),n.clearAudioBufferSource=function(){n.audioBufferSource.forEach(function(t){t.stop()})},n._isSoundExists=function(t){return!!n.audioMixing.sounds[t.soundId]||(d.default.error("SoundId not exists. #".concat(t.soundId)),!1)},n._initAudioContext=function(){if(n.audioMixing.audioContextInited)throw Error("Failed to init audio context. Already inited");if(!n.stream)throw Error("Failed to init audio context. Local Stream not initialized");n.audioMixing.ctx=Object(S.a)(),n.audioMixing.mediaStreamSource=n.audioMixing.ctx.createMediaStreamSource(n.stream),n.audioMixing.mediaStreamDest=n.audioMixing.ctx.createMediaStreamDestination(),n.audioMixing.mediaStreamSource.connect(n.audioMixing.mediaStreamDest);var t=n.stream.getVideoTracks()[0];if(t&&n.audioMixing.mediaStreamDest.stream.addTrack(t),n._originStream=n.stream,n._isAudioMuted()?(n._unmuteAudio(),n.stream=n.audioMixing.mediaStreamDest.stream,n._muteAudio()):n.stream=n.audioMixing.mediaStreamDest.stream,n.audioLevelHelper=null,n.pc&&n.pc.peerConnection&&n.pc.peerConnection){var i=(n.pc.peerConnection&&n.pc.peerConnection.getSenders()).find(function(t){return t&&t.track&&"audio"==t.track.kind}),r=n.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];i&&i.replaceTrack&&r&&i.replaceTrack(r)}n.audioMixing.audioContextInited=!0},n._cleanupAudioMixing=function(){if(n.audioMixing.audioContextInited){for(var t in n.audioMixing.sounds){var i=n.audioMixing.sounds[t];i.state!==n.audioMixing.states.BUSY&&i.state!==n.audioMixing.states.PAUSED||n._stopOneEffect({soundId:t})}n.audioLevelHelper=null,n.audioMixing.audioContextInited=!1}},n._reloadInEarMonitoringMode=function(t){if(t){if(!n.audioMixing.inEarMonitoringModes[t])return d.default.error("[".concat(n.streamId,"] Invalid InEarMonitoringMode ").concat(t));n.audioMixing.inEarMonitoring=t}switch(n.audioMixing.audioContextInited||n._initAudioContext(),n.audioMixing.inEarMonitoring){case n.audioMixing.inEarMonitoringModes.FILE:n.audioMixing.mediaStreamSource.connectedToDestination&&(n.audioMixing.mediaStreamSource.disconnect(n.audioMixing.ctx.destination),n.audioMixing.mediaStreamSource.connectedToDestination=!1);case n.audioMixing.inEarMonitoringModes.ALL:for(var i in n.audioMixing.sounds){var r=n.audioMixing.sounds[i];r&&r.source&&!r.source.connectedToDestination&&(r.source.gainNode.connect(n.audioMixing.ctx.destination),r.source.connectedToDestination=!0)}}switch(n.audioMixing.inEarMonitoring){case n.audioMixing.inEarMonitoringModes.MICROPHONE:n.audioMixing.source.forEach(function(t){t.connectedToDestination&&(t.gainNode.disconnect(n.audioMixing.ctx.destination),t.connectedToDestination=!1)});case n.audioMixing.inEarMonitoringModes.ALL:n.audioMixing.mediaStreamSource.connectedToDestination||(n.audioMixing.mediaStreamSource.connect(n.audioMixing.ctx.destination),n.audioMixing.mediaStreamSource.connectedToDestination=!0)}},n._startAudioMixingBufferSource=function(t){n.audioMixing.audioContextInited||n._initAudioContext();var i={soundId:t.soundId,id:t.filePath,loop:t.loop,cycle:t.cycle,playTime:t.playTime||0},r=t.replace,o=n.createAudioBufferSource(i);return o.sound=n.audioMixing.sounds[t.soundId],o?(o.addEventListener("ended",n._audioMixingFinishedListener,{once:!0}),n._reloadInEarMonitoringMode(),r&&n.audioMixing.mediaStreamSource.disconnect(n.audioMixing.mediaStreamDest),o):null},n._stopAudioMixingBufferSource=function(t){var i=n.audioMixing.sounds[t.soundId].source;return i?(i.removeEventListener("ended",n._audioMixingFinishedListener),n.audioMixing.mediaStreamSource.connect(n.audioMixing.mediaStreamDest),i.stop(),i.gainNode&&i.gainNode.disconnect&&i.gainNode.disconnect(),i.buffer=null,i):null},n._flushAudioMixingMuteStatus=function(t){for(var i in n.audioMixing.sounds){var r=n.audioMixing.sounds[i];r&&(void 0!==t&&(r.muted=!!t),r.source&&(r.muted?r.source.gainNode.gain.value=0:r.source.gainNode.gain.value=r.volume/100))}},n._handleAudioMixingInvalidStateError=function(t,i,r){var o=n.audioMixing.sounds[i.soundId],a=-1===i.soundId?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";d.default.error("[".concat(n.streamId,"] Cannot ").concat(t,": ").concat(a,", state is ").concat(o.state)),r&&r(a)},n._handleAudioMixingNoSourceError=function(t,i,r){n.audioMixing.sounds[i.soundId].state=n.audioMixing.states.IDLE;var o=-1===i.soundId?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";d.default.error("[".concat(n.streamId,"] Cannot ").concat(t,": ").concat(o)),r&&r(o)},n._getOneEffectStates=function(t){var i=n.audioMixing.sounds[t.soundId];return function(){return i?{state:i.state,startAt:i.startAt,resumeAt:i.resumeAt,pauseOffset:i.pauseOffset,pauseAt:i.pauseAt,resumeOffset:i.resumeOffset,stopAt:i.stopAt,duration:n._getOneEffectDuration(t),position:n._getOneEffectCurrentPosition(t)}:{}}},n._audioMixingFinishedListener=function(){var t=this.sound;t.state===n.audioMixing.states.IDLE&&n.audioMixing.buffer[t.options.filePath]&&!t.options.cacheResource&&(d.default.debug("Recycled buffer ".concat(t.options.filePath)),delete n.audioMixing.buffer[t.options.filePath]),-1===t.soundId&&n.dispatchEvent({type:"audioMixingFinished"})},n._playOneEffect=function(t,i){Object(E.checkValidObject)(t,"options");var r=t.soundId,o=(t.filePath,t.cacheResource);if(t.cycle,t.loop,t.playTime,t.replace,Object(a.isSafari)()&&12>Object(a.getBrowserVersion)()){var s="BROWSER_NOT_SUPPORT";return d.default.error("[".concat(n.streamId,"] Cannot _playOneEffect: "),s),i(s)}n.audioMixing.audioContextInited||n._initAudioContext(),n._initSoundIfNotExists(r);var c=n.audioMixing.sounds[r];if(c.state===n.audioMixing.states.IDLE){if(void 0!==t.cycle&&!t.cycle>0)return s="Invalid Parmeter cycle: "+t.cycle,d.default.error("[".concat(n.streamId,"] ").concat(r),s),i(s);if(Object(E.isEmpty)(o)&&(t.cacheResource=!0),c.state=n.audioMixing.states.STARTING,c.options=t,n.audioMixing.buffer[t.filePath]){var u=n._startAudioMixingBufferSource(t);if(u)return c.source=u,c.startAt=Date.now(),c.resumeAt=null,c.pauseOffset=null,c.pauseAt=null,c.resumeOffset=null,c.stopAt=null,c.startOffset=t.playTime||0,c.state=n.audioMixing.states.BUSY,n._flushAudioMixingMuteStatus(),i(null);c.state=n.audioMixing.states.IDLE;var l="CREATE_BUFFERSOURCE_FAILED";if(i)return i(l);d.default.error("[".concat(n.streamId,"] "),l)}else n.loadAudioBuffer(t.filePath,t.filePath,function(r){if(r)c.state=n.audioMixing.states.IDLE,i?i(r):d.default.error("[".concat(n.streamId,"] "),r);else{var o=n._startAudioMixingBufferSource(t);if(o)return c.source=o,c.startAt=Date.now(),c.resumeAt=null,c.pauseOffset=null,c.pauseAt=null,c.resumeOffset=null,c.stopAt=null,c.startOffset=t.playTime||0,c.state=n.audioMixing.states.BUSY,n._flushAudioMixingMuteStatus(),i(null);if(c.state=n.audioMixing.states.IDLE,r="CREATE_BUFFERSOURCE_FAILED",i)return i(r);d.default.error("[".concat(n.streamId,"] "),r)}})}else n._handleAudioMixingInvalidStateError("_playEffect",t,i)},n._stopOneEffect=function(t,i){var r=n.audioMixing.sounds[t.soundId];return n._isSoundExists(t)?r.state===n.audioMixing.states.BUSY||r.state===n.audioMixing.states.PAUSED?(n._stopAudioMixingBufferSource(t),r.stopAt=Date.now(),r.state=n.audioMixing.states.IDLE,n.audioMixing.buffer[r.options.filePath]&&!r.options.cacheResource&&(d.default.debug("Recycled buffer ".concat(r.options.filePath)),delete n.audioMixing.buffer[r.options.filePath]),void(i&&i(null))):void n._handleAudioMixingInvalidStateError("_stopOneEffect",t,i):i("SOUND_NOT_EXISTS")},n._pauseOneEffect=function(t,i){var r=n.audioMixing.sounds[t.soundId];if(r.state===n.audioMixing.states.BUSY)return n._stopAudioMixingBufferSource(t)?(r.pauseAt=Date.now(),r.state=n.audioMixing.states.PAUSED,r.resumeAt?r.pauseOffset=r.pauseAt-r.resumeAt+r.resumeOffset:r.pauseOffset=r.pauseAt-r.startAt+r.startOffset,i&&i(null)):void n._handleAudioMixingNoSourceError("_pauseOneEffect",t,i);n._handleAudioMixingInvalidStateError("_pauseOneEffect",t,i)},n._resumeOneEffect=function(t,i){var r=n.audioMixing.sounds[t.soundId];if(r.state===n.audioMixing.states.PAUSED){var o={soundId:t.soundId,filePath:r.options.filePath,cycle:r.options.cycle,loop:r.options.loop,playTime:r.pauseOffset,replace:r.options.replace},a=n._startAudioMixingBufferSource(o);if(!a){var s="CREATE_BUFFERSOURCE_FAILED";return i(s),void d.default.error("[".concat(n.streamId,"] "),s)}r.source=a,r.resumeAt=Date.now(),r.resumeOffset=r.pauseOffset,r.state=n.audioMixing.states.BUSY,r.pauseAt=null,r.pauseOffset=null,i(null)}else n._handleAudioMixingInvalidStateError("_resumeOneEffect",t,i)},n._getOneEffectDuration=function(t){var i=n.audioMixing.sounds[t.soundId];return i.options&&i.options.filePath&&n.audioMixing.buffer[i.options.filePath]?1e3*n.audioMixing.buffer[i.options.filePath].duration:null},n._getOneEffectCurrentPosition=function(t,i){var r=n.audioMixing.sounds[t.soundId];return r.state===n.audioMixing.states.PAUSED?r.pauseOffset%n._getOneEffectDuration(t):r.state===n.audioMixing.states.BUSY?r.resumeAt?(Date.now()-r.resumeAt+r.resumeOffset)%n._getOneEffectDuration(t):(Date.now()-r.startAt+r.startOffset)%n._getOneEffectDuration(t):void(i&&n._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",t))},n._setOneEffectPosition=function(t,i,r){var o=n.audioMixing.sounds[t.soundId];if(o.state===n.audioMixing.states.BUSY){if(!n._stopAudioMixingBufferSource(t))return void n._handleAudioMixingNoSourceError("_setOneEffectPosition",t,r);var a={soundId:t.soundId,filePath:o.options.filePath,loop:o.options.loop,cycle:o.options.cycle,playTime:i},s=n._startAudioMixingBufferSource(a);if(!s){var c="CREATE_BUFFERSOURCE_FAILED";return r&&r(c),void d.default.error("[".concat(n.streamId,"] "),c)}o.source=s,o.startAt=Date.now(),o.startOffset=i,o.resumeAt=null,o.resumeOffset=null,o.pauseOffset=null,o.pauseAt=null}else{if(o.state!==n.audioMixing.states.PAUSED)return void n._handleAudioMixingInvalidStateError("_setOneEffectPosition",t,r);o.pauseOffset=i}r&&r(null)},n.startAudioMixing=function(t,i){var r=p.report.reportApiInvoke(n.sid,{callback:function(t){if(t)return i&&i(t);n.dispatchEvent({type:"audioMixingPlayed"}),i&&i(null)},getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:t});Object(E.checkValidObject)(t,"options");var a=t.filePath,s=t.cacheResource,c=t.cycle,d=t.loop,u=t.playTime,l=t.replace;Object(E.checkValidString)(a,"filePath",1,Object(f.getParameter)("FILEPATH_LENMAX"),!1),Object(E.checkValidNumber)(u,"playTime",0,1e8),Object(E.isEmpty)(c)||Object(E.checkValidNumber)(c,"cycle"),Object(E.isEmpty)(d)||Object(E.checkValidBoolean)(d,"loop"),Object(E.isEmpty)(l)||Object(E.checkValidBoolean)(l,"replace"),Object(E.isEmpty)(s)||Object(E.checkValidBoolean)(s,"cacheResource");var _=o()({soundId:-1},t);n._playOneEffect(_,r)},n.stopAudioMixing=function(t){var i=p.report.reportApiInvoke(n.sid,{callback:t,getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});n._stopOneEffect({soundId:-1},i)},n.pauseAudioMixing=function(t){var i=p.report.reportApiInvoke(n.sid,{callback:t,getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return n._pauseOneEffect({soundId:-1},i)},n.resumeAudioMixing=function(t){var i=p.report.reportApiInvoke(n.sid,{callback:function(i,r){if(i)return t&&t(i);n.dispatchEvent({type:"audioMixingPlayed"}),t&&t(null)},getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});n._resumeOneEffect({soundId:-1},i)},n.adjustAudioMixingVolume=function(t){var i=p.report.reportApiInvoke(n.sid,{getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});Object(E.checkValidNumber)(t,"volume",0,100),n.audioMixing.sounds[-1].volume=t,n._flushAudioMixingMuteStatus(),i()},n.getAudioMixingDuration=function(){var t=p.report.reportApiInvoke(n.sid,{getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),i=n._getOneEffectDuration({soundId:-1});return t(null,i),i},n.getAudioMixingCurrentPosition=function(){var t=p.report.reportApiInvoke(n.sid,{getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),i=n._getOneEffectCurrentPosition({soundId:-1},!0);return t(null,i),i},n.setAudioMixingPosition=function(t,i){var r=p.report.reportApiInvoke(n.sid,{callback:i,options:arguments,tag:"tracer",getStates:n._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});Object(E.checkValidNumber)(t,"position",0,1e8),n._setOneEffectPosition({soundId:-1},t,r)},n.playEffect=function(t,i){var r=p.report.reportApiInvoke(n.sid,{callback:function(t){if(t)return i&&i(t);n.dispatchEvent({type:"effectPlayed"}),i&&i(null)},name:"Stream.playEffect",options:t});Object(E.checkValidObject)(t,"options");var o=t.soundId,a=t.filePath,s=t.cycle;Object(E.checkValidNumber)(o,"soundId",1,1e4),Object(E.checkValidString)(a,"filePath",0,Object(f.getParameter)("FILEPATH_LENMAX"),!1),Object(E.isEmpty)(s)||Object(E.checkValidNumber)(s,"cycle"),n._playOneEffect(t,r)},n.stopEffect=function(t,i){var r=p.report.reportApiInvoke(n.sid,{callback:i,getStates:n._getOneEffectStates({soundId:t}),name:"Stream.stopEffect"});Object(E.checkValidNumber)(t,"soundId",1,1e4),n._stopOneEffect({soundId:t},r)},n.stopAllEffects=function(t){var i=p.report.reportApiInvoke(n.sid,{callback:t,name:"Stream.stopAllEffect"}),r=!1,o=0,a=0,s=function(t){r||(t?(i(t),r=!0):o+=1,o===a&&(i(null),r=!0))};for(var c in n.audioMixing.sounds){var d=n.audioMixing.sounds[c];-1!==d.soundId&&(d.state!==n.audioMixing.states.BUSY&&d.state!==n.audioMixing.states.PAUSED||(a++,n._stopOneEffect({soundId:c},s)))}a||i(null)},n.preloadEffect=function(t,i,r){var o=p.report.reportApiInvoke(n.sid,{callback:r,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});Object(E.checkValidNumber)(t,"soundId",1,1e4),Object(E.checkValidString)(i,"filePath",1,Object(f.getParameter)("FILEPATH_LENMAX"),!1),n._initSoundIfNotExists(t,i),n.audioMixing.buffer[i]?o(null):n.loadAudioBuffer(i,i,o)},n.unloadEffect=function(t,i){var r=p.report.reportApiInvoke(n.sid,{callback:i,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});Object(E.checkValidNumber)(t,"soundId",1,1e4);var o=n.audioMixing.sounds[t];if(!o){var a="SOUND_NOT_EXISTS";return d.default.error(a,t),void r(a)}var s=o.options?o.options.filePath:o.filePath;if(s)delete n.audioMixing.buffer[s],delete n.audioMixing.sounds[t],r(null);else{var c="SOUND_BUFFER_NOT_FOUND";d.default.error(c,t),r(c)}},n.pauseEffect=function(t,i){var r=p.report.reportApiInvoke(n.sid,{callback:i,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return n._pauseOneEffect({soundId:t},r)},n.pauseAllEffects=function(t){var i=p.report.reportApiInvoke(n.sid,{callback:t,name:"Stream.pauseAllEffects"}),r=!1,o=0,a=0,s=function(t){r||(t?(i(t),r=!0):o+=1,o===a&&(i(null),r=!0))};for(var c in n.audioMixing.sounds)"-1"!==c&&n.audioMixing.sounds[c].state===n.audioMixing.states.BUSY&&(a++,n._pauseOneEffect({soundId:c},s));a||i(null)},n.resumeEffect=function(t,i){Object(E.checkValidNumber)(t,"soundId",1,1e4);var r=p.report.reportApiInvoke(n.sid,{callback:i,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return n._resumeOneEffect({soundId:t},r)},n.resumeAllEffects=function(t){var i=p.report.reportApiInvoke(n.sid,{callback:t,name:"Stream.resumeAllEffects"}),r=!1,o=0,a=0,s=function(t){r||(t?(i(t),r=!0):o+=1,o===a&&(i(null),r=!0))};for(var c in n.audioMixing.sounds)"-1"!==c&&n.audioMixing.sounds[c].state===n.audioMixing.states.PAUSED&&(a++,n._resumeOneEffect({soundId:c},s));a||i(null)},n.getEffectsVolume=function(){var t=[];for(var i in n.audioMixing.sounds){var r=n.audioMixing.sounds[i];r&&"-1"!==i&&t.push({soundId:parseInt(i),volume:r.volume})}return t},n.setEffectsVolume=function(t,i){var r=p.report.reportApiInvoke(n.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:i});for(var o in Object(E.checkValidNumber)(t,"volume",0,100),n.audioMixing.defaultVolume=t,n.audioMixing.sounds){var a=n.audioMixing.sounds[o];"-1"!==o&&(a.volume=t)}n._flushAudioMixingMuteStatus(),r(null)},n.setVolumeOfEffect=function(t,i,r){var o=p.report.reportApiInvoke(n.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:r});Object(E.checkValidNumber)(t,"soundId",0,1e4),Object(E.checkValidNumber)(i,"volume",0,100),n._initSoundIfNotExists(t),n.audioMixing.sounds[t].volume=i,n._flushAudioMixingMuteStatus(),o(null)},y.a.addVideoEffectCapability(c),i=c,r=t,i.videoConstraint={},r.cameraId&&(i.videoConstraint.deviceId={exact:r.cameraId}),r.facingMode&&(i.videoConstraint.facingMode=r.facingMode),i.videoSize&&(i.videoConstraint.width=i.videoSize[0],i.videoConstraint.height=i.videoSize[1]),Object(a.isLegacyChrome)()||(i.videoConstraint.frameRate=30),i.audioConstraint={},r.microphoneId&&(i.audioConstraint.deviceId={exact:r.microphoneId}),Object(a.isLegacyChrome)()||i.audioProcessing&&(void 0!==i.audioProcessing.AGC&&(Object(a.isFireFox)()?i.audioConstraint.autoGainControl=i.audioProcessing.AGC:Object(a.isChrome)()&&(i.audioConstraint.googAutoGainControl=i.audioProcessing.AGC,i.audioConstraint.googAutoGainControl2=i.audioProcessing.AGC)),void 0!==i.audioProcessing.AEC&&(i.audioConstraint.echoCancellation=i.audioProcessing.AEC),void 0!==i.audioProcessing.ANS&&(Object(a.isFireFox)()?i.audioConstraint.noiseSuppression=i.audioProcessing.ANS:Object(a.isChrome)()&&(i.audioConstraint.googNoiseSuppression=i.audioProcessing.ANS))),i.screenConstraint={},r.sourceId&&(i.screenConstraint.sourceId=r.sourceId),r.extensionId&&Object(a.isChrome)()?(i.screenConstraint.extensionId=r.extensionId,i.screenConstraint.mandatory={chromeMediaSource:"desktop",maxWidth:i.screenAttributes.width,maxHeight:i.screenAttributes.height,maxFrameRate:i.screenAttributes.maxFr,minFrameRate:i.screenAttributes.minFr}):(i.screenConstraint.mediaSource="screen",i.screenConstraint.width=i.screenAttributes.width,i.screenConstraint.height=i.screenAttributes.height,i.screenConstraint.frameRate={ideal:i.screenAttributes.maxFr,max:i.screenAttributes.maxFr}),r.mediaSource&&(i.screenConstraint.mediaSource=r.mediaSource),i.setVideoResolution=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});if(!(t instanceof Array)){var a=I(t+="");return a&&a.video?(i.videoConstraint=o()(i.videoConstraint,{width:{ideal:a.video.width},height:{ideal:a.video.height}}),r.attributes.resolution=a.attributes.resolution,(s=i.stream&&i.stream.getVideoTracks&&i.stream.getVideoTracks()[0])&&s.applyConstraints?(d.default.debug("setVideoResolution applyConstraints",i.videoConstraint),s.applyConstraints(i.videoConstraint).then(n).catch(n)):n(),!0):(n("NO_PROFILE_".concat(t)),!1)}var s,c=t[0],u=t[1];i.videoConstraint=o()(i.videoConstraint,{width:{ideal:c},height:{ideal:u}}),r.attributes.resolution="".concat(c,"x").concat(u),(s=i.stream&&i.stream.getVideoTracks&&i.stream.getVideoTracks()[0])&&s.applyConstraints?(d.default.debug("setVideoResolution applyConstraints",i.videoConstraint),y.a.disableVideoEffect(i).then(function(){return s.applyConstraints(i.videoConstraint).then(n).catch(n)}).then(function(){return y.a.restoreVideoEffect(i)})):n()},i.setVideoFrameRate=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});if(Object(a.isFireFox)())return n("FIREFOX_NOT_SUPPORTED"),!1;if("object"===T()(t)&&t instanceof Array&&t.length>1){i.videoConstraint=o()(i.videoConstraint,{frameRate:t[0]}),i.attributes.minFrameRate=t[0],i.attributes.maxFrameRate=t[1];var r=i.stream&&i.stream.getVideoTracks&&i.stream.getVideoTracks()[0];return r&&r.applyConstraints?(d.default.debug("setVideoFrameRate applyConstraints",i.videoConstraint),r.applyConstraints(i.videoConstraint).then(n).catch(n)):n(),!0}return n("INVALID_PARAM_".concat(JSON.stringify(t))),!1},i.setVideoBitRate=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return"object"===T()(t)&&t instanceof Array&&t.length>1?(r.attributes.minVideoBW=t[0],r.attributes.maxVideoBW=t[1],i.connectionSpec&&(i.connectionSpec.minVideoBW=t[0],i.connectionSpec.maxVideoBW=t[1]),i.pc&&i.pc.renegotiate&&i.pc.renegotiate(),n(),!0):(n("INVALID_PARAM_".concat(JSON.stringify(t))),!1)},i.setScreenBitRate=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return"object"===T()(t)&&t instanceof Array&&t.length>1?(i.screenAttributes.minVideoBW=t[0],i.screenAttributes.maxVideoBW=t[1],n(),!0):(n("INVALID_PARAM_".concat(JSON.stringify(t))),!1)},i.setScreenProfile=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});Object(E.checkValidEnum)(t,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]);var r=I(t);return r&&r.screen?(i.screenConstraint.mandatory?(i.screenConstraint.mandatory.maxWidth=r.screen.width,i.screenConstraint.mandatory.maxHeight=r.screen.height,r.screen.frameRate&&r.screen.frameRate.min&&r.screen.frameRate.max&&(i.screenConstraint.mandatory.minFrameRate=r.screen.frameRate.min,i.screenConstraint.mandatory.maxFrameRate=r.screen.frameRate.max)):i.screenConstraint=o()(i.screenConstraint,r.screen),i.screenAttributes.width=r.screen.width,i.screenAttributes.height=r.screen.height,i.screenAttributes.minFr=r.screen.frameRate.min,i.screenAttributes.maxFr=r.screen.frameRate.max,n(),!0):(n("NO_SCREEN_PROFILE_".concat(JSON.stringify(t))),!1)},i.setVideoProfileCustom=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});i.setVideoResolution(t[0]),i.setVideoFrameRate([t[1],t[1]]),i.setVideoBitRate([t[2],t[2]]),n()},i.setVideoProfileCustomPlus=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});i.setVideoResolution([t.width,t.height]),r.attributes.resolution="".concat(t.width,"x").concat(t.height),i.setVideoFrameRate([t.framerate,t.framerate]),i.setVideoBitRate([t.bitrate,t.bitrate]),n()},i.setVideoProfile=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"}),s=I(t);if(!s){var c="Invalid Profile ".concat(t);throw Error(c)}if(i.profile=t,s&&s.video){i.profile=s.profileName,i.videoConstraint=o()(i.videoConstraint,s.video),i.connectionSpec&&s.attributes.maxVideoBW&&(i.connectionSpec.minVideoBW=s.attributes.minVideoBW,i.connectionSpec.maxVideoBW=s.attributes.maxVideoBW),Object(a.isEdge)()&&(i.videoConstraint.frameRate.max=60),Object(a.isFireFox)()&&(i.videoConstraint.frameRate=30),r.attributes=o()(r.attributes,s.attributes),i.pc&&i.pc.renegotiate&&i.pc.renegotiate();var u=i.stream&&i.stream.getVideoTracks&&i.stream.getVideoTracks()[0];return u&&u.applyConstraints?(d.default.debug("setVideoProfile applyConstraints",i.videoConstraint),y.a.disableVideoEffect(i).then(function(){return u.applyConstraints(i.videoConstraint)}).then(function(){return y.a.restoreVideoEffect(i)}).then(function(t){return new Promise(function(r,o){n(t),setTimeout(function(){Object(m.vsResHack)(i.stream,function(t,n){i.videoWidth=t,i.videoHeight=n,r()},function(t){d.default.warning("[".concat(i.streamId,"] vsResHack failed: "),t),o()})},2500)})}).catch(n)):n(),!0}return n("INVALID_VIDEO_PROFILE_".concat(t)),!1},i.setAudioProfile=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});Object(E.checkValidEnum)(t,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),i.audioProfile=t;var r=C(t);return i.highQuality=r.highQuality,i.stereo=r.stereo,i.speech=r.speech,i.lowQuality=r.lowQuality,i.stereo&&Object(a.isChrome)()&&(i.audioConstraint.googAutoGainControl=!1,i.audioConstraint.googAutoGainControl2=!1,i.audioConstraint.echoCancellation=!1,i.audioConstraint.googNoiseSuppression=!1),n(),!0},i.setVideoEncoderConfiguration=function(t){Object(E.checkValidObject)(t,"config");var n=p.report.reportApiInvoke(i.sid,{name:"Stream.setVideoEncoderConfiguration",options:t,tag:"tracer"});t.resolution&&(Object(E.checkValidNumber)(t.resolution.width,"config.resolution.width"),Object(E.checkValidNumber)(t.resolution.height,"config.resolution.height"),i.setVideoResolution([t.resolution.width,t.resolution.height])),t.frameRate&&(Object(E.checkValidNumber)(t.frameRate.min,"config.frameRate.min"),Object(E.checkValidNumber)(t.frameRate.max,"config.frameRate.max"),i.setVideoFrameRate([t.frameRate.min,t.frameRate.max])),t.bitrate&&(Object(E.checkValidNumber)(t.bitrate.min,"config.bitrate.min",1,1e7),Object(E.checkValidNumber)(t.bitrate.max,"config.bitrate.max",1,1e7),i.setVideoBitRate([t.bitrate.min,t.bitrate.max])),n()},i.getSupportedProfile=function(t){var n=p.report.reportApiInvoke(i.sid,{name:"Stream.getSupportedProfile",options:arguments,tag:"tracer",callback:t});if(!i.local){var r="ONLY_LOCAL_STREAM_SUPPORTED";return d.default.error(r),n(r)}if(!i.stream)return r="STREAM_NOT_INIT",d.default.error(r),n(r);if(!i.stream.getVideoTracks)return r="TRACK_NOT_SUPPORT",d.default.error(r),n(r);var o=i.stream.getVideoTracks()[0];if(!o)return r="NO_VIDEO_TRACK_FOUND",d.default.error(r),n(r);if(!o.getCapabilities)return r="GETCAPABILITY_NOT_SUPPORT",d.default.error(r),n(r);var a=A(o.getCapabilities());return n(null,a)},c.getId=function(){return c.streamId},c.getUserId=function(){return c.userId},c.checkDualStreamEnabled=function(){return!!Object(f.getParameter)("DUALSTREAM_OPERATION_CHECK")&&!!c.isDualStream&&(d.default.error("Operation not permitted: ".concat("DUAL_STREAM_ENABLED")),"DUAL_STREAM_ENABLED")},c.setUserId=function(t){var n=p.report.reportApiInvoke(c.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});c.userId&&d.default.warning("[".concat(c.streamId,"] Stream.userId ").concat(c.userId," => ").concat(t)),c.userId=t,n()},c.getAttributes=function(){return t.screen?c.screenAttributes:t.attributes},c.hasAudio=function(){return!!c.audio},c.hasVideo=function(){return!!c.video},c.hasScreen=function(){return!!c.screen},c.hasScreenAudio=function(){return!!c.screenAudio},c.isVideoOn=function(){return(c.hasVideo()||c.hasScreen())&&!c.userMuteVideo},c.isAudioOn=function(){return c.hasAudio()&&!c.userMuteAudio},c.init=function(n,i){var r=p.report.reportApiInvoke(c.sid,{callback:function(t,r){if(t)return i&&i(t);n&&n(r)},name:"Stream.init",options:arguments,tag:"tracer"}),o=((new Date).getTime(),arguments[2]);if(void 0===o&&(o=2),!0===c.initialized)return r({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(!0!==c.local)return r({type:"warning",msg:"STREAM_NOT_LOCAL"});var a=Math.random().toString().slice(3);c._streamInitID=a,c.videoSource?c.videoName="videoSource":c.video&&(c.videoName=$.a.searchDeviceNameById(t.cameraId)||"default"),c.audioSource?c.audioName="audioSource":c.audio&&(c.audioName=$.a.searchDeviceNameById(t.microphoneId)||"default"),c.screen&&(c.screenName=t.extensionId||"default");try{if(t.audio||t.video||t.screen||t.screenAudio||t.videoSource||t.audioSource){d.default.debug("[".concat(c.streamId,"] Requested access to local media"));var s={streamId:c.streamId};t.videoSource?s.videoSource=t.videoSource:t.screen?s.screen=c.screenConstraint:t.video&&(s.video=c.videoConstraint),t.audioSource?s.audioSource=t.audioSource:t.screenAudio?s.screenAudio=t.screenAudio:t.audio&&(s.audio=c.audioConstraint),Object(h.b)(s,function(n){if(s.screenAudio&&!n.getAudioTracks()[0]&&d.default.warning("[".concat(c.streamId,"] Audio sharing is not selected")),s.screen&&d.default.debug("[".concat(c.streamId,"] User has granted access to screen sharing")),(s.video||s.audio)&&d.default.debug("[".concat(c.streamId,"] User has granted access to local media")),null===c._streamInitID){n.getTracks().forEach(function(t){t.stop()});var i={type:"error",msg:"STREAM_IS_CLOSED",info:"stream is closed and cannot be initialized"};return d.default.error(c.streamId,i.info),void r(i)}if(c._streamInitID!==a)return n.getTracks().forEach(function(t){t.stop()}),i={type:"error",msg:"ABORT_OTHER_INIT",info:"stream initialization is aborted because of another stream.init"},d.default.error(c.streamId,i.info),void r(i);c.dispatchEvent({type:"accessAllowed"}),c.stream=n,c.initialized=!0,c.reloadDeviceName(),c.hasVideo()&&Object(m.vsResHack)(n,function(t,n){c.videoWidth=t,c.videoHeight=n},function(t){d.default.warning("[".concat(c.streamId,"] vsResHack failed: "),t)}),t.screen&&c.stream&&c.stream.getVideoTracks()[0]&&(c.stream.getVideoTracks()[0].onended=function(){c.dispatchEvent({type:"stopScreenSharing"})}),c.stream&&c.stream.getTracks&&c.stream.getTracks().forEach(function(n){n&&!n.onended&&(n.onended=u),"video"===n.kind&&t.optimizationMode&&(n.contentHint=t.optimizationMode,n.contentHint===t.optimizationMode&&d.default.debug("[".concat(c.streamId,"] set content hint to"),t.optimizationMode))}),r()},function(t){var n={type:"error",info:null};switch(t&&(n.msg=t.name||t.code||t,t.message&&(n.info=t.message),t.code&&(n.info?n.info+=". "+t.code:n.info=" "+t.code),t.constraint&&(n.info?n.info+=". Constraint: "+t.constraint:n.info="constraint: "+t.constraint)),n.msg){case"Starting video failed":case"TrackStartError":if(c.videoConstraint&&(delete c.videoConstraint.width,delete c.videoConstraint.height),o>0)return void setTimeout(function(){c.init(function(t){return r(t)},r,o-1)},1);n.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":n.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":n.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":n.msg="PERMISSION_DENIED",c.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":c.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":n.msg="CONSTRAINT_NOT_SATISFIED";break;default:n.msg||(n.msg="UNDEFINED")}var i="Media access ".concat(n.msg).concat(n.info?": "+n.info:"");d.default.error("[".concat(c.streamId,"] "),i),r(n)})}else r({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(l){d.default.error("[".concat(c.streamId,"] Stream init: "),l),r({type:"error",msg:l.message||l})}},c.reloadDeviceName=function(){if(c.stream){if(c.stream.getVideoTracks){var t=c.stream.getVideoTracks()[0];t&&t.label&&(c.videoName=t.label)}if(c.stream.getAudioTracks){var n=c.stream.getAudioTracks()[0];n&&n.label&&(c.audioName=n.label)}}},c.close=function(){var t=p.report.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(d.default.debug("[".concat(c.streamId,"] Close stream with id"),c.streamId),c._originStream)try{c._originStream.getTracks().map(function(t){return t.stop()})}catch(n){}if(void 0!==c.stream){var i=c.stream.getTracks();for(var r in i)i.hasOwnProperty(r)&&(i[r].stop(),i[r].onended=null);!c.isLowStream&&c.local?y.a.disableVideoEffect(c).then(function(){c.stream=void 0}):(c.stream&&c.stream.clean&&c.stream.clean(),c.stream=void 0)}if(c._originStream){for(var r in i=c._originStream.getTracks())i.hasOwnProperty(r)&&(i[r].stop(),i[r].onended=null);!c.isLowStream&&c.local?y.a.disableVideoEffect(c).then(function(){c._originStream=void 0}):(c._originStream&&c._originStream.clean&&c._originStream.clean(),c._originStream=void 0)}Object(a.isSafari)()&&c.pc&&c.pc.peerConnection&&c.pc.peerConnection.removeTrack&&c.pc.peerConnection.getSenders&&c.pc.peerConnection.getSenders().forEach(function(t){t&&(d.default.debug("[".concat(c.streamId,"] Remove Track"),t),c.pc.peerConnection.removeTrack(t))}),c.local&&(c.initialized=!1),c._streamInitID=null,c._onAudioMute=void 0,c._onAudioUnmute=void 0,c._onVideoMute=void 0,c._onVideoUnmute=void 0,c.lowStream&&c.lowStream.close(),c.player&&c.player.video&&c.player.video.srcObject&&(c.player.video.srcObject=null),c.player&&c.player.audio&&c.player.audio.srcObject&&(c.player.audio.srcObject=null),t()},c.enableAudio=function(){var t,n=p.report.reportApiInvoke(c.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});return d.default.deprecate("[".concat(c.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead")),c.userMuteAudio||d.default.warning("[".concat(c.streamId,"] User already enableAudio")),c.userMuteAudio=!1,n(null,t=!c.peerMuteAudio&&c._unmuteAudio()),t},c.disableAudio=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});d.default.deprecate("[".concat(c.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead")),c.userMuteAudio&&d.default.warning("[".concat(c.streamId,"] User already disableAudio")),c.userMuteAudio=!0;var n=c._muteAudio();return t(null,n),n},c.enableVideo=function(){var t,n=p.report.reportApiInvoke(c.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});return d.default.deprecate("[".concat(c.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead")),c.userMuteVideo||d.default.warning("[".concat(c.streamId,"] User already enableVideo")),c.userMuteVideo=!1,c.lowStream&&(c.lowStream.userMuteVideo=!1),n(null,t=!c.peerMuteVideo&&c._unmuteVideo()),t},c.disableVideo=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});d.default.deprecate("[".concat(c.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead")),c.userMuteVideo&&d.default.warning("[".concat(c.streamId,"] User already disableVideo")),c.userMuteVideo=!0,c.lowStream&&(c.lowStream.userMuteVideo=!0);var n=c._muteVideo();return t(null,n),n},c.unmuteAudio=function(){var t,n=p.report.reportApiInvoke(c.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"});return c.userMuteAudio||d.default.warning("[".concat(c.streamId,"] User already unmuteAudio")),c.userMuteAudio=!1,n(null,t=!c.peerMuteAudio&&c._unmuteAudio()),t},c.muteAudio=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"});c.userMuteAudio&&d.default.warning("[".concat(c.streamId,"] User already muteAudio")),c.userMuteAudio=!0;var n=c._muteAudio();return t(null,n),n},c.unmuteVideo=function(){var t,n=p.report.reportApiInvoke(c.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"});return c.userMuteVideo||d.default.warning("[".concat(c.streamId,"] User already unmuteVideo")),c.userMuteVideo=!1,c.lowStream&&(c.lowStream.userMuteVideo=!1),n(null,t=!c.peerMuteVideo&&c._unmuteVideo()),t},c.muteVideo=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"});c.userMuteVideo&&d.default.warning("[".concat(c.streamId,"] User already muteVideo")),c.userMuteVideo=!0,c.lowStream&&(c.lowStream.userMuteVideo=!0);var n=c._muteVideo();return t(null,n),n},c._unmuteAudio=function(){return d.default.debug("[".concat(c.streamId,"] Unmuted audio stream with id "),c.streamId),c._flushAudioMixingMuteStatus(!1),!(!c.hasAudio()||!c.initialized||void 0===c.stream||!0===c.stream.getAudioTracks()[0].enabled)&&(c._onAudioUnmute&&c._onAudioUnmute(),c.pc&&(c.pc.isAudioMute=!1),c.stream.getAudioTracks()[0].enabled=!0,!0)},c._isAudioMuted=function(){if(c.stream&&c.hasAudio()){var t=c.stream.getAudioTracks();return t.length>0&&!t[0].enabled}return!1},c._isVideoMuted=function(){if(c.stream&&c.hasVideo()){var t=c.stream.getVideoTracks();return t.length>0&&!t[0].enabled}return!1},c._muteAudio=function(){return d.default.debug("[".concat(c.streamId,"] Muted audio stream with id "),c.streamId),c._flushAudioMixingMuteStatus(!0),!!(c.hasAudio()&&c.initialized&&void 0!==c.stream&&c.stream.getAudioTracks()[0].enabled)&&(c._onAudioMute&&c._onAudioMute(),c.pc&&(c.pc.isAudioMute=!0),c.stream.getAudioTracks()[0].enabled=!1,c.sid&&p.report.audioSendingStopped(c.sid,{succ:!0,reason:"muteAudio"}),!0)},c._unmuteVideo=function(){return d.default.debug("[".concat(c.streamId,"] Unmuted video stream with id"),c.streamId),!(!c.initialized||void 0===c.stream||!c.stream.getVideoTracks().length||!0===c.stream.getVideoTracks()[0].enabled)&&(c._onVideoUnmute&&c._onVideoUnmute(),c.pc&&(c.pc.isVideoMute=!1),c.stream.getVideoTracks()[0].enabled=!0,c.lowStream&&c.lowStream._unmuteVideo(),!0)},c._muteVideo=function(){return d.default.debug("[".concat(c.streamId,"] Muted video stream with id"),c.streamId),!!(c.initialized&&void 0!==c.stream&&c.stream.getVideoTracks().length&&c.stream.getVideoTracks()[0].enabled)&&(c._onVideoMute&&c._onVideoMute(),c.pc&&(c.pc.isVideoMute=!0),c.stream.getVideoTracks()[0].enabled=!1,c.lowStream&&c.lowStream._muteVideo(),c.sid&&p.report.videoSendingStopped(c.sid,{succ:!0,reason:"muteVideo"}),!0)},c.addTrack=function(n){if(c.audio&&"audio"===n.kind)d.default.warning("already added audio track");else if(c.video&&"video"===n.kind)d.default.warning("already added video track");else{var i=p.report.reportApiInvoke(c.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(c.pc&&c.pc.addTrack(n,c.stream),"audio"==n.kind){c._cleanupAudioMixing();var r=new MediaStream;c.userMuteAudio&&(n.enabled=!1),r.addTrack(n);var o=c.stream.getVideoTracks()[0];o&&r.addTrack(o),c.audio=!0,t.audio=!0,c.stream=r,c.audioLevelHelper=null,c.player&&c.player.video&&(c.player.video.srcObject=c.stream)}else c.userMuteVideo&&(n.enabled=!1),c.stream.addTrack(n),c.video=!0,t.video=!0;n.onended||(n.onended=u),i()}},c.removeTrack=function(n){if(n){if(c.audio||"audio"!==n.kind){if(c.video||"video"!==n.kind){var i=p.report.reportApiInvoke(c.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});c.pc&&c.pc.removeTrack(n,c.stream),c.stream.removeTrack(n),c._cleanupAudioMixing(),"audio"===n.kind?(c.audio=!1,t.audio=!1):(c.video=!1,t.video=!1),c.audioLevelHelper=null,"live"==n.readyState&&(n.stop(),d.default.debug("[".concat(c.streamId,"] Track ").concat(n.kind," Stopped"))),i()}else d.default.warning("already removed video track")}else d.default.warning("already removed audio track")}else d.default.warning("track doesn't exist.")},c.setAudioOutput=function(t,n,i){var r=p.report.reportApiInvoke(c.sid,{callback:function(t,r){if(t)return i&&i(t);n&&n(r)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return Object(E.isValidString)(t,1,255)?(c.audioOutput=t,c.player?void c.player.setAudioOutput(t,function(){return r()},r):r()):(d.default.error("[".concat(c.streamId,"] setAudioOutput Invalid Parameter"),t),r(l.default.INVALID_PARAMETER))},c.play=function(t,n,i){"function"==typeof n&&(i=n,n=null),d.default.debug("[".concat(c.streamId,"] play()."),t,n);var r=p.report.reportApiInvoke(c.sid,{name:"Stream.play",options:arguments,tag:"tracer",callback:i});if(Object(E.checkValidString)(t,"elementID"),Object(E.isEmpty)(n)||(Object(E.isEmpty)(n.fit)||Object(E.checkValidEnum)(n.fit,"fit",["cover","contain"]),Object(E.isEmpty)(n.muted)||Object(E.checkValidBoolean)(n.muted,"muted")),c.player)d.default.warning("[".concat(c.streamId,"] Stream.play(): Stream is already playing. Fallback to resume stream")),c.resume().then(function(){r(null)}).catch(r);else{c.elementID=t,c.playOptions=n,!c.local||c.video||c.screen?(c.player=new g({id:c.getId(),stream:c,elementID:t,options:n}),c.local&&y.a.applyEffectInPlayer(c)):c.hasAudio()&&(c.player=new g({id:c.getId(),stream:c,elementID:t,options:n}));var o={video:null,audio:null},a=function t(n){if(o[n.mediaType]=n,o.video&&o.audio){if(c.removeEventListener("player-status-change",t),o.video.isErrorState||o.audio.isErrorState){var i=o.video.isErrorState?o.video:o.audio;r({isErrorState:!0,status:i.status,reason:i.reason,video:o.video,audio:o.audio})}else"aborted"===o.video.status&&"aborted"===o.audio.status?r({status:"aborted",reason:"stop",video:o.video,audio:o.audio}):r(null)}};c.on("player-status-change",a),c.audioOutput&&c.player.setAudioOutput(c.audioOutput),void 0!==c.audioLevel&&c.player.setAudioVolume(c.audioLevel),c._flushAudioMixingMuteStatus(!1)}},c.stop=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});d.default.debug("[".concat(c.streamId,"] Stop stream player with id "),c.streamId),c.player?(y.a.removeEffectFromLocalPlayer(c),c.player.destroy(),delete c.player):d.default.error("[".concat(c.streamId,"] Stream.stop(): Stream is not playing")),c._flushAudioMixingMuteStatus(!0),t()},c.isPlaying=function(){return!!c.player},c.isPaused=function(){return!!c.player&&(!!(c.player.video&&c.player.video.paused&&c.player.mediaElemExists(c.player.video))||!!(c.player.audio&&c.player.audio.paused&&c.player.mediaElemExists(c.player.audio)))},c.resume=function(){var t,n;return c.player?(c.player.video&&c.player.video.play&&(t=c.player.video.play()),t=t||Promise.resolve(),c.player.audio&&c.player.audio.play&&(n=c.player.audio.play()),Promise.all([t,n=n||Promise.resolve()])):Promise.reject("NO_PLAYER_FOUND")},c.getVideoTrack=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(c.stream&&c.stream.getVideoTracks){var n=c.stream.getVideoTracks()[0];if(n)return d.default.info("[".concat(c.streamId,"] getVideoTrack"),n),t(),n}d.default.info("[".concat(c.streamId,"] getVideoTrack None")),t(null,"getVideoTrack None")},c.getAudioTrack=function(){var t=p.report.reportApiInvoke(c.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(c.stream&&c.stream.getAudioTracks){var n=c.stream.getAudioTracks()[0];if(n)return d.default.info("[".concat(c.streamId,"] getAudioTracks"),n),t(),n}d.default.info("[".concat(c.streamId,"] getAudioTracks None")),t(null,"getAudioTracks None")},c._hasVideoTracks=function(){return!!(c.stream&&c.stream.getVideoTracks&&c.stream.getVideoTracks()[0])},c._hasAudioTracks=function(){return!!(c.stream&&c.stream.getAudioTracks&&c.stream.getAudioTracks()[0])},c._replaceMediaStreamTrack=function(t,n,i){if(c.stream){if("video"==t.kind){if(r=c.stream.getVideoTracks()[0])return c.userMuteVideo&&(t.enabled=!1),c.stream.removeTrack(r),c.stream.addTrack(t),d.default.debug("[".concat(c.streamId,"] _replaceMediaStreamTrack ").concat(t.kind," SUCCESS")),"live"==r.readyState&&(r.stop(),d.default.debug("[".concat(c.streamId,"] Track ").concat(r.kind," Stopped"))),n&&n();var r,o="MEDIASTREAM_TRACK_NOT_FOUND";return d.default.error("[".concat(c.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(t.kind)),i(o)}if("audio"==t.kind){if(r=c.stream.getAudioTracks()[0]){c.userMuteAudio&&(t.enabled=!1);var a=new MediaStream;a.addTrack(t);var s=c.stream&&c.stream.getVideoTracks()[0];return s&&a.addTrack(s),c.stream=a,c.audioLevelHelper=null,c.player&&c.player.video&&(c.player.video.srcObject=c.stream),d.default.debug("[".concat(c.streamId,"] _replaceMediaStreamTrack SUCCESS")),"live"==r.readyState&&(r.stop(),d.default.debug("[".concat(c.streamId,"] Track ").concat(r.kind," Stopped"))),n&&n()}return o="MEDIASTREAM_TRACK_NOT_FOUND",d.default.error("[".concat(c.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(t.kind)),i(o)}return o="INVALID_TRACK_TYPE",d.default.error("[".concat(c.streamId,"] _replaceMediaStreamTrack ").concat(o," ").concat(t.kind)),i&&i(o)}return o="NO_STREAM_FOUND",d.default.error("[".concat(c.streamId,"] _replaceMediaStreamTrack ").concat(o)),i&&i(o)},c.replaceTrack=function(t,n,i){var r=p.report.reportApiInvoke(c.sid,{callback:function(t,r){if(t)return i&&i(t);n&&n(r)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return t&&t.kind?(c._cleanupAudioMixing(),t.onended||(t.onended=u),c.pc&&c.pc.hasSender&&c.pc.hasSender(t.kind)?void c.pc.replaceTrack(t,function(){return d.default.debug("[".concat(c.streamId,"] PeerConnection.replaceTrack ").concat(t.kind," SUCCESS")),c._replaceMediaStreamTrack(t,function(t){return r(null,t)},r)},function(n){return d.default.error("[".concat(c.streamId,"] PeerConnection.replaceTrack ").concat(t.kind," Failed ").concat(n)),r(n)}):c._replaceMediaStreamTrack(t,function(t){return r(null,t)},r)):r("INVALID_TRACK")},c.setAudioVolume=function(t){var n=p.report.reportApiInvoke(c.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});Object(E.checkValidNumber)(t,"level",0,100),c.audioLevel=t,c.player&&c.player.setAudioVolume(t),n()},c.getStats=function(t,n,i){var r=[];r.push(c._getPCStats(i)),r.push(new Promise(function(t){var n={};c.pc&&c.pc.isSubscriber?null!==window.navigator.userAgent.match("Firefox")&&(Object(v.b)(n,"videoReceiveResolutionHeight",c.videoHeight),Object(v.b)(n,"videoReceiveResolutionWidth",c.videoWidth)):c.pc&&!c.pc.isSubscriber&&((Object(a.isSafari)()||Object(a.isFireFox)())&&(Object(v.b)(n,"videoSendResolutionHeight",c.videoHeight),Object(v.b)(n,"videoSendResolutionWidth",c.videoWidth)),(Object(a.isSafari)()||Object(a.isFireFox)())&&c.uplinkStats&&Object(v.b)(n,"videoSendPacketsLost",c.uplinkStats.uplink_cumulative_lost)),t(n)})),r.push(new Promise(function(t){var n={};return c.traffic_stats&&c.pc&&c.pc.isSubscriber?(Object(v.b)(n,"accessDelay",c.traffic_stats.access_delay),Object(v.b)(n,"endToEndDelay",c.traffic_stats.e2e_delay),Object(v.b)(n,"videoReceiveDelay",c.traffic_stats.video_delay),Object(v.b)(n,"audioReceiveDelay",c.traffic_stats.audio_delay)):c.traffic_stats&&c.pc&&!c.pc.isSubscriber&&Object(v.b)(n,"accessDelay",c.traffic_stats.access_delay),t(n)})),Promise.all(r).then(function(n){for(var i={},r=n.length-1;r>=0;r--){var a=n[r];o()(i,a)}t&&setTimeout(t.bind(c,i),0)}).catch(function(t){n&&setTimeout(n.bind(c,t),0)})},c._getPCStats=function(t){return new Promise(function(n,i){if(!c.pc||"established"!==c.pc.state||!c.pc.getStats)return i("PEER_CONNECTION_NOT_ESTABLISHED");c.pc.getStats(function(t){return c.pc&&"established"===c.pc.state&&c.pc.getStats?n(c.pc.isSubscriber?Object(v.c)(t):Object(v.a)(t)):i("PEER_CONNECTION_STATE_CHANGE")},t)}).then(function(t){return c.pc.isSubscriber?(Object(a.isFireFox)()||Object(a.isSafari)())&&(t.videoReceiveResolutionHeight&&"0"!==t.videoReceiveResolutionHeight||t.videoReceiveResolutionWidth&&"0"!==t.videoReceiveResolutionWidth||(Object(v.b)(t,"videoReceiveResolutionHeight",c.videoHeight),Object(v.b)(t,"videoReceiveResolutionWidth",c.videoWidth))):((Object(a.isSafari)()||Object(a.isFireFox)())&&(t.videoSendResolutionHeight&&"0"!==t.videoSendResolutionHeight||t.videoSendResolutionWidth&&"0"!==t.videoSendResolutionWidth||(Object(v.b)(t,"videoSendResolutionHeight",c.videoHeight),Object(v.b)(t,"videoSendResolutionWidth",c.videoWidth))),(Object(a.isSafari)()||Object(a.isFireFox)())&&c.uplinkStats&&Object(v.b)(t,"videoSendPacketsLost",c.uplinkStats.uplink_cumulative_lost)),Promise.resolve(t)})},c.getAudioLevel=function(){if(c.audioLevelHelper)return c.audioLevelHelper.getAudioLevel();if(c.stream){if(0!==c.stream.getAudioTracks().length)return c.audioLevelHelper=new m.audioLevelHelper(c.stream),c.audioLevelHelper.getAudioLevel();d.default.warning("[".concat(c.streamId,"] can't get audioLevel beacuse no audio trace in stream"))}else d.default.warning("[".concat(c.streamId,"] can't get audioLevel beacuse no stream exist"))},c.setVideoProfile("480p_1"),c._switchVideoDevice=function(t,n,i){if(t===c.cameraId)return n&&n();var r={video:o()({},c.videoConstraint,{deviceId:{exact:t}}),audio:!1};d.default.debug("[".concat(c.streamId,"] ").concat(r)),Object(h.b)(r,function(r){try{var o=function(){c.isPlaying()&&(c.stop(),c.elementID&&c.play(c.elementID,c.playOptions)),c.cameraId=t,c.videoConstraint.deviceId={exact:t},c.userMuteVideo&&(c.stream.getVideoTracks()[0].enabled=!1),y.a.restoreVideoEffect(c).then(function(){n&&n()})};y.a.disableVideoEffect(c).then(function(){var t=!1;window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack&&(t=!0),t?c.replaceTrack(r.getVideoTracks()[0],o,i):(c.removeTrack(c.stream.getVideoTracks()[0]),c.addTrack(r.getVideoTracks()[0]),o())})}catch(a){return i&&i(a)}},function(t){return i&&i(t)})},c._switchAudioDevice=function(t,n,i){if(t===c.microphoneId)return n&&n();var r={video:!1,audio:o()({},c.audioConstraint,{deviceId:{exact:t}})};d.default.debug("[".concat(c.streamId,"] "),r);var a=c.stream.getAudioTracks()[0];a&&a.stop(),Object(h.b)(r,function(r){var o=function(){c._cleanupAudioMixing(),c.userMuteAudio&&(c.stream.getAudioTracks()[0].enabled=!1),c.isPlaying()&&(c.stop(),c.elementID&&c.play(c.elementID,c.playOptions)),c.microphoneId=t,c.audioConstraint.deviceId={exact:t},n&&n()};try{var a=!1;window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack&&(a=!0),a?c.replaceTrack(r.getAudioTracks()[0],o,i):(c.removeTrack(c.stream.getAudioTracks()[0]),c.addTrack(r.getAudioTracks()[0]),o())}catch(s){return i&&i(s)}},function(t){return i&&i(t)})},c.switchDevice=function(t,n,i,r){var o=p.report.reportApiInvoke(c.sid,{callback:function(t,n){if(t)return r&&r(t);i&&i(n)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});Object(E.checkValidString)(n,"deviceId");var a=function(){return c.inSwitchDevice=!1,o()},s=function(t){c.inSwitchDevice=!1,d.default.error("[".concat(c.streamId,"] "),t),o(t)};if(c.inSwitchDevice)return o("Device switch is in process.");if(c.inSwitchDevice=!0,!c.local)return s("Only the local stream can switch the device.");if(c.screen&&"video"===t)return s("The device cannot be switched during screen-sharing.");if(!c.video&&"video"===t)return s("Video track not exist.");if(!c.audio&&"audio"===t)return s("Audio track not exist.");if(c.videoSource||c.audioSource)return s("The device cannot be switched when using videoSource or audioSource.");var u=!1;for(var l in c.audioMixing.sounds)if(c.audioMixing.sounds[l].state!==c.audioMixing.states.IDLE){u=!0;break}if(c.audioMixing.audioContextInited&&u)return s("The device cannot be switched when using audio Mixing.");$.a.getDeviceById(n,function(){if("video"===t)c._switchVideoDevice(n,a,s);else{if("audio"!==t)return s("Invalid type.");c._switchAudioDevice(n,a,s)}},function(){return s("The device does not exist.")})},c},N=function(t){var n=p.report.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer",getStates:function(){return{audioTrackEnable:t&&t.audioSource?t.audioSource.enabled:null,videoTrackEnable:t&&t.videoSource?t.videoSource.enabled:null}}});Object(E.checkValidObject)(t,"StreamSpec");var i=t.streamID,r=t.audio,o=t.video,a=t.screen,s=t.screenAudio,c=(t.audioSource,t.videoSource,t.cameraId),u=t.facingMode,l=t.microphoneId,f=t.mirror,_=t.extensionId,g=t.mediaSource,h=t.audioProcessing,v=t.optimizationMode;if(!Object(E.isEmpty)(i)&&!Object(m.is32Uint)(i)&&!Object(E.isValidString)(i,1,255))throw Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32");if(Object(E.checkValidBoolean)(r,"audio"),Object(E.checkValidBoolean)(o,"video"),Object(E.isEmpty)(a)||Object(E.checkValidBoolean)(a,"screen"),Object(E.isEmpty)(s)||Object(E.checkValidBoolean)(s,"screenAudio"),Object(E.isEmpty)(c)||Object(E.checkValidString)(c,"cameraId",0,255,!1),Object(E.isEmpty)(u)||Object(E.checkValidEnum)(u,"facingMode",["user","environment","left","right"]),Object(E.isEmpty)(l)||Object(E.checkValidString)(l,"microphoneId",0,255,!1),Object(E.isEmpty)(_)||Object(E.checkValidString)(_,"extensionId"),Object(E.isEmpty)(g)||Object(E.checkValidEnum)(g,"mediaSource",["screen","application","window"]),Object(E.isEmpty)(f)||Object(E.checkValidBoolean)(f,"mirror"),!Object(E.isEmpty)(h)){var $=h.AGC,S=h.AEC,y=h.ANS;Object(E.isEmpty)($)||Object(E.checkValidBoolean)($,"AGC"),Object(E.isEmpty)(S)||Object(E.checkValidBoolean)(S,"AEC"),Object(E.isEmpty)(y)||Object(E.checkValidBoolean)(y,"ANS")}Object(E.isEmpty)(v)||Object(E.checkValidEnum)(v,"optimizationMode",["detail","motion"]),d.default.debug("Create stream"),!0===s&&!0===r&&d.default.warning("Do not set both 'screenAudio' and 'audio' to true at the same time"),t.screen&&!v&&(t.optimizationMode="detail");var R=b(t);return n(),R}},function(t,n,i){"use strict";i.d(n,"a",function(){return I}),i.d(n,"b",function(){return A});var r=i(4),o=i(7),a=i.n(o),s=i(12),c=i.n(s),d=i(17),u=i.n(d),l=i(0),f=i(15),p=i(2);function _(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"==typeof t)return g(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(t,n)}}(t))){var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function g(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,r=Array(n);i<n;i++)r[i]=t[i];return r}var h=function(t){var n={},i=f.RTCPeerConnection;n.uid=t.uid,n.isVideoMute=t.isVideoMute,n.isAudioMute=t.isAudioMute,n.isSubscriber=t.isSubscriber,n.clientId=t.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[]};var o={id:"outbound_audio_ssrc_send",type:"ssrc",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},s={id:"outbound_video_ssrc_send",type:"ssrc",mediaType:"",googCodecName:t.codec?t.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},d={id:"inbound_audio_ssrc_recv",type:"ssrc",mediaType:"",googCodecName:"opus",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},g={id:"inbound_video_ssrc_recv",type:"ssrc",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesReceived:"0",googFramesDecoded:"0"},h={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"};n.con={optional:[{DtlsSrtpKeyAgreement:!0}]},t.iceServers instanceof Array?n.pc_config.iceServers=t.iceServers:(t.stunServerUrl&&(t.stunServerUrl instanceof Array?t.stunServerUrl.map(function(t){"string"==typeof t&&""!==t&&n.pc_config.iceServers.push({url:t})}):"string"==typeof t.stunServerUrl&&""!==t.stunServerUrl&&n.pc_config.iceServers.push({url:t.stunServerUrl})),t.turnServers&&(t.turnServers instanceof Array?t.turnServers.map(function(t){t.udpport&&n.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.udpport+"?transport=udp"}),"string"==typeof t.tcpport&&""!==t.tcpport&&n.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.tcpport+"?transport=tcp"}),!0===t.forceturn&&(n.pc_config.iceTransportPolicy="relay")}):l.default.error("[".concat(n.clientId,"] turnServers is not a array")))),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),n.mediaConstraints=r.isChromeKernel()&&103>r.getChromeKernelVersion()?{mandatory:{OfferToReceiveVideo:t.video,OfferToReceiveAudio:t.audio}}:{offerToReceiveVideo:t.video,offerToReceiveAudio:t.audio},n.roapSessionId=103;try{n.pc_config.sdpSemantics=Object(p.getParameter)("PLAN"),n.peerConnection=new i(n.pc_config,n.con)}catch(m){delete n.pc_config.sdpSemantics,n.peerConnection=new i(n.pc_config,n.con);var v=n.peerConnection.getConfiguration();v.sdpSemantics&&Object(p.setParameter)("PLAN",v.sdpSemantics)}n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,l.default.debug("[".concat(n.clientId,"]Candidates collected: ").concat(n.iceCandidateCount)),n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(p.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(t){var i,r,o,a;r=(i=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=i.match(/a=candidate:.+typ\shost.+\r\n/),a=i.match(/a=candidate:.+typ\srelay.+\r\n/),(null!==r||null!==o||null!==a)&&void 0===n.ice&&n.iceCandidateTimer&&(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1};var $,E=function(t){return t=t.replace("a=x-google-flag:conference\r\n","")},S=function(i){var r,o;if((r=i.match(/m=video.*\r\n/))&&t.minVideoBW&&t.maxVideoBW){o=r[0]+"b=AS:"+t.maxVideoBW+"\r\n";var a=0,s=0;"h264"===t.codec?(a=i.search(/a=rtpmap:(\d+) H264\/90000\r\n/),s=i.search(/H264\/90000\r\n/)):"vp8"===t.codec?(a=i.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),s=i.search(/VP8\/90000\r\n/)):"vp9"===t.codec&&(a=i.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),s=i.search(/VP9\/90000\r\n/)),-1!==a&&-1!==s&&s-a>10&&(o=o+"a=fmtp:"+i.slice(a+9,s-1)+" x-google-min-bitrate="+t.minVideoBW+"\r\n"),i=(i=(i=i.replace(r[0],o)).replace("a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f","a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f")).replace("a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"),l.default.debug("["+n.clientId+"]Set Video Bitrate - min:"+t.minVideoBW+" max:"+t.maxVideoBW)}return(r=i.match(/m=audio.*\r\n/))&&t.maxAudioBW&&(o=r[0]+"b=AS:"+t.maxAudioBW+"\r\n",i=i.replace(r[0],o)),i};n.processSignalingMessage=function(i){var r,o=JSON.parse(i);n.incomingMessage=o,"new"===n.state?"OFFER"===o.messageType?(r={sdp:o.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch(function(t){}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+o.messageType+" in state "+n.state):"offer-sent"===n.state?"ANSWER"===o.messageType?((r={sdp:o.sdp,type:"answer"}).sdp=E(r.sdp),r.sdp=S(r.sdp),t.screen&&"detail"===t.optimizationMode&&(l.default.debug("[".concat(n.client,"] remove screen share abs ext")),r.sdp=r.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),t.isSubscriber&&(r.sdp=r.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch(function(t){}),n.state="established"):"pr-answer"===o.messageType?(r={sdp:o.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch(function(t){})):"offer"===o.messageType?n.error("Not written yet"):n.error("Illegal message for this state: "+o.messageType+" in state "+n.state):"established"===n.state&&("OFFER"===o.messageType?(r={sdp:o.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch(function(t){}),n.state="offer-received",n.markActionNeeded()):"ANSWER"===o.messageType?((r={sdp:o.sdp,type:"answer"}).sdp=E(r.sdp),r.sdp=S(r.sdp),n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch(function(t){})):n.error("Illegal message for this state: "+o.messageType+" in state "+n.state))},n.setRtpSenderParameters=($=u()(c.a.mark(function t(i){var r,o,a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(r=n.peerConnection.getSenders()).find(function(t){return"video"===t.track.kind})){t.next=4;break}return t.abrupt("return");case 4:return(a=o.getParameters()).degradationPreference=i,t.prev=6,l.default.debug("[".concat(n.clientId,"] setParameters"),a),t.next=10,o.setParameters(a);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),l.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return t.stop()}},t,null,[[6,12]])})),function(t){return $.apply(this,arguments)});var y=0,R=0;return n.getVideoRelatedStats=function(t){n.getStats(function(i){i.forEach(function(i){if(n.isSubscriber){if("video"===i.mediaType&&i.id&&~i.id.indexOf("recv")){if(r.isChromeKernel()&&+r.getBrowserVersion()>=76){var o=+i.googFramesReceived-y,a=+i.googFramesDecoded-R;n._setStat(g,"googFrameRateReceived",o),n._setStat(g,"googFrameRateDecoded",a),n._setStat(g,"googFrameRateOutput",a),y=+i.googFramesReceived,R=+i.googFramesDecoded}t&&t({mediaType:"video",peerId:n.uid,isVideoMute:n.isVideoMute,frameRateReceived:i.googFrameRateReceived,frameRateDecoded:i.googFrameRateDecoded,bytesReceived:i.bytesReceived,packetsReceived:i.packetsReceived,packetsLost:i.packetsLost})}}else"video"===i.mediaType&&i.id&&~i.id.indexOf("send")&&t&&t({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:i.googFrameRateInput,frameRateSent:i.googFrameRateSent,googRtt:i.googRtt})})})},n.getAudioRelatedStats=function(t){n.getStats(function(i){i.forEach(function(i){n.isSubscriber&&"audio"===i.mediaType&&i.id&&~i.id.indexOf("recv")&&t&&t({mediaType:"audio",peerId:n.uid,isAudioMute:n.isAudioMute,frameDropped:parseInt(i.googDecodingPLC)+parseInt(i.googDecodingPLCCNG)+"",frameReceived:i.googDecodingCTN,googJitterReceived:i.googJitterReceived,bytesReceived:i.bytesReceived,packetsReceived:i.packetsReceived,packetsLost:i.packetsLost})})})},n.getStatsRate=function(t){n.getStats(function(n){t(n)})},n.getStats=function(t,n){},n._setStat=function(t,n,i){t.hasOwnProperty(n)&&(null!=i&&i!==1/0&&i==i||(i=0),t[n]=i+"")},n._processGetStatsAfterChrome76=function(t){var i=this;n.lastStats||(n.lastStats=new Map),n.peerConnection.getStats().then(function(r){var c,u=[],l=[],f=new Map,p=new Date,m=_(r.values());try{for(m.s();!(c=m.n()).done;){var v=c.value;"codec"!=v.type?"candidate-pair"!=v.type?("inbound-rtp"===v.type&&"video"===v.mediaType&&f.set("inbound-video",v),"inbound-rtp"===v.type&&"audio"===v.mediaType&&f.set("inbound-audio",v),"outbound-rtp"===v.type&&"audio"===v.mediaType&&f.set("outbound-audio",v),"outbound-rtp"===v.type&&"video"===v.mediaType&&f.set("outbound-video",v),"track"===v.type&&"video"===v.kind&&v.remoteSource&&f.set("remote-video-track",v),"track"===v.type&&"audio"===v.kind&&v.remoteSource&&f.set("remote-audio-track",v),"remote-inbound-rtp"===v.type&&"video"===v.mediaType&&f.set("remote-inbound-video",v),"remote-inbound-rtp"===v.type&&"audio"===v.mediaType&&f.set("remote-inbound-audio",v),"track"!==v.type||"video"!==v.kind||v.remoteSource||f.set("local-video-track",v),"track"!==v.type||"audio"!==v.kind||v.remoteSource||f.set("local-audio-track",v),"media-source"===v.type&&"video"===v.kind&&f.set("media-source-video",v),"media-source"===v.type&&"audio"===v.kind&&f.set("media-source-audio",v)):l.push(v):u.push(v)}}catch($){m.e($)}finally{m.f()}f.set("codec",u),f.set("candidatePairs",l),f.set("timestamp",+p);var E=null,S=null;if(g.timestamp=p,d.timestamp=p,o.timestamp=p,o.timestamp=p,h.timestamp=p,i.isSubscriber)(E=f.get("inbound-video"))&&(n._setStat(g,"id","inbound_video_ssrc_recv"),n._setStat(g,"mediaType",E.mediaType),n._setStat(g,"packetsLost",E.packetsLost),n._setStat(g,"googDecodeMs",null),n._setStat(g,"googMaxDecodeMs",null),n._setStat(g,"googRenderDelayMs",null),n._setStat(g,"googMinPlayoutDelayMs",null),n._setStat(g,"googNacksSent",E.nackCount),n._setStat(g,"googPlisSent",E.pliCount),n._setStat(g,"googFirsSent",E.firCount),n._setStat(g,"bytesReceived",E.bytesReceived),n._setStat(g,"packetsReceived",E.packetsReceived)),(E=f.get("inbound-audio"))&&(n._setStat(d,"id","inbound_audio_ssrc_recv"),n._setStat(d,"mediaType",E.mediaType),n._setStat(d,"bytesReceived",E.bytesReceived),n._setStat(d,"packetsLost",E.packetsLost),n._setStat(d,"packetsReceived",E.packetsReceived),n._setStat(d,"googAccelerateRate",E.removedSamplesForAcceleration),n._setStat(d,"googCurrentDelayMs",E.jitterBufferDelay),n._setStat(d,"googDecodingCNG",null),n._setStat(d,"googDecodingCTN",null),n._setStat(d,"googDecodingCTSG",null),n._setStat(d,"googDecodingNormal",null),n._setStat(d,"googDecodingPLC",null),n._setStat(d,"googDecodingPLCCNG",null),n._setStat(d,"googJitterReceived",E.jitter),n._setStat(d,"googPreferredJitterBufferMs",null),n._setStat(d,"googSecondaryDecodedRate",null)),(E=f.get("remote-video-track"))&&(n._setStat(g,"googTargetDelayMs",E.jitterBufferDelay),n._setStat(g,"googFrameWidthReceived",E.frameWidth),n._setStat(g,"googFrameHeightReceived",E.frameHeight),n._setStat(g,"googJitterBufferMs",E.jitterBufferDelay/E.jitterBufferEmittedCount*1e3),n._setStat(g,"googCurrentDelayMs",E.jitterBufferDelay),n._setStat(g,"googFramesDecoded",E.framesDecoded),n._setStat(g,"googFramesReceived",E.framesReceived)),(E=f.get("remote-audio-track"))&&(n._setStat(d,"audioOutputLevel",32767*E.audioLevel),n._setStat(d,"googJitterBufferMs",E.jitterBufferDelay/E.jitterBufferEmittedCount*1e3),n._setStat(d,"googExpandRate",E.concealedSamples),n._setStat(d,"googPreemptiveExpandRate",E.insertedSamplesForDeceleration),n._setStat(d,"googSpeechExpandRate",E.silentConcealedSamples));else{var y=n.lastStats.get("timestamp"),R=n.lastStats.get("outbound-video");if((E=f.get("outbound-audio"))&&(n._setStat(o,"id","outbound_audio_ssrc_send"),n._setStat(o,"mediaType",E.mediaType),n._setStat(o,"aecDivergentFilterFraction",null),n._setStat(o,"bytesSent",E.bytesSent),n._setStat(o,"packetsSent",E.packetsSent),S=E.transportId),E=f.get("outbound-video")){if(n._setStat(s,"id","outbound_video_ssrc_send"),n._setStat(s,"mediaType",E.mediaType),n._setStat(s,"bytesSent",E.bytesSent),n._setStat(s,"packetsSent",E.packetsSent),n._setStat(s,"googAdaptationChanges",E.qualityLimitationDurations),n._setStat(s,"googAvgEncodeMs",null),n._setStat(s,"googEncodeUsagePercent",null),S=E.transportId,E.totalEncodedBytesTarget&&R&&R.totalEncodedBytesTarget){var T=(E.totalEncodedBytesTarget-R.totalEncodedBytesTarget)/(+new Date-y);n._setStat(h,"googTargetEncBitrate",Math.floor(8*T*1e3))}if(E.retransmittedBytesSent&&R&&R.retransmittedBytesSent){var I=(E.retransmittedBytesSent-R.retransmittedBytesSent)/(+new Date-y);n._setStat(h,"googRetransmitBitrate",Math.floor(8*I*1e3))}if(E.bytesSent&&R&&R.bytesSent){var A=(E.bytesSent-R.bytesSent)/(+new Date-y);n._setStat(h,"googTransmitBitrate",Math.floor(8*A*1e3)),n._setStat(h,"googActualEncBitrate",Math.floor(8*A*1e3))}if(E.totalPacketSendDelay&&R&&R.totalPacketSendDelay){var C=(E.totalPacketSendDelay-R.totalPacketSendDelay)/(+new Date-y);n._setStat(h,"googBucketDelay",Math.floor(1e3*C))}}if((E=f.get("remote-inbound-video"))&&(n._setStat(s,"packetsLost",E.packetsLost),n._setStat(s,"googRtt",E.roundTripTime)),(E=f.get("local-video-track"))&&(n._setStat(s,"googFrameHeightSent",E.frameHeight),n._setStat(s,"googFrameWidthSent",E.frameWidth),void 0!==E.framesPerSecond&&n._setStat(s,"googFrameRateSent",E.framesPerSecond)),(E=f.get("local-audio-track"))&&(n._setStat(o,"googEchoCancellationReturnLoss",E.echoReturnLoss),n._setStat(o,"googEchoCancellationReturnLossEnhancement",E.echoReturnLossEnhancement)),(E=f.get("media-source-video"))&&(n._setStat(s,"googFrameHeightInput",E.height),n._setStat(s,"googFrameWidthInput",E.width),n._setStat(s,"googFrameRateInput",E.framesPerSecond)),(E=f.get("media-source-audio"))&&n._setStat(o,"audioInputLevel",32767*E.totalAudioEnergy),(E=f.get("inbound-video"))&&(n._setStat(s,"googFirsReceived",E.firCount),n._setStat(s,"googNacksReceived",E.nackCount),n._setStat(s,"googPlisReceived",E.pliCount)),S)f.get("candidatePairs").map(function(t){S==t.transportId&&n._setStat(h,"googAvailableSendBandwidth",t.availableOutgoingBitrate)});else{var b=f.get("candidatePairs")[0];b&&n._setStat(h,"googAvailableSendBandwidth",b.availableOutgoingBitrate)}}n.lastStats=f;var N=[a()({},s),a()({},o),a()({},g),a()({},d),a()({},h)];N.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),t(N)})},n._processGetStatsBeforeChrome76=function(t){n.peerConnection.getStats(function(i){var r=[],c=[],u=null;Object.keys(i).forEach(function(t){var n=i[t];n&&(c.push(n),u=n.timestamp,"VideoBwe"===n.type?h=n:n.id.indexOf("_send")>-1&&"video"===n.mediaType?s=n:n.id.indexOf("_send")>-1&&"audio"===n.mediaType?o=n:n.id.indexOf("_recv")>-1&&"video"===n.mediaType?g=n:n.id.indexOf("_recv")>-1&&"audio"===n.mediaType&&(d=n))}),(r=[a()({},s),a()({},o),a()({},g),a()({},d),a()({},h)]).push({id:"time",startTime:n.connectedTime,timestamp:u||new Date}),t(r,c)})},n._getStats=function(t){Object(p.getParameter)("CHROME_NEW_STATS")&&r.isChromeKernel()&&+r.getBrowserVersion()>=76?n._processGetStatsAfterChrome76(t):n._processGetStatsBeforeChrome76(t)},n.addTrack=function(t,i){if("unified-plan"===Object(p.getParameter)("PLAN")){var r="audio"===t.kind?n._audioSender:n._videoSender;if(r){var o=n.peerConnection.getTransceivers().find(function(t){return t.sender===r});r.replaceTrack(t).then(function(){o.direction="sendrecv",n.renegotiate()})}else r=n.peerConnection.addTrack(t,i),"audio"===t.kind?n._audioSender=r:n._videoSender=r}else n.peerConnection.addTrack(t,i)},n.removeTrack=function(t,i){if("unified-plan"===Object(p.getParameter)("PLAN")){var r=n.peerConnection.getTransceivers().find(function(n){return n.sender.track===t});r&&(r.direction="inactive",n.peerConnection.removeTrack(r.sender))}else n.peerConnection.removeTrack(n.peerConnection.getSenders().find(function(n){return n.track==t}))},n.addStream=function(t){"unified-plan"===Object(p.getParameter)("PLAN")?t.getTracks().forEach(function(i){var r=n.peerConnection.addTrack(i,t);"audio"===i.kind?n._audioSender=r:n._videoSender=r}):(n.peerConnection.addStream(t),n.markActionNeeded())},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(t){window.setTimeout(t,1)},n.onstablestate=function(){var i;if(n.actionNeeded){if("new"===n.state||"established"===n.state)n.peerConnection.createOffer(n.mediaConstraints).then(function(i){return i?i.sdp!==n.prevOffer?(t.isSubscriber&&(i.sdp=i.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),n.peerConnection.setLocalDescription(i),n.state="preparing-offer",void n.markActionNeeded()):void l.default.debug("["+n.clientId+"]Not sending a new offer"):(l.default.debug("["+n.clientId+"]sessionDescription is null"),void n.onsignalingmessage(null))}).catch(function(t){l.default.debug("["+n.clientId+"]peer connection create offer failed ",t)});else if("preparing-offer"===n.state){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(t.isCloudProxy3&&t.onNoIceCandidate&&t.onNoIceCandidate(),l.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),Object(p.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),n.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if("offer-received"===n.state)n.peerConnection.createAnswer(function(t){if(n.peerConnection.setLocalDescription(t),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var i=new Date;l.default.debug("["+n.clientId+"]"+i.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(t){l.default.debug("["+n.clientId+"]peer connection create answer failed ",t)},n.mediaConstraints);else if("offer-received-preparing-answer"===n.state){if(n.moreIceComing)return;i=n.peerConnection.localDescription.sdp,n.sendMessage("ANSWER",i),n.state="established"}else l.default.debug("[".concat(n.clientId,"] Dazed and confused in state ").concat(n.state,", stopping here'"));n.actionNeeded=!1}},n.sendMessage=function(t,i){var r={};r.messageType=t,r.sdp=i,"OFFER"===t?(r.offererSessionId=n.sessionId,r.answererSessionId=n.otherSessionId,r.seq=n.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=n.incomingMessage.offererSessionId,r.answererSessionId=n.sessionId,r.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(r))},n._getSender=function(t){if(n.peerConnection&&n.peerConnection.getSenders){var i=n.peerConnection.getSenders().find(function(n){return n.track.kind==t});if(i)return i}return null},n.hasSender=function(t){return!!n._getSender(t)},n.replaceTrack=function(t,i,r){var o=n._getSender(t.kind);if(!o)return r("NO_SENDER_FOUND");try{o.replaceTrack(t)}catch(a){return r&&r(a)}setTimeout(function(){return i&&i()},50)},n.error=function(t){throw"Error in RoapOnJsep: "+t},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=t.callback,n.peerConnection.ontrack=function(t){n.onaddstream&&(n.onaddstream(t,"ontrack"),n.peerConnection.onaddstream=null)},n.peerConnection.onaddstream=function(t){n.onaddstream&&(n.onaddstream(t,"onaddstream"),n.peerConnection.ontrack=null)},n.peerConnection.onremovestream=function(t){n.onremovestream&&n.onremovestream(t)},n.peerConnection.oniceconnectionstatechange=function(t){l.default.debug(n.peerConnection.iceConnectionState),"connected"===t.currentTarget.iceConnectionState&&(n.connectedTime=new Date),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},n.renegotiate=function(){void 0!==n.prevOffer&&n.peerConnection.createOffer().then(function(t){return"unified-plan"!==Object(p.getParameter)("PLAN")&&(t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")),t.sdp=E(t.sdp),t.sdp=S(t.sdp),n.peerConnection.setLocalDescription(t)}).then(function(){n.onnegotiationneeded&&n.onnegotiationneeded(n.peerConnection.localDescription.sdp)}).catch(function(t){l.default.error("createOffer error: ",t.message||t)})},n.peerConnection.onnegotiationneeded=n.renegotiate,n.onaddstream=null,n.onremovestream=null,n.onnegotiationneeded=null,n.state="new",n.markActionNeeded(),n},m=function(t){var n={},i=f.RTCPeerConnection;n.uid=t.uid,n.isVideoMute=t.isVideoMute,n.isAudioMute=t.isAudioMute,n.isSubscriber=t.isSubscriber,n.clientId=t.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[],bundlePolicy:"max-bundle"},n.con={optional:[{DtlsSrtpKeyAgreement:!0}]},t.iceServers instanceof Array?n.pc_config.iceServers=t.iceServers:(t.stunServerUrl&&(t.stunServerUrl instanceof Array?t.stunServerUrl.map(function(t){"string"==typeof t&&""!==t&&n.pc_config.iceServers.push({url:t})}):"string"==typeof t.stunServerUrl&&""!==t.stunServerUrl&&n.pc_config.iceServers.push({url:t.stunServerUrl})),t.turnServers&&(t.turnServers instanceof Array?t.turnServers.map(function(t){t.udpport&&n.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.udpport+"?transport=udp"}),"string"==typeof t.tcpport&&""!==t.tcpport&&n.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.tcpport+"?transport=tcp"}),!0===t.forceturn&&(n.pc_config.iceTransportPolicy="relay")}):l.default.error("[".concat(n.clientId,"] turnServers is not a array")))),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),n.mediaConstraints={mandatory:{OfferToReceiveVideo:t.video,OfferToReceiveAudio:t.audio}},n.roapSessionId=103;try{n.pc_config.sdpSemantics=Object(p.getParameter)("PLAN"),n.peerConnection=new i(n.pc_config,n.con)}catch(r){delete n.pc_config.sdpSemantics,n.peerConnection=new i(n.pc_config,n.con)}n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(p.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(t){var i,r,o,a;r=(i=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=i.match(/a=candidate:.+typ\shost.+\r\n/),a=i.match(/a=candidate:.+typ\srelay.+\r\n/),0===n.iceCandidateCount&&(n.timeout=setTimeout(function(){n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},1e3)),(null!==r||null!==o||null!==a)&&void 0===n.ice&&n.iceCandidateTimer&&(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1};var o,a,s=function(n){return t.screen&&(n=n.replace("a=x-google-flag:conference\r\n","")),n},d=function(i){var r,o;return(r=i.match(/m=video.*\r\n/))&&t.minVideoBW&&t.maxVideoBW&&(o=r[0]+"b=AS:"+t.maxVideoBW+"\r\n",i=i.replace(r[0],o),l.default.debug("["+n.clientId+"]Set Video Bitrate - min:"+t.minVideoBW+" max:"+t.maxVideoBW)),(r=i.match(/m=audio.*\r\n/))&&t.maxAudioBW&&(o=r[0]+"b=AS:"+t.maxAudioBW+"\r\n",i=i.replace(r[0],o)),i};n.processSignalingMessage=function(i){var r,o=JSON.parse(i);n.incomingMessage=o,"new"===n.state?"OFFER"===o.messageType?(r={sdp:o.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+o.messageType+" in state "+n.state):"offer-sent"===n.state?"ANSWER"===o.messageType?((r={sdp:o.sdp,type:"answer"}).sdp=s(r.sdp),r.sdp=d(r.sdp),r.sdp=r.sdp.replace(/a=x-google-flag:conference\r\n/g,""),t.screen&&"detail"===t.optimizationMode&&(l.default.debug("[".concat(n.client,"] remove screen share abs ext")),r.sdp=r.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),n.state="established"):"pr-answer"===o.messageType?(r={sdp:o.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(r))):"offer"===o.messageType?n.error("Not written yet"):n.error("Illegal message for this state: "+o.messageType+" in state "+n.state):"established"===n.state&&("OFFER"===o.messageType?(r={sdp:o.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),n.state="offer-received",n.markActionNeeded()):"ANSWER"===o.messageType?((r={sdp:o.sdp,type:"answer"}).sdp=s(r.sdp),r.sdp=d(r.sdp),n.peerConnection.setRemoteDescription(new RTCSessionDescription(r))):n.error("Illegal message for this state: "+o.messageType+" in state "+n.state))},n.setRtpSenderParameters=(o=u()(c.a.mark(function t(i){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.degradation=i;case 1:case"end":return t.stop()}},t)})),function(t){return o.apply(this,arguments)}),n._setRtpSenderParameters=(a=u()(c.a.mark(function t(i){var r,o,a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(r=n.peerConnection.getSenders()).find(function(t){return t&&t.track&&"video"===t.track.kind})){t.next=4;break}return t.abrupt("return");case 4:return(a=o.getParameters()).degradationPreference=i,t.prev=6,l.default.debug("[".concat(n.clientId,"] setParameters"),a),t.next=10,o.setParameters(a);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),l.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return t.stop()}},t,null,[[6,12]])})),function(t){return a.apply(this,arguments)});var _={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},g={id:"",type:"",mediaType:"",googCodecName:t.codec?t.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},h={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},m={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},v={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},$=0,E=0,S=0;return n.isRemoteVideoStats=function(t){return!!(t.frameHeight&&t.frameWidth&&t.remoteSource)},n.getVideoRelatedStats=function(i){n.peerConnection.getStats().then(function(r){r.forEach(function(r){if(n.isSubscriber){var o={peerId:n.uid,mediaType:"video",isVideoMute:n.isVideoMute};if("track"===r.type&&(~r.id.indexOf("video")||~r.trackIdentifier.indexOf("v")||n.isRemoteVideoStats(r))){if(!n.lastReport)return void(n.lastReport=r);o.frameRateReceived=r.framesReceived-n.lastReport.framesReceived+"",o.frameRateDecoded=r.framesDecoded-n.lastReport.framesDecoded+"",n.lastReport=r}"inbound-rtp"===r.type&&~r.id.indexOf("Video")&&(o.bytesReceived=r.bytesReceived+"",o.packetsReceived=r.packetsReceived+"",o.packetsLost=r.packetsLost+""),i&&i(o)}else if("outbound-rtp"===r.type&&~r.id.indexOf("Video")){if(!n.lastReport)return void(n.lastReport=r);i&&i({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:t.maxFrameRate+"",frameRateSent:r.framesEncoded-n.lastReport.framesEncoded+""}),n.lastReport=r}})})},n.getAudioRelatedStats=function(t){n.peerConnection.getStats().then(function(i){i.forEach(function(i){n.isSubscriber&&"inbound-rtp"===i.type&&~i.id.indexOf("Audio")&&t&&t({peerId:n.uid,mediaType:"audio",isAudioMute:n.isAudioMute,frameDropped:i.packetsLost+"",frameReceived:i.packetsReceived+"",googJitterReceived:i.jitter+"",bytesReceived:i.bytesReceived+"",packetsReceived:i.packetsReceived+"",packetsLost:i.packetsLost+""})})})},n.getStatsRate=function(t){n.getStats(function(n){n.forEach(function(t){"outbound-rtp"===t.type&&"video"===t.mediaType&&t.googFramesEncoded&&(t.googFrameRateSent=Math.ceil((t.googFramesEncoded-$)/3).toString(),$=t.googFramesEncoded),"inbound-rtp"===t.type&&-1!=t.id.indexOf("55543")&&(t.googFrameRateReceived&&(t.googFrameRateReceived=Math.ceil((t.googFrameReceived-S)/3).toString(),S=t.googFrameReceived),t.googFrameRateDecoded&&(t.googFrameRateDecoded=Math.ceil((t.googFramesDecoded-E)/3).toString(),E=t.googFramesDecoded))}),t(n)})},n.getStats=function(t,i){i=(i=i||500)>500?500:i,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<i?t&&t(n.filterStatsCache,n.originStatsCache):this._getStats(function(i,r){n.filterStatsCache=i,n.originStatsCache=r,n.lastTimeGetStats=Date.now(),t&&t(i,r)})},n._getStats=function(i){var r=[];n.peerConnection.getStats().then(function(o){o.forEach(function(n){var i;r.push(n),"outbound-rtp"===n.type&&"audio"===n.mediaType&&(_.id=n.id,_.type=n.type,_.mediaType=n.mediaType,_.bytesSent=n.bytesSent?n.bytesSent+"":"0",_.packetsSent=n.packetsSent?n.packetsSent+"":"0",t.agoraStream.local&&(_.audioInputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"outbound-rtp"===n.type&&"video"===n.mediaType&&(g.id=n.id,g.type=n.type,g.mediaType=n.mediaType,g.bytesSent=n.bytesSent?n.bytesSent+"":"0",g.packetsSent=n.packetsSent?n.packetsSent+"":"0",g.googPlisReceived=n.pliCount?n.pliCount+"":"0",g.googNacksReceived=n.nackCount?n.nackCount+"":"0",g.googFirsReceived=n.firCount?n.firCount+"":"0",g.googFramesEncoded=n.framesEncoded?n.framesEncoded+"":"0",(i=o.get(n.trackId))&&(g.googFrameHeightSent=i.frameHeight&&i.frameHeight.toString(),g.googFrameWidthSent=i.frameWidth&&i.frameWidth.toString())),"inbound-rtp"!==n.type||-1==n.id.indexOf("44444")&&"audio"!==n.mediaType||(h.id=n.id,h.type=n.type,h.mediaType="audio",h.packetsReceived=n.packetsReceived?n.packetsReceived+"":"0",h.bytesReceived=n.bytesReceived?n.bytesReceived+"":"0",h.packetsLost=n.packetsLost?n.packetsLost+"":"0",h.packetsReceived=n.packetsReceived?n.packetsReceived+"":"0",h.googJitterReceived=n.jitter?n.jitter+"":"0",(i=o.get(n.trackId))&&(h.audioOutputLevel=i.audioLevel&&Math.round(32767*i.audioLevel).toString()),t.agoraStream.local||h.audioOutputLevel||(h.audioOutputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==n.type||-1==n.id.indexOf("55543")&&"video"!==n.mediaType||(m.id=n.id,m.type=n.type,m.mediaType="video",m.packetsReceived=n.packetsReceived?n.packetsReceived+"":"0",m.bytesReceived=n.bytesReceived?n.bytesReceived+"":"0",m.packetsLost=n.packetsLost?n.packetsLost+"":"0",m.googJitterBufferMs=n.jitter?n.jitter+"":"0",m.googNacksSent=n.nackCount?n.nackCount+"":"0",m.googPlisSent=n.pliCount?n.pliCount+"":"0",m.googFirsSent=n.firCount?n.firCount+"":"0",(i=o.get(n.trackId))&&(m.googFrameHeightReceived=i.frameHeight&&i.frameHeight.toString(),m.googFrameWidthReceived=i.frameWidth&&i.frameWidth.toString(),m.googFrameReceived=i.framesReceived&&i.framesReceived.toString(),m.googFramesDecoded=i.framesDecoded&&i.framesDecoded.toString())),"candidate-pair"===n.type&&(0==n.availableIncomingBitrate?v.googAvailableSendBandwidth=n.availableOutgoingBitrate+"":v.googAvailableReceiveBandwidth=n.availableIncomingBitrate+"")});var a=[v,_,g,h,m];a.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),i(a,r)}).catch(function(t){l.default.error("["+n.clientId+"] ",t)})},n.addTrack=function(t,i){n.peerConnection.addTrack(t,i)},n.removeTrack=function(t,i){var r=n.peerConnection.getSenders().find(function(n){return n.track==t});r.replaceTrack(null),n.peerConnection.removeTrack(r)},n.addStream=function(t){window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?t.getTracks().forEach(function(i){return n.peerConnection.addTrack(i,t)}):n.peerConnection.addStream(t),n.markActionNeeded()},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(t){window.setTimeout(t,1)},n.onstablestate=function(){var i;if(n.actionNeeded){if("new"===n.state||"established"===n.state)t.isSubscriber&&(n.peerConnection.addTransceiver("audio",{direction:"recvonly"}),n.peerConnection.addTransceiver("video",{direction:"recvonly"})),n.peerConnection.createOffer(n.mediaConstraints).then(function(i){if(i.sdp=d(i.sdp),t.isSubscriber||(i.sdp=i.sdp.replace(/a=.*video-orientation\r\n/g,"")),i.sdp!==n.prevOffer)return n.peerConnection.setLocalDescription(i),n.state="preparing-offer",void n.markActionNeeded();l.default.debug("["+n.clientId+"]Not sending a new offer")}).catch(function(t){l.default.debug("["+n.clientId+"]peer connection create offer failed ",t)});else if("preparing-offer"===n.state){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(l.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),t.isCloudProxy3&&t.onNoIceCandidate&&t.onNoIceCandidate(),Object(p.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),n.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if("offer-received"===n.state)n.peerConnection.createAnswer(function(t){if(n.peerConnection.setLocalDescription(t),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var i=new Date;l.default.debug("["+n.clientId+"]"+i.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(t){l.default.debug("["+n.clientId+"]peer connection create answer failed ",t)},n.mediaConstraints);else if("offer-received-preparing-answer"===n.state){if(n.moreIceComing)return;i=n.peerConnection.localDescription.sdp,n.sendMessage("ANSWER",i),n.state="established"}else n.debug("Dazed and confused in state "+n.state+", stopping here");n.actionNeeded=!1}},n.sendMessage=function(t,i){var r={};r.messageType=t,r.sdp=i,"OFFER"===t?(r.offererSessionId=n.sessionId,r.answererSessionId=n.otherSessionId,r.seq=n.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=n.incomingMessage.offererSessionId,r.answererSessionId=n.sessionId,r.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(r))},n._getSender=function(t){if(n.peerConnection&&n.peerConnection.getSenders){var i=n.peerConnection.getSenders().find(function(n){return n.track.kind==t});if(i)return i}return null},n.hasSender=function(t){return!!n._getSender(t)},n.replaceTrack=function(t,i,r){var o=n._getSender(t.kind);if(!o)return r("NO_SENDER_FOUND");try{o.replaceTrack(t)}catch(a){return r&&r(a)}setTimeout(function(){return i&&i()},50)},n.error=function(t){throw"Error in RoapOnJsep: "+t},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=t.callback,n.peerConnection.ontrack=function(t){n.onaddstream&&n.onaddstream(t,"ontrack")},n.peerConnection.onremovestream=function(t){n.onremovestream&&n.onremovestream(t)},n.peerConnection.oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(n.connectedTime=new Date,n._setRtpSenderParameters(n.degradation)),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},n.renegotiate=function(){n.isSubscriber||(l.default.debug("[".concat(n.uid,"]"),"renegotiating"),void 0!==n.prevOffer&&n.peerConnection.createOffer().then(function(t){return t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),t.sdp=s(t.sdp),t.sdp=d(t.sdp),n.peerConnection.setLocalDescription(t)}).then(function(){n.onnegotiationneeded&&n.onnegotiationneeded(n.peerConnection.localDescription.sdp)}).catch(function(t){l.default.error("createOffer error: ",t)}))},n.isSubscriber||(n.peerConnection.onnegotiationneeded=n.renegotiate),n.onaddstream=null,n.onremovestream=null,n.state="new",n.markActionNeeded(),n};function v(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"==typeof t)return $(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(t,n)}}(t))){var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function $(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,r=Array(n);i<n;i++)r[i]=t[i];return r}var E=function(t){var n,i={},r=(mozRTCPeerConnection,mozRTCSessionDescription),o=!1;i.uid=t.uid,i.isVideoMute=t.isVideoMute,i.isAudioMute=t.isAudioMute,i.isSubscriber=t.isSubscriber,i.clientId=t.clientId,i.filterStatsCache=[],i.originStatsCache=[],i.lastTimeGetStats=null,i.pc_config={iceServers:[]},t.iceServers instanceof Array?t.iceServers.map(function(t){0===t.url.indexOf("stun:")&&i.pc_config.iceServers.push({url:t.url})}):(t.stunServerUrl&&(t.stunServerUrl instanceof Array?t.stunServerUrl.map(function(t){"string"==typeof t&&""!==t&&i.pc_config.iceServers.push({url:t})}):"string"==typeof t.stunServerUrl&&""!==t.stunServerUrl&&i.pc_config.iceServers.push({url:t.stunServerUrl})),t.turnServers&&(t.turnServers instanceof Array?t.turnServers.map(function(t){t.udpport&&i.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.udpport+"?transport=udp"}),"string"==typeof t.tcpport&&""!==t.tcpport&&i.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.tcpport+"?transport=tcp"}),!0===t.forceturn&&(i.pc_config.iceTransportPolicy="relay")}):l.default.error("[".concat(i.clientId,"] turnServers is not a array")))),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),i.mediaConstraints={offerToReceiveAudio:t.audio,offerToReceiveVideo:t.video,mozDontOfferDataChannel:!0},i.roapSessionId=103,i.peerConnection=new f.RTCPeerConnection(i.pc_config),i.iceCandidateTimer=setTimeout(function(){i.iceCandidateTimer=null,l.default.debug("[".concat(i.clientId,"]Candidates collected: ").concat(i.iceCandidateCount)),i.moreIceComing&&(i.moreIceComing=!1,i.markActionNeeded())},Object(p.getParameter)("CANDIDATE_TIMEOUT")),i.peerConnection.onicecandidate=function(t){var n,r,o,a;r=(n=i.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),(null!==r||null!==o||null!==a)&&void 0===i.ice&&i.iceCandidateTimer&&(clearTimeout(i.iceCandidateTimer),i.iceCandidateTimer=null,i.ice=0,i.moreIceComing=!1,i.markActionNeeded()),i.iceCandidateCount=i.iceCandidateCount+1},i.checkMLineReverseInSDP=function(t){return!(!~t.indexOf("m=audio")||!~t.indexOf("m=video"))&&t.indexOf("m=audio")>t.indexOf("m=video")},i.reverseMLineInSDP=function(t){var n=t.split("m=audio"),i=n[1].split("m=video"),r="m=video"+i[1],o="m=audio"+i[0];return t=n[0]+r+o},i.processSignalingMessage=function(n){var o,a=JSON.parse(n);i.incomingMessage=a,"new"===i.state?"OFFER"===a.messageType?(a.sdp=$(a.sdp),o={sdp:a.sdp,type:"offer"},i.peerConnection.setRemoteDescription(new r(o),function(){l.default.debug("["+i.clientId+"]setRemoteDescription succeeded")},function(t){l.default.info("["+i.clientId+"]setRemoteDescription failed: "+t.name)}),i.state="offer-received",i.markActionNeeded()):i.error("Illegal message for this state: "+a.messageType+" in state "+i.state):"offer-sent"===i.state?"ANSWER"===a.messageType?(a.sdp=$(a.sdp),a.sdp=a.sdp.replace(/ generation 0/g,""),a.sdp=a.sdp.replace(/ udp /g," UDP "),-1!==a.sdp.indexOf("a=group:BUNDLE")?(a.sdp=a.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),a.sdp=a.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),a.sdp=a.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(a.sdp=a.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),a.sdp=a.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),o={sdp:a.sdp,type:"answer"},t.screen&&"detail"===t.optimizationMode&&(l.default.debug("[".concat(i.client,"] remove screen share abs ext")),a.sdp=E(o.sdp)),i.peerConnection.setRemoteDescription(new r(o),function(){l.default.debug("["+i.clientId+"]setRemoteDescription succeeded")},function(t){l.default.info("["+i.clientId+"]setRemoteDescription failed: "+t)}),i.state="established"):"pr-answer"===a.messageType?(o={sdp:a.sdp,type:"pr-answer"},i.peerConnection.setRemoteDescription(new r(o),function(){l.default.debug("["+i.clientId+"]setRemoteDescription succeeded")},function(t){l.default.info("["+i.clientId+"]setRemoteDescription failed: "+t.name)})):"offer"===a.messageType?i.error("Not written yet"):i.error("Illegal message for this state: "+a.messageType+" in state "+i.state):"established"===i.state&&("OFFER"===a.messageType?(o={sdp:a.sdp,type:"offer"},i.peerConnection.setRemoteDescription(new r(o),function(){l.default.debug("["+i.clientId+"]setRemoteDescription succeeded")},function(t){l.default.info("["+i.clientId+"]setRemoteDescription failed: "+t.name)}),i.state="offer-received",i.markActionNeeded()):i.error("Illegal message for this state: "+a.messageType+" in state "+i.state))},i.setRtpSenderParameters=(n=u()(c.a.mark(function t(n){var r,o,a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(r=i.peerConnection.getSenders()).find(function(t){return"video"===t.track.kind})){t.next=4;break}return t.abrupt("return");case 4:return(a=o.getParameters()).degradationPreference=n,t.prev=6,l.default.debug("[".concat(i.clientId,"] setParameters"),a),t.next=10,o.setParameters(a);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),l.default.debug("[".concat(i.clientId,"] setParameters failed, ignore"));case 15:case"end":return t.stop()}},t,null,[[6,12]])})),function(t){return n.apply(this,arguments)});var a={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},s={id:"",type:"",mediaType:"",googCodecName:t.codec?t.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},d={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},_={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},g=0,h=0,m=0;i.getVideoRelatedStats=function(t){i.peerConnection.getStats().then(function(n){var r,o=v(n.values());try{for(o.s();!(r=o.n()).done;){var a=r.value;if(i.isSubscriber){if(("inbound-rtp"===a.type||"inboundrtp"===a.type)&&"video"===a.mediaType){if(!i.lastReport)return void(i.lastReport=a);t&&t({browser:"firefox",mediaType:"video",peerId:i.uid,isVideoMute:i.isVideoMute,frameRateReceived:Math.round(a.framerateMean)+"",frameRateDecoded:a.framesDecoded-i.lastReport.framesDecoded+"",bytesReceived:a.bytesReceived+"",packetsReceived:a.packetsReceived+"",packetsLost:a.packetsLost+""}),i.lastReport=a}}else if(("outbound-rtp"===a.type||"outboundrtp"===a.type)&&"video"===a.mediaType){if(!i.lastReport)return void(i.lastReport=a);t&&t({mediaType:"video",isVideoMute:i.isVideoMute,frameRateInput:Math.round(a.framerateMean)+"",frameRateSent:a.framesEncoded-i.lastReport.framesEncoded+""}),i.lastReport=a}}}catch(s){o.e(s)}finally{o.f()}})},i.getAudioRelatedStats=function(t){i.peerConnection.getStats().then(function(n){var r,o=v(n.values());try{for(o.s();!(r=o.n()).done;){var a=r.value;i.isSubscriber&&("inbound-rtp"!==a.type&&"inboundrtp"!==a.type||"audio"!==a.mediaType||t&&t({browser:"firefox",mediaType:"audio",peerId:i.uid,isAudioMute:i.isAudioMute,frameDropped:a.packetsLost+"",frameReceived:a.packetsReceived+"",googJitterReceived:a.jitter+"",bytesReceived:a.bytesReceived+"",packetsReceived:a.packetsReceived+"",packetsLost:a.packetsLost+""}))}}catch(s){o.e(s)}finally{o.f()}})},i.getStatsRate=function(t){i.getStats(function(n){n.forEach(function(t){}),t(n)})},i.getStats=function(t,n){n=(n=n||500)>500?500:n,i.lastTimeGetStats&&Date.now()-i.lastTimeGetStats<n?t&&t(i.filterStatsCache,i.originStatsCache):this._getStats(function(n,r){i.filterStatsCache=n,i.originStatsCache=r,i.lastTimeGetStats=Date.now(),t&&t(n,r)})},i._getStats=function(n){i.peerConnection.getStats().then(function(r){var o,c=[],u=v(r.values());try{for(u.s();!(o=u.n()).done;){var l=o.value;c.push(l),"outbound-rtp"!==l.type&&"outboundrtp"!==l.type||"video"!==l.mediaType||-1!==l.id.indexOf("rtcp")||(s.id=l.id,s.type=l.type,s.mediaType=l.mediaType,s.bytesSent=l.bytesSent?l.bytesSent+"":"0",s.packetsSent=l.packetsSent?l.packetsSent+"":"0",s.googPlisReceived=l.pliCount?l.pliCount+"":"0",s.googNacksReceived=l.nackCount?l.nackCount+"":"0",s.googFirsReceived=l.firCount?l.firCount+"":"0",s.googFrameRateSent=l.framerateMean?Math.round(l.framerateMean)+"":"0"),"outbound-rtp"!==l.type&&"outboundrtp"!==l.type||"audio"!==l.mediaType||-1!==l.id.indexOf("rtcp")||(a.id=l.id,a.type=l.type,a.mediaType=l.mediaType,a.bytesSent=l.bytesSent?l.bytesSent+"":"0",a.packetsSent=l.packetsSent?l.packetsSent+"":"0",t.agoraStream.local&&(a.audioInputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==l.type&&"inboundrtp"!==l.type||"audio"!==l.mediaType||l.isRemote||-1!==l.id.indexOf("rtcp")||(d.id=l.id,d.type=l.type,d.mediaType=l.mediaType,d.bytesReceived=l.bytesReceived?l.bytesReceived+"":"0",d.packetsLost=l.packetsLost?l.packetsLost+"":"0",d.packetsReceived=l.packetsReceived?l.packetsReceived+"":"0",d.googJitterReceived=l.jitter?l.jitter+"":"0",t.agoraStream.local||(d.audioOutputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==l.type&&"inboundrtp"!==l.type||"video"!==l.mediaType||l.isRemote||-1!==l.id.indexOf("rtcp")||(_.id=l.id,_.type=l.type,_.mediaType=l.mediaType,_.bytesReceived=l.bytesReceived?l.bytesReceived+"":"0",_.googFrameRateReceived=l.framerateMean?Math.round(l.framerateMean)+"":"0",_.googFramesDecoded=l.framesDecoded?l.framesDecoded+"":"0",Date.now()-m>=1e3?(_.googFrameRateDecoded=(l.framesDecoded-g)/((Date.now()-m)/1e3),_.googFrameRateDecoded=Math.round(Math.max(0,_.googFrameRateDecoded)),m=Date.now(),h=_.googFrameRateDecoded,g=l.framesDecoded,_.googFrameRateDecoded=_.googFrameRateDecoded.toString()):_.googFrameRateDecoded=h.toString(),_.packetsLost=l.packetsLost?l.packetsLost+"":"0",_.packetsReceived=l.packetsReceived?l.packetsReceived+"":"0",_.googJitterBufferMs=l.jitter?l.jitter+"":"0",_.googNacksSent=l.nackCount?l.nackCount+"":"0",_.googPlisSent=l.pliCount?l.pliCount+"":"0",_.googFirsSent=l.firCount?l.firCount+"":"0"),-1!==l.id.indexOf("outbound_rtcp_video")&&(s.packetsLost=l.packetsLost?l.packetsLost+"":"0")}}catch(f){u.e(f)}finally{u.f()}var p=[s,a,d,_];p.push({id:"time",startTime:i.connectedTime,timestamp:new Date}),n(p,c)},function(t){l.default.error("["+i.clientId+"]"+t)})},i.addStream=function(t){o=!0,i.peerConnection.addStream(t),i.markActionNeeded()},i.removeStream=function(){i.markActionNeeded()},i.close=function(){i.state="closed",i.peerConnection.close()},i.markActionNeeded=function(){i.actionNeeded=!0,i.doLater(function(){i.onstablestate()})},i.doLater=function(t){window.setTimeout(t,1)},i.onstablestate=function(){if(i.actionNeeded){if("new"===i.state||"established"===i.state)o&&(i.mediaConstraints=void 0),i.peerConnection.createOffer(function(t){if(t.sdp=$(t.sdp),t.sdp=t.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),t.sdp!==i.prevOffer)return i.peerConnection.setLocalDescription(t),i.state="preparing-offer",void i.markActionNeeded();l.default.debug("["+i.clientId+"]Not sending a new offer")},function(t){l.default.debug("["+i.clientId+"]Ups! create offer failed ",t)},i.mediaConstraints);else if("preparing-offer"===i.state){if(i.moreIceComing)return;i.prevOffer=i.peerConnection.localDescription.sdp,i.offerCandidates=i.prevOffer.match(/a=candidate.+\r\n/g)||[],i.offerCandidates.length||(t.isCloudProxy3&&t.onNoIceCandidate&&t.onNoIceCandidate(),l.default.warning("[".concat(i.clientId,"]No Ice Candidate generated")),Object(p.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),i.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(i.clientId,"]None Ice Candidate not allowed"))),i.prevOffer=i.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),i.sendMessage("OFFER",i.prevOffer),i.state="offer-sent"}else if("offer-received"===i.state)i.peerConnection.createAnswer(function(t){if(i.peerConnection.setLocalDescription(t),i.state="offer-received-preparing-answer",i.iceStarted)i.markActionNeeded();else{var n=new Date;l.default.debug("["+i.clientId+"]"+n.getTime()+": Starting ICE in responder"),i.iceStarted=!0}},function(){l.default.debug("["+i.clientId+"]Ups! Something went wrong")});else if("offer-received-preparing-answer"===i.state){if(i.moreIceComing)return;var n=i.peerConnection.localDescription.sdp;i.sendMessage("ANSWER",n),i.state="established"}else i.debug("Dazed and confused in state "+i.state+", stopping here");i.actionNeeded=!1}},i.sendMessage=function(t,n){var r={};r.messageType=t,r.sdp=n,"OFFER"===t?(r.offererSessionId=i.sessionId,r.answererSessionId=i.otherSessionId,r.seq=i.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=i.incomingMessage.offererSessionId,r.answererSessionId=i.sessionId,r.seq=i.incomingMessage.seq),i.onsignalingmessage(JSON.stringify(r))},i._getSender=function(t){if(i.peerConnection&&i.peerConnection.getSenders){var n=i.peerConnection.getSenders().find(function(n){return n.track.kind==t});if(n)return n}return null},i.hasSender=function(t){return!!i._getSender(t)},i.replaceTrack=function(t,n,r){var o=i._getSender(t.kind);if(!o)return r("NO_SENDER_FOUND");try{o.replaceTrack(t)}catch(a){return r&&r(a)}setTimeout(function(){return n&&n()},50)},i.error=function(t){throw"Error in RoapOnJsep: "+t},i.sessionId=i.roapSessionId+=1,i.sequenceNumber=0,i.actionNeeded=!1,i.iceStarted=!1,i.moreIceComing=!0,i.iceCandidateCount=0,i.onsignalingmessage=t.callback,i.peerConnection.ontrack=function(t){i.onaddstream&&i.onaddstream(t,"ontrack")},i.peerConnection.onremovestream=function(t){i.onremovestream&&i.onremovestream(t)},i.peerConnection.oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(i.connectedTime=new Date),i.oniceconnectionstatechange&&i.oniceconnectionstatechange(t.currentTarget.iceConnectionState)};var $=function(n){var i;if(t.video&&t.maxVideoBW&&(null==(i=n.match(/m=video.*\r\n/))&&(i=n.match(/m=video.*\n/)),i&&i.length>0)){var r=i[0]+"b=TIAS:"+1e3*t.maxVideoBW+"\r\n";n=n.replace(i[0],r)}return t.audio&&t.maxAudioBW&&(null==(i=n.match(/m=audio.*\r\n/))&&(i=n.match(/m=audio.*\n/)),i&&i.length>0)&&(r=i[0]+"b=TIAS:"+1e3*t.maxAudioBW+"\r\n",n=n.replace(i[0],r)),n},E=function(t){return(t=t.replace(/a=.*abs-send-time\r\n/g,"")).replace(/a=.*goog-remb\r\n/g,"")};return i.onaddstream=null,i.onremovestream=null,i.state="new",i.markActionNeeded(),i},S=i(50),y=i.n(S),R=i(26),T=(i(5),103),I=function(t){var n={};if(n.clientId=t.clientId,t.session_id=T+=1,"undefined"==typeof window||!window.navigator)throw l.default.error("["+n.streamId+"]["+n.clientId+"]Publish/subscribe video/audio streams not supported yet"),Error("NON_BROWSER_ENV_DETECTED");return null!==window.navigator.userAgent.match("Firefox")?(n.browser="mozilla",n=E(t)):"iOS"===r.getBrowserOS()||r.isSafari()?(l.default.debug("["+n.streamId+"]["+n.clientId+"]Safari"),(n=m(t)).browser="safari"):~window.navigator.userAgent.indexOf("Edge")?n=new y.a(t):(n=h(t)).browser="chrome-stable",n},A=function(t,n,i){var o={};o.config=t,o.streamId=t.streamId,delete t.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var a=0,s=1,c=!1,d=null,u=function(t){if(a++,d){if(d===t)l.default.debug("Using Video Source/ Audio Source");else{var i=d.getVideoTracks()[0],r=d.getAudioTracks()[0],o=t.getVideoTracks()[0],u=t.getAudioTracks()[0];o&&(i&&d.removeTrack(i),d.addTrack(o)),u&&(r&&d.removeTrack(r),d.addTrack(u))}}else d=t;a!==s||c||(c=!0,setTimeout(function(){n(d)},0))},f=function(t){l.default.error("Failed to GetUserMedia",t.name,t.code,t.message,t),a++,c||(c=!0,setTimeout(function(){i&&i(t)},0))},p=function(){var n={video:t.video,audio:t.audio};if(l.default.debug("GetUserMedia",JSON.stringify(n)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(n).then(u).catch(f);else if("undefined"!=typeof navigator&&navigator.getMedia)navigator.getMedia(t,u,f);else{var r={name:"MEDIA_NOT_SUPPORT",message:"Video/audio streams not supported yet"};l.default.error("["+o.streamId+"]"+r.message),i&&i(r)}};if((t.videoSource||t.audioSource)&&(d=new MediaStream,t.videoSource&&d.addTrack(t.videoSource),t.audioSource&&d.addTrack(t.audioSource)),t.video||t.audio||t.screen||t.screenAudio){if(!t.screen&&t.screenAudio)return i&&i({code:"Set screen to true before sharing the audio"});if(t.screen){if(R.a.isElectron())return t.screen.sourceId?R.a.getScreenStream(t.screen.sourceId,t.screen,function(n,i){n?f(n):(t.audio&&(s++,p()),u(i))}):R.a.shareScreen(t.screen,function(n,i){n?f(n):(t.audio&&(s++,p()),u(i))});if(r.isFireFox()){if(l.default.debug("["+o.streamId+"]Screen access requested"),!~["screen","window","application"].indexOf(t.screen.mediaSource))return i&&i({code:"Invalid mediaSource, mediaSource should be one of [screen, window, application]"});navigator.getMedia({video:t.screen},function(n){t.audio&&(s++,p()),u(n)},f)}else if(r.isChromeKernel()&&t.screen.extensionId){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void i({code:"This browser does not support screen sharing"});l.default.debug("["+o.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(t.screen.extensionId,{getStream:!0},function(n){void 0===n?(l.default.error("["+o.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),f({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})):(t.screen.mandatory.chromeMediaSourceId=n.streamId,navigator.getMedia({video:t.screen},function(n){t.audio&&(s++,p()),u(n)},f))})}catch(_){return l.default.debug("["+o.streamId+"]AgoraRTC screensharing plugin is not accessible"),void i({code:"no_plugin_present"})}}else{if(window.navigator.mediaDevices.getDisplayMedia){var g={};return"number"==typeof t.screen.width&&"number"==typeof t.screen.height?g.video={width:{ideal:t.screen.width},height:{ideal:t.screen.height}}:g.video={width:t.screen.width,height:t.screen.height},t.screen.frameRate&&t.screen.frameRate.min?g.video.frameRate={ideal:t.screen.frameRate.max,max:t.screen.frameRate.max}:g.video.frameRate=t.screen.frameRate,t.screenAudio&&(g.audio=t.screenAudio),l.default.debug("use getDisplayMedia, constraints:",g),window.navigator.mediaDevices.getDisplayMedia(g).then(function(n){!t.screenAudio&&t.audio&&(s++,p()),u(n)}).catch(f)}l.default.error("["+o.streamId+"]This browser does not support screenSharing"),i({code:"This browser does not support screen sharing"})}}else p()}else u(d)}},function(t,n,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var o,a=r(i(0)),s=function(){function t(t,n,i){void 0===n&&(n=""),this.name="AgoraRTCException",this.code=t,this.message="AgoraRTCError "+this.code+": "+n,this.data=i}return t.prototype.toString=function(){return this.data?this.message+" data: "+JSON.stringify(this.data):this.message},t.prototype.throw=function(){throw a.default.error(this.toString()),this},t}();n.AgoraRTCError=s,(o=n.AgoraRTCErrorCode||(n.AgoraRTCErrorCode={})).UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_SUPPORT="NOT_SUPPORT",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORT="OPERATION_ABORT",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.STREAM_ALREADY_INITIALIZED="STREAM_ALREADY_INITIALIZED",o.STREAM_IS_CLOSED="STREAM_IS_CLOSED",o.ABORT_OTHER_INIT="ABORT_OTHER_INIT",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.CAN_NOT_AUTOPLAY="CAN_NOT_AUTOPLAY",o.HIGH_STREAM_NO_VIDEO_TRACK="HIGH_STREAM_NO_VIDEO_TRACK",o.SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM="SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.TOKEN_GENERATOR_FUNCTION_ERROR="TOKEN_GENERATOR_FUNCTION_ERROR",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.UID_CONFLICT="UID_CONFLICT",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.SUBSCRIPTION_IS_IN_PROGRESS="SUBSCRIPTION_IS_IN_PROGRESS",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.EFFECT_ID_CONFLICTED="EFFECT_ID_CONFLICTED",o.EFFECT_SOUND_ID_NOT_FOUND="EFFECT_SOUND_ID_NOT_FOUND",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER="CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT="LIVE_STREAMING_TRANSCODING_NOT_SUPPORT",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"},function(t,n,i){"use strict";i.d(n,"a",function(){return d});var r=i(0),o=window.AudioContext||window.webkitAudioContext,a=i(2),s=a.getParameter,c=a.setParameter,d=function(){return s("AUDIO_CONTEXT")||c("AUDIO_CONTEXT",function(){if(o){var t=new o;return window.ctx=t,new Promise(function(t){document.body?t():window.addEventListener("load",t)}).then(function(){var n=function n(){"suspended"==t.state?(r.default.debug("AudioContext is suspended, auto resume"),t.resume().then(function(){r.default.debug("AudioContext resume success"),document.body.removeEventListener("touchend",n,!0),document.body.removeEventListener("mousedown",n,!0)})):(r.default.debug("AudioContext is running"),document.body.removeEventListener("touchend",n,!0),document.body.removeEventListener("mousedown",n,!0))};document.body.addEventListener("touchend",n,!0),document.body.addEventListener("mousedown",n,!0)}),t}throw Error("AUDIO_CONTEXT_NOT_SUPPORTED")}()),s("AUDIO_CONTEXT")};d()},function(t,n,i){"use strict";var r=i(1),o=null,a=function(){try{o=window.require("electron")}catch(t){}return o},s=function(t){var n=r.report.reportApiInvoke(null,{callback:t,name:"getScreenSources",options:arguments,tag:"tracer"}),i=a();if(!i)return n&&n("electron is null");try{var o=i.desktopCapturer.getSources({types:["window","screen"]})}catch(s){console.log(s)}o instanceof Promise?o.then(function(t){return n&&n(null,t)}).catch(function(t){return n&&n(t)}):o=i.desktopCapturer.getSources({types:["window","screen"]},function(t,i){n&&n(null,i)})},c=function(t,n,i){var r=n.width;n={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:n.height,maxWidth:r,maxFrameRate:n.frameRate&&n.frameRate.max,minFrameRate:n.frameRate&&n.frameRate.min}}},navigator.webkitGetUserMedia(n,function(t){i&&i(null,t)},function(t){i&&i(t)})};n.a={isElectron:function(){return!!a()},getElectronInstance:a,getScreenSources:s,getScreenStream:c,shareScreen:function(t,n){s(function(i,r){var o,a,s,d,u,l,f,p,_;if(i)return n&&n(i);o=r,a=function(i,r){if(i)return n&&n(i);c(r,t,n)},(s=document.createElement("div")).innerText="share screen",s.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;"),(d=document.createElement("div")).setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;"),(u=document.createElement("div")).innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;"),(l=document.createElement("div")).setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;"),(f=document.createElement("div")).setAttribute("style","text-align: right; padding: 16px 0;"),(p=document.createElement("button")).innerHTML="cancel",p.setAttribute("style","width: 85px;"),p.onclick=function(){document.body.removeChild(_),a&&a("NotAllowedError")},f.appendChild(p),d.appendChild(u),d.appendChild(l),d.appendChild(f),(_=document.createElement("div")).setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(s),_.appendChild(d),document.body.appendChild(_),o.map(function(t){if(t.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var i=t.thumbnail;i.getSize().width>1920&&(i=i.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+i.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.name.replace(/[\u00A0-\u9999<>\&]/g,function(t){return"&#"+t.charCodeAt(0)+";"})+"</span>",n.onclick=function(){document.body.removeChild(_),a&&a(null,t.id)},l.appendChild(n)}})})}}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o,a,s,c,d=i(3);(r=n.LiveStreamingServiceMode||(n.LiveStreamingServiceMode={})).TRANSCODE="mix_streaming",r.RAW="raw_streaming",r.INJECT="inject_streaming",n.DEFAULT_LIVE_STREAMING_TRANSCODING_USER={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},n.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},n.isLiveStreamingTranscodingConfig=function(t){return d.isEmpty(t.width)||d.checkValidNumber(t.width,"config.width",0),d.isEmpty(t.height)||d.checkValidNumber(t.height,"config.height",0),d.isEmpty(t.videoBitrate)||d.checkValidNumber(t.videoBitrate,"config.videoBitrate",1,1e6),d.isEmpty(t.videoFramerate)||d.checkValidNumber(t.videoFramerate,"config.videoFramerate"),d.isEmpty(t.lowLatency)||d.checkValidBoolean(t.lowLatency,"config.lowLatency"),d.isEmpty(t.audioSampleRate)||d.checkValidEnum(t.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),d.isEmpty(t.audioBitrate)||d.checkValidNumber(t.audioBitrate,"config.audioBitrate",1,128),d.isEmpty(t.audioChannels)||d.checkValidEnum(t.audioChannels,"config.audioChannels",[1,2,3,4,5]),d.isEmpty(t.videoGop)||d.checkValidNumber(t.videoGop,"config.videoGop"),d.isEmpty(t.videoCodecProfile)||d.checkValidEnum(t.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),d.isEmpty(t.userCount)||d.checkValidNumber(t.userCount,"config.userCount",0,17),d.isEmpty(t.backgroundColor)||d.checkValidNumber(t.backgroundColor,"config.backgroundColor",0,16777215),t.transcodingUsers&&!d.isEmpty(t.transcodingUsers)&&(d.checkValidArray(t.transcodingUsers,"config.transcodingUsers"),t.transcodingUsers.forEach(function(t,n){d.checkValidUID(t.uid),d.isEmpty(t.x)||d.checkValidNumber(t.x,"transcodingUser["+n+"].x",0,1e4),d.isEmpty(t.y)||d.checkValidNumber(t.y,"transcodingUser["+n+"].y",0,1e4),d.isEmpty(t.width)||d.checkValidNumber(t.width,"transcodingUser["+n+"].width",0,1e4),d.isEmpty(t.height)||d.checkValidNumber(t.height,"transcodingUser["+n+"].height",0,1e4),d.isEmpty(t.zOrder)||d.checkValidNumber(t.zOrder-1,"transcodingUser["+n+"].zOrder",0,100),d.isEmpty(t.alpha)||d.checkValidFloatNumber(t.alpha,"transcodingUser["+n+"].alpha",0,1)})),t.images&&!d.isEmpty(t.images)&&(d.checkValidArray(t.images,"config.images"),t.images.forEach(function(t,n){d.checkValidString(t.url,"images["+n+"].url",1,1e3,!1),d.isEmpty(t.x)||d.checkValidNumber(t.x,"images["+n+"].x",0,1e4),d.isEmpty(t.y)||d.checkValidNumber(t.y,"images["+n+"].y",0,1e4),d.isEmpty(t.width)||d.checkValidNumber(t.width,"images["+n+"].width",0,1e4),d.isEmpty(t.height)||d.checkValidNumber(t.height,"images["+n+"].height",0,1e4),d.isEmpty(t.zOrder)||d.checkValidNumber(t.zOrder,"images["+n+"].zOrder",0,255),d.isEmpty(t.alpha)||d.checkValidFloatNumber(t.alpha,"images["+n+"].alpha",0,1)})),!0},n.DEFAULT_TRANSCODING_CONFIG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFramerate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},n.isInjectStreamConfig=function(t){return d.isEmpty(t.audioVolume)||d.checkValidNumber(t.audioVolume,"config.audioVolume",0,1e3),d.isEmpty(t.audioBitrate)||d.checkValidNumber(t.audioBitrate,"config.audioBitrate",1,1e4),d.isEmpty(t.audioChannels)||d.checkValidEnum(t.audioChannels,"config.audioChannels",[1,2]),d.isEmpty(t.audioSampleRate)||d.checkValidEnum(t.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),d.isEmpty(t.width)||d.checkValidNumber(t.width,"config.width",0,1e4),d.isEmpty(t.height)||d.checkValidNumber(t.height,"config.height",0,1e4),d.isEmpty(t.videoBitrate)||d.checkValidNumber(t.videoBitrate,"config.videoBitrate",1,1e4),d.isEmpty(t.videoFramerate)||d.checkValidNumber(t.videoFramerate,"config.videoFramerate",1,1e4),d.isEmpty(t.videoGop)||d.checkValidNumber(t.videoGop,"config.videoGop",1,1e4),!0},n.DEFAULT_INJECT_CONFIG={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},(o=n.LiveStreamingUapSignalEvents||(n.LiveStreamingUapSignalEvents={})).WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address",(a=n.LiveStreamingInternalEvents||(n.LiveStreamingInternalEvents={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",(s=n.LIVE_STREAM_ERROR_CODE||(n.LIVE_STREAM_ERROR_CODE={}))[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE=505]="LIVE_STREAM_RESPONSE_INGNORE_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",(c=n.WebSocketManagerEvents||(n.WebSocketManagerEvents={})).CONNECTED="websocket:connected",c.RECONNECTING="websocket:reconnecting",c.WILL_RECONNECT="websocket:will_reconnect",c.CLOSED="websocket:closed",c.FAILED="websocket:failed",c.ON_MESSAGE="websocket:on_message",c.REQUEST_NEW_URLS="websocket:request_new_urls"},function(t,n,i){var r=i(57),o=i(58);t.exports=function(t,n,i){var a=n&&i||0;"string"==typeof t&&(n="binary"===t?Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n)for(var c=0;c<16;++c)n[a+c]=s[c];return n||o(s)}},function(t,n,i){var r,o,a,s,c,d,u,l,f,p,_;t.exports=(r=i(73),o=Math,c=(s=(a=r).lib).WordArray,d=s.Hasher,u=a.algo,l=[],f=[],function(){function t(t){for(var n=o.sqrt(t),i=2;i<=n;i++)if(!(t%i))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var i=2,r=0;r<64;)t(i)&&(r<8&&(l[r]=n(o.pow(i,.5))),f[r]=n(o.pow(i,1/3)),r++),i++}(),p=[],_=u.SHA256=d.extend({_doReset:function(){this._hash=new c.init(l.slice(0))},_doProcessBlock:function(t,n){for(var i=this._hash.words,r=i[0],o=i[1],a=i[2],s=i[3],c=i[4],d=i[5],u=i[6],l=i[7],_=0;_<64;_++){if(_<16)p[_]=0|t[n+_];else{var g=p[_-15],h=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,m=p[_-2],v=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;p[_]=h+p[_-7]+v+p[_-16]}var $=r&o^r&a^o&a,E=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),S=l+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&d^~c&u)+f[_]+p[_];l=u,u=d,d=c,c=s+S|0,s=a,a=o,o=r,r=S+(E+$)|0}i[0]=i[0]+r|0,i[1]=i[1]+o|0,i[2]=i[2]+a|0,i[3]=i[3]+s|0,i[4]=i[4]+c|0,i[5]=i[5]+d|0,i[6]=i[6]+u|0,i[7]=i[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=o.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=d.clone.call(this);return t._hash=this._hash.clone(),t}}),a.SHA256=d._createHelper(_),a.HmacSHA256=d._createHmacHelper(_),r.SHA256)},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.randomString=function(t){void 0===t&&(t=8);for(var n="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=n.length,r="",o=0;o<t;o++)r+=n.charAt(Math.floor(Math.random()*i));return r}},function(t,n,i){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++)for(var o in n=arguments[i])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},a=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),d=s(i(37)),u=i(24),l=s(i(0)),f=i(1);function p(t){return new Promise(function(n){window.setTimeout(n,t)})}function _(t,n){return new Promise(function(i,r){n.timeout=n.timeout||c.getParameter("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&(n.data=JSON.stringify(n.data)),n.headers=n.headers||{},n.headers["Content-Type"]="application/json",n.method="POST",n.url=t,d.default.request(n).then(function(t){i(t.data)}).catch(function(t){d.default.isCancel(t)?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.OPERATION_ABORT,"cancel token canceled")):"ECONNABORTED"===t.code?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_TIMEOUT,t.message)):t.response?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_RESPONSE_ERROR,t.response.status)):r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_ERROR,t.message))})})}function g(t,i,r,s){var c=this,d=Object.assign({},n.DEFAULT_RETRY_CONFIG,s),l=d.timeout,f=function(){return o(c,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,p(l)];case 1:return t.sent(),l*=d.timeoutFactor,l=Math.min(d.maxRetryTimeout,l),[2]}})})},_=!1,g=new Promise(function(n,s){return o(c,void 0,void 0,function(){var o,c,l;return a(this,function(a){switch(a.label){case 0:i=i||function(){return!1},r=r||function(){return!0},o=0,a.label=1;case 1:if(!(o<d.maxRetryCount))return[3,12];if(_)return[2,s(new u.AgoraRTCError(u.AgoraRTCErrorCode.OPERATION_ABORT))];a.label=2;case 2:return a.trys.push([2,7,,11]),[4,t()];case 3:return i(c=a.sent(),o)?o+1===d.maxRetryCount?[2,n(c)]:[4,f()]:[3,5];case 4:return a.sent(),[3,6];case 5:return[2,n(c)];case 6:case 10:return[3,11];case 7:return r(l=a.sent(),o)?o+1===d.maxRetryCount?[2,s(l)]:[4,f()]:[3,9];case 8:return a.sent(),[3,10];case 9:return[2,s(l)];case 11:return o+=1,[3,1];case 12:return[2]}})})});return g.cancel=function(){return _=!0},g}function h(t,n){return{addressList:t.servers.map(function(t,i){return"wss://"+t.address.replace(/\./g,"-")+".edge.agora.io:"+t.wss+"?serviceName="+encodeURIComponent(n)}),workerToken:t.workerToken,vid:t.vid}}n.wait=p,n.post=_,n.DEFAULT_RETRY_CONFIG={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},n.getRetryWaitTime=function(t,n){var i=n.timeout*Math.pow(n.timeoutFactor,t);return Math.min(n.maxRetryTimeout,i)},n.retryable=g,n.liveStreamingServerResponseToResult=h;var m=1;function v(t,i,s,d,p){var v=this;void 0===p&&(p=n.DEFAULT_RETRY_CONFIG),m+=1;var $,E,S={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:m,requestId:m,version:c.VERSION,cname:s.cname},y={service_name:i,json_body:JSON.stringify(S)},R=t[0];return g(function(){return o(v,void 0,void 0,function(){var t,n,o,s,f;return a(this,function(a){switch(a.label){case 0:return $=Date.now(),[4,_(R,{data:y,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}})];case 1:if(t=a.sent(),E=Date.now()-$,0!==t.code)throw o=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming ap error, code"+t.code,{retry:!0}),l.default.error(o.toString()),o;if(200!==(n=JSON.parse(t.json_body)).code)throw o=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center error, code: "+n.code+", reason: "+n.reason),l.default.error(o.toString()),o;if(!n.servers||0===n.servers.length)throw o=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center empty server"),l.default.error(o.toString()),o;if(s=h(n,i),c.getParameter("LIVE_STREAMING_ADDRESS"))try{f=JSON.parse(c.getParameter("LIVE_STREAMING_ADDRESS")),s.addressList=f}catch(p){s.addressList=[c.getParameter("LIVE_STREAMING_ADDRESS")]}return[2,r(r({},s),{responseTime:E})]}})})},function(n,r){return f.report.requestApWorkerEvent(s.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(n.addressList),firstSuccess:0===r,responseTime:E,serverIp:t[r%t.length]}),!1},function(n,r){return f.report.requestApWorkerEvent(s.sid,{success:!1,sc:n.data&&n.data.code||200,serviceName:i,responseTime:E,serverIp:t[r%t.length]}),!!(n.code!==u.AgoraRTCErrorCode.OPERATION_ABORT&&n.code!==u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE||n.data&&n.data.retry)&&(R=t[(r+1)%t.length],!0)},p)}n.requestLiveStreamingWorkerManager=v,n.getLiveStreamingWorkerMangerResult=function(t,n,i){return o(this,void 0,void 0,function(){var r,o;return a(this,function(a){switch(a.label){case 0:r=c.getParameter("UAP_AP").map(function(t){return n.proxyServer?"https://"+n.proxyServer+"/ap/?url="+t+"/api/v1?action=uap":"https://"+t+"/api/v1?action=uap"}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,v(r,t,n,i)];case 2:return[2,a.sent()];case 3:throw o=a.sent(),f.report.requestApWorkerEvent(n.sid,{success:!1,sc:o.data&&o.data.code||200,serviceName:t,responseTime:o.data&&o.data.responseTime}),o;case 4:return[2]}})})}},function(t,n,i){var r=i(70),o=i(71),a=i(34),s=i(72);t.exports=function(t){return r(t)||o(t)||a(t)||s()}},function(t,n){var i;i=function(){return this}();try{i=i||Function("return this")()}catch(r){"object"==typeof window&&(i=window)}t.exports=i},function(t,n,i){var r=i(35);t.exports=function(t,n){if(t){if("string"==typeof t)return r(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,n):void 0}}},function(t,n){t.exports=function(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,r=Array(n);i<n;i++)r[i]=t[i];return r}},function(t,n,i){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<i;n++)for(var a=arguments[n],s=0,c=a.length;s<c;s++,o++)r[o]=a[s];return r};Object.defineProperty(n,"__esModule",{value:!0});var o=i(24),a=function(){function t(){this._events={},this.addListener=this.on}return t.prototype.getListeners=function(t){return this._events[t]?this._events[t].map(function(t){return t.listener}):[]},t.prototype.on=function(t,n){this._events[t]||(this._events[t]=[]);var i=this._events[t];-1===this._indexOfListener(i,n)&&i.push({listener:n,once:!1})},t.prototype.once=function(t,n){this._events[t]||(this._events[t]=[]);var i=this._events[t];-1===this._indexOfListener(i,n)&&i.push({listener:n,once:!0})},t.prototype.off=function(t,n){if(this._events[t]){var i=this._events[t],r=this._indexOfListener(i,n);-1!==r&&i.splice(r,1),0===this._events[t].length&&delete this._events[t]}},t.prototype.removeAllListeners=function(t){t?delete this._events[t]:this._events={}},t.prototype.emit=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this._events[t]||(this._events[t]=[]);for(var r=this._events[t].map(function(t){return t}),o=0;o<r.length;o+=1){var a=r[o];a.once&&this.off(t,a.listener),a.listener.apply(this,n||[])}},t.prototype._indexOfListener=function(t,n){for(var i=t.length;i--;)if(t[i].listener===n)return i;return -1},t}();function s(t,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];var s=null,c=null;if(t.emit.apply(t,r([n],i,[function(t){s=t},function(t){c=t}])),null!==c)throw c;if(null===s)throw new o.AgoraRTCError(o.AgoraRTCErrorCode.UNEXPECTED_ERROR,"handler is not sync");return s}n.EventEmitter=a,n.emitAsPromise=function(t,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];return 0===t.getListeners(n).length?Promise.reject(new o.AgoraRTCError(o.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not emit promise")):new Promise(function(o,a){t.emit.apply(t,r([n],i,[o,a]))})},n.emitAsInvokerNoResponse=function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return 0===t.getListeners(n).length?null:s.apply(void 0,r([t,n],i))},n.emitAsInvoker=s},function(t,n,i){t.exports=i(78)},function(t,n,i){"use strict";t.exports=function(t,n){return function(){for(var i=Array(arguments.length),r=0;r<i.length;r++)i[r]=arguments[r];return t.apply(n,i)}}},function(t,n,i){"use strict";var r=i(18);function o(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,n,i){if(!n)return t;if(i)a=i(n);else if(r.isURLSearchParams(n))a=n.toString();else{var a,s=[];r.forEach(n,function(t,n){null!=t&&(r.isArray(t)?n+="[]":t=[t],r.forEach(t,function(t){r.isDate(t)?t=t.toISOString():r.isObject(t)&&(t=JSON.stringify(t)),s.push(o(n)+"="+o(t))}))}),a=s.join("&")}if(a){var c=t.indexOf("#");-1!==c&&(t=t.slice(0,c)),t+=(-1===t.indexOf("?")?"?":"&")+a}return t}},function(t,n,i){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,n,i){"use strict";(function(n){var r=i(18),o=i(84),a={"Content-Type":"application/x-www-form-urlencoded"};function s(t,n){!r.isUndefined(t)&&r.isUndefined(t["Content-Type"])&&(t["Content-Type"]=n)}var c,d={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==n&&"[object process]"===Object.prototype.toString.call(n))&&(c=i(42)),c),transformRequest:[function(t,n){return o(n,"Accept"),o(n,"Content-Type"),r.isFormData(t)||r.isArrayBuffer(t)||r.isBuffer(t)||r.isStream(t)||r.isFile(t)||r.isBlob(t)?t:r.isArrayBufferView(t)?t.buffer:r.isURLSearchParams(t)?(s(n,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):r.isObject(t)?(s(n,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(n){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};d.headers={common:{Accept:"application/json, text/plain, */*"}},r.forEach(["delete","get","head"],function(t){d.headers[t]={}}),r.forEach(["post","put","patch"],function(t){d.headers[t]=r.merge(a)}),t.exports=d}).call(this,i(83))},function(t,n,i){"use strict";var r=i(18),o=i(85),a=i(39),s=i(87),c=i(90),d=i(91),u=i(43);t.exports=function(t){return new Promise(function(n,l){var f=t.data,p=t.headers;r.isFormData(f)&&delete p["Content-Type"];var _=new XMLHttpRequest;if(t.auth){var g=t.auth.username||"",h=t.auth.password||"";p.Authorization="Basic "+btoa(g+":"+h)}var m=s(t.baseURL,t.url);if(_.open(t.method.toUpperCase(),a(m,t.params,t.paramsSerializer),!0),_.timeout=t.timeout,_.onreadystatechange=function(){if(_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in _?c(_.getAllResponseHeaders()):null,r={data:t.responseType&&"text"!==t.responseType?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:i,config:t,request:_};o(n,l,r),_=null}},_.onabort=function(){_&&(l(u("Request aborted",t,"ECONNABORTED",_)),_=null)},_.onerror=function(){l(u("Network Error",t,null,_)),_=null},_.ontimeout=function(){var n="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(n=t.timeoutErrorMessage),l(u(n,t,"ECONNABORTED",_)),_=null},r.isStandardBrowserEnv()){var v=i(92),$=(t.withCredentials||d(m))&&t.xsrfCookieName?v.read(t.xsrfCookieName):void 0;$&&(p[t.xsrfHeaderName]=$)}if("setRequestHeader"in _&&r.forEach(p,function(t,n){void 0===f&&"content-type"===n.toLowerCase()?delete p[n]:_.setRequestHeader(n,t)}),r.isUndefined(t.withCredentials)||(_.withCredentials=!!t.withCredentials),t.responseType)try{_.responseType=t.responseType}catch(E){if("json"!==t.responseType)throw E}"function"==typeof t.onDownloadProgress&&_.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){_&&(_.abort(),l(t),_=null)}),void 0===f&&(f=null),_.send(f)})}},function(t,n,i){"use strict";var r=i(86);t.exports=function(t,n,i,o,a){return r(Error(t),n,i,o,a)}},function(t,n,i){"use strict";var r=i(18);t.exports=function(t,n){n=n||{};var i={},o=["url","method","params","data"],a=["headers","auth","proxy"],s=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];r.forEach(o,function(t){void 0!==n[t]&&(i[t]=n[t])}),r.forEach(a,function(o){r.isObject(n[o])?i[o]=r.deepMerge(t[o],n[o]):void 0!==n[o]?i[o]=n[o]:r.isObject(t[o])?i[o]=r.deepMerge(t[o]):void 0!==t[o]&&(i[o]=t[o])}),r.forEach(s,function(r){void 0!==n[r]?i[r]=n[r]:void 0!==t[r]&&(i[r]=t[r])});var c=o.concat(a).concat(s),d=Object.keys(n).filter(function(t){return -1===c.indexOf(t)});return r.forEach(d,function(r){void 0!==n[r]?i[r]=n[r]:void 0!==t[r]&&(i[r]=t[r])}),i}},function(t,n,i){"use strict";function r(t){this.message=t}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,t.exports=r},function(t,n){t.exports=function(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}},function(t,n,i){"use strict";var r=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n.default=t,n};Object.defineProperty(n,"__esModule",{value:!0});var c=a(i(59)),d=s(i(62)),u=s(i(63)),l=a(i(0)),f=i(2),p=c.default.Root.fromJSON(u),_=function(){function t(){this.requestArray=[],this.retryBackoffCount=0,this.state=0}return t.prototype.setProxy=function(t){this.proxyServer=t},t.prototype.sendReportList=function(t,n){var i=this,r=this._dataConvert("ProtoRaws",{vid:n,sendTs:Math.round(Date.now()/1e3),payloads:t.map(function(t){return{id:d[t.type],msg:i._dataConvert(t.type,t.data)}})});this.send(r)},t.prototype._dataConvert=function(t,n){try{r=p.lookupType("protobuf."+t)}catch(i){l.default.error("[send-proto] invalid proto name "+t)}var r,o=r.create(n);return r.encode(o).finish()},t.prototype.send=function(t){0==this.state?this._send(t):this.requestArray.push(t)},t.prototype._send=function(t){return r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,4]),this.state=1,[4,this.request(t)];case 1:return n.sent(),this.retryBackoffCount=0,0!==this.requestArray.length?this._send(this.requestArray.shift()):this.state=0,[3,4];case 2:return n.sent(),[4,g(this.retryBackoffCount++<2?200:1e4)];case 3:return n.sent(),this._send(t),[3,4];case 4:return[2]}})})},t.prototype.request=function(t){return r(this,void 0,void 0,function(){var n,i;return o(this,function(r){switch(r.label){case 0:n=this._getAddress(),i=this._getBackupAddress(),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this._request(n,t)];case 2:case 4:return r.sent(),[3,5];case 3:return r.sent(),[4,this._request(i,t)];case 5:return[2]}})})},t.prototype._request=function(t,n){return this._post(t,n)},t.prototype._post=function(t,n){var i=this;return new Promise(function(r,o){var a=new XMLHttpRequest;a.timeout=f.getParameter("HTTP_CONNECT_TIMEOUT"),a.open("POST",t,!0),a.setRequestHeader("Content-type","application/octet-stream"),i.proxyServer||(a.setRequestHeader("Cache-Control","no-cache, no-store"),a.setRequestHeader("Pragma","no-cache"),a.setRequestHeader("Expires","0")),a.onload=function(t){r(a.responseText)},a.onerror=function(t){o(t)},a.ontimeout=function(t){o(t)},a.send(n)})},t.prototype._getAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+f.getParameter("EVENT_REPORT_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+f.getParameter("EVENT_REPORT_DOMAIN")+":6443/events/proto-raws"},t.prototype._getBackupAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+f.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+f.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+":6443/events/proto-raws"},t}();n.default=_;var g=function(t){return new Promise(function(n){window.setTimeout(n,t)})}},function(t,n){t.exports=function(t,n){if(!(t instanceof n))throw TypeError("Cannot call a class as a function")}},function(t,n){function i(t,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,n,r){return n&&i(t.prototype,n),r&&i(t,r),t}},function(t,n,i){"use strict";var r=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var s,c,d=a(i(0)),u=i(15);(c=s||(s={})).NEW="new",c.PREPARING_OFFER="preparing-offer",c.OFFER_SENT="offer-sent",c.ESTABLISHED="established",c.CLOSED="closed";var l=function(){function t(t){this.candidate=null,this.state=s.NEW,this.config=t,this.isSubscriber=this.config.isSubscriber,this.peerConnection=this.initPeecConnection(t),this.peerConnection.onicecandidate=this._onicecandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this._oniceconnectionstatechange.bind(this),this.peerConnection.onaddstream=this._onaddstream.bind(this),this.peerConnection.ontrack=this._ontrack.bind(this),this.processSignalingMessage=this.setAnswer.bind(this),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.setLocalSDP.bind(this)),this.sendVideoStats={id:"",type:"",mediaType:"",googCodecName:this.config.codec.toUpperCase(),bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},this.sendAudioStats={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},this.receiveAudioStats={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},this.receiveVideoStats={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"}}return t.prototype.addStream=function(t){this.peerConnection.addStream(t)},t.prototype.setRtpSenderParameters=function(t){return r(this,void 0,void 0,function(){return o(this,function(t){return[2]})})},t.prototype.setAnswer=function(t){var n=JSON.parse(t);this.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:n.sdp,type:"answer"})),this.onsignalingmessage&&this.onsignalingmessage("")},t.prototype.close=function(){this.peerConnection.close()},t.prototype.getStats=function(t,n){if(void 0===n&&(n=500),n=n>500?500:n,Date.now()-this.lastTimeGetStats<n){var i=[];this.config.isSubscriber?(i.push(this.receiveVideoStats),i.push(this.receiveAudioStats)):(i.push(this.sendAudioStats),i.push(this.sendVideoStats)),i.push({id:"time",startTime:this.connectedTime,timestamp:Date.now()}),t&&t(i)}else this._getStats(t)},t.prototype._getStats=function(t){var n=this,i=[];this.peerConnection.getStats(null).then(function(r){n.lastTimeGetStats=Date.now(),Object.keys(r).map(function(t){var i=r[t];n.config.isSubscriber?i.type&&"inboundrtp"===i.type&&i.mediaType&&"audio"===i.mediaType?(n.receiveAudioStats.id=i.id+"recv",n.receiveAudioStats.type=i.type+"",n.receiveAudioStats.mediaType=i.mediaType+"",n.receiveAudioStats.packetsReceived=i.packetsReceived+"",n.receiveAudioStats.bytesReceived=i.bytesReceived+"",n.receiveAudioStats.packetsLost=i.packetsLost+"",n.receiveAudioStats.googJitterReceived=i.jitter+""):i.type&&"inboundrtp"===i.type&&i.mediaType&&"video"===i.mediaType?(n.receiveVideoStats.id=i.id+"recv",n.receiveVideoStats.type=i.type+"",n.receiveVideoStats.mediaType=i.mediaType+"",n.receiveVideoStats.packetsReceived=i.packetsReceived+"",n.receiveVideoStats.bytesReceived=i.bytesReceived+"",n.receiveVideoStats.packetsLost=i.packetsLost+"",n.receiveVideoStats.googJitterBufferMs=i.jitter+"",n.receiveVideoStats.googPlisSent=i.pliCount+"",n.receiveVideoStats.googFirsSent=i.firCount+"",n.receiveVideoStats.googNacksSent=i.nackCount+""):i.remoteSource&&i.type&&"track"===i.type&&i.trackIdentifier&&-1!==i.trackIdentifier.indexOf("v")?(n.receiveVideoStats.googFrameHeightReceived=i.frameHeight+"",n.receiveVideoStats.googFrameWidthReceived=i.frameWidth+"",n.receiveVideoStats.googFrameRateDecoded=i.framesPerSecond+"",n.receiveVideoStats.googFrameRateOutput=i.framesPerSecond+"",n.receiveVideoStats.googFrameRateReceived=i.framesPerSecond+"",n.receiveVideoStats.googFramesDecoded=i.framesDecoded+"",n.receiveVideoStats.googFrameReceived=i.framesReceived+""):i.remoteSource&&i.type&&"track"===i.type&&i.trackIdentifier&&-1!==i.trackIdentifier.indexOf("a")&&(n.receiveAudioStats.audioOutputLevel=i.audioLevel+""):!i.isRemote&&i.type&&"outboundrtp"===i.type&&i.mediaType&&"audio"===i.mediaType?(n.sendAudioStats.id=i.id+"send",n.sendAudioStats.type=i.type+"",n.sendAudioStats.mediaType=i.mediaType+"",n.sendAudioStats.packetsSent=i.packetsSent+"",n.sendAudioStats.bytesSent=i.bytesSent+""):!i.isRemote&&i.type&&"outboundrtp"===i.type&&i.mediaType&&"video"===i.mediaType?(n.sendVideoStats.id=i.id+"send",n.sendVideoStats.type=i.type+"",n.sendVideoStats.mediaType=i.mediaType+"",n.sendVideoStats.packetsSent=i.packetsSent+"",n.sendVideoStats.bytesSent=i.bytesSent+"",n.sendVideoStats.googRtt=i.roundTripTime+"",n.sendVideoStats.googPlisReceived=i.pliCount+"",n.sendVideoStats.googFirsReceived=i.firCount+"",n.sendVideoStats.googNacksReceived=i.nackCount+""):!i.remoteSource&&i.type&&"track"===i.type&&i.framesSent&&0!==i.framesSent&&(n.sendVideoStats.googFrameHeightSent=i.frameHeight+"",n.sendVideoStats.googFrameHeightInput=i.frameHeight+"",n.sendVideoStats.googFrameWidthSent=i.frameWidth+"",n.sendVideoStats.googFrameWidthInput=i.frameWidth+"",n.sendVideoStats.googFramesEncoded=i.framesSent+"",n.sendVideoStats.googFrameRateSent=i.framesPerSecond+"")}),n.config.isSubscriber?(i.push(n.receiveVideoStats),i.push(n.receiveAudioStats)):(i.push(n.sendAudioStats),i.push(n.sendVideoStats)),i.push({id:"time",startTime:n.connectedTime,timestamp:Date.now()}),t&&t(i)})},t.prototype.getStatsRate=function(t){this.getStats(t)},t.prototype.initPeecConnection=function(t){var n=t.stunServerUrl,i=t.turnServer,r=t.iceServers;return this.pcConfig={iceServers:[]},r instanceof Array?this.pcConfig.iceServers=t.iceServers:n&&(n instanceof Array?n.map(function(t){"string"==typeof t&&""!==t&&this.pcConfig.iceServers.push({urls:t})}):"string"==typeof n&&""!==n&&this.pcConfig.iceServers.push({urls:n})),i&&(i instanceof Array?i.map(function(t){"string"==typeof t.url&&""!==t.url&&this.pcConfig.iceServers.push({username:t.username,credential:t.credential,url:t.url})}):"auto"!==i.mode&&"manual"!==i.mode||(i.udpport&&this.pcConfig.iceServers.push({username:i.username,credential:i.credential,credentialType:"password",urls:"turn:"+i.url+":"+i.udpport+"?transport=udp"}),"string"==typeof i.tcpport&&""!==i.tcpport&&this.pcConfig.iceServers.push({username:i.username,credential:i.credential,credentialType:"password",urls:"turn:"+i.url+":"+i.tcpport+"?transport=tcp"}),!0===i.forceturn&&(this.pcConfig.iceTransportPolicy="relay"))),new u.RTCPeerConnection(this.pcConfig)},t.prototype._ontrack=function(t){this.onaddstream&&this.onaddstream(t,"ontrack")},t.prototype._onaddstream=function(t){this.onaddstream&&this.onaddstream(t,"onaddstream")},t.prototype._oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(this.state=s.ESTABLISHED,this.connectedTime=Date.now()),this.oniceconnectionstatechange&&this.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},t.prototype._onicecandidate=function(t){!this.candidate&&t&&(this.candidate=t.candidate,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch())},t.prototype.setLocalSDP=function(t){return this.peerConnection.setLocalDescription(new RTCSessionDescription({sdp:t.sdp,type:"offer"})),this.state=s.PREPARING_OFFER,t},t.prototype.editLocalSDP=function(t){return t.sdp=this.setBandWidth(t.sdp),t.sdp=this.reviseOpus(t.sdp),t.sdp=this.addCandidate(t.sdp),t},t.prototype.setSendRecv=function(t){return t=(t=(t=t.replace(/a=recvonly\r\n/g,"a=sendrecv\r\n")).replace(/a=sendonly\r\n/g,"a=sendrecv\r\n")).replace(/a=inactive\r\n/g,"a=sendrecv\r\n")},t.prototype.setBandWidth=function(t){var n,i,r=this.config,o=r.codec,a=r.minVideoBW,s=r.maxVideoBW,c=r.maxAudioBW,u=r.clientId;if((n=t.match(/m=video.*\r\n/))&&a&&s){i=n[0]+"b=AS:"+s+"\r\n";var l=0,f=0;"h264"===o?(l=t.search(/a=rtpmap:(\d+) H264\/90000\r\n/),f=t.search(/H264\/90000\r\n/)):"vp8"===o?(l=t.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),f=t.search(/VP8\/90000\r\n/)):"vp9"===o&&(l=t.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),f=t.search(/VP9\/90000\r\n/)),-1!==l&&-1!==f&&f-l>10&&(i=i+"a=fmtp:"+t.slice(l+9,f-1)+" x-google-min-bitrate="+a+"\r\n"),t=t.replace(n[0],i),d.default.debug("["+u+"]Set Video Bitrate - min:"+a+" max:"+s)}return(n=t.match(/m=audio.*\r\n/))&&c&&(i=n[0]+"b=AS:"+c+"\r\n",t=t.replace(n[0],i)),t},t.prototype.reviseOpus=function(t){return t=(t=t.replace(/a=rtpmap:102 opus\/48000\/2/g,"a=rtpmap:111 opus/48000/2")).replace(/m=audio 9 UDP\/TLS\/RTP\/SAVPF 102 0 8 97 13 118 101/g,"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101")},t.prototype.addCandidate=function(t){return t+"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"},t.prototype.sendOffer=function(t){this.config.callback(JSON.stringify({sdp:t.sdp,messageType:"OFFER",tiebreaker:Math.floor(429496723*Math.random()+1)})),this.state=s.OFFER_SENT},t}();n.default=l},function(t,n,i){var r=i(65),o=i(66),a=i(34),s=i(67);t.exports=function(t,n){return r(t)||o(t,n)||a(t,n)||s()}},function(t,n,i){var r,o,a;o=this,a=function(){"use strict";var t,n=this;function i(t){n.console&&(n.console.error?n.console.error(t):n.console.log&&n.console.log(t))}function r(t,n,r,o){var a=o||i,s=t.createShader(r);return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(a("*** Error compiling shader '"+s+"':"+t.getShaderInfoLog(s)),t.deleteShader(s),null)}function o(t,n,r,o,a){var s=a||i,c=t.createProgram();return n.forEach(function(n){t.attachShader(c,n)}),r&&r.forEach(function(n,i){t.bindAttribLocation(c,o?o[i]:i,n)}),t.linkProgram(c),t.getProgramParameter(c,t.LINK_STATUS)?c:(s("Error in program linking:"+t.getProgramInfoLog(c)),t.deleteProgram(c),null)}(t=t||n)===t.top&&(console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:"),console.log("%c%s","color:blue;font-weight:bold;","http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html"));var a,s=["VERTEX_SHADER","FRAGMENT_SHADER"];return!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(a=HTMLCanvasElement.prototype.getContext,function(){var t=arguments;return"webgl"===t[0]&&((t=[].slice.call(arguments))[0]="experimental-webgl"),a.apply(this,t)})),{createProgram:o,createProgramFromSources:function(t,n,i,a,c){for(var d=[],u=0;u<n.length;++u)d.push(r(t,n[u],t[s[u]],c));return o(t,d,i,a,c)}}},void 0===(r=(function(){return a.call(o)}).apply(n,[]))||(t.exports=r)},function(t,n,i){"use strict";var r=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var s=i(68),c=i(4),d=a(i(0));n.getSupportedCodec=function(t){return r(void 0,void 0,void 0,function(){var n,i,r,a,l;return o(this,function(o){switch(o.label){case 0:return n={video:[],audio:[]},"undefined"!=typeof window?[3,1]:(d.default.error("getSupportedCodec: NOT_BROWSER_ENV"),[2,Promise.reject("NOT_BROWSER_ENV")]);case 1:try{i=s.createRTCPeerConnection({iceServers:[]})}catch(f){return d.default.error("Failed to init RTCPeerConnection",f),[2,Promise.reject(f)]}return i?[3,2]:(d.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),[2,Promise.resolve(n)]);case 2:return t&&t.stream?[3,7]:(r={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},a=void 0,(c.isSafari()||c.isFireFox()||c.isWeChatBrowser())&&i.addTransceiver?(i.addTransceiver("audio"),i.addTransceiver("video"),[4,i.createOffer()]):[3,4]);case 3:return a=o.sent(),[3,6];case 4:return[4,new Promise(function(t,n){var o=setTimeout(function(){n("CREATEOFFER_TIMEOUT")},3e3);i.createOffer(function(n){clearTimeout(o),t(n)},function(t){clearTimeout(o),n(t)},r)})];case 5:a=o.sent(),o.label=6;case 6:return i.close(),[2,u(l=a.sdp)];case 7:return t.stream.getTracks&&i.addTrack?t.stream.getTracks().forEach(function(n){i.addTrack(n,t.stream)}):i.addStream(t.stream),a=void 0,c.isSafari()||c.isFireFox()?[4,i.createOffer()]:[3,9];case 8:return a=o.sent(),[3,11];case 9:return[4,new Promise(function(t,n){i.createOffer(t,n)})];case 10:a=o.sent(),o.label=11;case 11:return i.close(),[2,u(l=a.sdp)]}})})};var u=function(t){var n={video:[],audio:[]};return t.match(/ VP8/i)&&n.video.push("VP8"),t.match(/ VP9/i)&&n.video.push("VP9"),t.match(/ H264/i)&&n.video.push("H264"),t.match(/ opus/i)&&n.audio.push("OPUS"),Promise.resolve(n)}},function(t,n,i){"use strict";var r=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(10);function s(t){for(var n="",i=0;i<t.length;i+=1)n+=String.fromCharCode(t[i]);return window.btoa(n)}n.encryptRSA=function(t){return r(void 0,void 0,void 0,function(){var n,i,r,c;return o(this,function(o){var d;switch(o.label){case 0:return n=a.base64ToUint8Array("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),[4,window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])];case 1:return i=o.sent(),d=t,r=(new TextEncoder).encode(d),[4,window.crypto.subtle.encrypt({name:"RSA-OAEP"},i,r)];case 2:return c=o.sent(),[2,s(new Uint8Array(c))]}})})}},function(t,n,i){"use strict";var r=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(i(0)),c=i(75),d=i(24),u=i(1),l=i(27);n.addLiveStreamingCapability=function(t,n){var i=this,a=function(n){var i=n.type;if(!t.joinInfo)return new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();switch(i){case l.LiveStreamingServiceMode.INJECT:return t._injectStreamingClient||(t._injectStreamingClient=new c.AgoraRTCLiveStreamingClient(t.joinInfo),t._injectStreamingClient.onInjectStatusChange=function(n,i,r){t.gatewayClient.dispatchEvent({type:"streamInjectedStatus",url:r,status:n})}),t._injectStreamingClient;case l.LiveStreamingServiceMode.RAW:return t._liveRawStreamingClient||(t._liveRawStreamingClient=new c.AgoraRTCLiveStreamingClient(t.joinInfo),t._liveRawStreamingClient.setGatewayConnectionState(t.getConnectionState()),t.on("connection-state-change",function(n){t._liveRawStreamingClient.setGatewayConnectionState(n.curState),"CONNECTING"===n.prevState&&"CONNECTED"===n.curState&&t._liveRawStreamingClient&&t._liveRawStreamingClient.resetAllTask()}),t._liveRawStreamingClient.onLiveStreamError=function(n,i){s.default.error("LIVE_STREAMING_ERROR",i.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:n,reason:i.code})},t._liveRawStreamingClient.onLiveStreamWarning=function(n,i){s.default.warning("LIVE_STREAMING_WARNING",i.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:n,reason:i.code})}),t._liveRawStreamingClient;case l.LiveStreamingServiceMode.TRANSCODE:return t._liveTranscodeStreamingClient||(t._liveTranscodeStreamingClient=new c.AgoraRTCLiveStreamingClient(t.joinInfo),t._liveTranscodeStreamingClient.setGatewayConnectionState(t.getConnectionState()),t.on("connection-state-change",function(n){t._liveTranscodeStreamingClient.setGatewayConnectionState(n.curState),"CONNECTING"===n.prevState&&"CONNECTED"===n.curState&&t._liveTranscodeStreamingClient&&t._liveTranscodeStreamingClient.resetAllTask()}),t._liveTranscodeStreamingClient.onLiveStreamError=function(n,i){s.default.error("LIVE_STREAMING_ERROR",i.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:n,reason:i.code})},t._liveTranscodeStreamingClient.onLiveStreamWarning=function(n,i){s.default.warning("LIVE_STREAMING_WARNING",i.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:n,reason:i})}),t._liveTranscodeStreamingClient}};t.gatewayClient.addEventListener("join",function(n){t._injectStreamingClient&&t._injectStreamingClient.resetAllTask()}),t.gatewayClient.addEventListener("stream-unpublished",function(n){n.options&&0===n.options.streamType&&(t._liveRawStreamingClient&&t._liveRawStreamingClient.resetAllTask(),t._liveTranscodeStreamingClient&&t._liveTranscodeStreamingClient.resetAllTask())}),t.gatewayClient.addEventListener("stream-published",function(t){}),t.startLiveStreaming=function(i,r){s.default.debug("startLiveStreaming");var o=u.report.reportApiInvoke(n.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});if(t.gatewayClient&&"audience"===t.gatewayClient.role){var a={code:403,reason:"AUDIENCE_STREAMING_FORBIDDEN"};throw o(a),a}var c=t._startLiveStreaming(i,r);return c.then(function(t){o(null,t)}).catch(function(n){s.default.error("LIVE_STREAMING_ERROR",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:i,reason:n.code}),o(n)}),c},t._startLiveStreaming=function(c,u){return r(i,void 0,void 0,function(){var i;return o(this,function(r){switch(r.label){case 0:return u||("vp8"===n.codec&&s.default.warning("VP8 is not supported by raw_streaming. Subscriber side will suffer"),"vp9"===n.codec&&s.default.warning("VP9 is not supported by raw_streaming. Subscriber side will suffer"),"rtc"===n.mode&&s.default.warning("RTC mode is not supported by raw_streaming. Subscriber side will suffer")),(t._liveRawStreamingClient&&t._liveRawStreamingClient.haveUrl(c)||t._liveTranscodeStreamingClient&&t._liveTranscodeStreamingClient.haveUrl(c))&&new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw(),[4,a({type:i=u?l.LiveStreamingServiceMode.TRANSCODE:l.LiveStreamingServiceMode.RAW}).startLiveStreamingTask(c,i)];case 1:return r.sent(),t.gatewayClient.dispatchEvent({type:"liveStreamingStarted",url:c}),[2]}})})},t.setLiveTranscoding=function(i){s.default.debug("setLiveTranscoding: "+JSON.stringify(i));var r=u.report.reportApiInvoke(n.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"});return a({type:l.LiveStreamingServiceMode.TRANSCODE}).setTranscodingConfig(i).then(function(){t.gatewayClient.dispatchEvent({type:"liveTranscodingUpdated"}),r(null)}).catch(function(n){s.default.error("SET_LIVE_TRANSCODING_ERROR",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",reason:n.code}),r(n)})},t.stopLiveStreaming=function(i){var r=u.report.reportApiInvoke(n.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"}),o=t._stopLiveStreaming(i);return o.then(function(t){r(null,t)}).catch(function(n){s.default.error("STOP_LIVE_STREAMING_ERROR",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:i,reason:n.code}),r(n)}),o},t._stopLiveStreaming=function(n){return r(this,void 0,void 0,function(){var i;return o(this,function(r){switch(r.label){case 0:return s.default.debug("stopLiveStreaming: "+JSON.stringify(n)),[4,Promise.all((i=[t._liveRawStreamingClient,t._liveTranscodeStreamingClient]).map(function(t){return t&&t.haveUrl(n)&&t.stopLiveStreamingTask(n)}))];case 1:return r.sent(),s.default.debug("stopLiveStreaming sucess: "+JSON.stringify(n)),t.gatewayClient.dispatchEvent({type:"liveStreamingStopped",url:n}),[2]}})})},t.addInjectStreamUrl=function(i,r){var o=u.report.reportApiInvoke(n.sessionId,{name:"Client.addInjectStreamUrl",options:[i,r],tag:"tracer"});if("audience"===t.gatewayClient.role){var a={code:403,reason:"AUDIENCE_INJECTING_FORBIDDEN"};throw o(a),a}var c=t._addInjectStreamUrl(i,r);return c.then(function(t){o(null,t)}).catch(function(t){s.default.error("ADD_INJECT_STREAM_ERROR",t.toString()),o(t)}),c},t._addInjectStreamUrl=function(t,n){return r(i,void 0,void 0,function(){var i;return o(this,function(r){switch(r.label){case 0:return(i=a({type:l.LiveStreamingServiceMode.INJECT})).setInjectStreamConfig(n,0),[4,i.startLiveStreamingTask(t,l.LiveStreamingServiceMode.INJECT)];case 1:return r.sent(),[2]}})})},t.removeInjectStreamUrl=function(i){return r(this,void 0,void 0,function(){var r,a;return o(this,function(o){return r=u.report.reportApiInvoke(n.sessionId,{name:"Client.removeInjectStreamUrl",options:[i],tag:"tracer"}),(a=t._removeInjectStreamUrl(i)).then(function(t){r(null,t)}).catch(function(t){s.default.error("REMOVE_INJECT_STREAM_ERROR",t.toString()),r(t)}),[2,a]})})},t._removeInjectStreamUrl=function(t){return r(i,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,a({type:l.LiveStreamingServiceMode.INJECT}).stopLiveStreamingTask(t)];case 1:return n.sent(),[2]}})})},t._terminateLiveStreaming=function(){return r(i,void 0,void 0,function(){return o(this,function(n){return[t._injectStreamingClient,t._liveRawStreamingClient,t._liveTranscodeStreamingClient].forEach(function(t){t&&t.terminate()}),[2]})})}}},function(t,n,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var o=r(i(5)),a=r(i(0)),s=i(10);n.default=function(t,n){void 0===n&&(n={width:160,height:120,framerate:15});var i=n.width,r=n.height,c=n.framerate,d=t.stream;if(!d)throw o.default.INVALID_LOCAL_STREAM;if(!d.getVideoTracks()[0])throw o.default.HIGH_STREAM_NOT_VIDEO_TRACE;var u=d.getVideoTracks()[0];a.default.debug("Start getLowStream");var l=document.createElement("video"),f=document.createElement("canvas");l.setAttribute("style","display:none"),l.setAttribute("muted",""),l.muted=!0,l.setAttribute("autoplay",""),l.autoplay=!0,l.setAttribute("playsinline",""),f.setAttribute("style","display:none"),f.setAttribute("width",i.toString()),f.setAttribute("height",r.toString());var p=f.getContext("2d");if(!p)throw Error("not get canvas context");l.srcObject=d,document.body.append(l),document.body.append(f),l.play(),a.default.debug("Start render lowStream");var _=s.audioTimerLoop(function(){return function(){if(l.paused&&l.play(),l.videoHeight>2&&l.videoWidth>2){var n=l.videoWidth,i=l.videoHeight/n,r=f.width*i;Math.abs(r-f.height)>=2&&(a.default.debug("adjust low stream resolution",f.width+"x"+f.height+" -> "+f.width+"x"+r),f.height=r)}p.drawImage(l,0,0,f.width,f.height);var o=t.stream;if(o){var s=o.getVideoTracks()[0];u!==s&&(a.default.debug("adjust low stream track"),l.srcObject=o,u=s)}}()},c),g=f.captureStream(c),h=g.getVideoTracks()[0];return h.requestFrame&&h.requestFrame(),g.clean=function(){a.default.debug("Start clean lowStream"),_(),(l||l.parentNode||l.parentNode.removeChild)&&l.parentNode.removeChild(l),(f||f.parentNode||f.parentNode.removeChild)&&f.parentNode.removeChild(f),a.default.debug("Clean lowStream")},g}},function(t,n){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);t.exports=function(){return i(r),r}}else{var o=Array(16);t.exports=function(){for(var t,n=0;n<16;n++)0==(3&n)&&(t=4294967296*Math.random()),o[n]=t>>>((3&n)<<3)&255;return o}}},function(t,n){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);t.exports=function(t,n){var r=n||0,o=i;return[o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]]].join("")}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,undefined,e,t,n,r;e={1:[function(t,n,i){n.exports=function(t,n){for(var i=Array(arguments.length-1),r=0,o=2,a=!0;o<arguments.length;)i[r++]=arguments[o++];return new Promise(function(o,s){i[r]=function(t){if(a){if(a=!1,t)s(t);else{for(var n=Array(arguments.length-1),i=0;i<n.length;)n[i++]=arguments[i];o.apply(null,n)}}};try{t.apply(n||null,i)}catch(c){a&&(a=!1,s(c))}})}},{}],2:[function(t,n,i){var r=i;r.length=function(t){var n=t.length;if(!n)return 0;for(var i=0;--n%4>1&&"="===t.charAt(n);)++i;return Math.ceil(3*t.length)/4-i};for(var o=Array(64),a=Array(123),s=0;s<64;)a[o[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(t,n,i){for(var r,a=null,s=[],c=0,d=0;n<i;){var u=t[n++];switch(d){case 0:s[c++]=o[u>>2],r=(3&u)<<4,d=1;break;case 1:s[c++]=o[r|u>>4],r=(15&u)<<2,d=2;break;case 2:s[c++]=o[r|u>>6],s[c++]=o[63&u],d=0}c>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,s)),c=0)}return d&&(s[c++]=o[r],s[c++]=61,1===d&&(s[c++]=61)),a?(c&&a.push(String.fromCharCode.apply(String,s.slice(0,c))),a.join("")):String.fromCharCode.apply(String,s.slice(0,c))},r.decode=function(t,n,i){for(var r,o=i,s=0,c=0;c<t.length;){var d=t.charCodeAt(c++);if(61===d&&s>1)break;if(undefined===(d=a[d]))throw Error("invalid encoding");switch(s){case 0:r=d,s=1;break;case 1:n[i++]=r<<2|(48&d)>>4,r=d,s=2;break;case 2:n[i++]=(15&r)<<4|(60&d)>>2,r=d,s=3;break;case 3:n[i++]=(3&r)<<6|d,s=0}}if(1===s)throw Error("invalid encoding");return i-o},r.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},{}],3:[function(t,n,i){function r(t,n){"string"==typeof t&&(n=t,t=undefined);var i=[];function o(t){if("string"!=typeof t){var n=a();if(r.verbose&&console.log("codegen: "+n),n="return "+n,t){for(var s=Object.keys(t),c=Array(s.length+1),d=Array(s.length),u=0;u<s.length;)c[u]=s[u],d[u]=t[s[u++]];return c[u]=n,Function.apply(null,c).apply(null,d)}return Function(n)()}for(var l=Array(arguments.length-1),f=0;f<l.length;)l[f]=arguments[++f];if(f=0,t=t.replace(/%([%dfijs])/g,function(t,n){var i=l[f++];switch(n){case"d":case"f":return String(Number(i));case"i":return String(Math.floor(i));case"j":return JSON.stringify(i);case"s":return String(i)}return"%"}),f!==l.length)throw Error("parameter count mismatch");return i.push(t),o}function a(r){return"function "+(r||n||"")+"("+(t&&t.join(",")||"")+"){\n  "+i.join("\n  ")+"\n}"}return o.toString=a,o}n.exports=r,r.verbose=!1},{}],4:[function(t,n,i){function r(){this._listeners={}}n.exports=r,r.prototype.on=function(t,n,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:n,ctx:i||this}),this},r.prototype.off=function(t,n){if(t===undefined)this._listeners={};else if(n===undefined)this._listeners[t]=[];else for(var i=this._listeners[t],r=0;r<i.length;)i[r].fn===n?i.splice(r,1):++r;return this},r.prototype.emit=function(t){var n=this._listeners[t];if(n){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<n.length;)n[r].fn.apply(n[r++].ctx,i)}return this}},{}],5:[function(t,n,i){n.exports=a;var r=t(1),o=t(7)("fs");function a(t,n,i){return"function"==typeof n?(i=n,n={}):n||(n={}),i?!n.xhr&&o&&o.readFile?o.readFile(t,function(r,o){return r&&"undefined"!=typeof XMLHttpRequest?a.xhr(t,n,i):r?i(r):i(null,n.binary?o:o.toString("utf8"))}):a.xhr(t,n,i):r(a,this,t,n)}a.xhr=function(t,n,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return i(Error("status "+r.status));if(n.binary){var t=r.response;if(!t){t=[];for(var o=0;o<r.responseText.length;++o)t.push(255&r.responseText.charCodeAt(o))}return i(null,"undefined"!=typeof Uint8Array?new Uint8Array(t):t)}return i(null,r.responseText)}},n.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",t),r.send()}},{1:1,7:7}],6:[function(t,n,i){function r(t){return"undefined"!=typeof Float32Array?function(){var n=new Float32Array([-0]),i=new Uint8Array(n.buffer),r=128===i[3];function o(t,r,o){n[0]=t,r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3]}function a(t,r,o){n[0]=t,r[o]=i[3],r[o+1]=i[2],r[o+2]=i[1],r[o+3]=i[0]}function s(t,r){return i[0]=t[r],i[1]=t[r+1],i[2]=t[r+2],i[3]=t[r+3],n[0]}function c(t,r){return i[3]=t[r],i[2]=t[r+1],i[1]=t[r+2],i[0]=t[r+3],n[0]}t.writeFloatLE=r?o:a,t.writeFloatBE=r?a:o,t.readFloatLE=r?s:c,t.readFloatBE=r?c:s}():function(){function n(t,n,i,r){var o=n<0?1:0;if(o&&(n=-n),0===n)t(1/n>0?0:2147483648,i,r);else if(isNaN(n))t(2143289344,i,r);else if(n>34028234663852886e22)t((o<<31|2139095040)>>>0,i,r);else if(n<11754943508222875e-54)t((o<<31|Math.round(n/1401298464324817e-60))>>>0,i,r);else{var a=Math.floor(Math.log(n)/Math.LN2);t((o<<31|a+127<<23|8388607&Math.round(n*Math.pow(2,-a)*8388608))>>>0,i,r)}}function i(t,n,i){var r=t(n,i),o=2*(r>>31)+1,a=r>>>23&255,s=8388607&r;return 255===a?s?NaN:o*(1/0):0===a?1401298464324817e-60*o*s:o*Math.pow(2,a-150)*(s+8388608)}t.writeFloatLE=n.bind(null,o),t.writeFloatBE=n.bind(null,a),t.readFloatLE=i.bind(null,s),t.readFloatBE=i.bind(null,c)}(),"undefined"!=typeof Float64Array?function(){var n=new Float64Array([-0]),i=new Uint8Array(n.buffer),r=128===i[7];function o(t,r,o){n[0]=t,r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],r[o+4]=i[4],r[o+5]=i[5],r[o+6]=i[6],r[o+7]=i[7]}function a(t,r,o){n[0]=t,r[o]=i[7],r[o+1]=i[6],r[o+2]=i[5],r[o+3]=i[4],r[o+4]=i[3],r[o+5]=i[2],r[o+6]=i[1],r[o+7]=i[0]}function s(t,r){return i[0]=t[r],i[1]=t[r+1],i[2]=t[r+2],i[3]=t[r+3],i[4]=t[r+4],i[5]=t[r+5],i[6]=t[r+6],i[7]=t[r+7],n[0]}function c(t,r){return i[7]=t[r],i[6]=t[r+1],i[5]=t[r+2],i[4]=t[r+3],i[3]=t[r+4],i[2]=t[r+5],i[1]=t[r+6],i[0]=t[r+7],n[0]}t.writeDoubleLE=r?o:a,t.writeDoubleBE=r?a:o,t.readDoubleLE=r?s:c,t.readDoubleBE=r?c:s}():function(){function n(t,n,i,r,o,a){var s,c=r<0?1:0;if(c&&(r=-r),0===r)t(0,o,a+n),t(1/r>0?0:2147483648,o,a+i);else if(isNaN(r))t(0,o,a+n),t(2146959360,o,a+i);else if(r>17976931348623157e292)t(0,o,a+n),t((c<<31|2146435072)>>>0,o,a+i);else if(r<22250738585072014e-324)t((s=r/5e-324)>>>0,o,a+n),t((c<<31|s/4294967296)>>>0,o,a+i);else{var d=Math.floor(Math.log(r)/Math.LN2);1024===d&&(d=1023),t(4503599627370496*(s=r*Math.pow(2,-d))>>>0,o,a+n),t((c<<31|d+1023<<20|1048576*s&1048575)>>>0,o,a+i)}}function i(t,n,i,r,o){var a=t(r,o+n),s=t(r,o+i),c=2*(s>>31)+1,d=s>>>20&2047,u=4294967296*(1048575&s)+a;return 2047===d?u?NaN:c*(1/0):0===d?5e-324*c*u:c*Math.pow(2,d-1075)*(u+4503599627370496)}t.writeDoubleLE=n.bind(null,o,0,4),t.writeDoubleBE=n.bind(null,a,4,0),t.readDoubleLE=i.bind(null,s,0,4),t.readDoubleBE=i.bind(null,c,4,0)}(),t}function o(t,n,i){n[i]=255&t,n[i+1]=t>>>8&255,n[i+2]=t>>>16&255,n[i+3]=t>>>24}function a(t,n,i){n[i]=t>>>24,n[i+1]=t>>>16&255,n[i+2]=t>>>8&255,n[i+3]=255&t}function s(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0}function c(t,n){return(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3])>>>0}n.exports=r(r)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],8:[function(t,n,i){var r=i,o=r.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},a=r.normalize=function(t){var n=(t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),i=o(t),r="";i&&(r=n.shift()+"/");for(var a=0;a<n.length;)".."===n[a]?a>0&&".."!==n[a-1]?n.splice(--a,2):i?n.splice(a,1):++a:"."===n[a]?n.splice(a,1):++a;return r+n.join("/")};r.resolve=function(t,n,i){return i||(n=a(n)),o(n)?n:(i||(t=a(t)),(t=t.replace(/(?:\/|^)[^/]+$/,"")).length?a(t+"/"+n):n)}},{}],9:[function(t,n,i){n.exports=function(t,n,i){var r=i||8192,o=r>>>1,a=null,s=r;return function(i){if(i<1||i>o)return t(i);s+i>r&&(a=t(r),s=0);var c=n.call(a,s,s+=i);return 7&s&&(s=1+(7|s)),c}}},{}],10:[function(t,n,i){var r=i;r.length=function(t){for(var n=0,i=0,r=0;r<t.length;++r)(i=t.charCodeAt(r))<128?n+=1:i<2048?n+=2:55296==(64512&i)&&56320==(64512&t.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},r.read=function(t,n,i){if(i-n<1)return"";for(var r,o=null,a=[],s=0;n<i;)(r=t[n++])<128?a[s++]=r:r>191&&r<224?a[s++]=(31&r)<<6|63&t[n++]:r>239&&r<365?(r=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,a[s++]=55296+(r>>10),a[s++]=56320+(1023&r)):a[s++]=(15&r)<<12|(63&t[n++])<<6|63&t[n++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},r.write=function(t,n,i){for(var r,o,a=i,s=0;s<t.length;++s)(r=t.charCodeAt(s))<128?n[i++]=r:r<2048?(n[i++]=r>>6|192,n[i++]=63&r|128):55296==(64512&r)&&56320==(64512&(o=t.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&o),++s,n[i++]=r>>18|240,n[i++]=r>>12&63|128,n[i++]=r>>6&63|128,n[i++]=63&r|128):(n[i++]=r>>12|224,n[i++]=r>>6&63|128,n[i++]=63&r|128);return i-a}},{}],11:[function(t,n,i){var r=i,o=t(14),a=t(33);function s(t,n,i,r){if(n.resolvedType){if(n.resolvedType instanceof o){t("switch(d%s){",r);for(var a=n.resolvedType.values,s=Object.keys(a),c=0;c<s.length;++c)n.repeated&&a[s[c]]===n.typeDefault&&t("default:"),t("case%j:",s[c])("case %i:",a[s[c]])("m%s=%j",r,a[s[c]])("break");t("}")}else t('if(typeof d%s!=="object")',r)("throw TypeError(%j)",n.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,i,r)}else{var d=!1;switch(n.type){case"double":case"float":t("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":t("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":t("m%s=d%s|0",r,r);break;case"uint64":d=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,d)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,d?"true":"");break;case"bytes":t('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":t("m%s=String(d%s)",r,r);break;case"bool":t("m%s=Boolean(d%s)",r,r)}}return t}function c(t,n,i,r){if(n.resolvedType)n.resolvedType instanceof o?t("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,i,r,r):t("d%s=types[%i].toObject(m%s,o)",r,i,r);else{var a=!1;switch(n.type){case"double":case"float":t("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":a=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,a?"true":"",r);break;case"bytes":t("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:t("d%s=m%s",r,r)}}return t}r.fromObject=function(t){var n=t.fieldsArray,i=a.codegen(["d"],t.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!n.length)return i("return new this.ctor");i("var m=new this.ctor");for(var r=0;r<n.length;++r){var c=n[r].resolve(),d=a.safeProp(c.name);c.map?(i("if(d%s){",d)('if(typeof d%s!=="object")',d)("throw TypeError(%j)",c.fullName+": object expected")("m%s={}",d)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",d),s(i,c,r,d+"[ks[i]]")("}")("}")):c.repeated?(i("if(d%s){",d)("if(!Array.isArray(d%s))",d)("throw TypeError(%j)",c.fullName+": array expected")("m%s=[]",d)("for(var i=0;i<d%s.length;++i){",d),s(i,c,r,d+"[i]")("}")("}")):(c.resolvedType instanceof o||i("if(d%s!=null){",d),s(i,c,r,d),c.resolvedType instanceof o||i("}"))}return i("return m")},r.toObject=function(t){var n=t.fieldsArray.slice().sort(a.compareFieldsById);if(!n.length)return a.codegen()("return {}");for(var i=a.codegen(["m","o"],t.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],s=[],d=[],u=0;u<n.length;++u)n[u].partOf||(n[u].resolve().repeated?r:n[u].map?s:d).push(n[u]);if(r.length){for(i("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)i("d%s=[]",a.safeProp(r[u].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),u=0;u<s.length;++u)i("d%s={}",a.safeProp(s[u].name));i("}")}if(d.length){for(i("if(o.defaults){"),u=0;u<d.length;++u){var l=d[u],f=a.safeProp(l.name);if(l.resolvedType instanceof o)i("d%s=o.enums===String?%j:%j",f,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",f)("}else")("d%s=o.longs===String?%j:%i",f,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var p="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",f,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",f,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",f,f)("}")}else i("d%s=%j",f,l.typeDefault)}i("}")}var _=!1;for(u=0;u<n.length;++u){l=n[u];var g=t._fieldsArray.indexOf(l);f=a.safeProp(l.name),l.map?(_||(_=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",f,f)("d%s={}",f)("for(var j=0;j<ks2.length;++j){"),c(i,l,g,f+"[ks2[j]]")("}")):l.repeated?(i("if(m%s&&m%s.length){",f,f)("d%s=[]",f)("for(var j=0;j<m%s.length;++j){",f),c(i,l,g,f+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",f,l.name),c(i,l,g,f),l.partOf&&i("if(o.oneofs)")("d%s=%j",a.safeProp(l.partOf.name),l.name)),i("}")}return i("return d")}},{14:14,33:33}],12:[function(t,n,i){n.exports=function(t){var n=a.codegen(["r","l"],t.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(t.fieldsArray.filter(function(t){return t.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");t.group&&n("if((t&7)===4)")("break"),n("switch(t>>>3){");for(var i=0;i<t.fieldsArray.length;++i){var c=t._fieldsArray[i].resolve(),d=c.resolvedType instanceof r?"int32":c.type,u="m"+a.safeProp(c.name);n("case %i:",c.id),c.map?(n("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),undefined!==o.defaults[c.keyType]?n("k=%j",o.defaults[c.keyType]):n("k=null"),undefined!==o.defaults[d]?n("value=%j",o.defaults[d]):n("value=null"),n("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",c.keyType)("case 2:"),undefined===o.basic[d]?n("value=types[%i].decode(r,r.uint32())",i):n("value=r.%s()",d),n("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),n(undefined!==o.long[c.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):c.repeated?(n("if(!(%s&&%s.length))",u,u)("%s=[]",u),undefined!==o.packed[d]&&n("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,d)("}else"),undefined===o.basic[d]?n(c.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,i):n("%s.push(r.%s())",u,d)):undefined===o.basic[d]?n(c.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,i):n("%s=r.%s()",u,d),n("break")}for(n("default:")("r.skipType(t&7)")("break")("}")("}"),i=0;i<t._fieldsArray.length;++i){var l=t._fieldsArray[i];l.required&&n("if(!m.hasOwnProperty(%j))",l.name)("throw util.ProtocolError(%j,{instance:m})",s(l))}return n("return m")};var r=t(14),o=t(32),a=t(33);function s(t){return"missing required '"+t.name+"'"}},{14:14,32:32,33:33}],13:[function(t,n,i){n.exports=function(t){for(var n,i=a.codegen(["m","w"],t.name+"$encode")("if(!w)")("w=Writer.create()"),c=t.fieldsArray.slice().sort(a.compareFieldsById),d=0;d<c.length;++d){var u=c[d].resolve(),l=t._fieldsArray.indexOf(u),f=u.resolvedType instanceof r?"int32":u.type,p=o.basic[f];n="m"+a.safeProp(u.name),u.map?(i("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|o.mapKey[u.keyType],u.keyType),p===undefined?i("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,n):i(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,f,n),i("}")("}")):u.repeated?(i("if(%s!=null&&%s.length){",n,n),u.packed&&undefined!==o.packed[f]?i("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",f,n)("w.ldelim()"):(i("for(var i=0;i<%s.length;++i)",n),p===undefined?s(i,u,l,n+"[i]"):i("w.uint32(%i).%s(%s[i])",(u.id<<3|p)>>>0,f,n)),i("}")):(u.optional&&i("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,u.name),p===undefined?s(i,u,l,n):i("w.uint32(%i).%s(%s)",(u.id<<3|p)>>>0,f,n))}return i("return w")};var r=t(14),o=t(32),a=t(33);function s(t,n,i,r){return n.resolvedType.group?t("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",i,r,(n.id<<3|3)>>>0,(n.id<<3|4)>>>0):t("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",i,r,(n.id<<3|2)>>>0)}},{14:14,32:32,33:33}],14:[function(t,n,i){n.exports=s;var r=t(22);((s.prototype=Object.create(r.prototype)).constructor=s).className="Enum";var o=t(21),a=t(33);function s(t,n,i,o,a){if(r.call(this,t,i),n&&"object"!=typeof n)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=o,this.comments=a||{},this.reserved=undefined,n)for(var s=Object.keys(n),c=0;c<s.length;++c)"number"==typeof n[s[c]]&&(this.valuesById[this.values[s[c]]=n[s[c]]]=s[c])}s.fromJSON=function(t,n){var i=new s(t,n.values,n.options,n.comment,n.comments);return i.reserved=n.reserved,i},s.prototype.toJSON=function(t){var n=!!t&&Boolean(t.keepComments);return a.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"comment",n?this.comment:undefined,"comments",n?this.comments:undefined])},s.prototype.add=function(t,n,i){if(!a.isString(t))throw TypeError("name must be a string");if(!a.isInteger(n))throw TypeError("id must be an integer");if(undefined!==this.values[t])throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(n))throw Error("id "+n+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(undefined!==this.valuesById[n]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+n+" in "+this);this.values[t]=n}else this.valuesById[this.values[t]=n]=t;return this.comments[t]=i||null,this},s.prototype.remove=function(t){if(!a.isString(t))throw TypeError("name must be a string");var n=this.values[t];if(null==n)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[n],delete this.values[t],delete this.comments[t],this},s.prototype.isReservedId=function(t){return o.isReservedId(this.reserved,t)},s.prototype.isReservedName=function(t){return o.isReservedName(this.reserved,t)}},{21:21,22:22,33:33}],15:[function(t,n,i){n.exports=u;var r=t(22);((u.prototype=Object.create(r.prototype)).constructor=u).className="Field";var o,a=t(14),s=t(32),c=t(33),d=/^required|optional|repeated$/;function u(t,n,i,o,a,u,l){if(c.isObject(o)?(l=a,u=o,o=a=undefined):c.isObject(a)&&(l=u,u=a,a=undefined),r.call(this,t,u),!c.isInteger(n)||n<0)throw TypeError("id must be a non-negative integer");if(!c.isString(i))throw TypeError("type must be a string");if(o!==undefined&&!d.test(o=o.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(a!==undefined&&!c.isString(a))throw TypeError("extend must be a string");this.rule=o&&"optional"!==o?o:undefined,this.type=i,this.id=n,this.extend=a||undefined,this.required="required"===o,this.optional=!this.required,this.repeated="repeated"===o,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!c.Long&&undefined!==s.long[i],this.bytes="bytes"===i,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}u.fromJSON=function(t,n){return new u(t,n.id,n.type,n.rule,n.extend,n.options,n.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(t,n,i){return"packed"===t&&(this._packed=null),r.prototype.setOption.call(this,t,n,i)},u.prototype.toJSON=function(t){var n=!!t&&Boolean(t.keepComments);return c.toObject(["rule","optional"!==this.rule&&this.rule||undefined,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",n?this.comment:undefined])},u.prototype.resolve=function(){if(this.resolved)return this;if(undefined===(this.typeDefault=s.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof o?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof a&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(undefined===this.options.packed||!this.resolvedType||this.resolvedType instanceof a)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined)),this.long)this.typeDefault=c.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var t;c.base64.test(this.typeDefault)?c.base64.decode(this.typeDefault,t=c.newBuffer(c.base64.length(this.typeDefault)),0):c.utf8.write(this.typeDefault,t=c.newBuffer(c.utf8.length(this.typeDefault)),0),this.typeDefault=t}return this.map?this.defaultValue=c.emptyObject:this.repeated?this.defaultValue=c.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof o&&(this.parent.ctor.prototype[this.name]=this.defaultValue),r.prototype.resolve.call(this)},u.d=function(t,n,i,r){return"function"==typeof n?n=c.decorateType(n).name:n&&"object"==typeof n&&(n=c.decorateEnum(n).name),function(o,a){c.decorateType(o.constructor).add(new u(a,t,n,i,{default:r}))}},u._configure=function(t){o=t}},{14:14,22:22,32:32,33:33}],16:[function(t,n,i){var r=n.exports=t(17);r.build="light",r.load=function(t,n,i){return"function"==typeof n?(i=n,n=new r.Root):n||(n=new r.Root),n.load(t,i)},r.loadSync=function(t,n){return n||(n=new r.Root),n.loadSync(t)},r.encoder=t(13),r.decoder=t(12),r.verifier=t(36),r.converter=t(11),r.ReflectionObject=t(22),r.Namespace=t(21),r.Root=t(26),r.Enum=t(14),r.Type=t(31),r.Field=t(15),r.OneOf=t(23),r.MapField=t(18),r.Service=t(30),r.Method=t(20),r.Message=t(19),r.wrappers=t(37),r.types=t(32),r.util=t(33),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},{11:11,12:12,13:13,14:14,15:15,17:17,18:18,19:19,20:20,21:21,22:22,23:23,26:26,30:30,31:31,32:32,33:33,36:36,37:37}],17:[function(t,n,i){var r=i;function o(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=t(38),r.BufferWriter=t(39),r.Reader=t(24),r.BufferReader=t(25),r.util=t(35),r.rpc=t(28),r.roots=t(27),r.configure=o,o()},{24:24,25:25,27:27,28:28,35:35,38:38,39:39}],18:[function(t,n,i){n.exports=s;var r=t(15);((s.prototype=Object.create(r.prototype)).constructor=s).className="MapField";var o=t(32),a=t(33);function s(t,n,i,o,s,c){if(r.call(this,t,n,o,undefined,undefined,s,c),!a.isString(i))throw TypeError("keyType must be a string");this.keyType=i,this.resolvedKeyType=null,this.map=!0}s.fromJSON=function(t,n){return new s(t,n.id,n.keyType,n.type,n.options,n.comment)},s.prototype.toJSON=function(t){var n=!!t&&Boolean(t.keepComments);return a.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",n?this.comment:undefined])},s.prototype.resolve=function(){if(this.resolved)return this;if(undefined===o.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},s.d=function(t,n,i){return"function"==typeof i?i=a.decorateType(i).name:i&&"object"==typeof i&&(i=a.decorateEnum(i).name),function(r,o){a.decorateType(r.constructor).add(new s(o,t,n,i))}}},{15:15,32:32,33:33}],19:[function(t,n,i){n.exports=o;var r=t(35);function o(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)this[n[i]]=t[n[i]]}o.create=function(t){return this.$type.create(t)},o.encode=function(t,n){return this.$type.encode(t,n)},o.encodeDelimited=function(t,n){return this.$type.encodeDelimited(t,n)},o.decode=function(t){return this.$type.decode(t)},o.decodeDelimited=function(t){return this.$type.decodeDelimited(t)},o.verify=function(t){return this.$type.verify(t)},o.fromObject=function(t){return this.$type.fromObject(t)},o.toObject=function(t,n){return this.$type.toObject(t,n)},o.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},{35:35}],20:[function(t,n,i){n.exports=a;var r=t(22);((a.prototype=Object.create(r.prototype)).constructor=a).className="Method";var o=t(33);function a(t,n,i,a,s,c,d,u){if(o.isObject(s)?(d=s,s=c=undefined):o.isObject(c)&&(d=c,c=undefined),n!==undefined&&!o.isString(n))throw TypeError("type must be a string");if(!o.isString(i))throw TypeError("requestType must be a string");if(!o.isString(a))throw TypeError("responseType must be a string");r.call(this,t,d),this.type=n||"rpc",this.requestType=i,this.requestStream=!!s||undefined,this.responseType=a,this.responseStream=!!c||undefined,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u}a.fromJSON=function(t,n){return new a(t,n.type,n.requestType,n.responseType,n.requestStream,n.responseStream,n.options,n.comment)},a.prototype.toJSON=function(t){var n=!!t&&Boolean(t.keepComments);return o.toObject(["type","rpc"!==this.type&&this.type||undefined,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",n?this.comment:undefined])},a.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},{22:22,33:33}],21:[function(t,n,i){n.exports=l;var r=t(22);((l.prototype=Object.create(r.prototype)).constructor=l).className="Namespace";var o,a,s,c=t(15),d=t(33);function u(t,n){if(t&&t.length){for(var i={},r=0;r<t.length;++r)i[t[r].name]=t[r].toJSON(n);return i}}function l(t,n){r.call(this,t,n),this.nested=undefined,this._nestedArray=null}function f(t){return t._nestedArray=null,t}l.fromJSON=function(t,n){return new l(t,n.options).addJSON(n.nested)},l.arrayToJSON=u,l.isReservedId=function(t,n){if(t){for(var i=0;i<t.length;++i)if("string"!=typeof t[i]&&t[i][0]<=n&&t[i][1]>n)return!0}return!1},l.isReservedName=function(t,n){if(t){for(var i=0;i<t.length;++i)if(t[i]===n)return!0}return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=d.toArray(this.nested))}}),l.prototype.toJSON=function(t){return d.toObject(["options",this.options,"nested",u(this.nestedArray,t)])},l.prototype.addJSON=function(t){if(t)for(var n,i=Object.keys(t),r=0;r<i.length;++r)n=t[i[r]],this.add((undefined!==n.fields?o.fromJSON:undefined!==n.values?s.fromJSON:undefined!==n.methods?a.fromJSON:undefined!==n.id?c.fromJSON:l.fromJSON)(i[r],n));return this},l.prototype.get=function(t){return this.nested&&this.nested[t]||null},l.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof s)return this.nested[t].values;throw Error("no such enum: "+t)},l.prototype.add=function(t){if(!(t instanceof c&&undefined!==t.extend||t instanceof o||t instanceof s||t instanceof a||t instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var n=this.get(t.name);if(n){if(!(n instanceof l&&t instanceof l)||n instanceof o||n instanceof a)throw Error("duplicate name '"+t.name+"' in "+this);for(var i=n.nestedArray,r=0;r<i.length;++r)t.add(i[r]);this.remove(n),this.nested||(this.nested={}),t.setOptions(n.options,!0)}}else this.nested={};return this.nested[t.name]=t,t.onAdd(this),f(this)},l.prototype.remove=function(t){if(!(t instanceof r))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=undefined),t.onRemove(this),f(this)},l.prototype.define=function(t,n){if(d.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&""===t[0])throw Error("path must be relative");for(var i=this;t.length>0;){var r=t.shift();if(i.nested&&i.nested[r]){if(!((i=i.nested[r])instanceof l))throw Error("path conflicts with non-namespace objects")}else i.add(i=new l(r))}return n&&i.addJSON(n),i},l.prototype.resolveAll=function(){for(var t=this.nestedArray,n=0;n<t.length;)t[n]instanceof l?t[n++].resolveAll():t[n++].resolve();return this.resolve()},l.prototype.lookup=function(t,n,i){if("boolean"==typeof n?(i=n,n=undefined):n&&!Array.isArray(n)&&(n=[n]),d.isString(t)&&t.length){if("."===t)return this.root;t=t.split(".")}else if(!t.length)return this;if(""===t[0])return this.root.lookup(t.slice(1),n);var r=this.get(t[0]);if(r){if(1===t.length){if(!n||n.indexOf(r.constructor)>-1)return r}else if(r instanceof l&&(r=r.lookup(t.slice(1),n,!0)))return r}else for(var o=0;o<this.nestedArray.length;++o)if(this._nestedArray[o]instanceof l&&(r=this._nestedArray[o].lookup(t,n,!0)))return r;return null===this.parent||i?null:this.parent.lookup(t,n)},l.prototype.lookupType=function(t){var n=this.lookup(t,[o]);if(!n)throw Error("no such type: "+t);return n},l.prototype.lookupEnum=function(t){var n=this.lookup(t,[s]);if(!n)throw Error("no such Enum '"+t+"' in "+this);return n},l.prototype.lookupTypeOrEnum=function(t){var n=this.lookup(t,[o,s]);if(!n)throw Error("no such Type or Enum '"+t+"' in "+this);return n},l.prototype.lookupService=function(t){var n=this.lookup(t,[a]);if(!n)throw Error("no such Service '"+t+"' in "+this);return n},l._configure=function(t,n,i){o=t,a=n,s=i}},{15:15,22:22,33:33}],22:[function(t,n,i){n.exports=a,a.className="ReflectionObject";var r,o=t(33);function a(t,n){if(!o.isString(t))throw TypeError("name must be a string");if(n&&!o.isObject(n))throw TypeError("options must be an object");this.options=n,this.parsedOptions=null,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(a.prototype,{root:{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t}},fullName:{get:function(){for(var t=[this.name],n=this.parent;n;)t.unshift(n.name),n=n.parent;return t.join(".")}}}),a.prototype.toJSON=function(){throw Error()},a.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;var n=t.root;n instanceof r&&n._handleAdd(this)},a.prototype.onRemove=function(t){var n=t.root;n instanceof r&&n._handleRemove(this),this.parent=null,this.resolved=!1},a.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},a.prototype.getOption=function(t){return this.options?this.options[t]:undefined},a.prototype.setOption=function(t,n,i){return i&&this.options&&undefined!==this.options[t]||((this.options||(this.options={}))[t]=n),this},a.prototype.setParsedOption=function(t,n,i){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(i){var a=r.find(function(n){return Object.prototype.hasOwnProperty.call(n,t)});if(a){var s=a[t];o.setProperty(s,i,n)}else(a={})[t]=o.setProperty({},i,n),r.push(a)}else{var c={};c[t]=n,r.push(c)}return this},a.prototype.setOptions=function(t,n){if(t)for(var i=Object.keys(t),r=0;r<i.length;++r)this.setOption(i[r],t[i[r]],n);return this},a.prototype.toString=function(){var t=this.constructor.className,n=this.fullName;return n.length?t+" "+n:t},a._configure=function(t){r=t}},{33:33}],23:[function(t,n,i){n.exports=s;var r=t(22);((s.prototype=Object.create(r.prototype)).constructor=s).className="OneOf";var o=t(15),a=t(33);function s(t,n,i,o){if(Array.isArray(n)||(i=n,n=undefined),r.call(this,t,i),n!==undefined&&!Array.isArray(n))throw TypeError("fieldNames must be an Array");this.oneof=n||[],this.fieldsArray=[],this.comment=o}function c(t){if(t.parent)for(var n=0;n<t.fieldsArray.length;++n)t.fieldsArray[n].parent||t.parent.add(t.fieldsArray[n])}s.fromJSON=function(t,n){return new s(t,n.oneof,n.options,n.comment)},s.prototype.toJSON=function(t){var n=!!t&&Boolean(t.keepComments);return a.toObject(["options",this.options,"oneof",this.oneof,"comment",n?this.comment:undefined])},s.prototype.add=function(t){if(!(t instanceof o))throw TypeError("field must be a Field");return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),t.partOf=this,c(this),this},s.prototype.remove=function(t){if(!(t instanceof o))throw TypeError("field must be a Field");var n=this.fieldsArray.indexOf(t);if(n<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(n,1),(n=this.oneof.indexOf(t.name))>-1&&this.oneof.splice(n,1),t.partOf=null,this},s.prototype.onAdd=function(t){r.prototype.onAdd.call(this,t);for(var n=0;n<this.oneof.length;++n){var i=t.get(this.oneof[n]);i&&!i.partOf&&(i.partOf=this,this.fieldsArray.push(i))}c(this)},s.prototype.onRemove=function(t){for(var n,i=0;i<this.fieldsArray.length;++i)(n=this.fieldsArray[i]).parent&&n.parent.remove(n);r.prototype.onRemove.call(this,t)},s.d=function(){for(var t=Array(arguments.length),n=0;n<arguments.length;)t[n]=arguments[n++];return function(n,i){a.decorateType(n.constructor).add(new s(i,t)),Object.defineProperty(n,i,{get:a.oneOfGetter(t),set:a.oneOfSetter(t)})}}},{15:15,22:22,33:33}],24:[function(t,n,i){n.exports=d;var r,o=t(35),a=o.LongBits,s=o.utf8;function c(t,n){return RangeError("index out of range: "+t.pos+" + "+(n||1)+" > "+t.len)}function d(t){this.buf=t,this.pos=0,this.len=t.length}var u,l="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new d(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new d(t);throw Error("illegal buffer")},f=function(){return o.Buffer?function(t){return(d.create=function(t){return o.Buffer.isBuffer(t)?new r(t):l(t)})(t)}:l};function p(){var t=new a(0,0),n=0;if(!(this.len-this.pos>4)){for(;n<3;++n){if(this.pos>=this.len)throw c(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*n)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*n)>>>0,t}for(;n<4;++n)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*n)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(n=0,this.len-this.pos>4){for(;n<5;++n)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*n+3)>>>0,this.buf[this.pos++]<128)return t}else for(;n<5;++n){if(this.pos>=this.len)throw c(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*n+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function _(t,n){return(t[n-4]|t[n-3]<<8|t[n-2]<<16|t[n-1]<<24)>>>0}function g(){if(this.pos+8>this.len)throw c(this,8);return new a(_(this.buf,this.pos+=4),_(this.buf,this.pos+=4))}d.create=f(),d.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,d.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return u;if((this.pos+=5)>this.len)throw this.pos=this.len,c(this,10);return u}),d.prototype.int32=function(){return 0|this.uint32()},d.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},d.prototype.bool=function(){return 0!==this.uint32()},d.prototype.fixed32=function(){if(this.pos+4>this.len)throw c(this,4);return _(this.buf,this.pos+=4)},d.prototype.sfixed32=function(){if(this.pos+4>this.len)throw c(this,4);return 0|_(this.buf,this.pos+=4)},d.prototype.float=function(){if(this.pos+4>this.len)throw c(this,4);var t=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},d.prototype.double=function(){if(this.pos+8>this.len)throw c(this,4);var t=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},d.prototype.bytes=function(){var t=this.uint32(),n=this.pos,i=this.pos+t;if(i>this.len)throw c(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(n,i):n===i?new this.buf.constructor(0):this._slice.call(this.buf,n,i)},d.prototype.string=function(){var t=this.bytes();return s.read(t,0,t.length)},d.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw c(this,t);this.pos+=t}else do if(this.pos>=this.len)throw c(this);while(128&this.buf[this.pos++]);return this},d.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},d._configure=function(t){r=t,d.create=f(),r._configure();var n=o.Long?"toLong":"toNumber";o.merge(d.prototype,{int64:function(){return p.call(this)[n](!1)},uint64:function(){return p.call(this)[n](!0)},sint64:function(){return p.call(this).zzDecode()[n](!1)},fixed64:function(){return g.call(this)[n](!0)},sfixed64:function(){return g.call(this)[n](!1)}})}},{35:35}],25:[function(t,n,i){n.exports=a;var r=t(24);(a.prototype=Object.create(r.prototype)).constructor=a;var o=t(35);function a(t){r.call(this,t)}a._configure=function(){o.Buffer&&(a.prototype._slice=o.Buffer.prototype.slice)},a.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},a._configure()},{24:24,35:35}],26:[function(t,n,i){n.exports=f;var r=t(21);((f.prototype=Object.create(r.prototype)).constructor=f).className="Root";var o,a,s,c=t(15),d=t(14),u=t(23),l=t(33);function f(t){r.call(this,"",t),this.deferred=[],this.files=[]}function p(){}f.fromJSON=function(t,n){return n||(n=new f),t.options&&n.setOptions(t.options),n.addJSON(t.nested)},f.prototype.resolvePath=l.path.resolve,f.prototype.fetch=l.fetch,f.prototype.load=function t(n,i,r){"function"==typeof i&&(r=i,i=undefined);var o=this;if(!r)return l.asPromise(t,o,n,i);var c=r===p;function d(t,n){if(r){var i=r;if(r=null,c)throw t;i(t,n)}}function u(t){var n=t.lastIndexOf("google/protobuf/");if(n>-1){var i=t.substring(n);if(i in s)return i}return null}function f(t,n){try{if(l.isString(n)&&"{"===n.charAt(0)&&(n=JSON.parse(n)),l.isString(n)){a.filename=t;var r,s=a(n,o,i),f=0;if(s.imports)for(;f<s.imports.length;++f)(r=u(s.imports[f])||o.resolvePath(t,s.imports[f]))&&_(r);if(s.weakImports)for(f=0;f<s.weakImports.length;++f)(r=u(s.weakImports[f])||o.resolvePath(t,s.weakImports[f]))&&_(r,!0)}else o.setOptions(n.options).addJSON(n.nested)}catch(p){d(p)}c||g||d(null,o)}function _(t,n){if(!(o.files.indexOf(t)>-1)){if(o.files.push(t),t in s)c?f(t,s[t]):(++g,setTimeout(function(){--g,f(t,s[t])}));else if(c){var i;try{i=l.fs.readFileSync(t).toString("utf8")}catch(a){return void(n||d(a))}f(t,i)}else++g,o.fetch(t,function(i,a){--g,r&&(i?n?g||d(null,o):d(i):f(t,a))})}}var g=0;l.isString(n)&&(n=[n]);for(var h,m=0;m<n.length;++m)(h=o.resolvePath("",n[m]))&&_(h);return c?o:void(g||d(null,o))},f.prototype.loadSync=function(t,n){if(!l.isNode)throw Error("not supported");return this.load(t,n,p)},f.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return r.prototype.resolveAll.call(this)};var _=/^[A-Z]/;function g(t,n){var i=n.parent.lookup(n.extend);if(i){var r=new c(n.fullName,n.id,n.type,n.rule,undefined,n.options);return r.declaringField=n,n.extensionField=r,i.add(r),!0}return!1}f.prototype._handleAdd=function(t){if(t instanceof c)undefined===t.extend||t.extensionField||g(0,t)||this.deferred.push(t);else if(t instanceof d)_.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof u)){if(t instanceof o)for(var n=0;n<this.deferred.length;)g(0,this.deferred[n])?this.deferred.splice(n,1):++n;for(var i=0;i<t.nestedArray.length;++i)this._handleAdd(t._nestedArray[i]);_.test(t.name)&&(t.parent[t.name]=t)}},f.prototype._handleRemove=function(t){if(t instanceof c){if(undefined!==t.extend){if(t.extensionField)t.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var n=this.deferred.indexOf(t);n>-1&&this.deferred.splice(n,1)}}}else if(t instanceof d)_.test(t.name)&&delete t.parent[t.name];else if(t instanceof r){for(var i=0;i<t.nestedArray.length;++i)this._handleRemove(t._nestedArray[i]);_.test(t.name)&&delete t.parent[t.name]}},f._configure=function(t,n,i){o=t,a=n,s=i}},{14:14,15:15,21:21,23:23,33:33}],27:[function(t,n,i){n.exports={}},{}],28:[function(t,n,i){i.Service=t(29)},{29:29}],29:[function(t,n,i){n.exports=o;var r=t(35);function o(t,n,i){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(n),this.responseDelimited=Boolean(i)}(o.prototype=Object.create(r.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function t(n,i,o,a,s){if(!a)throw TypeError("request must be specified");var c=this;if(!s)return r.asPromise(t,c,n,i,o,a);if(!c.rpcImpl)return void setTimeout(function(){s(Error("already ended"))},0);try{return c.rpcImpl(n,i[c.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(t,i){if(t)return c.emit("error",t,n),s(t);if(null===i)return void c.end(!0);if(!(i instanceof o))try{i=o[c.responseDelimited?"decodeDelimited":"decode"](i)}catch(r){return c.emit("error",r,n),s(r)}return c.emit("data",i,n),s(null,i)})}catch(d){return c.emit("error",d,n),void setTimeout(function(){s(d)},0)}},o.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{35:35}],30:[function(t,n,i){n.exports=c;var r=t(21);((c.prototype=Object.create(r.prototype)).constructor=c).className="Service";var o=t(20),a=t(33),s=t(28);function c(t,n){r.call(this,t,n),this.methods={},this._methodsArray=null}function d(t){return t._methodsArray=null,t}c.fromJSON=function(t,n){var i=new c(t,n.options);if(n.methods)for(var r=Object.keys(n.methods),a=0;a<r.length;++a)i.add(o.fromJSON(r[a],n.methods[r[a]]));return n.nested&&i.addJSON(n.nested),i.comment=n.comment,i},c.prototype.toJSON=function(t){var n=r.prototype.toJSON.call(this,t),i=!!t&&Boolean(t.keepComments);return a.toObject(["options",n&&n.options||undefined,"methods",r.arrayToJSON(this.methodsArray,t)||{},"nested",n&&n.nested||undefined,"comment",i?this.comment:undefined])},Object.defineProperty(c.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=a.toArray(this.methods))}}),c.prototype.get=function(t){return this.methods[t]||r.prototype.get.call(this,t)},c.prototype.resolveAll=function(){for(var t=this.methodsArray,n=0;n<t.length;++n)t[n].resolve();return r.prototype.resolve.call(this)},c.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof o?(this.methods[t.name]=t,t.parent=this,d(this)):r.prototype.add.call(this,t)},c.prototype.remove=function(t){if(t instanceof o){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,d(this)}return r.prototype.remove.call(this,t)},c.prototype.create=function(t,n,i){for(var r,o=new s.Service(t,n,i),c=0;c<this.methodsArray.length;++c){var d=a.lcFirst((r=this._methodsArray[c]).resolve().name).replace(/[^$\w_]/g,"");o[d]=a.codegen(["r","c"],a.isReserved(d)?d+"_":d)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return o}},{20:20,21:21,28:28,33:33}],31:[function(t,n,i){n.exports=$;var r=t(21);(($.prototype=Object.create(r.prototype)).constructor=$).className="Type";var o=t(14),a=t(23),s=t(15),c=t(18),d=t(30),u=t(19),l=t(24),f=t(38),p=t(33),_=t(13),g=t(12),h=t(36),m=t(11),v=t(37);function $(t,n){r.call(this,t,n),this.fields={},this.oneofs=undefined,this.extensions=undefined,this.reserved=undefined,this.group=undefined,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function E(t){return t._fieldsById=t._fieldsArray=t._oneofsArray=null,delete t.encode,delete t.decode,delete t.verify,t}Object.defineProperties($.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var t=Object.keys(this.fields),n=0;n<t.length;++n){var i=this.fields[t[n]],r=i.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=i}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=p.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=p.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=$.generateConstructor(this)())},set:function(t){var n=t.prototype;n instanceof u||((t.prototype=new u).constructor=t,p.merge(t.prototype,n)),t.$type=t.prototype.$type=this,p.merge(t,u,!0),this._ctor=t;for(var i=0;i<this.fieldsArray.length;++i)this._fieldsArray[i].resolve();var r={};for(i=0;i<this.oneofsArray.length;++i)r[this._oneofsArray[i].resolve().name]={get:p.oneOfGetter(this._oneofsArray[i].oneof),set:p.oneOfSetter(this._oneofsArray[i].oneof)};i&&Object.defineProperties(t.prototype,r)}}}),$.generateConstructor=function(t){for(var n,i=p.codegen(["p"],t.name),r=0;r<t.fieldsArray.length;++r)(n=t._fieldsArray[r]).map?i("this%s={}",p.safeProp(n.name)):n.repeated&&i("this%s=[]",p.safeProp(n.name));return i("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},$.fromJSON=function(t,n){var i=new $(t,n.options);i.extensions=n.extensions,i.reserved=n.reserved;for(var u=Object.keys(n.fields),l=0;l<u.length;++l)i.add((void 0!==n.fields[u[l]].keyType?c.fromJSON:s.fromJSON)(u[l],n.fields[u[l]]));if(n.oneofs)for(u=Object.keys(n.oneofs),l=0;l<u.length;++l)i.add(a.fromJSON(u[l],n.oneofs[u[l]]));if(n.nested)for(u=Object.keys(n.nested),l=0;l<u.length;++l){var f=n.nested[u[l]];i.add((undefined!==f.id?s.fromJSON:undefined!==f.fields?$.fromJSON:undefined!==f.values?o.fromJSON:undefined!==f.methods?d.fromJSON:r.fromJSON)(u[l],f))}return n.extensions&&n.extensions.length&&(i.extensions=n.extensions),n.reserved&&n.reserved.length&&(i.reserved=n.reserved),n.group&&(i.group=!0),n.comment&&(i.comment=n.comment),i},$.prototype.toJSON=function(t){var n=r.prototype.toJSON.call(this,t),i=!!t&&Boolean(t.keepComments);return p.toObject(["options",n&&n.options||undefined,"oneofs",r.arrayToJSON(this.oneofsArray,t),"fields",r.arrayToJSON(this.fieldsArray.filter(function(t){return!t.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"group",this.group||undefined,"nested",n&&n.nested||undefined,"comment",i?this.comment:undefined])},$.prototype.resolveAll=function(){for(var t=this.fieldsArray,n=0;n<t.length;)t[n++].resolve();var i=this.oneofsArray;for(n=0;n<i.length;)i[n++].resolve();return r.prototype.resolveAll.call(this)},$.prototype.get=function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null},$.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof s&&undefined===t.extend){if(this._fieldsById?this._fieldsById[t.id]:this.fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=this,t.onAdd(this),E(this)}return t instanceof a?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(this),E(this)):r.prototype.add.call(this,t)},$.prototype.remove=function(t){if(t instanceof s&&undefined===t.extend){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(this),E(this)}if(t instanceof a){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),E(this)}return r.prototype.remove.call(this,t)},$.prototype.isReservedId=function(t){return r.isReservedId(this.reserved,t)},$.prototype.isReservedName=function(t){return r.isReservedName(this.reserved,t)},$.prototype.create=function(t){return new this.ctor(t)},$.prototype.setup=function(){for(var t=this.fullName,n=[],i=0;i<this.fieldsArray.length;++i)n.push(this._fieldsArray[i].resolve().resolvedType);this.encode=_(this)({Writer:f,types:n,util:p}),this.decode=g(this)({Reader:l,types:n,util:p}),this.verify=h(this)({types:n,util:p}),this.fromObject=m.fromObject(this)({types:n,util:p}),this.toObject=m.toObject(this)({types:n,util:p});var r=v[t];if(r){var o=Object.create(this);o.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(o),o.toObject=this.toObject,this.toObject=r.toObject.bind(o)}return this},$.prototype.encode=function(t,n){return this.setup().encode(t,n)},$.prototype.encodeDelimited=function(t,n){return this.encode(t,n&&n.len?n.fork():n).ldelim()},$.prototype.decode=function(t,n){return this.setup().decode(t,n)},$.prototype.decodeDelimited=function(t){return t instanceof l||(t=l.create(t)),this.decode(t,t.uint32())},$.prototype.verify=function(t){return this.setup().verify(t)},$.prototype.fromObject=function(t){return this.setup().fromObject(t)},$.prototype.toObject=function(t,n){return this.setup().toObject(t,n)},$.d=function(t){return function(n){p.decorateType(n,t)}}},{11:11,12:12,13:13,14:14,15:15,18:18,19:19,21:21,23:23,24:24,30:30,33:33,36:36,37:37,38:38}],32:[function(t,n,i){var r=i,o=t(33),a=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function s(t,n){var i=0,r={};for(n|=0;i<t.length;)r[a[i+n]]=t[i++];return r}r.basic=s([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=s([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",o.emptyArray,null]),r.long=s([0,0,0,1,1],7),r.mapKey=s([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=s([1,5,0,0,0,5,5,0,0,0,1,1,0])},{33:33}],33:[function(t,n,i){var r,o,a=n.exports=t(35),s=t(27);a.codegen=t(3),a.fetch=t(5),a.path=t(8),a.fs=a.inquire("fs"),a.toArray=function(t){if(t){for(var n=Object.keys(t),i=Array(n.length),r=0;r<n.length;)i[r]=t[n[r++]];return i}return[]},a.toObject=function(t){for(var n={},i=0;i<t.length;){var r=t[i++],o=t[i++];o!==undefined&&(n[r]=o)}return n};var c=/\\/g,d=/"/g;a.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)},a.safeProp=function(t){return!/^[$\w_]+$/.test(t)||a.isReserved(t)?'["'+t.replace(c,"\\\\").replace(d,'\\"')+'"]':"."+t},a.ucFirst=function(t){return t.charAt(0).toUpperCase()+t.substring(1)};var u=/_([a-z])/g;a.camelCase=function(t){return t.substring(0,1)+t.substring(1).replace(u,function(t,n){return n.toUpperCase()})},a.compareFieldsById=function(t,n){return t.id-n.id},a.decorateType=function(n,i){if(n.$type)return i&&n.$type.name!==i&&(a.decorateRoot.remove(n.$type),n.$type.name=i,a.decorateRoot.add(n.$type)),n.$type;r||(r=t(31));var o=new r(i||n.name);return a.decorateRoot.add(o),o.ctor=n,Object.defineProperty(n,"$type",{value:o,enumerable:!1}),Object.defineProperty(n.prototype,"$type",{value:o,enumerable:!1}),o};var l=0;a.decorateEnum=function(n){if(n.$type)return n.$type;o||(o=t(14));var i=new o("Enum"+l++,n);return a.decorateRoot.add(i),Object.defineProperty(n,"$type",{value:i,enumerable:!1}),i},a.setProperty=function(t,n,i){if("object"!=typeof t)throw TypeError("dst must be an object");if(!n)throw TypeError("path must be specified");return function t(n,i,r){var o=i.shift();if(i.length>0)n[o]=t(n[o]||{},i,r);else{var a=n[o];a&&(r=[].concat(a).concat(r)),n[o]=r}return n}(t,n=n.split("."),i)},Object.defineProperty(a,"decorateRoot",{get:function(){return s.decorated||(s.decorated=new(t(26)))}})},{14:14,26:26,27:27,3:3,31:31,35:35,5:5,8:8}],34:[function(t,n,i){n.exports=o;var r=t(35);function o(t,n){this.lo=t>>>0,this.hi=n>>>0}var a=o.zero=new o(0,0);a.toNumber=function(){return 0},a.zzEncode=a.zzDecode=function(){return this},a.length=function(){return 1};var s=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(t){if(0===t)return a;var n=t<0;n&&(t=-t);var i=t>>>0,r=(t-i)/4294967296>>>0;return n&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new o(i,r)},o.from=function(t){if("number"==typeof t)return o.fromNumber(t);if(r.isString(t)){if(!r.Long)return o.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new o(t.low>>>0,t.high>>>0):a},o.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var n=1+~this.lo>>>0,i=~this.hi>>>0;return n||(i=i+1>>>0),-(n+4294967296*i)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var c=String.prototype.charCodeAt;o.fromHash=function(t){return t===s?a:new o((c.call(t,0)|c.call(t,1)<<8|c.call(t,2)<<16|c.call(t,3)<<24)>>>0,(c.call(t,4)|c.call(t,5)<<8|c.call(t,6)<<16|c.call(t,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},o.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},o.prototype.length=function(){var t=this.lo,n=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===n?t<16384?t<128?1:2:t<2097152?3:4:n<16384?n<128?5:6:n<2097152?7:8:i<128?9:10}},{35:35}],35:[function(t,n,i){var r=i;function o(t,n,i){for(var r=Object.keys(n),o=0;o<r.length;++o)undefined!==t[r[o]]&&i||(t[r[o]]=n[r[o]]);return t}function a(t){function n(t,i){if(!(this instanceof n))return new n(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:Error().stack||""}),i&&o(this,i)}return(n.prototype=Object.create(Error.prototype)).constructor=n,Object.defineProperty(n.prototype,"name",{get:function(){return t}}),n.prototype.toString=function(){return this.name+": "+this.message},n}r.asPromise=t(1),r.base64=t(2),r.EventEmitter=t(4),r.float=t(6),r.inquire=t(7),r.utf8=t(10),r.pool=t(9),r.LongBits=t(34),r.isNode=Boolean(void 0!==global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"==typeof t||t instanceof String},r.isObject=function(t){return t&&"object"==typeof t},r.isset=r.isSet=function(t,n){var i=t[n];return!(null==i||!t.hasOwnProperty(n))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(n){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(t){return"number"==typeof t?r.Buffer?r._Buffer_allocUnsafe(t):new r.Array(t):r.Buffer?r._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,n){var i=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(i.lo,i.hi,n):i.toNumber(Boolean(n))},r.merge=o,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=a,r.ProtocolError=a("ProtocolError"),r.oneOfGetter=function(t){for(var n={},i=0;i<t.length;++i)n[t[i]]=1;return function(){for(var t=Object.keys(this),i=t.length-1;i>-1;--i)if(1===n[t[i]]&&undefined!==this[t[i]]&&null!==this[t[i]])return t[i]}},r.oneOfSetter=function(t){return function(n){for(var i=0;i<t.length;++i)t[i]!==n&&delete this[t[i]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var t=r.Buffer;t?(r._Buffer_from=t.from!==Uint8Array.from&&t.from||function(n,i){return new t(n,i)},r._Buffer_allocUnsafe=t.allocUnsafe||function(n){return new t(n)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,34:34,4:4,6:6,7:7,9:9}],36:[function(t,n,i){n.exports=function(t){var n=o.codegen(["m"],t.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),i=t.oneofsArray,r={};i.length&&n("var p={}");for(var d=0;d<t.fieldsArray.length;++d){var u=t._fieldsArray[d].resolve(),l="m"+o.safeProp(u.name);if(u.optional&&n("if(%s!=null&&m.hasOwnProperty(%j)){",l,u.name),u.map)n("if(!util.isObject(%s))",l)("return%j",a(u,"object"))("var k=Object.keys(%s)",l)("for(var i=0;i<k.length;++i){"),c(n,u,"k[i]"),s(n,u,d,l+"[k[i]]")("}");else if(u.repeated)n("if(!Array.isArray(%s))",l)("return%j",a(u,"array"))("for(var i=0;i<%s.length;++i){",l),s(n,u,d,l+"[i]")("}");else{if(u.partOf){var f=o.safeProp(u.partOf.name);1===r[u.partOf.name]&&n("if(p%s===1)",f)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,n("p%s=1",f)}s(n,u,d,l)}u.optional&&n("}")}return n("return null")};var r=t(14),o=t(33);function a(t,n){return t.name+": "+n+(t.repeated&&"array"!==n?"[]":t.map&&"object"!==n?"{k:"+t.keyType+"}":"")+" expected"}function s(t,n,i,o){if(n.resolvedType){if(n.resolvedType instanceof r){t("switch(%s){",o)("default:")("return%j",a(n,"enum value"));for(var s=Object.keys(n.resolvedType.values),c=0;c<s.length;++c)t("case %i:",n.resolvedType.values[s[c]]);t("break")("}")}else t("{")("var e=types[%i].verify(%s);",i,o)("if(e)")("return%j+e",n.name+".")("}")}else switch(n.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.isInteger(%s))",o)("return%j",a(n,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",o,o,o,o)("return%j",a(n,"integer|Long"));break;case"float":case"double":t('if(typeof %s!=="number")',o)("return%j",a(n,"number"));break;case"bool":t('if(typeof %s!=="boolean")',o)("return%j",a(n,"boolean"));break;case"string":t("if(!util.isString(%s))",o)("return%j",a(n,"string"));break;case"bytes":t('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',o,o,o)("return%j",a(n,"buffer"))}return t}function c(t,n,i){switch(n.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.key32Re.test(%s))",i)("return%j",a(n,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.key64Re.test(%s))",i)("return%j",a(n,"integer|Long key"));break;case"bool":t("if(!util.key2Re.test(%s))",i)("return%j",a(n,"boolean key"))}return t}},{14:14,33:33}],37:[function(t,n,i){var r=i,o=t(19);r[".google.protobuf.Any"]={fromObject:function(t){if(t&&t["@type"]){var n=t["@type"].substring(t["@type"].lastIndexOf("/")+1),i=this.lookup(n);if(i){var r="."===t["@type"].charAt(0)?t["@type"].substr(1):t["@type"];return -1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:i.encode(i.fromObject(t)).finish()})}}return this.fromObject(t)},toObject:function(t,n){var i="",r="";if(n&&n.json&&t.type_url&&t.value){r=t.type_url.substring(t.type_url.lastIndexOf("/")+1),i=t.type_url.substring(0,t.type_url.lastIndexOf("/")+1);var a=this.lookup(r);a&&(t=a.decode(t.value))}if(!(t instanceof this.ctor)&&t instanceof o){var s=t.$type.toObject(t,n);return""===i&&(i="type.googleapis.com/"),r=i+("."===t.$type.fullName[0]?t.$type.fullName.substr(1):t.$type.fullName),s["@type"]=r,s}return this.toObject(t,n)}}},{19:19}],38:[function(t,n,i){n.exports=f;var r,o=t(35),a=o.LongBits,s=o.base64,c=o.utf8;function d(t,n,i){this.fn=t,this.len=n,this.next=undefined,this.val=i}function u(){}function l(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function f(){this.len=0,this.head=new d(u,0,0),this.tail=this.head,this.states=null}var p=function(){return o.Buffer?function(){return(f.create=function(){return new r})()}:function(){return new f}};function _(t,n,i){n[i]=255&t}function g(t,n){this.len=t,this.next=undefined,this.val=n}function h(t,n,i){for(;t.hi;)n[i++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)n[i++]=127&t.lo|128,t.lo=t.lo>>>7;n[i++]=t.lo}function m(t,n,i){n[i]=255&t,n[i+1]=t>>>8&255,n[i+2]=t>>>16&255,n[i+3]=t>>>24}f.create=p(),f.alloc=function(t){return new o.Array(t)},o.Array!==Array&&(f.alloc=o.pool(f.alloc,o.Array.prototype.subarray)),f.prototype._push=function(t,n,i){return this.tail=this.tail.next=new d(t,n,i),this.len+=n,this},g.prototype=Object.create(d.prototype),g.prototype.fn=function(t,n,i){for(;t>127;)n[i++]=127&t|128,t>>>=7;n[i]=t},f.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new g((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},f.prototype.int32=function(t){return t<0?this._push(h,10,a.fromNumber(t)):this.uint32(t)},f.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},f.prototype.uint64=function(t){var n=a.from(t);return this._push(h,n.length(),n)},f.prototype.int64=f.prototype.uint64,f.prototype.sint64=function(t){var n=a.from(t).zzEncode();return this._push(h,n.length(),n)},f.prototype.bool=function(t){return this._push(_,1,t?1:0)},f.prototype.fixed32=function(t){return this._push(m,4,t>>>0)},f.prototype.sfixed32=f.prototype.fixed32,f.prototype.fixed64=function(t){var n=a.from(t);return this._push(m,4,n.lo)._push(m,4,n.hi)},f.prototype.sfixed64=f.prototype.fixed64,f.prototype.float=function(t){return this._push(o.float.writeFloatLE,4,t)},f.prototype.double=function(t){return this._push(o.float.writeDoubleLE,8,t)};var v=o.Array.prototype.set?function(t,n,i){n.set(t,i)}:function(t,n,i){for(var r=0;r<t.length;++r)n[i+r]=t[r]};f.prototype.bytes=function(t){var n=t.length>>>0;if(!n)return this._push(_,1,0);if(o.isString(t)){var i=f.alloc(n=s.length(t));s.decode(t,i,0),t=i}return this.uint32(n)._push(v,n,t)},f.prototype.string=function(t){var n=c.length(t);return n?this.uint32(n)._push(c.write,n,t):this._push(_,1,0)},f.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new d(u,0,0),this.len=0,this},f.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new d(u,0,0),this.len=0),this},f.prototype.ldelim=function(){var t=this.head,n=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=n,this.len+=i),this},f.prototype.finish=function(){for(var t=this.head.next,n=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,n,i),i+=t.len,t=t.next;return n},f._configure=function(t){r=t,f.create=p(),r._configure()}},{35:35}],39:[function(t,n,i){n.exports=a;var r=t(38);(a.prototype=Object.create(r.prototype)).constructor=a;var o=t(35);function a(){r.call(this)}function s(t,n,i){t.length<40?o.utf8.write(t,n,i):n.utf8Write?n.utf8Write(t,i):n.write(t,i)}a._configure=function(){a.alloc=o._Buffer_allocUnsafe,a.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&"set"===o.Buffer.prototype.set.name?function(t,n,i){n.set(t,i)}:function(t,n,i){if(t.copy)t.copy(n,i,0,t.length);else for(var r=0;r<t.length;)n[i++]=t[r++]}},a.prototype.bytes=function(t){o.isString(t)&&(t=o._Buffer_from(t,"base64"));var n=t.length>>>0;return this.uint32(n),n&&this._push(a.writeBytesBuffer,n,t),this},a.prototype.string=function(t){var n=o.Buffer.byteLength(t);return this.uint32(n),n&&this._push(s,n,t),this},a._configure()},{35:35,38:38}]},t={},(r=function n(i){var r=t[i];return r||e[i][0].call(r=t[i]={exports:{}},n,r,r.exports),r.exports}((n=[16])[0])).util.global.protobuf=r,undefined===(__WEBPACK_AMD_DEFINE_RESULT__=(function(t){return t&&t.isLong&&(r.util.Long=t,r.configure()),r}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(61)]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),module&&module.exports&&(module.exports=r)}).call(this,__webpack_require__(33),__webpack_require__(60)(module))},function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,n){t.exports=o;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(r){}function o(t,n,i){this.low=0|t,this.high=0|n,this.unsigned=!!i}function a(t){return!0===(t&&t.__isLong__)}o.prototype.__isLong__,Object.defineProperty(o.prototype,"__isLong__",{value:!0}),o.isLong=a;var s={},c={};function d(t,n){var i,r,o;return n?(o=0<=(t>>>=0)&&t<256)&&(r=c[t])?r:(i=l(t,(0|t)<0?-1:0,!0),o&&(c[t]=i),i):(o=-128<=(t|=0)&&t<128)&&(r=s[t])?r:(i=l(t,t<0?-1:0,!1),o&&(s[t]=i),i)}function u(t,n){if(isNaN(t))return n?E:$;if(n){if(t<0)return E;if(t>=h)return I}else{if(t<=-m)return A;if(t+1>=m)return T}return t<0?u(-t,n).neg():l(t%g|0,t/g|0,n)}function l(t,n,i){return new o(t,n,i)}o.fromInt=d,o.fromNumber=u,o.fromBits=l;var f=Math.pow;function p(t,n,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return $;if("number"==typeof n?(i=n,n=!1):n=!!n,(i=i||10)<2||36<i)throw RangeError("radix");if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return p(t.substring(1),n,i).neg();for(var r,o=u(f(i,8)),a=$,s=0;s<t.length;s+=8){var c=Math.min(8,t.length-s),d=parseInt(t.substring(s,s+c),i);if(c<8){var l=u(f(i,c));a=a.mul(l).add(u(d))}else a=(a=a.mul(o)).add(u(d))}return a.unsigned=n,a}function _(t,n){return"number"==typeof t?u(t,n):"string"==typeof t?p(t,n):l(t.low,t.high,"boolean"==typeof n?n:t.unsigned)}o.fromString=p,o.fromValue=_;var g=4294967296,h=g*g,m=h/2,v=d(16777216),$=d(0);o.ZERO=$;var E=d(0,!0);o.UZERO=E;var S=d(1);o.ONE=S;var y=d(1,!0);o.UONE=y;var R=d(-1);o.NEG_ONE=R;var T=l(-1,2147483647,!1);o.MAX_VALUE=T;var I=l(-1,-1,!0);o.MAX_UNSIGNED_VALUE=I;var A=l(0,-2147483648,!1);o.MIN_VALUE=A;var C=o.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},C.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(A)){var n=u(t),i=this.div(n),r=i.mul(n).sub(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=u(f(t,6),this.unsigned),a=this,s="";;){var c=a.div(o),d=(a.sub(c.mul(o)).toInt()>>>0).toString(t);if((a=c).isZero())return d+s;for(;d.length<6;)d="0"+d;s=""+d+s}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,n=31;n>0&&0==(t&1<<n);n--);return 0!=this.high?n+33:n+1},C.isZero=function(){return 0===this.high&&0===this.low},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return 1==(1&this.low)},C.isEven=function(){return 0==(1&this.low)},C.equals=function(t){return a(t)||(t=_(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},C.eq=C.equals,C.notEquals=function(t){return!this.eq(t)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(t){return 0>this.comp(t)},C.lt=C.lessThan,C.lessThanOrEqual=function(t){return 0>=this.comp(t)},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(t){return this.comp(t)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(t){return this.comp(t)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(t){if(a(t)||(t=_(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(S)},C.neg=C.negate,C.add=function(t){a(t)||(t=_(t));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,s=t.high>>>16,c=65535&t.high,d=t.low>>>16,u=0,f=0,p=0,g=0;return p+=(g+=o+(65535&t.low))>>>16,f+=(p+=r+d)>>>16,u+=(f+=i+c)>>>16,u+=n+s,l((p&=65535)<<16|(g&=65535),(u&=65535)<<16|(f&=65535),this.unsigned)},C.subtract=function(t){return a(t)||(t=_(t)),this.add(t.neg())},C.sub=C.subtract,C.multiply=function(t){if(this.isZero())return $;if(a(t)||(t=_(t)),i)return l(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return $;if(this.eq(A))return t.isOdd()?A:$;if(t.eq(A))return this.isOdd()?A:$;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(v)&&t.lt(v))return u(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,o=this.low>>>16,s=65535&this.low,c=t.high>>>16,d=65535&t.high,f=t.low>>>16,p=65535&t.low,g=0,h=0,m=0,E=0;return m+=(E+=s*p)>>>16,h+=(m+=o*p)>>>16,m&=65535,h+=(m+=s*f)>>>16,g+=(h+=r*p)>>>16,h&=65535,g+=(h+=o*f)>>>16,h&=65535,g+=(h+=s*d)>>>16,g+=n*p+r*f+o*d+s*c,l((m&=65535)<<16|(E&=65535),(g&=65535)<<16|(h&=65535),this.unsigned)},C.mul=C.multiply,C.divide=function(t){if(a(t)||(t=_(t)),t.isZero())throw Error("division by zero");if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?l((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?E:$;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return E;if(t.gt(this.shru(1)))return y;o=E}else{if(this.eq(A))return t.eq(S)||t.eq(R)?A:t.eq(A)?S:(n=this.shr(1).div(t).shl(1)).eq($)?t.isNegative()?S:R:(r=this.sub(t.mul(n)),o=n.add(r.div(t)));if(t.eq(A))return this.unsigned?E:$;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=$}for(r=this;r.gte(t);){n=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var n,r,o,s=Math.ceil(Math.log(n)/Math.LN2),c=s<=48?1:f(2,s-48),d=u(n),p=d.mul(t);p.isNegative()||p.gt(r);)p=(d=u(n-=c,this.unsigned)).mul(t);d.isZero()&&(d=S),o=o.add(d),r=r.sub(p)}return o},C.div=C.divide,C.modulo=function(t){return a(t)||(t=_(t)),i?l((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return l(~this.low,~this.high,this.unsigned)},C.and=function(t){return a(t)||(t=_(t)),l(this.low&t.low,this.high&t.high,this.unsigned)},C.or=function(t){return a(t)||(t=_(t)),l(this.low|t.low,this.high|t.high,this.unsigned)},C.xor=function(t){return a(t)||(t=_(t)),l(this.low^t.low,this.high^t.high,this.unsigned)},C.shiftLeft=function(t){return a(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):l(0,this.low<<t-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(t){return a(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):l(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(t){if(a(t)&&(t=t.toInt()),0==(t&=63))return this;var n=this.high;return t<32?l(this.low>>>t|n<<32-t,n>>>t,this.unsigned):l(32===t?n:n>>>t-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},C.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var t=this.high,n=this.low;return[255&n,n>>>8&255,n>>>16&255,n>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},C.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,n>>>24,n>>>16&255,n>>>8&255,255&n]},o.fromBytes=function(t,n,i){return i?o.fromBytesLE(t,n):o.fromBytesBE(t,n)},o.fromBytesLE=function(t,n){return new o(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)},o.fromBytesBE=function(t,n){return new o(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)}},function(t){t.exports=JSON.parse('{"PeerPublishStatus":408,"JoinChannelTimeout":407,"OnUpdateStream":356,"OnRemoveStream":355,"OnAddVideoStream":353,"OnAddAudioStream":352,"FirstAudioDecode":351,"FirstVideoDecode":350,"FirstAudioReceived":349,"FirstVideoReceived":348,"ReqUserAccount":196,"ApiInvoke":41,"RequestProxyWorkerManager":36,"RequestProxyAppCenter":35,"VideoSendingStopped":34,"AudioSendingStopped":33,"StreamSwitch":32,"FirstFrame":31,"Publish":30,"Subscribe":29,"JoinGateway":28,"JoinChooseServer":27,"Session":26,"APWorkerEvent":160,"WorkerEvent":156,"JoinWebProxyAP":700,"WebSocketQuit":671}')},function(t){t.exports=JSON.parse('{"nested":{"protobuf":{"nested":{"Session":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"version":{"type":"string","id":11},"browser":{"type":"string","id":12},"appid":{"type":"string","id":13},"mode":{"type":"string","id":14},"extend":{"type":"string","id":15},"process":{"type":"string","id":16},"build":{"type":"string","id":17},"ipv6":{"type":"string","id":18},"sourceHost":{"type":"string","id":19},"sourcePath":{"type":"string","id":20},"collectorHost":{"type":"string","id":21},"collectorName":{"type":"string","id":22}}},"JoinChooseServer":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"chooseServerAddr":{"type":"string","id":11},"chooseServerAddrList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"chooseServerIp":{"type":"string","id":15}}},"JoinGateway":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"gatewayAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"firstSuccess":{"type":"bool","id":14}}},"Subscribe":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"video":{"type":"bool","id":16},"audio":{"type":"bool","id":17},"subscribeRequestid":{"type":"int32","id":18},"p2pid":{"type":"int32","id":19}}},"Publish":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"videoName":{"type":"string","id":16},"audioName":{"type":"string","id":17},"screenName":{"type":"string","id":18},"video":{"type":"bool","id":19},"audio":{"type":"bool","id":20},"publishRequestid":{"type":"int32","id":21},"p2pid":{"type":"int32","id":22},"screenshare":{"type":"bool","id":23}}},"FirstFrame":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"extend":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"width":{"type":"int64","id":13},"height":{"type":"int64","id":14}}},"StreamSwitch":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"isDual":{"type":"bool","id":11}}},"AudioSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"VideoSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"RequestProxyAppCenter":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"APAddr":{"type":"string","id":11},"workerManagerList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"extend":{"type":"string","id":15},"response":{"type":"string","id":16}}},"RequestProxyWorkerManager":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"workerManagerAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"extend":{"type":"string","id":14},"response":{"type":"string","id":15}}},"ApiInvoke":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"apiName":{"type":"string","id":9},"errorCode":{"type":"string","id":10},"options":{"type":"string","id":11},"execElapse":{"type":"int64","id":12},"execStates":{"type":"string","id":13},"execResult":{"type":"string","id":14},"invokeId":{"type":"int64","id":15}}},"ReqUserAccount":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"serverAddress":{"type":"string","id":10},"stringUid":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"extend":{"type":"string","id":13}}},"FirstVideoReceived":{"fields":{"lts":{"type":"int64","id":1},"peer":{"type":"int64","id":2},"elapse":{"type":"int64","id":3},"sid":{"type":"string","id":4},"cname":{"type":"string","id":5},"cid":{"type":"int64","id":6},"uid":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstAudioReceived":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstVideoDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"videowidth":{"type":"int32","id":9},"videoheight":{"type":"int32","id":10},"subscribeRequestid":{"type":"int32","id":11},"p2pid":{"type":"int32","id":12},"subscribeElapse":{"type":"int64","id":13}}},"FirstAudioDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"OnAddAudioStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnAddVideoStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnRemoveStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnUpdateStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"audio":{"type":"bool","id":8},"video":{"type":"bool","id":9}}},"JoinChannelTimeout":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"timeout":{"type":"int32","id":7}}},"PeerPublishStatus":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"peer":{"type":"int64","id":6},"elapse":{"type":"int64","id":7},"peerPublishDuration":{"type":"int64","id":8},"joinChannelSuccessElapse":{"type":"int64","id":9},"subscribeElapse":{"type":"int64","id":10},"audiotag":{"type":"int32","id":11},"videotag":{"type":"int32","id":12},"screensharetag":{"type":"int32","id":13},"firsttimetag":{"type":"int32","id":14}}},"WebSocketQuit":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"succ":{"type":"int32","id":7},"errorCode":{"type":"string","id":8},"ip":{"type":"string","id":9}}},"Message":{"fields":{"id":{"type":"int64","id":1},"msg":{"type":"bytes","id":2}}},"ProtoRaws":{"fields":{"sendTs":{"type":"int64","id":1},"payloads":{"rule":"repeated","type":"Message","id":2},"vid":{"type":"int32","id":3}}},"APWorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"ec":{"type":"int32","id":10},"sc":{"type":"int32","id":11},"serverIp":{"type":"string","id":12},"firstSuccess":{"type":"bool","id":13},"responseTime":{"type":"int32","id":14},"serviceName":{"type":"string","id":15},"responseDetail":{"type":"string","id":16}}},"WorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"command":{"type":"string","id":10},"actionType":{"type":"string","id":11},"url":{"type":"string","id":12},"payload":{"type":"string","id":13},"serverCode":{"type":"int32","id":14},"code":{"type":"int32","id":15},"traceId":{"type":"string","id":16},"workerType":{"type":"int32","id":17},"responseTime":{"type":"int32","id":18},"requestId":{"type":"int64","id":19},"packIndex":{"type":"int32","id":20},"requestByUser":{"type":"bool","id":21},"tid":{"type":"string","id":22}}},"JoinWebProxyAP":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"sucess":{"type":"int32","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"apServerAddr":{"type":"string","id":10},"turnServerAddrList":{"type":"string","id":11},"errorCode":{"type":"string","id":12}}}}}}}')},function(t,n,i){var r=function(t){"use strict";var n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(t,n,i,r){var o,a,s,c,f=Object.create((n&&n.prototype instanceof l?n:l).prototype),p=new R(r||[]);return f._invoke=(o=t,a=i,s=p,c="suspendedStart",function(t,n){if("executing"===c)throw Error("Generator is already running");if("completed"===c){if("throw"===t)throw n;return I()}for(s.method=t,s.arg=n;;){var i=s.delegate;if(i){var r=E(i,s);if(r){if(r===u)continue;return r}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if("suspendedStart"===c)throw c="completed",s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);c="executing";var l=d(o,a,s);if("normal"===l.type){if(c=s.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:s.done}}"throw"===l.type&&(c="completed",s.method="throw",s.arg=l.arg)}}),f}function d(t,n,i){try{return{type:"normal",arg:t.call(n,i)}}catch(r){return{type:"throw",arg:r}}}t.wrap=c;var u={};function l(){}function f(){}function p(){}var _={};_[o]=function(){return this};var g=Object.getPrototypeOf,h=g&&g(g(T([])));h&&h!==n&&i.call(h,o)&&(_=h);var m=p.prototype=l.prototype=Object.create(_);function v(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function $(t,n){var r;this._invoke=function(o,a){function s(){return new n(function(r,s){!function r(o,a,s,c){var u=d(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&i.call(f,"__await")?n.resolve(f.__await).then(function(t){r("next",t,s,c)},function(t){r("throw",t,s,c)}):n.resolve(f).then(function(t){l.value=t,s(l)},function(t){return r("throw",t,s,c)})}c(u.arg)}(o,a,r,s)})}return r=r?r.then(s,s):s()}}function E(t,n){var i=t.iterator[n.method];if(void 0===i){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=void 0,E(t,n),"throw"===n.method))return u;n.method="throw",n.arg=TypeError("The iterator does not provide a 'throw' method")}return u}var r=d(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,u;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,u):o:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,u)}function S(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function y(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function T(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=void 0,n.done=!0,n};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return f.prototype=m.constructor=p,p.constructor=f,p[s]=f.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===f||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v($.prototype),$.prototype[a]=function(){return this},t.AsyncIterator=$,t.async=function(n,i,r,o,a){void 0===a&&(a=Promise);var s=new $(c(n,i,r,o),a);return t.isGeneratorFunction(i)?s:s.next().then(function(t){return t.done?t.value:s.next()})},v(m),m[s]="Generator",m[o]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var n=[];for(var i in t)n.push(i);return n.reverse(),function i(){for(;n.length;){var r=n.pop();if(r in t)return i.value=r,i.done=!1,i}return i.done=!0,i}},t.values=T,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(y),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(c&&d){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=t,s.arg=n,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),u},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),y(i),u}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var o=r.arg;y(i)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:T(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=r}catch(o){Function("r","regeneratorRuntime = r")(r)}},function(t,n){t.exports=function(t){if(Array.isArray(t))return t}},function(t,n){t.exports=function(t,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],r=!0,o=!1,a=void 0;try{for(var s,c=t[Symbol.iterator]();!(r=(s=c.next()).done)&&(i.push(s.value),!n||i.length!==n);r=!0);}catch(d){o=!0,a=d}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return i}}},function(t,n){t.exports=function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="object"==typeof window&&window.RTCPeerConnection,o="object"==typeof window&&window.webkitRTCPeerConnection,a="object"==typeof window&&window.mozRTCPeerConnection;n.createRTCPeerConnection=function(t){var n=r||o||a;return n?new n(t):null}},function(t,n,i){var r;/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */ !function(n){"use strict";function o(){}var a=o.prototype,s=n.EventEmitter;function c(t,n){for(var i=t.length;i--;)if(t[i].listener===n)return i;return -1}function d(t){return function(){return this[t].apply(this,arguments)}}a.getListeners=function(t){var n,i,r=this._getEvents();if(t instanceof RegExp)for(i in n={},r)r.hasOwnProperty(i)&&t.test(i)&&(n[i]=r[i]);else n=r[t]||(r[t]=[]);return n},a.flattenListeners=function(t){var n,i=[];for(n=0;n<t.length;n+=1)i.push(t[n].listener);return i},a.getListenersAsObject=function(t){var n,i=this.getListeners(t);return i instanceof Array&&((n={})[t]=i),n||i},a.addListener=function(t,n){if(!function t(n){return"function"==typeof n||n instanceof RegExp||!(!n||"object"!=typeof n)&&t(n.listener)}(n))throw TypeError("listener must be a function");var i,r=this.getListenersAsObject(t),o="object"==typeof n;for(i in r)r.hasOwnProperty(i)&&-1===c(r[i],n)&&r[i].push(o?n:{listener:n,once:!1});return this},a.on=d("addListener"),a.addOnceListener=function(t,n){return this.addListener(t,{listener:n,once:!0})},a.once=d("addOnceListener"),a.defineEvent=function(t){return this.getListeners(t),this},a.defineEvents=function(t){for(var n=0;n<t.length;n+=1)this.defineEvent(t[n]);return this},a.removeListener=function(t,n){var i,r,o=this.getListenersAsObject(t);for(r in o)o.hasOwnProperty(r)&&-1!==(i=c(o[r],n))&&o[r].splice(i,1);return this},a.off=d("removeListener"),a.addListeners=function(t,n){return this.manipulateListeners(!1,t,n)},a.removeListeners=function(t,n){return this.manipulateListeners(!0,t,n)},a.manipulateListeners=function(t,n,i){var r,o,a=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"!=typeof n||n instanceof RegExp)for(r=i.length;r--;)a.call(this,n,i[r]);else for(r in n)n.hasOwnProperty(r)&&(o=n[r])&&("function"==typeof o?a.call(this,r,o):s.call(this,r,o));return this},a.removeEvent=function(t){var n,i=typeof t,r=this._getEvents();if("string"===i)delete r[t];else if(t instanceof RegExp)for(n in r)r.hasOwnProperty(n)&&t.test(n)&&delete r[n];else delete this._events;return this},a.removeAllListeners=d("removeEvent"),a.emitEvent=function(t,n){var i,r,o,a,s=this.getListenersAsObject(t);for(a in s)if(s.hasOwnProperty(a))for(i=s[a].slice(0),o=0;o<i.length;o++)!0===(r=i[o]).once&&this.removeListener(t,r.listener),r.listener.apply(this,n||[])===this._getOnceReturnValue()&&this.removeListener(t,r.listener);return this},a.trigger=d("emitEvent"),a.emit=function(t){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,n)},a.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},a._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},a._getEvents=function(){return this._events||(this._events={})},o.noConflict=function(){return n.EventEmitter=s,o},void 0===(r=(function(){return o}).call(n,i,n,t))||(t.exports=r)}("undefined"!=typeof window?window:this||{})},function(t,n,i){var r=i(35);t.exports=function(t){if(Array.isArray(t))return r(t)}},function(t,n){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,n){t.exports=function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,n,i){(function(n){var r;t.exports=r=r||function(t,r){if("undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(a=globalThis.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&void 0!==n&&n.crypto&&(a=n.crypto),!a)try{a=i(74)}catch(o){}var a,s=function(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(n){}}throw Error("Native crypto module could not be used to get secure random number.")},c=Object.create||function(){function t(){}return function(n){var i;return t.prototype=n,i=new t,t.prototype=null,i}}(),d={},u=d.lib={},l=u.Base={extend:function(t){var n=c(this);return t&&n.mixIn(t),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},f=u.WordArray=l.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=null!=n?n:4*t.length},toString:function(t){return(t||_).stringify(this)},concat:function(t){var n=this.words,i=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var a=0;a<o;a++){var s=i[a>>>2]>>>24-a%4*8&255;n[r+a>>>2]|=s<<24-(r+a)%4*8}else for(var c=0;c<o;c+=4)n[r+c>>>2]=i[c>>>2];return this.sigBytes+=o,this},clamp:function(){var n=this.words,i=this.sigBytes;n[i>>>2]&=4294967295<<32-i%4*8,n.length=t.ceil(i/4)},clone:function(){var t=l.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(s());return new f.init(n,t)}}),p=d.enc={},_=p.Hex={stringify:function(t){for(var n=t.words,i=t.sigBytes,r=[],o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(t){for(var n=t.length,i=[],r=0;r<n;r+=2)i[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new f.init(i,n/2)}},g=p.Latin1={stringify:function(t){for(var n=t.words,i=t.sigBytes,r=[],o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(a))}return r.join("")},parse:function(t){for(var n=t.length,i=[],r=0;r<n;r++)i[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new f.init(i,n)}},h=p.Utf8={stringify:function(t){try{return decodeURIComponent(escape(g.stringify(t)))}catch(n){throw Error("Malformed UTF-8 data")}},parse:function(t){return g.parse(unescape(encodeURIComponent(t)))}},m=u.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(n){var i,r=this._data,o=r.words,a=r.sigBytes,s=this.blockSize,c=a/(4*s),d=(c=n?t.ceil(c):t.max((0|c)-this._minBufferSize,0))*s,u=t.min(4*d,a);if(d){for(var l=0;l<d;l+=s)this._doProcessBlock(o,l);i=o.splice(0,d),r.sigBytes-=u}return new f.init(i,u)},clone:function(){var t=l.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),v=(u.Hasher=m.extend({cfg:l.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(n,i){return new t.init(i).finalize(n)}},_createHmacHelper:function(t){return function(n,i){return new v.HMAC.init(t,i).finalize(n)}}}),d.algo={});return d}(Math)}).call(this,i(33))},function(t,n){},function(t,n,i){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++)for(var o in n=arguments[i])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},a=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var c=i(76),d=i(27),u=i(95),l=i(20),f=i(24),p=i(31),_=s(i(0)),g=s(i(37)),h=function(){function t(t){this.retryTimeout=1e4,this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.taskMutex=new u.PromiseMutex("LS"),this.cancelToken=g.default.CancelToken.source(),this.injectConfig=r({},d.DEFAULT_INJECT_CONFIG),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Map,this.spec=t}return Object.defineProperty(t.prototype,"isNeedReset",{get:function(){for(var t=this,n=0,i=Array.from(this.streamingTasks.values());n<i.length;n++){var r=i[n];if(r.mode===d.LiveStreamingServiceMode.INJECT||r.mode===d.LiveStreamingServiceMode.TRANSCODE&&(this.transcodingConfig&&(this.transcodingConfig.userConfigs||this.transcodingConfig.transcodingUsers)||[]).find(function(n){return n.uid===t.spec.uid}))return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.setTranscodingConfig=function(t){return o(this,void 0,void 0,function(){var n,i,o,s,c,u=this;return a(this,function(a){switch(a.label){case 0:(n=r(r({},d.DEFAULT_TRANSCODING_CONFIG),t)).transcodingUsers||(n.transcodingUsers=n.userConfigs),66!==n.videoCodecProfile&&77!==n.videoCodecProfile&&100!==n.videoCodecProfile&&(_.default.debug("["+this.spec.clientId+"] set transcoding config, fix video codec profile: "+n.videoCodecProfile+" -> 100"),n.videoCodecProfile=100),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(function(t){return r(r(r({},d.DEFAULT_LIVE_STREAMING_TRANSCODING_USER),t),{zOrder:t.zOrder?t.zOrder+1:1})})),n.images&&(n.images=n.images.map(function(t){return r(r({},d.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK),t)}));try{d.isLiveStreamingTranscodingConfig(n)}catch(f){throw f}return n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(function(t){return r({},t)}),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers),i=(n.userConfigs||[]).map(function(t){return"number"==typeof t.uid?Promise.resolve(t.uid):l.getUserAccount(u.spec,null,t.uid)}),[4,this.taskMutex.lock()];case 1:return o=a.sent(),[4,Promise.all(i)];case 2:if(a.sent().forEach(function(t,i){n.userConfigs&&n.userConfigs[i]&&(n.userConfigs[i].uid=t&&t.uid||t)}),this.transcodingConfig=n,!this.connection)return o(),[2];a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(this.streamingTasks.values()).map(function(t){return t.taskId}).join("#")})];case 4:return s=a.sent(),o(),_.default.debug("["+this.spec.clientId+"] update live transcoding config success, code: "+s.code+", config:",JSON.stringify(this.transcodingConfig)),[3,6];case 5:if(c=a.sent(),o(),!c.data||!c.data.retry)throw c;return c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(function(t){_.default.warning("["+u.spec.clientId+"] live streaming receive error",c.toString(),"try to republish",t.url),u.startLiveStreamingTask(t.url,t.mode,c).then(function(){_.default.debug("["+u.spec.clientId+"] live streaming republish "+t.url+" success")}).catch(function(n){_.default.error("["+u.spec.clientId+"] live streaming republish failed",t.url,n.toString()),u.onLiveStreamError&&u.onLiveStreamError(t.url,n)})}),[3,6];case 6:return[2]}})})},t.prototype.setInjectStreamConfig=function(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n},t.prototype.startLiveStreamingTask=function(t,n,i){return o(this,void 0,void 0,function(){var o,s,c,u,l,g,h,m,v=this;return a(this,function(a){switch(a.label){case 0:return Array.from(this.streamingTasks.values()).find(function(t){return t.mode===d.LiveStreamingServiceMode.INJECT})&&n===d.LiveStreamingServiceMode.INJECT?[2,new f.AgoraRTCError(f.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw()]:(o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:30},_.default.debug("["+this.spec.clientId+"] start live streaming "+t+", mode: "+n),[4,this.taskMutex.lock()]);case 1:if(s=a.sent(),!this.transcodingConfig&&n===d.LiveStreamingServiceMode.TRANSCODE)throw s(),new f.AgoraRTCError(f.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(!this.connection&&i)return s(),[2];if(this.streamingTasks.get(t)&&!i)return s(),[2,new f.AgoraRTCError(f.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw()];if(!this.transcodingConfig&&n===d.LiveStreamingServiceMode.TRANSCODE)throw s(),new f.AgoraRTCError(f.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");a.label=2;case 2:return a.trys.push([2,5,,6]),this.connection?[3,4]:(c=this,[4,this.connect(n)]);case 3:c.connection=a.sent(),a.label=4;case 4:return[3,6];case 5:throw u=a.sent(),s(),u;case 6:switch(n){case d.LiveStreamingServiceMode.TRANSCODE:o.transcodingConfig=r({},this.transcodingConfig);break;case d.LiveStreamingServiceMode.RAW:break;case d.LiveStreamingServiceMode.INJECT:o={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,l=this.lastTaskId++,a.label=7;case 7:return a.trys.push([7,9,,14]),g=new Promise(function(n,r){p.wait(v.retryTimeout).then(function(){if(i)return r(i);var n=v.statusError.get(t);return n?(v.statusError.delete(t),r(n)):void 0})}),[4,Promise.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===d.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),g])];case 8:return h=a.sent(),this.isStartingStreamingTask=!1,_.default.debug("["+this.spec.clientId+"] live streaming started, code: "+h.code),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:l}),s(),[3,14];case 9:if(m=a.sent(),s(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||i)throw m;return m.data.changeAddress?[3,11]:[4,this.startLiveStreamingTask(t,n,m)];case 10:case 12:return[2,a.sent()];case 11:return this.connection.tryNextAddress(),[4,this.startLiveStreamingTask(t,n,m)];case 13:return[3,14];case 14:return[2]}})})},t.prototype.stopLiveStreamingTask=function(t){var n=this;return new Promise(function(i,r){var o=n.streamingTasks.get(t);if(!o||!n.connection)return new f.AgoraRTCError(f.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var a=o.mode;o.abortTask=function(){_.default.debug("["+n.spec.clientId+"] stop live streaming success(worker exception)"),n.streamingTasks.delete(t),i()},_.default.debug("stop live streaming task request: "+JSON.stringify(t)),n.connection.request("request",{clientRequest:{command:a===d.LiveStreamingServiceMode.INJECT?"UninjectStream":"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:a===d.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!0,tid:(n.lastTaskId++).toString()}).then(function(r){_.default.debug("["+n.spec.clientId+"] stop live streaming success, code: "+r.code),n.streamingTasks.delete(t),0===n.streamingTasks.size&&a!==d.LiveStreamingServiceMode.INJECT&&(n.connection.close(),n.connection=void 0),i()}).catch(r)})},t.prototype.controlInjectStream=function(t,n,i,r){return o(this,void 0,void 0,function(){var o;return a(this,function(a){switch(a.label){case 0:if(!(o=this.streamingTasks.get(t))||!this.connection||o.mode!==d.LiveStreamingServiceMode.INJECT)throw new f.AgoraRTCError(f.AgoraRTCErrorCode.INVALID_OPERATION,"can not find inject stream task to control");return[4,this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:i,position:r}})];case 1:return[2,a.sent().serverResponse]}})})},t.prototype.resetAllTask=function(){var t=this,n=Array.from(this.streamingTasks.values());this.terminate();for(var i=function(n){r.startLiveStreamingTask(n.url,n.mode).catch(function(i){t.onLiveStreamError&&t.onLiveStreamError(n.url,i)})},r=this,o=0,a=n;o<a.length;o++)i(a[o])},t.prototype.setGatewayConnectionState=function(t){this.connection&&(this.connection.gatewayConnectionState=t)},t.prototype.terminate=function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=g.default.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0},t.prototype.connect=function(t){return o(this,void 0,void 0,function(){var n,i=this;return a(this,function(r){switch(r.label){case 0:if(this.connection)throw new f.AgoraRTCError(f.AgoraRTCErrorCode.UNEXPECTED_ERROR,"live streaming connection has already connected");return[4,p.getLiveStreamingWorkerMangerResult(t,this.spec,this.cancelToken.token)];case 1:return n=r.sent(),this.uapResponse=n,this.connection=new c.AgoraLiveStreamingUapSignal(n.workerToken,this.spec,t),this.connection.on(d.LiveStreamingUapSignalEvents.WARNING,function(t,n){return i.onLiveStreamWarning&&i.onLiveStreamWarning(n,t)}),this.connection.on(d.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,function(t){return i.handlePublishStreamServer(t)}),this.connection.on(d.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,function(t){return i.handleInjectStreamServerStatus(t)}),this.connection.on(d.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS,function(n,r){if(!i.connection)return r(new f.AgoraRTCError(f.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not get new live streaming address list"));p.getLiveStreamingWorkerMangerResult(t,i.spec,i.cancelToken.token).then(function(t){i.uapResponse=t,n(t.addressList)}).catch(r)}),[4,this.connection.init(n.addressList)];case 2:return r.sent(),[2,this.connection]}})})},t.prototype.handlePublishStreamServer=function(t){var n=this,i=t.serverStatus&&t.serverStatus.url;if(!i)throw new f.AgoraRTCError(f.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"empty url",{code:t.code});var r=this.streamingTasks.get(i);switch(t.code){case d.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case d.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case d.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case d.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var o=new f.AgoraRTCError(f.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return _.default.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,o);if(!this.isStartingStreamingTask)return;this.statusError.set(i,o);case d.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case d.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(!this.connection||0===this.streamingTasks.size)return;this.connection.tryNextAddress();for(var a=Array.from(this.streamingTasks.values()),s=function(i){if(i.abortTask)return i.abortTask(),"continue";_.default.warning("["+c.spec.clientId+"] publish stream status code",t.code,"try to republish",i.url),c.startLiveStreamingTask(i.url,i.mode,new f.AgoraRTCError(f.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(function(){_.default.debug("["+n.spec.clientId+"] republish live stream success",i.url)}).catch(function(t){_.default.error(t.toString()),n.onLiveStreamError&&n.onLiveStreamError(i.url,t)})},c=this,u=0,l=a;u<l.length;u++)s(l[u]);return}},t.prototype.handleInjectStreamServerStatus=function(t){var n=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,n,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,n,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,n,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,n,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,n,i),void this.streamingTasks.delete(i);default:return void _.default.debug("inject stream server status",t)}},t.prototype.haveUrl=function(t){return this.streamingTasks.has(t)||void 0},t}();n.AgoraRTCLiveStreamingClient=h},function(t,n,i){"use strict";var r,o=this&&this.__extends||(r=function(t,n){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),a=this&&this.__assign||function(){return(a=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++)for(var o in n=arguments[i])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},c=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},d=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var u=i(27),l=i(77),f=i(36),p=i(24),_=i(2),g=d(i(0)),h=i(1),m=i(31),v=function(t){function n(n,i,r){var o=t.call(this)||this;return o._gatewayConnectionState="CONNECTED",o.reconnectMode="retry",o.reqId=0,o.commandReqId=0,o.waitingResponseList=[],o.handleWebSocketOpen=function(){o.reconnectMode="retry",o.startPingPong()},o.handleWebSocketMessage=function(t){if(t.data){var n=JSON.parse(t.data);if(n.requestId)o.emit("@"+n.requestId,n);else if(o.serviceMode===u.LiveStreamingServiceMode.INJECT)o.emit(u.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,n);else{h.report.requestWorkerEvent(o.spec.sid,{actionType:"status",serverCode:n.code,workerType:o.serviceMode===u.LiveStreamingServiceMode.TRANSCODE?1:2});var i=n.serverStatus&&n.serverStatus.url;i&&o.waitingResponseList.includes(i)&&200===n.code&&o.emit(i),o.emit(u.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,n)}}},o.spec=i,o.token=n,o.serviceMode=r,o.websocket=new l.AgoraWebSocketManager("live-streaming"),o.websocket.on(u.WebSocketManagerEvents.CONNECTED,o.handleWebSocketOpen),o.websocket.on(u.WebSocketManagerEvents.ON_MESSAGE,o.handleWebSocketMessage),o.websocket.on(u.WebSocketManagerEvents.REQUEST_NEW_URLS,function(t,n){f.emitAsPromise(o,u.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS).then(t).catch(n)}),o.websocket.on(u.WebSocketManagerEvents.RECONNECTING,function(){o.websocket.reconnectMode=o.reconnectMode}),o}return o(n,t),Object.defineProperty(n.prototype,"gatewayConnectionState",{get:function(){return this._gatewayConnectionState},set:function(t){this._gatewayConnectionState=t,"CONNECTED"===t&&this.emit("gateway-connected",t)},enumerable:!0,configurable:!0}),n.prototype.init=function(t){return this.websocket.init(t)},n.prototype.request=function(t,n,i,r){return s(this,void 0,void 0,function(){var o,s,d,l,f,g,v,$,E,S,y=this;return c(this,function(c){switch(c.label){case 0:if(this.reqId+=1,o=this.reqId,"request"===t&&(this.commandReqId+=1),s=this.commandReqId,!o||!this.websocket)throw new p.AgoraRTCError(p.AgoraRTCErrorCode.UNEXPECTED_ERROR);if(d=_.VERSION,"closed"===this.websocket.state)throw new p.AgoraRTCError(p.AgoraRTCErrorCode.WS_DISCONNECT);return l=function(){return new Promise(function(t,n){var i=function(){"CONNECTED"===y.gatewayConnectionState&&"connected"===y.websocket.state&&(y.off("gateway-connected",i),y.websocket.off(u.WebSocketManagerEvents.CONNECTED,i),t(void 0))};y.on("gateway-connected",i),y.websocket.once(u.WebSocketManagerEvents.CLOSED,function(){return n(new p.AgoraRTCError(p.AgoraRTCErrorCode.WS_ABORT))}),y.websocket.on(u.WebSocketManagerEvents.CONNECTED,i)})},"connected"===this.websocket.state&&"CONNECTED"===this.gatewayConnectionState?[3,2]:[4,l()];case 1:c.sent(),c.label=2;case 2:f=Promise.race([new Promise(function(t,n){var i=function(){n(new p.AgoraRTCError(p.AgoraRTCErrorCode.WS_ABORT))};y.websocket.once(u.WebSocketManagerEvents.RECONNECTING,i),y.websocket.once(u.WebSocketManagerEvents.CLOSED,i),y.once("@"+o,function(n){t(n)})}),m.wait(_.getParameter("LIVE_STREAMING_TIMEOUT")).then(function(){return!1})]),(g=a({command:t,sdkVersion:d,seq:o,requestId:o,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n)).clientRequest&&(g.clientRequest.workerToken=this.token),r&&h.report.requestWorkerEvent(this.spec.sid,a(a({},r),{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0})),v=Date.now(),this.websocket.sendMessage(g),$=null,c.label=3;case 3:return c.trys.push([3,5,,8]),[4,f];case 4:return $=c.sent(),[3,8];case 5:if(E=c.sent(),"closed"===this.websocket.state)throw E;return[4,l()];case 6:return c.sent(),[4,this.request(t,n,i,r)];case 7:return[2,c.sent()];case 8:if(!1===$)throw S=new p.AgoraRTCError(p.AgoraRTCErrorCode.NETWORK_TIMEOUT,(n&&n.clientRequest&&n.clientRequest.command)+" timeout",{changeAddress:!0,retry:!0}),this.emit(u.LiveStreamingUapSignalEvents.WARNING,S,r&&r.url||"unknown url"),r&&h.report.requestWorkerEvent(this.spec.sid,a(a({},r),{requestId:s,actionType:"response",payload:"TIMEOUT",serverCode:0,success:0,responseTime:Date.now()-v})),S;return r&&h.report.requestWorkerEvent(this.spec.sid,a(a({},r),{requestId:s,actionType:"response",payload:JSON.stringify($.serverResponse),serverCode:$.code,success:200===$.code,responseTime:Date.now()-v})),200===$.code?[3,10]:[4,this.handleResponseError($)];case 9:c.sent(),c.label=10;case 10:return[2,$]}})})},n.prototype.tryNextAddress=function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")},n.prototype.close=function(){var t="__VERSION__"===_.VERSION?"0.0.1":_.VERSION;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)},n.prototype.handleResponseError=function(t){return s(this,void 0,void 0,function(){var n,i,r,o,a=this;return c(this,function(s){switch(g.default.debug("[live-streaming] receive response error "+t.code),t.code){case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return g.default.warning("live stream response already exists stream"),n=t.serverResponse.url,this.emit(u.LiveStreamingUapSignalEvents.WARNING,"live stream response already exists stream, code 454",n),this.waitingResponseList.includes(n)||this.waitingResponseList.push(n),[2,new Promise(function(i,r){a.once(n,function(){a.waitingResponseList.splice(a.waitingResponseList.indexOf(n),1),i()}),setTimeout(function(){a.waitingResponseList.splice(a.waitingResponseList.indexOf(n),1),r(new p.AgoraRTCError(p.AgoraRTCErrorCode.TIMEOUT,"live stream timeout waiting 454",{code:t.code}))},1e4)})];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_BAD_STREAM:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return[2,new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE:throw new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)break;throw new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return[2,new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return i=new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,i,t.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return i=new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FREQUENT_REQUEST),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,i,t.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return[2,new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return i=new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,i,t.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return[2,new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)break;throw new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)break;if("UpdateTranscoding"===t.serverResponse.command||"ControlStream"===t.serverResponse.command)return[2,new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw()];throw new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return r=t.serverResponse.url,this.waitingResponseList.includes(r)||this.waitingResponseList.push(r),o=new p.AgoraRTCError(p.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}),this.emit(u.LiveStreamingUapSignalEvents.WARNING,o,r),[2,new Promise(function(t,n){a.once(r,function(){a.waitingResponseList.splice(a.waitingResponseList.indexOf(r),1),t()}),setTimeout(function(){a.waitingResponseList.splice(a.waitingResponseList.indexOf(r),1),n(o)},1e4)})]}return[2]})})},n.prototype.startPingPong=function(){var t=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(function(){"connected"===t.websocket.state&&t.request("ping",{}).catch(function(){})},6e3)},n}(f.EventEmitter);n.AgoraLiveStreamingUapSignal=v},function(t,n,i){"use strict";var r,o=this&&this.__extends||(r=function(t,n){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),a=this&&this.__awaiter||function(t,n,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{d(r.next(t))}catch(n){a(n)}}function c(t){try{d(r.throw(t))}catch(n){a(n)}}function d(t){var n;t.done?o(t.value):((n=t.value)instanceof i?n:new i(function(t){t(n)})).then(s,c)}d((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var i,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(c){a=[6,c],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var d=i(24),u=i(36),l=i(31),f=i(27),p=c(i(0)),_=function(t){function n(n){var i=t.call(this)||this;return i.connectionID=0,i.currentURLIndex=0,i.reconnectMode="tryNext",i._state="closed",i.retryConfig=l.DEFAULT_RETRY_CONFIG,i.reconnectCount=0,i.name=n,i}return o(n,t),Object.defineProperty(n.prototype,"url",{get:function(){return this.websocket?this.websocket.url:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){t!==this._state&&(this._state=t,"reconnecting"===this._state?this.emit(f.WebSocketManagerEvents.RECONNECTING,this.reconnectMode):"connected"===this._state?this.emit(f.WebSocketManagerEvents.CONNECTED):"closed"===this._state?this.emit(f.WebSocketManagerEvents.CLOSED):"failed"===this._state&&this.emit(f.WebSocketManagerEvents.FAILED))},enumerable:!0,configurable:!0}),n.prototype.init=function(t){var n=this;return new Promise(function(i,r){n.urls=t;var o=n.urls[n.currentURLIndex];n.state="connecting",n.createWebSocketConnection(o).then(i).catch(r),n.once(f.WebSocketManagerEvents.CLOSED,function(){return r(new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_DISCONNECT))}),n.once(f.WebSocketManagerEvents.CONNECTED,function(){return i()})})},n.prototype.close=function(t,n){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var i=this.websocket;n?setTimeout(function(){return i.close()},500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed"},n.prototype.reconnect=function(t){if(this.websocket){void 0!==t&&(this.reconnectMode=t);var n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999})}else p.default.warning("["+this.name+"] can not reconnect, no websocket")},n.prototype.sendMessage=function(t){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_ABORT,"websocket is not ready");var n=JSON.stringify(t);try{this.websocket.send(n)}catch(i){throw new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_ERR,"send websocket message error"+i.toString())}},n.prototype.createWebSocketConnection=function(t){return a(this,void 0,void 0,function(){var n,i=this;return s(this,function(r){return this.connectionID+=1,n=this.connectionID,[2,new Promise(function(r,o){i.websocket&&(i.websocket.onclose=null,i.websocket.close()),p.default.debug("["+i.name+"] start connect, url: "+t);try{i.websocket=new WebSocket(t),i.websocket.binaryType="arraybuffer"}catch(c){var _=new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_ERR,"init websocket failed! Error: "+c.toString());return p.default.error("["+i.name+"]"+_),void o(_)}l.wait(5e3).then(function(){n===i.connectionID&&i.websocket&&i.websocket.readyState!==WebSocket.OPEN&&i.websocket&&i.websocket.close()}),i.websocket.onopen=function(){p.default.debug("["+i.name+"] websockect opened:",t),i.reconnectMode="retry",i.state="connected",i.reconnectCount=0,r()},i.websocket.onclose=function(t){return a(i,void 0,void 0,function(){var n,i;return s(this,function(a){switch(a.label){case 0:return p.default.debug("["+this.name+"] websocket close "+(this.websocket&&this.websocket.url)+", code: "+t.code+", reason: "+t.reason+", current mode: "+this.reconnectMode),this.reconnectCount<this.retryConfig.maxRetryCount?("connected"===this.state&&(this.state="reconnecting"),n=u.emitAsInvokerNoResponse(this,f.WebSocketManagerEvents.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,[4,this.reconnectWithAction(n)]):[3,2];case 1:return i=a.sent(),"closed"===this.state?(p.default.debug("["+this.connectionID+"] ws is closed, no need to reconnect"),[2]):i?(r(),[3,3]):(o(new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_DISCONNECT,"websocket reconnect failed: "+t.code)),this.close(!0),[2]);case 2:o(new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_DISCONNECT,"websocket close: "+t.code)),this.close(),a.label=3;case 3:return[2]}})})},i.websocket.onmessage=function(t){i.emit(f.WebSocketManagerEvents.ON_MESSAGE,t)}})]})})},n.prototype.reconnectWithAction=function(t,n){return a(this,void 0,void 0,function(){var i,r,o,a;return s(this,function(s){switch(s.label){case 0:return!n&&this.reconnectCount>=this.retryConfig.maxRetryCount?[2,!1]:this.urls?"closed"===this.state?[2,!1]:(i=l.getRetryWaitTime(this.reconnectCount,this.retryConfig),p.default.debug("["+this.name+"] wait "+i+"ms to reconnect websocket, mode: "+t),[4,l.wait(i)]):[2,!1];case 1:if(s.sent(),"closed"===this.state)return[2,!1];this.reconnectCount+=1,s.label=2;case 2:return s.trys.push([2,12,,14]),"retry"!==t?[3,4]:(o=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(o)]);case 3:case 7:return s.sent(),[3,11];case 4:return"tryNext"!==t?[3,8]:(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length?[4,this.reconnectWithAction("recover")]:[3,6]);case 5:return[2,s.sent()];case 6:return p.default.debug("["+this.name+"] websocket url length: "+this.urls.length+" current index: "+this.currentURLIndex),o=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(o)];case 8:return"recover"!==t?[3,11]:(p.default.debug("["+this.name+"] request new urls"),r=this,[4,u.emitAsPromise(this,f.WebSocketManagerEvents.REQUEST_NEW_URLS)]);case 9:return r.urls=s.sent(),this.currentURLIndex=0,o=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(o)];case 10:s.sent(),s.label=11;case 11:return[2,!0];case 12:return a=s.sent(),p.default.error("["+this.name+"] reconnect failed",a.toString()),[4,this.reconnectWithAction(t)];case 13:return[2,s.sent()];case 14:return[2]}})})},n}(u.EventEmitter);n.AgoraWebSocketManager=_},function(t,n,i){"use strict";var r=i(18),o=i(38),a=i(79),s=i(44);function c(t){var n=new a(t),i=o(a.prototype.request,n);return r.extend(i,a.prototype,n),r.extend(i,n),i}var d=c(i(41));d.Axios=a,d.create=function(t){return c(s(d.defaults,t))},d.Cancel=i(45),d.CancelToken=i(93),d.isCancel=i(40),d.all=function(t){return Promise.all(t)},d.spread=i(94),t.exports=d,t.exports.default=d},function(t,n,i){"use strict";var r=i(18),o=i(39),a=i(80),s=i(81),c=i(44);function d(t){this.defaults=t,this.interceptors={request:new a,response:new a}}d.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=c(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=[s,void 0],i=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){n.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){n.push(t.fulfilled,t.rejected)});n.length;)i=i.then(n.shift(),n.shift());return i},d.prototype.getUri=function(t){return t=c(this.defaults,t),o(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],function(t){d.prototype[t]=function(n,i){return this.request(r.merge(i||{},{method:t,url:n}))}}),r.forEach(["post","put","patch"],function(t){d.prototype[t]=function(n,i,o){return this.request(r.merge(o||{},{method:t,url:n,data:i}))}}),t.exports=d},function(t,n,i){"use strict";var r=i(18);function o(){this.handlers=[]}o.prototype.use=function(t,n){return this.handlers.push({fulfilled:t,rejected:n}),this.handlers.length-1},o.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},o.prototype.forEach=function(t){r.forEach(this.handlers,function(n){null!==n&&t(n)})},t.exports=o},function(t,n,i){"use strict";var r=i(18),o=i(82),a=i(40),s=i(41);function c(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return c(t),t.headers=t.headers||{},t.data=o(t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),r.forEach(["delete","get","head","post","put","patch","common"],function(n){delete t.headers[n]}),(t.adapter||s.adapter)(t).then(function(n){return c(t),n.data=o(n.data,n.headers,t.transformResponse),n},function(n){return a(n)||(c(t),n&&n.response&&(n.response.data=o(n.response.data,n.response.headers,t.transformResponse))),Promise.reject(n)})}},function(t,n,i){"use strict";var r=i(18);t.exports=function(t,n,i){return r.forEach(i,function(i){t=i(t,n)}),t}},function(t,n){var i,r,o=t.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function c(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(n){try{return i.call(null,t,0)}catch(r){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(t){i=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(n){r=s}}();var d,u=[],l=!1,f=-1;function p(){l&&d&&(l=!1,d.length?u=d.concat(u):f=-1,u.length&&_())}function _(){if(!l){var t=c(p);l=!0;for(var n=u.length;n;){for(d=u,u=[];++f<n;)d&&d[f].run();f=-1,n=u.length}d=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(n){try{return r.call(null,t)}catch(i){return r.call(this,t)}}}(t)}}function g(t,n){this.fun=t,this.array=n}function h(){}o.nextTick=function(t){var n=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)n[i-1]=arguments[i];u.push(new g(t,n)),1!==u.length||l||c(_)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(t){return[]},o.binding=function(t){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,n,i){"use strict";var r=i(18);t.exports=function(t,n){r.forEach(t,function(i,r){r!==n&&r.toUpperCase()===n.toUpperCase()&&(t[n]=i,delete t[r])})}},function(t,n,i){"use strict";var r=i(43);t.exports=function(t,n,i){var o=i.config.validateStatus;!o||o(i.status)?t(i):n(r("Request failed with status code "+i.status,i.config,null,i.request,i))}},function(t,n,i){"use strict";t.exports=function(t,n,i,r,o){return t.config=n,i&&(t.code=i),t.request=r,t.response=o,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}},function(t,n,i){"use strict";var r=i(88),o=i(89);t.exports=function(t,n){return t&&!r(n)?o(t,n):n}},function(t,n,i){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,n,i){"use strict";t.exports=function(t,n){return n?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t}},function(t,n,i){"use strict";var r=i(18),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var n,i,a,s={};return t&&r.forEach(t.split("\n"),function(t){a=t.indexOf(":"),n=r.trim(t.substr(0,a)).toLowerCase(),i=r.trim(t.substr(a+1)),n&&!(s[n]&&o.indexOf(n)>=0)&&(s[n]="set-cookie"===n?(s[n]?s[n]:[]).concat([i]):s[n]?s[n]+", "+i:i)}),s}},function(t,n,i){"use strict";var r=i(18);t.exports=r.isStandardBrowserEnv()?function(){var t,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function o(t){var r=t;return n&&(i.setAttribute("href",r),r=i.href),i.setAttribute("href",r),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return t=o(window.location.href),function(n){var i=r.isString(n)?o(n):n;return i.protocol===t.protocol&&i.host===t.host}}():function(){return!0}},function(t,n,i){"use strict";var r=i(18);t.exports=r.isStandardBrowserEnv()?{write:function(t,n,i,o,a,s){var c=[];c.push(t+"="+encodeURIComponent(n)),r.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),r.isString(o)&&c.push("path="+o),r.isString(a)&&c.push("domain="+a),!0===s&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){var n=document.cookie.match(RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,n,i){"use strict";var r=i(45);function o(t){if("function"!=typeof t)throw TypeError("executor must be a function.");this.promise=new Promise(function(t){n=t});var n,i=this;t(function(t){i.reason||(i.reason=new r(t),n(i.reason))})}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var t;return{token:new o(function(n){t=n}),cancel:t}},t.exports=o},function(t,n,i){"use strict";t.exports=function(t){return function(n){return t.apply(null,n)}}},function(t,n,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var o=r(i(0)),a=1,s=function(){function t(t){this.lockingPromise=Promise.resolve(),this.locks=0,this.name="",this.lockId=a++,t&&(this.name=t),o.default.debug("[lock-"+this.name+"-"+this.lockId+"] is created.")}return Object.defineProperty(t.prototype,"isLocked",{get:function(){return this.locks>0},enumerable:!0,configurable:!0}),t.prototype.lock=function(){var t,n=this;this.locks+=1,o.default.debug("[lock-"+this.name+"-"+this.lockId+"] is locked, current queue "+this.locks+".");var i=new Promise(function(i){t=function(){n.locks-=1,o.default.debug("[lock-"+n.name+"-"+n.lockId+"] is not locked, current queue "+n.locks+"."),i()}}),r=this.lockingPromise.then(function(){return t});return this.lockingPromise=this.lockingPromise.then(function(){return i}),r},t}();n.PromiseMutex=s},function(t,n,i){"use strict";i.r(n);var r=i(2),o=i(0),a=i(1),s=i(8),c=i(4),d=function(){};d.prototype.set=function(t,n){["BatteryLevel"].indexOf(t)>-1&&(this[t]=n)};var u=function(){var t=a.report.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket,o=!!n&&!!i&&!!r,s=!1;c.isChrome()&&c.getBrowserVersion()>=58&&"iOS"!==c.getBrowserOS()&&(s=!0),c.isFireFox()&&c.getBrowserVersion()>=56&&(s=!0),c.isOpera()&&c.getBrowserVersion()>=45&&(s=!0),c.isSafari()&&c.getBrowserVersion()>=11&&(s=!0),c.isEdge()&&(s=!0),(c.isWeChatBrowser()||c.isQQBrowser())&&"iOS"!==c.getBrowserOS()&&(s=!0),c.isSupportedPC()||c.isSupportedMobile()||(s=!1);var d=o&&s;return t(null,d),d},l=new function(){var t=Object(s.b)();return t.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},t.state=t.states.UNINIT,t.batteryManager=null,t._init=function(n,i){t.state=t.states.INITING,navigator.getBattery?navigator.getBattery().then(function(i){t.batteryManager=i,n&&setTimeout(function(){n()},0)}).catch(function(t){o.default.debug("navigator.getBattery is disabled",t),n&&n()}):(t.state=t.states.INITED,n&&n())},t._getBatteryStats=function(){var n={};return t.batteryManager&&t.batteryManager.level?n.BatteryLevel=Math.floor(100*t.batteryManager.level):n.BatteryLevel="UNSUPPORTED",n},t.getStats=function(n,i){var r=new d,o=t._getBatteryStats();o&&o.BatteryLevel&&r.set("BatteryLevel",o.BatteryLevel),n&&n(r)},t._init(),t},f=i(22),p=i(19),_=i(26),g=i(53),h=i(9),m=["live","rtc","web","interop","h264_interop","web-only"],v=["vp8","vp9","h264"],$=["aes-128-gcm","aes-256-gcm","aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-256-gcm2","aes-128-gcm2"],E=i(11),S=i.n(E),y=i(7),R=i.n(y),T=i(13),I=i(5),A=i(10),C=i(20),b=i(6),N=i(14),O={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},w={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},L=function(t){var n={remoteStreamStorage:{},localStreamStorage:{}};return n.gatewayClient=t,n.checkAudioOutputLevel=function(t){return!(t&&parseInt(t.audioRecvBytesDelta)>0&&parseInt(t.audioDecodingNormalDelta)>0&&0===parseInt(t.audioOutputLevel))},n.checkAudioIntputLevel=function(t){return!t||0!==parseInt(t.audioInputLevel)},n.checkFramerateInput=function(t,n){if(!t||!n.attributes)return!0;var i=parseInt(n.attributes.maxFrameRate),r=parseInt(t.googFrameRateInput);return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)},n.checkFramerateSent=function(t){return!(t&&parseInt(t.googFrameRateInput)>5&&1>=parseInt(t.googFrameRateSent))},n.checkSendVideoBitrate=function(t){return!t||0!==parseInt(t.videoSendBytesDelta)},n.checkSendAudioBitrate=function(t){return!t||0!==parseInt(t.audioSendBytesDelta)},n.checkVideoDecode=function(t){return!t||0===parseInt(t.videoRecvBytesDelta)||0!==parseInt(t.googFrameRateDecoded)},n.checkAudioDecode=function(t){return!t||0===parseInt(t.audioRecvBytesDelta)||0!==parseInt(t.audioDecodingNormalDelta)},n.record=function(t,i,r,o,a){r[t]||(r[t]={isPrevNormal:!0,record:[]});var s=r[t],c=n["check"+t](i,a);if(s.record.push(c),s.record.length>=5){s.isCurNormal=-1!==s.record.indexOf(!0);var d=w[t];s.isPrevNormal&&!s.isCurNormal&&n.gatewayClient.dispatchEvent({type:"exception",code:d,msg:O[d],uid:o}),!s.isPrevNormal&&s.isCurNormal&&n.gatewayClient.dispatchEvent({type:"exception",code:d+2e3,msg:O[d+2e3],uid:o}),s.isPrevNormal=s.isCurNormal,s.record=[]}},n.setLocalStats=function(t){var i={};Object.keys(t).map(function(r){var o=t[r],a=n.gatewayClient.localStreams[parseInt(r)],s=n.localStreamStorage[r]||{};a&&a.hasVideo()&&(n.record("SendVideoBitrate",o.videoStats,s,r),n.record("FramerateInput",o.videoStats,s,r,a),n.record("FramerateSent",o.videoStats,s,r)),a&&a.hasAudio()&&(n.record("AudioIntputLevel",o.audioStats,s,r),n.record("SendAudioBitrate",o.audioStats,s,r)),i[r]=s}),n.localStreamStorage=i},n.setRemoteStats=function(i){var r={};Object.keys(i).map(function(o){var a=i[o],s=t.remoteStreams[o],c=n.remoteStreamStorage[o]||{};s&&s.hasVideo()&&s.isPlaying()&&n.record("VideoDecode",a.videoStats,c,o),s&&s.hasAudio()&&s.isPlaying()&&(n.record("AudioOutputLevel",a.audioStats,c,o),n.record("AudioDecode",a.audioStats,c,o)),r[o]=c}),n.remoteStreamStorage=r},n};function k(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"==typeof t)return D(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return D(t,n)}}(t))){var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function D(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,r=Array(n);i<n;i++)r[i]=t[i];return r}var P,M=i(3),x=new function(){var t=Object(s.b)();return t.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},t.state=t.states.UNINIT,t.type=null,t.lastConnectedAt=null,t.lastDisconnectedAt=null,t.lastTypeChangedAt=null,t.networkChangeTimer=null,t._init=function(n,i){if(t.state=t.states.INITING,navigator.connection&&navigator.connection.addEventListener){var r=t._getNetworkInfo();t.type=r&&r.type,t.state=t.states.INITED,n&&n()}else t.state=t.states.UNINIT,i&&i("DO_NOT_SUPPORT")},t._getNetworkInfo=function(){return navigator.connection},t._reloadNetworkInfo=function(){var n=t._getNetworkInfo(),i=n&&n.type||"UNSUPPORTED",r=Date.now();if(i!==t.type){t.lastTypeChangedAt=r,"none"==i?t.lastDisconnectedAt=r:"none"==t.type&&(t.lastConnectedAt=r),t.type=i;var o={type:"networkTypeChanged",networkType:i};t.dispatchEvent(o)}},t.getStats=function(n,i){var r={},o=t._getNetworkInfo();o&&(r.NetworkType=o.type||"UNSUPPORTED"),setTimeout(function(){n(r)},0)},t._init(function(){navigator.connection.addEventListener("change",function(){t._reloadNetworkInfo()}),t.networkChangeTimer=setInterval(function(){t._reloadNetworkInfo()},5e3)},function(t){}),t},U=i(55),V=i(16),B=i(56),F=i.n(B),j=i(21),W=function(){return"HTTPS"===(P||P||(P=(window.location.protocol.split(":")[0]||"").toUpperCase()))},G=function(){return void 0!==window.isSecureContext},H="host",q=function(t){var n,i,d,_,g={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServers:[],useProxyServer:!1,useLocalAccessPoint:!1};if(g.mode=t.mode,g.codec=t.codec,g.clientId=Object(A.generateSessionId)().slice(0,5),g.uintUid=null,g.customReportCount=0,t=R()({},t),g.aespassword=null,g.aesmode="none",g.hasPublished=!1,g.getSessionId=function(){return t.sessionId},g.startChannelMediaRelay=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:function(t){if(t)return i&&i(t);i&&i()},name:"Client.startChannelMediaRelay",options:arguments,tag:"tracer"});if(!(n instanceof h.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var o=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfos();if(Object(M.isEmpty)(o))throw"srcChannelMediaInfo should not be empty";if(Object(M.isEmpty)(s)||0===s.length)throw"destChannelMediaInfos should not be empty";if(!Object(A.is32Uint)(o.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(M.isValidChannelName)(o.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(o.token&&!Object(M.isValidToken)(o.token))throw"Invalid token in srcChannelMediaInfo";if(s.forEach(function(t){if(!Object(A.is32Uint)(t.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(M.isValidChannelName)(t.channelName))throw"Invalid channelName in destChannelMediaInfo";if(t.token&&!Object(M.isValidToken)(t.token))throw"Invalid token in destChannelMediaInfo"}),g.gatewayClient.state!==T.a.CONNECTED)throw"startChannelMediaRelay should be used after join";g.gatewayClient.startChannelMediaRelay(n).then(function(){r&&r()}).catch(function(t){r&&r(t)})},g.updateChannelMediaRelay=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:function(t){if(t)return i&&i(t);i&&i()},name:"Client.updateChannelMediaRelay",options:arguments,tag:"tracer"});if(!(n instanceof h.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var o=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfos();if(Object(M.isEmpty)(o))throw"srcChannelMediaInfo should not be empty";if(Object(M.isEmpty)(s)||0===s.length)throw"destChannelMediaInfos should not be empty";if(!Object(A.is32Uint)(o.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(M.isValidChannelName)(o.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(o.token&&!Object(M.isValidToken)(o.token))throw"Invalid token in srcChannelMediaInfo";if(s.forEach(function(t){if(!Object(A.is32Uint)(t.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(M.isValidChannelName)(t.channelName))throw"Invalid channelName in destChannelMediaInfo";if(t.token&&!Object(M.isValidToken)(t.token))throw"Invalid token in destChannelMediaInfo"}),g.gatewayClient.state!==T.a.CONNECTED)throw"updateChannelMediaRelay should be used after join";g.gatewayClient.updateChannelMediaRelay(n).then(function(){r&&r()}).catch(function(t){r&&r(t)})},g.stopChannelMediaRelay=function(n){var i=a.report.reportApiInvoke(t.sessionId,{callback:function(t){if(t)return n&&n(t);n&&n()},name:"Client.stopChannelMediaRelay",options:arguments,tag:"tracer"});g.gatewayClient.stopChannelMediaRelay().then(function(){i&&i()}).catch(function(t){i&&i(t)})},g.getConnectionState=function(){var n=a.report.reportApiInvoke(t.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),i=T.a.connetionStateMap[g.gatewayClient.state];return n(),i},g.setClientRole=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:i,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(Object(M.checkValidEnum)(n,"setClientRole",[H,"audience"]),"rtc"===g.mode){var s="RTC mode can not use setClientRole";return o.default.warning("[".concat(g.clientId,"] ").concat(s)),r&&r(s)}g.gatewayClient&&g.gatewayClient.state===T.a.CONNECTED?("audience"===n&&(0===this.highStreamState?this._unpublish(this.highStream,function(){r&&r(null,{role:n})},function(t){r&&r(t)}):g.gatewayClient.setClientRole("audience",r)),n===H&&g.gatewayClient.setClientRole(H,r)):(g.gatewayClient.role=n,r&&r(null,{role:n}))},g.getGatewayInfo=function(t){if(g.gatewayClient.state!==T.a.CONNECTED){var n="Client is not in connected state";return o.default.error("[".concat(g.clientId,"] ").concat(n)),void t(n)}g.gatewayClient.getGatewayInfo(function(n){t(null,n)},t)},g.renewToken=function(n,i,r){var s=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return o.default.error("Failed to renew token ".concat(t),n),r&&r(t);i&&i(n)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Object(M.isValidToken)(n))throw Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");return g.gatewayClient?g.key?(g.key=n,void g.gatewayClient.renewToken(n,function(t){return s(null,t)},s)):(o.default.error("[".concat(g.clientId,"] renewToken should not be called before user join")),s(I.default.INVALID_OPERATION)):(o.default.error("[".concat(g.clientId,"] renewToken Failed. GatewayClient not Exist")),s(I.default.INVALID_OPERATION))},g.setLowStreamParameter=function(n){var i=a.report.reportApiInvoke(t.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});Object(M.checkValidObject)(n,"param");var r=n.width,s=n.height,c=n.framerate,d=n.bitrate;Object(M.isEmpty)(r)||Object(M.checkValidNumber)(r,"width"),Object(M.isEmpty)(s)||Object(M.checkValidNumber)(s,"height"),Object(M.isEmpty)(c)||Object(M.checkValidNumber)(c,"framerate"),Object(M.isEmpty)(d)||Object(M.checkValidNumber)(d,"bitrate",1,1e7),(!r&&s||r&&!s)&&o.default.warning("[".concat(g.clientId,"] The width and height parameters take effect only when both are set")),g.lowStreamParameter=n,i()},g.init=function(n,i,r){var o=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return r&&r(t);i&&i(n)},name:"Client.init",options:arguments,tag:"tracer"});Object(M.checkValidString)(n),Object(c.isChromeKernel)()&&48>=Object(c.getChromeKernelVersion)()?r?o(I.default.BAD_ENVIRONMENT):Object(A.popBanTip)():(t.appId=n,t.sessionId=Object(A.generateSessionId)(),o())},g.setTurnServer=function(n){var i=a.report.reportApiInvoke(t.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(g.gatewayClient&&g.gatewayClient.state!==T.a.DISCONNECTED)throw Error("Set turn server before join channel");if(g.useProxyServer)throw Error("You have already set the proxy");if(g.useLocalAccessPoint)throw Error("You have already set the local proxy");n instanceof Array||(n=[n]);var r=[];n.map(function(t,n){Object(M.checkValidObject)(t,"turnServer");var i=t.turnServerURL,a=t.username,s=t.password,c=t.udpport,d=t.forceturn,u=t.tcpport;if(Object(M.checkValidString)(i,"turnServerURL"),Object(M.checkValidString)(a,"username"),Object(M.checkValidString)(s,"password"),Object(M.checkValidString)(c,"udpport"),0===parseInt(c))throw Error("udpport should not be ".concat(c));Object(M.isEmpty)(d)||Object(M.checkValidBoolean)(d,"forceturn");var l={mode:"manual"};if(l.url=i,l.udpport=c,l.username=a,l.credential=s,l.forceturn=d||!1,!Object(M.isEmpty)(u)){if(Object(M.checkValidString)(u,"tcpport"),0===parseInt(u))throw Error("tcpport should not be ".concat(u));l.tcpport=u,o.default.info("[".concat(g.clientId,"] Set turnserver[").concat(n,"] tcpurl. ").concat(l.url,":").concat(l.tcpport))}o.default.info("[".concat(g.clientId,"] Set turnserver[").concat(n,"] udpurl. ").concat(l.url,":").concat(l.udpport,",username: ").concat(l.username)),r.push(l)}),g.turnServers=r,i()},g.setProxyServer=function(n){var i=a.report.reportApiInvoke(t.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(g.gatewayClient&&g.gatewayClient.state!==T.a.DISCONNECTED)throw Error("Set proxy server before join channel");if(!n)throw Error("Do not set the proxyServer parameter as empty");if(g.useProxyServer)throw Error("You have already set the proxy");if(g.useLocalAccessPoint)throw Error("You have already set the local proxy");Object(M.checkValidString)(n,"proxyServer"),g.proxyServer=n,a.report.setProxyServer(n),o.default.setProxyServer(n),i()},g.startProxyServer=function(n){var i=a.report.reportApiInvoke(t.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(g.gatewayClient&&g.gatewayClient.state!==T.a.DISCONNECTED)throw Error("Start proxy server before join channel");if(g.proxyServer)throw Error("You have already set the proxy");if(g.useLocalAccessPoint)throw Error("You have already set the local proxy");g.useProxyServer=!0,g.proxyServerType=n||1,i()},g.stopProxyServer=function(){var n=a.report.reportApiInvoke(t.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(g.gatewayClient&&g.gatewayClient.state!==T.a.DISCONNECTED)throw Error("Stop proxy server after leave channel");a.report.setProxyServer(),o.default.setProxyServer(),g.turnServers=[],g.proxyServer=null,g.useProxyServer=!1,g.proxyServerType=null,n()},g.setEncryptionSecret=function(n){var i=a.report.reportApiInvoke(t.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});Object(M.checkValidString)(n,"password"),RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})").test(n)||o.default.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer,\n      "),g.aespassword=n,i()},g.setEncryptionMode=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(Object(M.checkValidString)(n,"encryptionMode"),-1===$.indexOf(n))throw Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb" | "sm4-128-ecb" | "aes-128-gcm" | "aes-256-gcm" | "aes-128-gcm2" | "aes-256-gcm2"');if(-1!==["aes-128-gcm2","aes-256-gcm2"].indexOf(n)){if(!i||!(i instanceof Uint8Array&&32===i.length))throw Error("salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw Error("Only ".concat("aes-128-gcm2"," and ").concat("aes-256-gcm2"," support use salt"));i&&(g.aesSalt=Object(A.uint8ArrayToBase64)(i)),g.aesmode=n,r()},g.configPublisher=function(n){var i=a.report.reportApiInvoke(t.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});Object(M.checkValidObject)(n,"config");var r=n.width,o=n.height,s=n.framerate,c=n.bitrate,d=n.publisherUrl;Object(M.checkValidNumber)(r,"width"),Object(M.checkValidNumber)(o,"height"),Object(M.checkValidNumber)(s,"framerate"),Object(M.checkValidNumber)(c,"bitrate",1,1e7),d&&Object(M.checkValidString)(d,"publisherUrl"),g.gatewayClient.configPublisher(n),i()},g.enableDualStream=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:function(t,r){if(t)return i&&i(t);n&&n(r)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return"iOS"===Object(c.getBrowserOS)()?(a.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),r(I.default.IOS_NOT_SUPPORT)):Object(c.isWeChatBrowser)()?(a.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),r(I.default.WECHAT_NOT_SUPPORT)):(a.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!0}),g.isDualStream=!0,g.highStream&&(g.highStream.isDualStream=!0),void(0===g.highStreamState?g._publishLowStream(function(t){return r(null,t)},function(t){o.default.warning("[".concat(g.clientId,"]"),t),r(I.default.ENABLE_DUALSTREAM_FAILED)}):1===g.highStreamState?r(I.default.STILL_ON_PUBLISHING):r(null)))},g.disableDualStream=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:function(t,r){if(t)return i&&i(t);n&&n(r)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});a.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!1,succ:!0}),g.isDualStream=!1,g.highStream&&(g.highStream.isDualStream=!1),0===g.highStreamState?g._unpublishLowStream(function(){g.highStream.lowStream=null,r()},function(t){o.default.warning("[".concat(g.clientId,"]"),t),r(I.default.DISABLE_DUALSTREAM_FAILED)}):1===g.highStreamState?r(I.default.STILL_ON_PUBLISHING):r()},g._getLowStream=function(t,n){g.lowStream?t(g.lowStream):g._createLowStream(function(n){g.lowStream=n,t(g.lowStream)},n)},g._createLowStream=function(t,n){if(g.highStream&&g.highStream.stream){var i=R()({},g.highStream.params);if(i.streamID+=1,i.audio=!1,i.video){if(g.highStream.stream.getVideoTracks()[0]){var r=new f.a(i);r.isLowStream=!0,r.streamId=g.highStream.getId()+1;var o={};g.lowStreamParameter&&(o=R()({},g.lowStreamParameter)),o.width&&o.height||(o.width=160,o.height=120),o.framerate=o.framerate||15,o.bitrate=o.bitrate||50,r.setVideoProfileCustomPlus(o);try{var a=F()(g.highStream,{width:r.videoConstraint.width.ideal,height:r.videoConstraint.height.ideal,framerate:r.videoConstraint.frameRate});return r.stream=a,g.highStream.lowStream=r,g.highStream.userMuteVideo&&r.muteVideo(),t&&t(r)}catch(s){return n&&n(s)}}else n&&n(I.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else n&&n(I.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else n&&n(I.default.HIGH_STREAM_NOT_VIDEO_TRACE)},g._publishLowStream=function(t,n){return 2!==g.lowStreamState?n&&n(I.default.LOW_STREAM_ALREADY_PUBLISHED):g.highStream&&g.highStream.hasScreen()?n&&n(I.default.SHARING_SCREEN_NOT_SUPPORT):void g._getLowStream(function(i){g.lowStreamState=1,g.gatewayClient.publish(i,{streamType:1},function(){g.lowStreamState=0,t&&t()},function(t){1===g.lowStreamState&&(g.lowStreamState=2),o.default.debug("[".concat(g.clientId,"] publish low stream failed")),n&&n(t)})},n)},g._unpublishLowStream=function(t,n){if(0!==g.lowStreamState)return n&&n(I.default.LOW_STREAM_NOT_YET_PUBLISHED);g.lowStream&&(g.gatewayClient.unpublish(g.lowStream,{streamType:1},function(){},function(t){o.default.debug("[".concat(g.clientId,"] unpublish low stream failed")),n&&n(t)}),g.lowStream.close(),g.lowStream=null,g.lowStreamState=2,t&&t())},g.join=function(n,i,r,s,d,l){s&&"function"==typeof s&&(l=d,d=s,s=null);var f=u(),p=Object(c.getBrowserInfo)();o.default.debug(p,",Support: "+f);var _=W(),h="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser",m=G()?window.isSecureContext:"Browser Not Support",v=function(){o.default.warning(h)};G()?window.isSecureContext||v():_||v();var $=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return l&&l(t);d&&d(n)},name:"Client.join",options:arguments,getStates:function(){return{isHttps:_,isSecureContext:m}},tag:"tracer"});if(n&&!Object(M.isValidToken)(n))return o.default.warning("[".concat(g.clientId,"] Param channelKey should be string")),$(I.default.INVALID_PARAMETER);if(!Object(M.isValidChannelName)(i))return o.default.error("Invalid Channel Name ".concat(i)),o.default.warning("[".concat(g.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),$(I.default.INVALID_PARAMETER);if("string"==typeof i&&""===i)return o.default.warning("[".concat(g.clientId,"] Param channel should not be empty")),$(I.default.INVALID_PARAMETER);if(s&&!Object(M.isValidString)(s))return o.default.warning("[".concat(g.clientId,"] optionalInfo should be string")),$(I.default.INVALID_PARAMETER);if(r&&!Object(A.is32Uint)(r)&&!Object(M.isValidString)(r,1,255))return o.default.error("Invalid UID ".concat(r," ").concat(S()(r))),o.default.warning("[".concat(g.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is 32Uint")),$(I.default.INVALID_PARAMETER);if("string"==typeof r&&0==r.length)return o.default.warning("[".concat(g.clientId,"] String uid should not be empty")),$(I.default.INVALID_PARAMETER);if("string"==typeof r&&r.length>256)return o.default.warning("[".concat(g.clientId,"] Length of string uid should be less than 255")),$(I.default.INVALID_PARAMETER);o.default.stopWaitJoin(),g.highStream=null,g.lowStream=null,g.lowStreamParameter=null,g.isDualStream=!1,g.highStreamState=2,g.lowStreamState=2;var E=Date.now(),y=setTimeout(function(){if(1!=g.gatewayClient.hasJoined){o.default.debug("[".concat(g.clientId,"] The time to join the channel is greater than 5 seconds "));var n=Date.now();a.report.joinChannelTimeOut({lts:n,sid:t.sessionId,cname:i,cid:b&&b.cid,uid:b.uid||("string"==typeof r?void 0:r),elapse:n-E,timeout:5})}},5e3),b={clientId:g.clientId,appId:t.appId,sid:t.sessionId,cname:i,uid:r,turnServers:g.turnServers.concat(),proxyServer:g.proxyServer,token:n||t.appId,useProxyServer:g.useProxyServer,useLocalAccessPoint:g.useLocalAccessPoint,proxyServerType:g.proxyServerType,optionalInfo:s};if("string"==typeof r&&(b.stringUid=r,g.uintUid?(b.uid=g.uintUid,delete g.uintUid):b.uid=0),g.aespassword&&"none"!==g.aesmode&&R()(b,{aespassword:g.aespassword,aesmode:g.aesmode}),g.aesSalt&&(b.aes_salt=g.aesSalt),a.report.sessionInit(t.sessionId,{lts:(new Date).getTime(),cname:i,appid:t.appId,mode:t.mode,succ:!0}),g.onSuccess=function(t){clearTimeout(y),g.rtcStatsCollector.startNetworkQualityTimer(),g.onSuccess=null,$(null,t)},g.onFailure=function(t){return $(t)},g.channel=i,g.gatewayClient.state!==T.a.DISCONNECTED)return o.default.error("[".concat(g.clientId,"] Client already in connecting/connected state")),$(I.default.INVALID_OPERATION),void a.report.joinGateway(t.sessionId,{lts:Date.now(),succ:!1,ec:I.default.INVALID_OPERATION,addr:null});g.gatewayClient.state=T.a.CONNECTING;var N=function(r,a){o.default.info("[".concat(g.clientId,"] Joining channel: ").concat(i)),g.gatewayClient.dispatchEvent({type:"config-distribute",config:a,joinInfo:b}),g.key=n||t.appId,b.cid=r.cid,b.uid||(b.uid=r.uid),b.vid=r.vid,b.clientId=g.clientId,b.apResponse=r.res,r.uni_lbs_ip&&r.uni_lbs_ip[1]&&(b.uni_lbs_ip=r.uni_lbs_ip[1]),b.gatewayAddr=r.gateway_addr,g.joinInfo=b,g.gatewayClient.join(b,g.key,function(t){o.default.info("[".concat(g.clientId,"] Join channel ").concat(i," success, join with uid: ").concat(t,".")),g.onSuccess=null,g.rtcStatsCollector.startNetworkQualityTimer(),$(null,t)},function(t){return $(t)})};b.stringUid&&!b.uid?(g.userAccountReq&&!g.userAccountReq.isFinished()&&g.userAccountReq.cancel(),g.userAccountReq=Object(C.getUserAccount)(b,g.gatewayClient),g.userAccountReq.then(function(t){o.default.debug("getUserAccount Success ".concat(t.url," ").concat(b.stringUid," => ").concat(t.uid)),b.uid=t.uid,Object(C.getGatewayList)(b,N,function(t){return $(t)})}).catch(function(t){o.default.error("getUserAccount rejected",t),$(t)})):Object(C.getGatewayList)(b,N,function(t){return $(t)})},g.renewChannelKey=function(n,i,r){var s=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return r&&r(t);i&&i(n)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});Object(M.checkValidString)(n,"key",1,2047),void 0===g.key?(o.default.error("[".concat(g.clientId,"] renewChannelKey should not be called before user join")),s(I.default.INVALID_OPERATION)):(g.key=n,g.gatewayClient.joinInfo.token=n,g.gatewayClient.key=n,g.gatewayClient.recover(),s())},g.leave=function(n,i){g.gatewayClient.isFirstSuccess=!0,g.gatewayClient.hasInvokeLeave=!0;var s=!1,c=a.report.reportApiInvoke(t.sessionId,{callback:function(t,r){if(t)return i&&i(t);g.gatewayClient.reconnectingCS=!1,g.gatewayClient.state=T.a.DISCONNECTED,clearTimeout(Object(C._getReconnectCSTimer)(g.clientId)),g._renewSession(),g.rtcStatsCollector.clearNetworkQualityTimer(),n&&n(r)},name:"Client.leave",options:arguments,tag:"tracer"});o.default.info("[".concat(g.clientId,"] Leaving channel")),g.userAccountReq&&!g.userAccountReq.isFinished()&&(g.userAccountReq.cancel(),g.gatewayClient.state===T.a.CONNECTING&&(g.gatewayClient.state=T.a.DISCONNECTED)),g._terminateLiveStreaming(),g.gatewayClient.leave(function(t){s=!0,c(null,t)},c),setTimeout(function(){s||(g.gatewayClient.socket&&(g.gatewayClient.socket.close(),g.gatewayClient.socket=null),g.gatewayClient.state=T.a.DISCONNECTED,c(null,"LEAVE_MSG_TIMEOUT"))},Object(r.getParameter)("LEAVE_MSG_TIMEOUT"))},g._renewSession=function(){var n=Object(A.generateSessionId)();if(o.default.debug("renewSession ".concat(t.sessionId," => ").concat(n)),t.sessionId=n,g.gatewayClient.peerPublishDurationMap.clear(),g.joinInfo&&(g.joinInfo.sid=n),g.gatewayClient&&(g.gatewayClient.joinInfo&&(g.gatewayClient.joinInfo.sid=n),g.gatewayClient.localStreams))for(var i in g.gatewayClient.localStreams){var r=g.gatewayClient.localStreams[i];r&&(r.sid=n)}},g._publish=function(n,i,a,s){if(2!==g.highStreamState)return o.default.warning("[".concat(g.clientId,"] Can't publish stream when stream already publish ").concat(n.getId())),a&&a(I.default.STREAM_ALREADY_PUBLISHED);if(0===g.turnServers.length&&Object(r.getParameter)("FORCE_TURN")&&!Object(r.getParameter)("TURN_ENABLE_TCP")&&!Object(r.getParameter)("TURN_ENABLE_UDP"))throw Error("force TURN With No TURN Configuration");o.default.info("[".concat(g.clientId,"] Publishing stream, uid ").concat(n.getId())),g.highStream=n,g.highStreamState=1,g.highStream.streamId=g.joinInfo.stringUid||g.joinInfo.uid,g.hasPublished=!1;var c=function(n,i,r){g.gatewayClient.publish(n,{streamType:0},function(){n.sid=t.sessionId,g.highStreamState=0,o.default.info("[".concat(g.clientId,"] Publish success, uid: ").concat(n.getId())),g.highStream&&(g.highStream.isDualStream=g.isDualStream),g.isDualStream?g._publishLowStream(function(){i&&i()},function(t){o.default.warning("[".concat(g.clientId,"] "),t),V.a.replaceWithCanvasTrack(n).then(function(){i&&i()})}):V.a.replaceWithCanvasTrack(n).then(function(){i&&i()})},r)};"audience"!==g.gatewayClient.role||"live"!==g.mode||s?c(n,i,a):g.gatewayClient.setClientRole(H,function(t){if(t)return a&&a(t);c(n,i,a)})},g._unpublish=function(t,n,i,r){if(0!==g.highStreamState)return o.default.warning("[".concat(g.clientId,"] Can't unpublish stream when stream not publish")),i&&i(I.default.STREAM_NOT_YET_PUBLISHED);o.default.info("[".concat(g.clientId,"] Unpublish stream, uid ").concat(t.getId()));var a=function(t,n,i){g.isDualStream&&g.lowStream&&g._unpublishLowStream(null,i),g.gatewayClient.unpublish(t,{streamType:0},function(){g.highStreamState=2,o.default.info("[".concat(g.clientId,"] Unpublish stream success, uid: ").concat(t.getId())),g.gatewayClient.dispatchEvent({type:"stream-unpublished",stream:t}),n&&n()},function(n){o.default.info("[".concat(g.clientId,"] Unpublish stream fail, uid: ").concat(t.getId())),i&&i(n)})};g.gatewayClient.role!==H||"live"!==g.mode||r?a(t,n,i):g.gatewayClient.setClientRole("audience",function(r){if(r)return i&&i(r);a(t,n,i)})},g.publish=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return 1===g.highStreamState&&"REQUEST_ABORT"!==t&&(g.highStreamState=2),i&&i(t)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});2===g.highStreamState?n._hasVideoTracks()||n._hasAudioTracks()?(g.gatewayClient.publishRequestId=Object(A.generateId)(),g._publish(n,function(t){return r(null,t)},function(t){return r(t)})):r(I.default.NO_TRACK_IN_STREAM):r(I.default.STREAM_ALREADY_PUBLISHED)},g.unpublish=function(n,i,r){var o=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return i&&i(t);r&&r(n)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});0===g.highStreamState?(g.gatewayClient.publishRequestId=null,g._unpublish(n,function(t){return o(null,t)},function(t){return o(t)})):o(I.default.STREAM_NOT_YET_PUBLISHED)},g.subscribe=function(n,i,r){var s=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return r&&r(t)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:i,onFailure:!!r}});"function"==typeof i&&(r=i,i=null),Object(M.checkValidObject)(n,"stream"),Object(M.isEmpty)(i)||(Object(M.checkValidObject)(i,"options"),Object(M.isEmpty)(i.video)||Object(M.checkValidBoolean)(i.video,"options.video"),Object(M.isEmpty)(i.audio)||Object(M.checkValidBoolean)(i.audio,"options.audio"));var d={video:!0,audio:!0};if(!Object(M.isEmpty)(i)){if(Object(c.isSafari)()&&(!i.video||!i.audio)){var u="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return o.default.error("[".concat(g.clientId,"] "),u),void s(u)}if(!Object(M.isEmpty)(i.video)&&!Object(M.isValidBoolean)(i.video)||!Object(M.isEmpty)(i.audio)&&!Object(M.isValidBoolean)(i.audio)||!1===i.audio&&!1===i.video)return u="INVALID_PARAMETER ".concat(JSON.stringify(i)),o.default.error("[".concat(g.clientId,"] "),u),void s(u)}n.subscribeOptions?(R()(n.subscribeOptions,d,i),g.gatewayClient.subscribeChange(n,function(t){return s(null,t)},s)):(g.gatewayClient.subscribeRequestId.set(n.getId(),Object(A.generateId)()),n.subscribeOptions=R()({},d,i),g.gatewayClient.subscribe(n,function(t){return s(null,t)},s))},g.unsubscribe=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return i&&i(t)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});o.default.info("[".concat(g.clientId,"] Unsubscribe stream, uid: ").concat(n.getId())),g.gatewayClient.subscribeRequestId.delete(n.getId()),g.gatewayClient.unsubscribe(n,function(t){return r(null,t)},r)},g.setRemoteVideoStreamType=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:i}});Object(M.checkValidEnum)(i,"streamType",[0,1]),g.gatewayClient.setRemoteVideoStreamType(n,i),r()},g.setStreamFallbackOption=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:i}});Object(M.checkValidEnum)(i,"fallbackType",[0,1,2]),g.gatewayClient.setStreamFallbackOption(n,i),r()},g.enableAudioVolumeIndicator=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});n=n||2e3,i=i||3,Object(M.checkValidNumber)(i,"smooth",1,100),Object(M.checkValidNumber)(n,"interval",50,1e5),g.audioVolumeIndication=g.audioVolumeIndication||{enabled:!0},g.audioVolumeIndication.interval=n,g.audioVolumeIndication.smooth=i,g.audioVolumeIndication={interval:n,smooth:i},o.default.info("[".concat(g.clientId,"] enableAudioVolumeIndicator interval ").concat(n," smooth ").concat(i)),g.gatewayClient.enableAudioVolumeIndicator(n,i),r()},g.getNetworkStats=function(t,n){return o.default.deprecate("[".concat(g.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),x.getStats(t,n)},g.getSystemStats=function(t,n){return l.getStats(t,n)},g.getRecordingDevices=function(t,n){return p.a.getRecordingDevices(t,n)},g.getPlayoutDevices=function(t,n){return p.a.getPlayoutDevices(t,n)},g.getCameras=function(t,n){return p.a.getCameras(t,n)},g.getRemoteAudioStats=function(t,n){return g.rtcStatsCollector.getRemoteAudioStats(t,n)},g.getLocalAudioStats=function(t,n){return g.rtcStatsCollector.getLocalAudioStats(t,n)},g.getRemoteVideoStats=function(t,n){return g.rtcStatsCollector.getRemoteVideoStats(t,n)},g.getLocalVideoStats=function(t,n){return g.rtcStatsCollector.getLocalVideoStats(t,n)},g._getRemoteVideoQualityStats=function(t,n){return g.rtcStatsCollector.getRemoteVideoQualityStats(t,n)},g._getRemoteAudioQualityStats=function(t,n){return g.rtcStatsCollector.getRemoteAudioQualityStats(t,n)},g.getTransportStats=function(t,n){return g.rtcStatsCollector.getTransportStats(function(i){return x.getStats(function(n){var r=R()({},i,n);t&&t(r)},n)},n)},g.getSessionStats=function(t,n){return g.rtcStatsCollector.getSessionStats(t,n)},g.onNetworkQuality=function(){return g.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},g.sendMetadata=function(n,i){var r=a.report.reportApiInvoke(t.sessionId,{name:"Client.sendMetadata",tag:"tracer",callback:function(t){if(t)return i&&i(t);i&&i()}});g.gatewayClient.sendMetadata(n,r)},g.sendCustomReportMessage=function(n,i,s,c,d,u){Object(r.getParameter)("CR")?g.customReportCount>Object(r.getParameter)("CRL")?u&&u("REPORT_LIMITED"):(g.gatewayClient.hasJoined||(o.default.WARNING("Should invoke Client.sendCustomReportMessage after join"),u&&u("REPORT_BEFORE_JOINED")),g.customReportTimer||(g.customReportTimer=setInterval(function(){g.customReportCount=0},Object(r.getParameter)("CRI"))),Object(M.checkValidString)(n,"reportId",0,100,!1),Object(M.checkValidString)(i,"category",0,100,!1),Object(M.checkValidString)(s,"event",0,100,!1),Object(M.checkValidString)(c,"label",0,100,!1),Object(M.checkValidNumber)(d,"value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),g.customReportCount++,a.report.sendCustomReportMessage(t.sessionId,{reportId:n,category:i,event:s,label:c,value:d,lts:Date.now()},function(t){t?u&&u("REPORT_FAILED"):u&&u()})):u&&u("REPORT_FORBIDDEN")},g.setLocalAccessPoints=function(n,i){var o=a.report.reportApiInvoke(t.sessionId,{name:"Client.setLocalAccessPoints",tag:"tracer"});if(Object(M.checkValidArray)(n,"serverList"),Object(M.checkValidString)(i,"domain"),g.useProxyServer)throw Error("You have already set the proxy");var s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(function(t){return s.test(t)?"".concat(t.replace(/\./g,"-"),".").concat(i):t}),g.useLocalAccessPoint=!0,Object(r.setParameter)("WEBCS_DOMAIN",n),Object(r.setParameter)("WEBCS_DOMAIN_BACKUP_LIST",n),Object(r.setParameter)("GATEWAY_DOMAINS",[i]),Object(r.setParameter)("EVENT_REPORT_DOMAIN",n[Math.floor(Math.random()*n.length)]),Object(r.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",n[Math.floor(Math.random()*n.length)]),Object(r.setParameter)("LOG_UPLOAD_SERVER","".concat(n[Math.floor(Math.random()*n.length)],":6444")),o()},t.clientId=g.clientId,g.gatewayClient=Object(T.a)(t),g.listenerLoggerTimer=null,g.listenerLoggerCache=[],g.on=function(t,n){g.gatewayClient.on(t,n),g.listenerLoggerCache.push("".concat(t).concat(n.name?":"+n.name:"")),g.listenerLoggerTimer?clearTimeout(g.listenerLoggerTimer):o.default.info("[".concat(g.clientId,"] Adding event handler on ").concat(t)),g.listenerLoggerTimer=setTimeout(function(){g.listenerLoggerCache.length&&(g.listenerLoggerTimer=null,o.default.info("[".concat(g.clientId,"] Added event handler on ").concat(g.listenerLoggerCache.join(", "))),g.listenerLoggerCache=[])},0)},g.off=function(t,n){o.default.info("remove event handler from [".concat(t,"]")),g.gatewayClient.removeEventListener(t,n)},g.rtcStatsCollector=(n=g.gatewayClient,(i=Object(s.b)()).gatewayClient=n,i.exceptionMonitor=new L(n),i.localStats={},i.remoteStats={},i.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},i.getRemoteAudioStats=function(t){var n=i.gatewayClient.traffic_stats,r={};for(var o in i.remoteStats){var a={},s=i.remoteStats[o];if(Object(b.b)(a,"End2EndDelay",s.peer_delay&&s.peer_delay.audio_delay),Object(b.b)(a,"TransportDelay",s.peer_delay&&s.peer_delay.e2e_delay),Object(b.b)(a,"PacketLossRate",s.peer_delay&&s.peer_delay.e2e_audio_lost_ratio_400ms),Object(b.b)(a,"RecvLevel",s.audioStats&&s.audioStats.audioOutputLevel),Object(b.b)(a,"RecvBitrate",s.audioRecvBitrate),Object(b.b)(a,"CodecType",s.audioStats&&s.audioStats.googCodecName),Object(b.b)(a,"MuteState",s.audioDisabled),Object(b.b)(a,"TotalFreezeTime",s.audioStats&&s.audioStats.audioTotalFreezeTime),Object(b.b)(a,"TotalPlayDuration",s.audioStats&&s.audioStats.audioTotalPlayDuration),n&&n.peer_delay){var c=n.peer_delay.find(function(t){return t.peer_uid==o});if(c){var d=c.peer_publish_audio_duration+(Date.now()-n.timestamp);Object(b.b)(a,"AudioPublishDuration",d)}else Object(b.b)(a,"AudioPublishDuration",-1)}r[o]=a}t&&t(r)},i.getLocalAudioStats=function(t){var n={};for(var r in i.localStats){var o={},a=i.localStats[r];Object(b.b)(o,"RecordingLevel",a.audioStats&&a.audioStats.audioInputLevel),Object(b.b)(o,"SendLevel",a.audioStats&&a.audioStats.totalAudioEnergy),Object(b.b)(o,"SamplingRate",a.audioStats&&a.audioStats.totalSamplesDuration),Object(b.b)(o,"SendBitrate",a.audioSendBitrate),Object(b.b)(o,"CodecType",a.audioStats&&a.audioStats.googCodecName),Object(b.b)(o,"MuteState",a.audioDisabled),Object(b.b)(o,"audioSendPacketsLost",a.audioStats&&a.audioStats.packetsLost);var s=i.gatewayClient.localStreams[r];s&&s.isPlaying()&&Object(b.b)(o,"MuteState",s.userMuteAudio?"1":"0"),n[r]=o}t&&t(n)},i.getRemoteVideoStats=function(t){var n=i.gatewayClient.traffic_stats,r={};for(var o in i.remoteStats){var a={},s=i.remoteStats[o];if(Object(b.b)(a,"End2EndDelay",s.peer_delay&&s.peer_delay.video_delay),Object(b.b)(a,"TransportDelay",s.peer_delay&&s.peer_delay.e2e_delay),Object(b.b)(a,"PacketLossRate",s.peer_delay&&s.peer_delay.e2e_video_lost_ratio_400ms),Object(b.b)(a,"RecvBitrate",s.videoRecvBitrate),Object(b.b)(a,"RecvResolutionWidth",s.videoStats&&s.videoStats.googFrameWidthReceived),Object(b.b)(a,"RecvResolutionHeight",s.videoStats&&s.videoStats.googFrameHeightReceived),Object(b.b)(a,"RenderResolutionWidth",s.videoStats&&s.videoStats.renderRemoteWidth),Object(b.b)(a,"RenderResolutionHeight",s.videoStats&&s.videoStats.renderRemoteHeight),Object(b.b)(a,"RenderFrameRate",s.videoStats&&s.videoStats.googFrameRateOutput),Object(b.b)(a,"MuteState",s.videoDisabled),Object(b.b)(a,"TotalFreezeTime",s.videoStats&&s.videoStats.videoTotalFreezeTime),Object(b.b)(a,"TotalPlayDuration",s.videoStats&&s.videoStats.videoTotalPlayDuration),n&&n.peer_delay){var c=n.peer_delay.find(function(t){return t.peer_uid==o});if(c){var d=c.peer_publish_video_duration+(Date.now()-n.timestamp);Object(b.b)(a,"VideoPublishDuration",d)}else Object(b.b)(a,"VideoPublishDuration",-1)}r[o]=a}t&&t(r)},i.getLocalVideoStats=function(t){var n={};for(var r in i.localStats){var o={},a=i.localStats[r];Object(b.b)(o,"TargetSendBitrate",a.videoTargetSendBitrate),Object(b.b)(o,"SendFrameRate",a.videoStats&&a.videoStats.googFrameRateSent),Object(b.b)(o,"SendBitrate",a.videoSendBitrate),Object(b.b)(o,"SendResolutionWidth",a.videoStats&&a.videoStats.googFrameWidthSent),Object(b.b)(o,"SendResolutionHeight",a.videoStats&&a.videoStats.googFrameHeightSent),Object(b.b)(o,"CaptureResolutionWidth",a.videoStats&&a.videoStats.googFrameWidthInput),Object(b.b)(o,"CaptureResolutionHeight",a.videoStats&&a.videoStats.googFrameHeightInput),Object(b.b)(o,"EncodeDelay",a.videoStats&&a.videoStats.googAvgEncodeMs),Object(b.b)(o,"MuteState",a.videoDisabled),Object(b.b)(o,"TotalFreezeTime",a.videoStats&&a.videoStats.videoTotalFreezeTime),Object(b.b)(o,"TotalDuration",a.videoStats&&a.videoStats.videoTotalPlayDuration),Object(b.b)(o,"CaptureFrameRate",a.videoStats&&a.videoStats.googFrameRateSent),Object(b.b)(o,"videoSendPacketsLost",a.videoStats&&a.videoStats.packetsLost),a.videoStats&&!a.videoStats.googFrameWidthInput&&Object(b.b)(o,"CaptureResolutionWidth",a.videoStats&&a.videoStats.renderLocalWidth),a.videoStats&&!a.videoStats.googFrameHeightInput&&Object(b.b)(o,"CaptureResolutionHeight",a.videoStats&&a.videoStats.renderLocalHeight),n[r]=o}t&&t(n)},i.getRemoteVideoQualityStats=function(t){var n={};for(var r in i.remoteStats){var o={},a=i.remoteStats[r];Object(b.b)(o,"videoReceiveDelay",a.videoStats&&a.videoStats.googCurrentDelayMs),Object(b.b)(o,"VideoFreezeRate",a.videoStats&&a.videoStats.videoFreezeRate),Object(b.b)(o,"FirstFrameTime",a.firstFrameTime),n[r]=o}t&&t(n)},i.getRemoteAudioQualityStats=function(t){var n={};for(var r in i.remoteStats){var o={},a=i.remoteStats[r];Object(b.b)(o,"audioReceiveDelay",a.audioStats&&a.audioStats.googCurrentDelayMs),Object(b.b)(o,"AudioFreezeRate",a.videoStats&&a.videoStats.videoFreezeRate),n[r]=o}t&&t(n)},i.getTransportStats=function(t){var n={},r={},o=i.gatewayClient.traffic_stats,a=o.peer_delay;if(Object(b.b)(n,"OutgoingAvailableBandwidth",i.gatewayClient.OutgoingAvailableBandwidth/1e3),Object(b.b)(n,"RTT",o&&2*o.access_delay),a){var s,c=k(a);try{for(c.s();!(s=c.n()).done;){var d=s.value;d.downlink_estimate_bandwidth&&(r[d.peer_uid]=d.downlink_estimate_bandwidth/1e3+"")}}catch(u){c.e(u)}finally{c.f()}}n.IncomingAvailableBandwidth=r,t&&t(n)},i.getSessionStats=function(t){var n,r={},o=i.gatewayClient.traffic_stats,a=i.gatewayClient.socket,s=0,c=0;for(var d in i.remoteStats)(n=i.remoteStats[d])&&n.videoStats&&n.videoStats.videoRecvBytesDelta&&(c+=parseInt(n.videoStats.videoRecvBytesDelta)),n&&n.audioStats&&n.audioStats.audioRecvBytesDelta&&(c+=parseInt(n.audioStats.audioRecvBytesDelta));for(var d in i.localStats)(n=i.localStats[d])&&n.videoStats&&n.videoStats.videoSendBytesDelta&&(s+=parseInt(n.videoStats.videoSendBytesDelta)),n&&n.audioStats&&n.audioStats.audioSendBytesDelta&&(s+=parseInt(n.audioStats.audioSendBytesDelta));var u=s+i.session.WSSendBytesDelta+i.session.HTTPSendBytesDelta,l=c+i.session.WSRecvBytesDelta+i.session.HTTPRecvBytesDelta,f=i.session.sendBytes+Object(N.getHTTPSendBytes)(),p=i.session.recvBytes+Object(N.getHTTPRecvBytes)();i.gatewayClient.socket&&i.gatewayClient.socket.state===i.gatewayClient.CONNECTED&&(f+=a.getSendBytes(),p+=a.getRecvBytes());var _=1;o.peer_delay&&(_=o.peer_delay.length,_+=1),a?Object(b.b)(r,"Duration",a.getDuration()):Object(b.b)(r,"Duration",0),Object(b.b)(r,"UserCount",_),Object(b.b)(r,"SendBytes",f),Object(b.b)(r,"RecvBytes",p),Object(b.b)(r,"SendBitrate",8*u/1e3),Object(b.b)(r,"RecvBitrate",8*l/1e3),t&&t(r)},i.isLocalVideoFreeze=function(t,n){var i=0,r=0;if(!t||!n)return!1;if(Object(c.isChrome)()||Object(c.isOpera)())i=t.googFrameRateInput,r=t.googFrameRateSent;else if(Object(c.isSafari)())i=parseInt(t.framerateMean),r=parseInt(t.framesEncoded)-parseInt(n.framesEncoded);else{if(!Object(c.isFireFox)())return!1;i=parseInt(t.framerateMean),r=parseInt(t.framesEncoded)-parseInt(n.framesEncoded)}return i>5&&r<3},i.isRemoteVideoFreeze=function(t,n){var i=0,r=0;if(!t||!n)return!1;if(Object(c.isChrome)()||Object(c.isOpera)())i=t.googFrameRateReceived,r=t.googFrameRateDecoded;else if(Object(c.isSafari)())i=t.framerateMean,r=parseInt(t.framesDecoded)-parseInt(n.framesDecoded);else{if(!Object(c.isFireFox)())return!1;i=parseInt(t.framesReceived)-parseInt(n.framesReceived),r=parseInt(t.framesDecoded)-parseInt(n.framesDecoded)}return i>5&&i<10&&r<3||i>10&&i<20&&r<4||i>20&&r<5},i.isAudioFreeze=function(t){if(Object(c.isChrome)()&&t){if(t.googDecodingPLC&&t.googDecodingPLCCNG&&t.googDecodingCTN)return(parseInt(t.googDecodingPLC)+parseInt(t.googDecodingPLCCNG))/parseInt(t.googDecodingCTN)>.2}else if((Object(c.isSafari)()||Object(c.isFireFox)())&&t.packetsLost&&t.packetsReceived)return parseInt(t.packetsLost)/(parseInt(t.packetsLost)+parseInt(t.packetsReceived))>.2;return!1},i.isAudioDecodeFailed=function(t){return!!((Object(c.isChrome)()||Object(c.isOpera)())&&t&&parseInt(t.bytesReceived)>0&&0===parseInt(t.googDecodingNormal))},i.startNetworkQualityTimer=function(){i.clearNetworkQualityTimer(),i.networkQualityTimer=setInterval(function(){if(i.gatewayClient.state===T.a.CONNECTED&&navigator.onLine){var t=i.gatewayClient.traffic_stats;i.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:i.networkQualityTrans(t.uplink_network_quality),downlinkNetworkQuality:i.networkQualityTrans(t.downlink_network_quality)})}else i.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3)},i.clearNetworkQualityTimer=function(){i.networkQualityTimer&&clearInterval(i.networkQualityTimer)},i.networkQualityTrans=function(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0},i.getStatsTimer=setInterval(function(){var t=i.gatewayClient.traffic_stats,n=Date.now();i.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(i.localStats).length&&i.exceptionMonitor.setLocalStats(i.localStats),Object.keys(i.remoteStats).length&&i.exceptionMonitor.setRemoteStats(i.remoteStats);var r={};Object.keys(i.gatewayClient.remoteStreams).forEach(function(o){var a=i.gatewayClient.remoteStreams[o],s=i.remoteStats[o],c={id:o,updatedAt:n};r[o]=c,c.firstFrameTime=a.firstFrameTime,s?(c.audioTotalPlayDuration=s.audioTotalPlayDuration+1,c.audioTotalFreezeTime=s.audioTotalFreezeTime,c.isAudioFreeze=!1,c.isAudioDecodeFailed=!1,c.videoTotalPlayDuration=s.videoTotalPlayDuration+1,c.videoTotalFreezeTime=s.videoTotalFreezeTime,c.isVideoFreeze=!1):(c.audioTotalPlayDuration=1,c.audioTotalFreezeTime=0,c.videoTotalPlayDuration=1,c.videoTotalFreezeTime=0);var d=t&&t.peer_delay&&t.peer_delay.find(function(t){return t.peer_uid==o});d&&(c.peer_delay=d),a&&(a.isPlaying()&&(c.audioDisabled=a.userMuteAudio||a.peerMuteAudio?"1":"0",c.videoDisabled=a.userMuteVideo||a.peerMuteVideo?"1":"0"),s&&s.peer_delay&&d&&s.peer_delay.stream_type!==d.stream_type&&i.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:o,streamType:d.stream_type}),a.pc&&"established"==a.pc.state&&a.pc.getStats(function(t){if(c.pcStats=t,c.audioStats=t.find(function(t){return"audio"==t.mediaType&&(t.id.indexOf("_recv")>-1||t.id.toLowerCase().indexOf("inbound")>-1)}),c.videoStats=t.find(function(t){return"video"==t.mediaType&&(t.id.indexOf("_recv")>-1||t.id.toLowerCase().indexOf("inbound")>-1)}),s&&s.audioStats&&c.audioStats){var n=parseInt(c.audioStats.bytesReceived)-parseInt(s.audioStats.bytesReceived),r=parseInt(c.audioStats.googDecodingNormal)-parseInt(s.audioStats.googDecodingNormal);if(c.audioStats.audioRecvBytesDelta=n,c.audioStats.audioDecodingNormalDelta=r,i.session.recvBytes+=n,isFinite(n)&&c.audioStats.timestamp){var o=c.audioStats.timestamp.getTime()-s.audioStats.timestamp.getTime();c.audioRecvBitrate=Math.floor(8*n/o)}i.isAudioFreeze(c.audioStats)&&c.audioTotalPlayDuration>10&&(c.audioTotalFreezeTime++,c.isAudioFreeze=!0),i.isAudioDecodeFailed(c.audioStats)&&c.audioTotalPlayDuration>10&&(c.isAudioDecodeFailed=!0),c.audioStats.audioTotalFreezeTime=c.audioTotalFreezeTime,c.audioStats.audioTotalPlayDuration=c.audioTotalPlayDuration,c.audioStats.audioFreezeRate=Math.ceil(100*c.audioTotalFreezeTime/c.audioTotalPlayDuration)}if(s&&s.videoStats&&c.videoStats){var d=parseInt(c.videoStats.bytesReceived)-parseInt(s.videoStats.bytesReceived);c.videoStats.videoRecvBytesDelta=d,i.session.recvBytes+=d,isFinite(d)&&c.videoStats.timestamp&&(o=c.videoStats.timestamp.getTime()-s.videoStats.timestamp.getTime(),c.videoRecvBitrate=Math.floor(8*d/o)),i.isRemoteVideoFreeze(c.videoStats,s.videoStats)&&(c.videoTotalFreezeTime++,c.isVideoFreeze=!0),c.videoStats.videoTotalFreezeTime=c.videoTotalFreezeTime,c.videoStats.videoTotalPlayDuration=c.videoTotalPlayDuration,c.videoStats.videoFreezeRate=Math.ceil(100*c.videoTotalFreezeTime/c.videoTotalPlayDuration),a.player&&a.player.video&&a.player.video.videoWidth&&a.player.video.videoHeight?(c.videoStats.renderRemoteWidth=a.player.video.videoWidth,c.videoStats.renderRemoteHeight=a.player.video.videoHeight):(c.videoStats.renderRemoteWidth=a.videoWidth||c.videoStats.googFrameWidthReceived,c.videoStats.renderRemoteHeight=a.videoHeight||c.videoStats.googFrameHeightReceived)}}))}),i.remoteStats=r;var o={};if(Object.keys(i.gatewayClient.localStreams).forEach(function(t){var r=i.gatewayClient.localStreams[t],a=i.localStats[t],s={id:t,updatedAt:n};o[t]=s,a?(s.videoTotalPlayDuration=a.videoTotalPlayDuration+1,s.videoTotalFreezeTime=a.videoTotalFreezeTime,s.isVideoFreeze=!1):(s.videoTotalPlayDuration=1,s.videoTotalFreezeTime=0),r&&(r.isPlaying()&&(s.audioDisabled=r.userMuteAudio?"1":"0",s.videoDisabled=r.userMuteVideo?"1":"0"),r.video&&r.attributes.maxVideoBW?s.videoTargetSendBitrate=r.attributes.maxVideoBW:r.video&&r.screenAttributes&&(s.videoTargetSendBitrate=r.screenAttributes.maxVideoBW),r.pc&&"established"==r.pc.state&&r.pc.getStats(function(t){if(s.pcStats=t.reverse(),s.audioStats=t.find(function(t){return"audio"==t.mediaType&&(t.id.indexOf("_send")>-1||t.id.toLowerCase().indexOf("outbound")>-1)}),s.videoStats=t.find(function(t){return"video"==t.mediaType&&(t.id.indexOf("_send")>-1||t.id.toLowerCase().indexOf("outbound")>-1)}),s.audioStats&&a&&a.audioStats){var n=parseInt(s.audioStats.bytesSent)-parseInt(a.audioStats.bytesSent);if(s.audioStats.audioSendBytesDelta=n,i.session.sendBytes+=n,isFinite(n)&&s.audioStats.timestamp){var o=s.audioStats.timestamp.getTime()-a.audioStats.timestamp.getTime();s.audioSendBitrate=Math.floor(8*n/o)}}if(s.videoStats&&a&&a.videoStats){var c=parseInt(s.videoStats.bytesSent)-parseInt(a.videoStats.bytesSent);s.videoStats.videoSendBytesDelta=c,i.session.sendBytes+=c,isFinite(c)&&s.videoStats.timestamp&&(o=s.videoStats.timestamp.getTime()-a.videoStats.timestamp.getTime(),s.videoSendBitrate=Math.floor(8*c/o)),i.isLocalVideoFreeze(s.videoStats,a.videoStats)&&(s.videoTotalFreezeTime++,s.isVideoFreeze=!0),s.videoStats.videoTotalFreezeTime=s.videoTotalFreezeTime,s.videoStats.videoTotalPlayDuration=s.videoTotalPlayDuration,s.videoStats.videoFreezeRate=Math.ceil(100*s.videoTotalFreezeTime/s.videoTotalPlayDuration),s.videoStats.renderLocalWidth=r.videoWidth||s.videoStats.googFrameWidthSent,s.videoStats.renderLocalHeight=r.videoHeight||s.videoStats.googFrameHeightSent}}))}),i.localStats=o,i.session.HTTPSendBytesDelta=Object(N.getHTTPSendBytes)()-i.session.HTTPSendBytes,i.session.HTTPSendBytes=Object(N.getHTTPSendBytes)(),i.session.HTTPRecvBytesDelta=Object(N.getHTTPRecvBytes)()-i.session.HTTPRecvBytes,i.session.HTTPRecvBytes=Object(N.getHTTPRecvBytes)(),i.gatewayClient.socket&&i.gatewayClient.socket.state===i.gatewayClient.CONNECTED){var a=i.gatewayClient.socket;i.session.WSSendBytesDelta=a.getSendBytes()-i.session.WSSendBytes,i.session.WSSendBytes=a.getSendBytes(),i.session.WSRecvBytesDelta=a.getRecvBytes()-i.session.WSRecvBytes,i.session.WSRecvBytes=a.getRecvBytes()}},1e3),i.gatewayClient.on("join",function(){i.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}}),i),g.configDistributManager=(d=g,(_={}).client=d,_.client.gatewayClient&&_.client.gatewayClient.on("config-distribute",function(t){var n=t.joinInfo,i=t.config;if(i){Object(M.isEmpty)(i.uploadLog)||(Object(r.setParameter)("UPLOAD_LOG",i.uploadLog),a.report.reportApiInvoke(n.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:i.uploadLog}})()),Object(M.isEmpty)(i.dualStream)||(d.isDualStream=i.dualStream,a.report.reportApiInvoke(n.sid,{name:"_configDistribute",options:{feature:"dualStream",value:i.dualStream}})()),Object(M.isEmpty)(i.streamFallbackOption)||_.client.gatewayClient&&_.client.gatewayClient.on("stream-subscribed",function(t){var r=t.stream;r?(_.client.gatewayClient.setStreamFallbackOption(r,i.streamFallbackOption),a.report.reportApiInvoke(n.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:i.streamFallbackOption,streamId:r.getId()}})()):a.report.reportApiInvoke(n.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:i.streamFallbackOption,streamId:r.getId(),err:"invalid stream"}})()});try{o.default.debug("[".concat(d.clientId,"] setParameter in distribution: ").concat(JSON.stringify(i))),Object.keys(i).map(function(t){return Object(r.setParameter)(t,i[t])})}catch(s){o.default.debug("[".concat(d.clientId,"] setParameter in distribution failed: ").concat(JSON.stringify(i)))}}}),_),Object(U.addLiveStreamingCapability)(g,t),t.areaCode){var m=t,v=m.areaCode,E=m.excludedArea,y=Object(j.getAreaCodeByConfig)({areaCode:v,excludedArea:E});Object(r.setParameter)("AREA_SETTING",y);var O=Object(j.getAreaDomainConfig)(y);Object.keys(O).map(function(t){var n=O[t];"LOG_UPLOAD_SERVER"==t||"EVENT_REPORT_DOMAIN"==t||"EVENT_REPORT_BACKUP_DOMAIN"==t||"NGINX"==t?Object(r.setParameter)(t,n[0]):Object(r.setParameter)(t,n)})}return Object(M.isEmpty)(t.turnServer)||g.setTurnServer(t.turnServer),Object(M.isEmpty)(t.proxyServer)||g.setProxyServer(t.proxyServer),"live"===g.mode&&(g.gatewayClient.role="audience"),"rtc"===g.mode&&(g.gatewayClient.role=H),g.gatewayClient.on("onMultiIP",function(t){g.gatewayClient.closeGateway(),g.gatewayClient.socket=void 0,g.gatewayClient.hasChangeBGPAddress=!0,g.joinInfo.multiIP=t.option,g.gatewayClient.state=T.a.CONNECTING;var n=function(t){o.default.info("[".concat(g.clientId,"] Joining channel: ").concat(g.channel)),g.joinInfo.cid=t.cid,g.joinInfo.uid||(g.joinInfo.uid=t.uid),g.joinInfo.uni_lbs_ip=t.uni_lbs_ip,g.joinInfo.gatewayAddr=t.gateway_addr,g.onSuccess?g.gatewayClient.join(g.joinInfo,g.key,function(t){o.default.info("[".concat(g.clientId,"] Join channel ").concat(g.channel," success"));var n=g.onSuccess;g.onSuccess=null,g.onFailure=null,n(t)},g.onFailure):(g.gatewayClient.joinInfo=R()({},g.joinInfo),g.gatewayClient.rejoin())};g.joinInfo.stringUid&&!g.joinInfo.uid?(g.userAccountReq&&!g.userAccountReq.isFinished()&&g.userAccountReq.cancel(),g.userAccountReq=Object(C.getUserAccount)(joinInfo,g.gatewayClient),g.userAccountReq.then(function(t){o.default.error("getUserAccount Success ".concat(t.url," ").concat(joinInfo.stringUid," => ").concat(t.uid)),g.joinInfo.uid=t.uid,Object(C.getGatewayList)(g.joinInfo,n,g.onFailure)}).catch(function(t){o.default.error("getUserAccount rejected",t),g.onFailure(t)})):Object(C.getGatewayList)(g.joinInfo,n,g.onFailure)}),g.gatewayClient.on("rejoin-start",function(){g._renewSession(),a.report.sessionInit(t.sessionId,{lts:(new Date).getTime(),extend:{rejoin:!0},cname:g.channel,appid:t.appId,mode:t.mode,succ:!0})}),g.gatewayClient.on("recover",function(){g._renewSession(),o.default.debug("[".concat(g.clientId,"]"),"recover",t.sessionId),a.report.sessionInit(t.sessionId,{lts:(new Date).getTime(),extend:{recover:!0},cname:g.channel,appid:t.appId,mode:t.mode,succ:!0})}),g.gatewayClient.on("rejoin",function(){var t=g.highStreamState;if(o.default.debug("[".concat(g.clientId,"] Client local stream preState: ").concat(t)),g.onSuccess){var n=g.onSuccess;g.onSuccess=null,g.onFailure=null,n(g.joinInfo.uid)}g.highStream&&(0===t||1===t)&&(o.default.info("[".concat(g.clientId,"] publish after rejoin")),g.highStreamState=2,g.lowStreamState=2,g.publish(g.highStream,function(t){t&&o.default.info("[".concat(g.clientId,"] "),t)}))}),g.gatewayClient.on("streamPublished",function(t){g.hasPublished||(g.hasPublished=!0,g.gatewayClient.dispatchEvent({type:"stream-published",stream:t.stream,proxy:t.proxy}))}),g.gatewayClient.on("pubP2PLost",function(t){o.default.debug("[".concat(g.clientId,"] Start reconnect local peerConnection: ").concat(g.highStream.getId())),g.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:g.highStream.getId()}),1===g.highStreamState&&(g.highStreamState=0,g.lowStreamState=0),g._unpublish(g.highStream,function(){g._publish(g.highStream,function(){o.default.debug("[".concat(g.clientId,"] Reconnect local peerConnection success: ").concat(g.highStream.getId())),g.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:g.highStream.getId(),success:!0,reason:""})},function(t){o.default.debug("[".concat(g.clientId,"] Reconnect local peerConnection failed: ").concat(t)),g.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:g.highStream.getId(),success:!1,reason:t})},!0)},function(t){o.default.debug("[".concat(g.clientId,"] Reconnect local peerConnection failed: ").concat(t)),g.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:g.highStream.getId(),success:!1,reason:t})},!0)}),g.gatewayClient.on("subP2PLost",function(t){o.default.debug("[".concat(g.clientId,"] Start reconnect remote peerConnection: ").concat(t.stream.getId()," ").concat(t.stream.subscribeOptions)),g.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:t.stream.getId()});var n=t.stream.subscribeOptions;o.default.debug("[".concat(g.clientId,"]"),"Re-subscribe stream",JSON.stringify(n)),g.gatewayClient.unsubscribe(t.stream,function(){t.stream.subscribeOptions=n,g.gatewayClient.subscribe(t.stream,function(){o.default.debug("[".concat(g.clientId,"] Reconnect remote peerConnection success: ").concat(t.stream.getId())),g.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.stream.getId(),success:!0,reason:""})},function(n){o.default.debug("[".concat(g.clientId,"] Reconnect remote peerConnection failed: "),n),g.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.stream.getId(),success:!1,reason:n})})},function(n){o.default.debug("[".concat(g.clientId,"] Reconnect remote peerConnection failed: "),n),g.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.stream.getId(),success:!1,reason:n})})}),x.on("networkTypeChanged",function(t){g.gatewayClient&&g.gatewayClient.dispatchEvent(t);var n=R()({},t,{type:"network-type-changed"});g.gatewayClient.dispatchEvent(n)}),p.a.on("recordingDeviceChanged",function(t){g.gatewayClient&&g.gatewayClient.dispatchEvent(t);var n=R()({},t,{type:"recording-device-changed"});g.gatewayClient.dispatchEvent(n)}),p.a.on("playoutDeviceChanged",function(t){g.gatewayClient&&g.gatewayClient.dispatchEvent(t);var n=R()({},t,{type:"playout-device-changed"});g.gatewayClient.dispatchEvent(n)}),p.a.on("cameraChanged",function(t){g.gatewayClient&&g.gatewayClient.dispatchEvent(t);var n=R()({},t,{type:"camera-changed"});g.gatewayClient.dispatchEvent(n)}),g.gatewayClient.on("streamTypeChange",function(n){var i=R()({},n,{type:"stream-type-changed"});g.gatewayClient.dispatchEvent(i),a.report.reportApiInvoke(t.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(n))}),g},Y={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},z=function(t){return"h264_interop"===t?"h264":"vp8"},K=function(t){return -1===m.indexOf(t.mode)?I.default.INVALID_CLIENT_MODE:-1===v.indexOf(t.codec)?I.default.INVALID_CLIENT_CODEC:"h264_interop"==t.mode&&"h264"!==t.codec&&I.default.CLIENT_MODE_CODEC_MISMATCH},J=function(t){switch(t.mode){case"interop":case"h264_interop":t.mode="live";break;case"web-only":t.mode="rtc"}},X=p.a.getDevices,Q=_.a.getScreenSources,Z=JSON.parse(JSON.stringify(r.SUPPORT_RESOLUTION_LIST));n.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:Y,createClient:function(t){var n=a.report.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(t=R()({},t||{})).codec||(t.codec=z(t.mode));var i=K(t);if(i)throw o.default.error("Invalid parameter setting MODE: ".concat(t.mode," CODEC: ").concat(t.codec," ERROR ").concat(i)),n(i),Error(i);return o.default.info("Creating client, MODE: ".concat(t.mode," CODEC: ").concat(t.codec)),J(t),n(null,t),q(t)},createStream:f.b,Logger:o.default,report:a.report,getDevices:X,getScreenSources:Q,getParameter:r.getParameter,setParameter:r.setParameter,checkSystemRequirements:u,getSupportedCodec:g.getSupportedCodec,ChannelMediaRelayConfiguration:h.ChannelMediaRelayConfiguration,VERSION:r.VERSION,BUILD:r.BUILD,PROFILE_TABLE:Z,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2,AREAS:j.AREAS,AREA_VERSION:"global"}}]).default});
